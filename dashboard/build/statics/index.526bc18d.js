var ad=Object.defineProperty;var od=(t,n,r)=>n in t?ad(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var oe=(t,n,r)=>(od(t,typeof n!="symbol"?n+"":n,r),r);import{i as Ni,B as ld,a as cd,b as dd,j as Bl,d as Ue,U as lo,z as ud,r as hd,f as pd,Q as md,e as gd,m as rr,u as co,c as d,t as fd,$ as bd,g as yr,h as Fe,k as e,l as P,I as yd,n as s,S as we,T as u,L as xd,o as ue,H as Sd,p as vd,q as wd,C as kd,s as _d,v as Cd,w as _a,x as Vl,y as Kl,A as Ad,G as $l,D as je,E as fs,V as pe,F as O,J as kt,K as Wt,M as $n,N as Do,O as Dd,P as $i,R as Id,W as Pd,X as Za,Y as Vs,Z as Cn,_ as uo,a0 as ho,a1 as Ed,a2 as cr,a3 as sr,a4 as Ui,a5 as Io,a6 as zr,a7 as xa,a8 as qn,a9 as qe,aa as V,ab as Oi,ac as Wi,ad as Gt,ae as Dt,af as Xt,ag as Tt,ah as Qt,ai as It,aj as _,ak as D,al as Ce,am as Ve,an as br,ao as Bt,ap as ns,aq as zd,ar as ql,as as Jl,at as Yl,au as Br,av as xt,aw as ei,ax as ti,ay as ri,az as qi,aA as si,aB as Gl,aC as nn,aD as Td,aE as Md,aF as Nd,aG as Ld,aH as Ar,aI as Ca,aJ as Aa,aK as _t,aL as gs,aM as fr,aN as Tr,aO as Mr,aP as Xl,aQ as Ql,aR as Zl,aS as Rd,aT as Ks,aU as hs,aV as Lt,aW as Xe,aX as as,aY as Le,aZ as zt,a_ as lr,a$ as Ud,b0 as Od,b1 as Wd,b2 as Fd,b3 as Hd,b4 as Bd,b5 as Vd,b6 as Kd,b7 as $d,b8 as qd,b9 as Jd,ba as pa,bb as Yd,bc as Gd,bd as Xd,be as Qd,bf as ni,bg as Ps,bh as ye,bi as Es,bj as Da,bk as Vr,bl as Jn,bm as ln,bn as Fi,bo as is,bp as dn,bq as un,br as hr,bs as hn,bt as pr,bu as Zd,bv as jd,bw as cn,bx as jl,by as eu,bz as tu,bA as Yn,bB as Gn,bC as ec,bD as tc,bE as rc,bF as ru,bG as ps,bH as jr,bI as Bn,bJ as an,bK as pt,bL as su,bM as at,bN as Hs,bO as Bs,bP as Yr,bQ as nu,bR as Ia,bS as en,bT as iu,bU as An,bV as Jr,bW as po,bX as sc,bY as Sa,bZ as Li,b_ as ma,b$ as au,c0 as ou,c1 as nc,c2 as Ji,c3 as mo,c4 as Pa,c5 as lu,c6 as ic,c7 as Fn,c8 as ur,c9 as At,ca as ga,cb as $s,cc as cu,cd as du,ce as va,cf as ac,cg as oc,ch as uu,ci as hu,cj as lc,ck as pu,cl as mu,cm as gu,cn as fu,co as vr,cp as Ea,cq as cc,cr as Zs,cs as bu,ct as Vn,cu as yu,cv as dc,cw as uc,cx as xu,cy as za,cz as Ys,cA as Su,cB as vu,cC as wu,cD as ku,cE as _u,cF as Cu,cG as Au,cH as Du,cI as ja,cJ as hc,cK as pc,cL as mc,cM as zn,cN as gc,cO as Iu,cP as Pu,cQ as Eu,cR as fc,cS as bc,cT as zu,cU as yc,cV as xc,cW as Tu,cX as Sc,cY as go,cZ as Mu,c_ as Nu,c$ as vc,d0 as wc,d1 as Lu,d2 as Ru,d3 as Uu,d4 as Ou,d5 as Zi,d6 as Tn,d7 as Po,d8 as Xs,d9 as Wu,da as Fu,db as Hu,dc as Bu,dd as Vu,de as Ku,df as $u,dg as qu,dh as Ju,di as Yu}from"./vendor.2a8f6379.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();Ni.use(ld).use(cd).use(dd).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Bl(["/","statics/locales/{{lng}}.json"])}},(t,n)=>{t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Ni.language),Ue.locale(Ni.language)});Ni.on("languageChanged",t=>{if(console.log("Language changed to:",t),Ue.locale(t),typeof document<"u"){const n=document.documentElement;n.setAttribute("lang",t),t==="fa"?n.setAttribute("dir","rtl"):n.setAttribute("dir","ltr")}});if(typeof window<"u"){const t=Ni.language||"en",n=document.documentElement;n.setAttribute("lang",t),t==="fa"?n.setAttribute("dir","rtl"):n.setAttribute("dir","ltr")}lo("zh-cn",ud);lo("ru",hd);lo("fa",pd);const Ii=new md,Pi=(t,n)=>{const r=document.querySelector('meta[name="theme-color"]'),o={dark:"#0f172a",light:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:n||"#f6f8ff"},a=n||o[t]||o.light;r==null||r.setAttribute("content",a)},Gu=gd({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:'Arad,Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol",sans-serif'},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:rr("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:rr("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:rr("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:rr("surface.light","surface.dark")(t),borderColor:rr("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:rr("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t),boxShadow:rr("lg","dark-lg")(t)},item:{_hover:{bg:rr("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:rr("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:rr("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t),boxShadow:rr("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:rr("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:rr("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:rr("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:rr("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:rr("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:rr("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:rr("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const fa=fd,Xu="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/",kc={base:Xu,folder:"72x72",ext:".png",className:"twemoji-emoji",size:"72x72"},Ra=t=>{var n,r;return typeof t=="string"&&((r=(n=fa.test)==null?void 0:n.call(fa,t))!=null?r:!1)},Qu=t=>t.some(n=>{var r;return n.type==="characterData"?Ra((r=n.target)==null?void 0:r.data):n.type==="childList"?Array.from(n.addedNodes).some(o=>{if(o.nodeType===Node.TEXT_NODE)return Ra(o.textContent);if(o.nodeType===Node.ELEMENT_NODE){const a=o;return a.tagName==="IMG"&&a.classList.contains(kc.className)?!1:Ra(a.textContent)}return!1}):!1}),Zu=()=>{co(),d.exports.useEffect(()=>{const t=document.getElementById("root");if(!t)return;const n=()=>{fa.parse(t,kc)};n();const r=new MutationObserver(o=>{Qu(o)&&requestAnimationFrame(n)});return r.observe(t,{childList:!0,subtree:!0,characterData:!0}),()=>r.disconnect()},[])},_c=t=>d.exports.createElement("svg",{id:"Flag_of_Iran_1964","data-name":"Flag of Iran 1964",viewBox:"0 0 1050.01 600.01",width:16,height:12,xmlSpace:"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg",...t},d.exports.createElement("defs",{id:"defs1"},d.exports.createElement("style",{id:"style1"},`\r
      .cls-1 {\r
        fill: #fff;\r
      }\r
\r
      .cls-2 {\r
        fill: #ffbb26;\r
      }\r
\r
      .cls-3 {\r
        fill: #da0000;\r
      }\r
\r
      .cls-4 {\r
        fill: #239f40;\r
      }\r
    `)),d.exports.createElement("rect",{className:"cls-4",width:1050.01,height:600.01,id:"rect1"}),d.exports.createElement("rect",{className:"cls-1",y:200,width:1050.01,height:400,id:"rect2"}),d.exports.createElement("rect",{className:"cls-3",y:400,width:1050.01,height:200,id:"rect3"}),d.exports.createElement("g",{fill:"#ffbb26",stroke:"#000000",strokeWidth:1.65117,id:"g33",transform:"matrix(1.0296008,0,0,1.029544,380.77232,173.64161)"},d.exports.createElement("path",{d:"m 161.07119,117.31343 1.58064,-86.247538 -7.64012,-0.0299 1.47133,86.277388 z",id:"path1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 168.96801,51.483322 -12.4375,65.363288 4.49219,0.93359 14.79101,-65.103518 c -2.24519,-0.49426 -4.52848,-0.89372 -6.8457,-1.19336 z",id:"path2",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 160.88092,118.22819 35.84067,-78.463898 -6.99455,-3.07387 -33.05373,79.708248 z",id:"path3-0",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 195.21801,59.766532 -38.31445,56.222648 3.74609,2.64844 40.62305,-55.300778 c -1.94971,-1.27745 -3.96981,-2.46958 -6.05469,-3.57031 z",id:"path4-9",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 160.34167,118.99121 64.15545,-57.664678 -5.18872,-5.60799 -62.09584,59.917108 z",id:"path5-4",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 214.97919,79.172522 -57.39204,36.179948 2.38086,3.92187 58.61313,-34.113348 z",id:"path6-8",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 159.54289,119.47592 84.16991,-28.081338 -2.55101,-7.29428 -83.15045,31.050638 z",id:"path7-8",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 230.23559,104.02434 -71.76758,11.01563 0.61914,4.54687 72.28516,-8.49219 c -0.24149,-2.39738 -0.62261,-4.75582 -1.13672,-7.07031 z",id:"path8-2",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 148.66527,51.450122 c -2.3185,0.29258 -4.60376,0.68603 -6.8496,1.17383 l 14.71484,65.156248 4.49219,-0.93359 -12.35547,-65.396488 z",id:"path9-4",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 160.88092,116.39867 -32.94158,-79.724458 -7.01836,3.01912 35.75233,78.534858 z",id:"path10-5",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 122.38207,59.678642 c -2.08713,1.09806 -4.11106,2.28678 -6.0625,3.5625 l 40.58399,55.396478 3.74609,-2.64844 z",id:"path11-5",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 160.34167,115.63565 -39.58897,-38.297348 -1.80196,7.17399 38.26182,34.478918 z",id:"path12-1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 158.73183,84.465842 c -19.75592,0 -36.01168,14.5997 -36.01168,32.804528 0,18.20485 16.24074,32.89065 36.01168,32.89065 19.77084,0 36.10225,-14.67088 36.10225,-32.89065 0,-18.219778 -16.34644,-32.804528 -36.10225,-32.804528 z",id:"path13-7",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"M 27.075712,114.49219 H 40.900391 C 39.957753,86.354592 45.101834,74.447442 49.610141,66.720468 63.625887,42.698305 91.338082,36.173328 108.70899,35.263672 91.645726,26.687202 55.386276,29.102931 36.730609,62.059781 27.106233,77.910032 27.024792,96.516572 27.075712,114.49219 Z",id:"path14-1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"M 27.075712,114.49219 H 40.900391 V 144.0075 H 27.060537 Z",id:"path15-1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 72.746094,39.181641 c -20.498052,4.610867 -31.990409,24.915825 -35.734375,37.453121 -2.613943,8.75324 -4.292704,17.91971 -3.964384,37.857428 H 35.03757 C 34.735349,102.09919 34.96683,88.884772 38.947266,76.695312 43.856882,61.660381 53.983888,47.109784 72.746094,39.181641 Z",id:"path16-5",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 14.668501,111.52396 h 9.216825 l 9.972557,-2.86003 9.972557,2.86003 h 9.216825 l 4.424345,2.96787 -4.424345,2.96787 H 43.83044 l -9.972557,2.86003 -9.972557,-2.86003 h -9.216825 l -4.424345,-2.96787 z",id:"path17-2",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"M 32.343798,219.03718 H 252.02746 V 206.62206 H 32.343798 Z",id:"path18-7",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 37.107422,206.62109 c 0.388163,2.31921 0.833147,5.73857 4.076172,6.20899 -0.832765,-0.96407 -1.563563,-3.91899 -1.820312,-6.20899 z m 6.652344,0 c 0.388162,2.31921 0.833146,5.73857 4.076172,6.20899 -0.832766,-0.96407 -1.563488,-3.91899 -1.820313,-6.20899 z m 6.652344,0 c 0.388099,2.31921 0.835099,5.73857 4.078125,6.20899 -0.832766,-0.96407 -1.565441,-3.91899 -1.822266,-6.20899 z m 6.654297,0 c 0.388099,2.31921 0.833146,5.73857 4.076171,6.20899 -0.832766,-0.96407 -1.56544,-3.91899 -1.822265,-6.20899 z m 6.652343,0 c 0.3881,2.31921 0.833243,5.73857 4.076172,6.20899 -0.83267,-0.96407 -1.565441,-3.91899 -1.822265,-6.20899 z m 6.652344,0 c 0.388179,2.31921 0.833243,5.73857 4.076172,6.20899 -0.83267,-0.96407 -1.565441,-3.91899 -1.822266,-6.20899 z m 6.652344,0 c 0.388178,2.31921 0.833243,5.73857 4.076172,6.20899 -0.83267,-0.96407 -1.563488,-3.91899 -1.820313,-6.20899 z m 6.652344,0 c 0.388177,2.31921 0.833242,5.73857 4.076171,6.20899 -0.83267,-0.96407 -1.563488,-3.91899 -1.820312,-6.20899 z m 6.652343,0 c 0.388163,2.31921 0.833146,5.73857 4.076172,6.20899 -0.83267,-0.96407 -1.56355,-3.91899 -1.82031,-6.20899 z m 6.652342,0 c 0.38816,2.31921 0.83315,5.73857 4.076173,6.20899 -0.83267,-0.96407 -1.563543,-3.91899 -1.820313,-6.20899 z m 6.654303,0 c 0.38816,2.31921 0.83314,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.5655,-3.91899 -1.82226,-6.20899 z m 6.65234,0 c 0.38816,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83276,-0.96407 -1.56544,-3.91899 -1.82226,-6.20899 z m 6.65235,0 c 0.38816,2.31921 0.83314,5.73857 4.07617,6.20899 -0.83277,-0.96407 -1.56544,-3.91899 -1.82227,-6.20899 z m 6.65234,0 c 0.3881,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83277,-0.96407 -1.56544,-3.91899 -1.82226,-6.20899 z m 6.65234,0 c 0.3881,2.31921 0.83315,5.73857 4.07618,6.20899 -0.83276,-0.96407 -1.56349,-3.91899 -1.82032,-6.20899 z m 6.65235,0 c 0.3881,2.31921 0.83314,5.73857 4.07617,6.20899 -0.83277,-0.96407 -1.56349,-3.91899 -1.82031,-6.20899 z m 6.65234,0 c 0.3881,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83276,-0.96407 -1.56349,-3.91899 -1.82031,-6.20899 z m 6.65235,0 c 0.38816,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.56349,-3.91899 -1.82032,-6.20899 z m 6.65429,0 c 0.38818,2.31921 0.83325,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.56544,-3.91899 -1.82226,-6.20899 z m 6.65235,0 c 0.38816,2.31921 0.83314,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.5655,-3.91899 -1.82227,-6.20899 z m 6.65234,0 c 0.38816,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.5655,-3.91899 -1.82226,-6.20899 z m 6.65234,0 c 0.38817,2.31921 0.83314,5.73857 4.07618,6.20899 -0.83277,-0.96407 -1.56544,-3.91899 -1.82227,-6.20899 z m 6.65235,0 c 0.38817,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83277,-0.96407 -1.56349,-3.91899 -1.82031,-6.20899 z m 6.65234,0 c 0.3881,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83276,-0.96407 -1.56348,-3.91899 -1.82031,-6.20899 z m 6.65234,0 c 0.38811,2.31921 0.83315,5.73857 4.07618,6.20899 -0.83277,-0.96407 -1.56349,-3.91899 -1.82032,-6.20899 z m 6.65235,0 c 0.38809,2.31921 0.8351,5.73857 4.07812,6.20899 -0.83276,-0.96407 -1.56543,-3.91899 -1.82226,-6.20899 z m 6.6543,0 c 0.3881,2.31921 0.83314,5.73857 4.07617,6.20899 -0.83277,-0.96407 -1.56545,-3.91899 -1.82227,-6.20899 z m 6.65234,0 c 0.3881,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83276,-0.96407 -1.56544,-3.91899 -1.82226,-6.20899 z m 6.65234,0 c 0.38817,2.31921 0.83305,5.73857 4.07617,6.20899 -0.83276,-0.96407 -1.56543,-3.91899 -1.82226,-6.20899 z m 6.65235,0 c 0.38816,2.31921 0.83315,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.56349,-3.91899 -1.82031,-6.20899 z m 6.65234,0 c 0.38816,2.31921 0.83314,5.73857 4.07617,6.20899 -0.83267,-0.96407 -1.56348,-3.91899 -1.82031,-6.20899 z m 6.65234,0 c 0.38817,2.31921 0.83315,5.73857 4.07618,6.20899 -0.83276,-0.96407 -1.56351,-3.91899 -1.82032,-6.20899 z",id:"path19-6",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 30.556278,143.68829 c 9.865186,6.63648 13.339988,7.25321 25.813537,3.49824 16.375049,22.06009 20.30138,17.64424 28.483312,25.24312 l 0.743617,-41.17964 c 0,0 -22.584658,-2.04529 -33.280271,-5.24736 -3.474431,-1.04018 -6.232241,-2.8356 -9.813421,-3.49823 -8.373187,-1.54929 -17.861044,-0.0301 -17.861044,4.84797 0,1.66591 1.066163,3.21805 4.420923,3.62477 z",id:"path20-1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 39.943043,140.77299 c 1.215805,0.47464 2.346687,2.9152 2.346687,2.9152 0,0 -1.853994,2.03295 -3.200028,2.72085 -2.766131,1.41366 -8.98953,1.64404 -12.373445,-0.38869 -0.904249,-0.54319 -1.280011,-1.44685 -1.280011,-2.4336 0,-1.02916 0.853341,-2.23062 0.853341,-2.23062",id:"path21-4",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 40.796384,135.52563 c 1.215805,0.47464 2.346687,2.9152 2.346687,2.9152 0,0 -1.857828,2.19286 -3.200028,2.72085 -3.947786,1.55295 -10.056206,2.03274 -13.440121,0 -0.904249,-0.54318 -1.280011,-1.55196 -1.280011,-2.53871 0,-1.20051 1.279997,-2.90299 1.279997,-2.90299",id:"path22-2",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 24.642008,127.35239 c 0,1.66591 1.066163,3.21805 4.420923,3.62477 5.665446,0.68687 9.194245,-1.86068 11.733439,-0.89323 0.92492,0.3524 1.652713,1.44282 2.346688,2.9152 0,0 -1.867716,2.16838 -3.200027,2.72085 -3.638423,1.50876 -10.056208,2.03274 -13.440123,0 -0.904249,-0.54319 -1.280011,-1.57786 -1.280011,-2.5646 0,-1.33488 0.784107,-1.97969 1.323343,-2.91368",id:"path23-3",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 167.84027,174.82438 c -4.2949,7.16015 1.66439,13.55871 -1.57379,19.03509 -10.45177,-2.37014 -20.85295,-3.4249 -27.47427,6.24368 -3.24923,4.74459 0.69257,9.28431 6.34141,6.91581 5.05165,4.64537 11.00266,1.67186 18.2917,-0.86962 2.85948,-0.99705 7.63105,1.87221 11.40131,0.41568 4.29684,-1.65995 7.2076,-6.55236 9.93173,-14.40161 l 4.23343,1.7759 c 0.0454,-3.35625 -1.44763,-5.91528 -3.39841,-8.23693 l 5.05208,1.69887 c 0.0311,-3.33852 -1.67741,-5.70863 -3.26524,-7.62426 l 4.86368,1.79654 c -0.97359,-4.3696 -0.0328,-8.06502 -0.46459,-9.53036 -0.93459,-3.17126 -1.42201,-1.59577 -2.65431,-7.49521 -14.63949,-6.41396 -11.48358,-21.52627 -8.796,-27.92442 l -27.87392,19.222 c -5.63175,3.66706 2.1027,16.85215 15.38519,18.97884 z",id:"path24-2",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 242.02372,63.406339 c -3.35003,-3.42548 -6.1273,-7.202482 -9.48838,-9.804733 -17.23914,-13.347057 -37.90979,5.703333 -25.41489,24.283326 5.25458,7.81359 21.79638,13.14764 28.00097,17.79274 16.89159,12.646038 12.04575,26.986838 -4.91202,27.316528 -9.41574,0.18301 -18.29832,-7.77438 -27.38793,-9.10936 -17.01876,-2.49949 -21.85387,4.11892 -37.66679,4.30555 -31.32216,0.36966 -44.10598,-9.09862 -44.10598,-9.09862 l -33.957862,39.3142 c -10.374154,3.87234 -10.919021,18.14233 0,25.83358 -7.839157,4.69715 -7.227631,10.3098 -12.841207,17.79105 -11.346262,-2.62085 -20.859627,-3.01022 -27.465914,6.2553 -3.128175,4.82526 0.682581,9.2737 6.331428,6.9052 5.051645,4.64536 10.991845,1.7291 18.280885,-0.81238 2.900743,-1.01145 7.794555,1.90616 11.414406,0.40619 4.199502,-1.74017 6.098203,-6.21277 9.095854,-9.34233 1.413757,-1.47595 4.191227,-4.46807 4.191227,-4.46807 l 2.76443,3.49322 c 1.861263,-2.89674 1.951203,-5.79569 1.515973,-8.69243 l 3.47783,3.73693 c 1.83926,-2.88775 1.69758,-5.77575 1.24845,-8.12377 l 3.29948,3.73693 c 0,0 0.54504,-1.62693 1.87267,-3.8994 0.86042,-1.47271 2.53614,-3.43996 2.8536,-4.54931 0.54818,-1.91542 0.7134,-4.38684 0.7134,-4.38684 1.90433,1.65845 3.35102,2.52172 5.79638,2.19342 0.34874,-3.46933 0.60214,-4.52022 1.51598,-5.93035 11.8082,-0.0855 40.91742,-4.01208 59.39058,-22.50284 0.66552,-0.66614 9.40501,-2.79468 14.53553,3.33075 2.56062,6.52231 8.6011,22.0889 25.23654,25.42739 -4.2949,7.16015 1.63303,13.61447 -1.60515,19.09085 -11.82253,-2.64967 -21.46876,-2.44441 -27.46591,6.17407 -3.28456,4.7202 0.68258,9.35494 6.33142,6.98644 5.05165,4.64536 10.99185,1.64786 18.28089,-0.89362 2.8762,-1.0029 7.65013,1.86041 11.4144,0.40619 4.29684,-1.65995 7.26348,-6.52982 9.98761,-14.37907 l 4.19123,1.70599 c 0.0454,-3.35624 -1.43788,-5.88335 -3.38865,-8.205 l 5.08297,1.70599 c 0.0311,-3.33852 -1.86597,-5.95219 -3.29947,-7.63634 l 4.90462,1.78723 c -1.04393,-4.15552 -0.0944,-8.00931 -0.53505,-9.50481 -0.92456,-3.13733 -1.54725,-1.86283 -2.58607,-7.47387 -18.61039,-8.82308 -3.92139,-22.14879 -17.74584,-33.99798 14.11913,0.42994 26.66261,-2.42126 28.59104,-17.74036 0.84012,-22.515088 -33.54428,-28.547878 -40.54064,-38.435368 -8.76355,-12.384885 4.54245,-26.511167 16.67574,-16.978674 7.2212,6.879494 14.3468,18.330504 25.32571,12.510602 11.95581,-6.337753 -0.84244,-17.788789 16.23731,-19.501435 -1.86703,-3.573859 -10.43916,-7.184842 -14.08136,0.289362 -4.37223,-5.944284 -12.72894,-3.056928 -14.29309,2.604181 22.84087,-0.521346 10.24192,20.327654 0.22365,10.083751 z",id:"path25-2",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 74.110418,132.71459 -2.52227,6.47918 c -2.016013,7.32769 -0.908644,13.78251 1.849676,18.99498 1.681541,-0.72973 3.363055,-2.30853 5.044568,-3.82963 0.830113,2.53071 0.458459,6.12922 3.363055,9.03791 3.294426,-1.68503 5.339659,-3.9828 6.557919,-5.66784 0.561303,3.46153 2.008535,6.0875 4.919521,7.96564 2.91099,-1.87814 4.35822,-4.50413 4.91953,-7.96566 1.21825,1.68503 3.263493,4.59558 6.557913,6.28062 2.9046,-2.9087 2.86924,-4.669 3.78345,-7.55997 1.47052,3.00983 3.34759,4.5417 6.64202,6.22673 2.90459,-2.9087 2.53294,-6.5072 3.36305,-9.03791 1.39279,2.04716 3.15628,3.47655 5.04457,3.82963 1.44195,-1.87886 2.49185,-4.88877 2.47904,-7.60975 2.70798,1.93489 5.22911,2.5126 6.93879,2.6411 0.68178,-3.54368 0.5361,-6.28299 -0.02,-9.43774 2.55275,0.80034 3.04437,1.52958 6.18444,1.53504 2.10002,-7.02304 -0.39725,-14.62309 -7.70121,-20.00786 z",id:"path26-1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 69.219202,111.09378 c 0,0 -6.503415,10.40315 -7.802774,15.77144 -0.840814,3.47377 -0.731521,8.88532 -0.731521,8.88532 2.113263,-0.12088 4.226498,-0.54638 6.339761,-2.44345 0.218586,2.96179 -0.105012,5.92354 1.950694,8.88533 2.113263,-0.74258 4.714178,-1.71969 6.827441,-5.3312 0.163226,3.68331 0.911897,5.85582 3.169866,9.3296 2.768593,-0.80518 4.941211,-3.80692 7.071282,-5.77547 0.04537,2.68625 0.780802,5.68685 3.413706,9.55173 3.45708,-1.88765 5.46639,-6.25441 6.26854,-8.73259 0.87739,2.34133 2.81148,6.84494 6.268563,8.73259 2.6329,-3.86488 3.36833,-6.86548 3.4137,-9.55173 2.13008,1.96855 4.30269,4.97029 7.07129,5.77547 2.25797,-3.47378 3.00664,-5.64629 3.16986,-9.3296 2.11327,3.61151 4.71418,4.58862 6.82744,5.3312 2.05571,-2.96179 1.73211,-5.92354 1.9507,-8.88533 2.11326,1.89707 5.00733,3.54197 7.12059,3.66285 0.42045,-0.38303 2.07288,-5.57449 1.27627,-8.68209 2.48518,1.96411 4.60865,3.27309 8.27713,3.17836 0.60066,-2.86955 0.0862,-5.7392 -0.52917,-8.33946 3.98754,1.37127 8.30715,1.74444 11.39029,0.26709 -7.19444,-12.1751 -18.5679,-14.1639 -31.05805,-16.26314 z",id:"path27-6",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{d:"m 117.68297,57.734823 c -0.49966,-1.262291 -0.24512,-4.019588 -0.24512,-4.019588 -7.94365,1.832908 -8.45862,3.466636 -11.5437,7.286382 0.51972,-3.101147 0.17635,-4.46464 -2.4513,-6.476007 -1.10409,1.375243 -2.35879,4.458401 -3.676953,5.659237 -0.44916,-2.804376 -1.05518,-5.210181 -3.59637,-7.00799 -2.21722,1.944218 -3.4885,4.120842 -3.59636,7.00799 -1.318169,-1.200836 -2.572869,-4.283994 -3.676956,-5.659237 -2.627653,2.011367 -2.971027,3.37486 -2.451301,6.476007 -3.884256,-4.817491 -5.676509,-6.140822 -11.543702,-7.286382 0,0 0.07077,2.708893 -0.245125,4.019588 -0.731749,3.035403 -4.315587,6.963823 -1.20305,11.752608 -8.93006,5.660951 -6.987157,13.246761 -11.920264,21.437851 2.221158,-0.21082 2.703474,0.45348 6.143148,-0.0341 -4.74026,3.67514 -5.07182,4.42045 -6.474194,9.869248 1.721721,-0.62495 3.181281,-0.12453 6.531637,-0.978108 -1.138473,2.430508 -3.590259,4.206398 -4.95642,5.357948 -3.376325,2.84589 -4.76289,5.69989 -5.598681,8.98948 2.212597,0.026 4.425223,-0.68406 6.63782,-1.25108 -0.75863,2.62482 -1.133365,4.55513 -0.228859,8.34068 3.319766,-1.21558 4.964496,-2.49747 7.095594,-3.75331 -0.272519,2.43268 -0.420164,5.28242 0.457775,7.71511 2.212597,-0.59079 4.425194,-1.91201 6.637791,-4.17034 -0.05165,3.17479 0.903907,5.43203 2.060015,7.50659 2.032392,-1.1602 4.080621,-2.30886 5.722241,-3.75328 0.661322,2.25513 0.818099,4.20382 3.204452,7.50659 3.645362,-1.48084 4.388809,-3.62257 5.722239,-5.62994 0.50637,1.85344 1.40923,3.88748 4.07469,6.72435 3.486193,-2.29613 3.310093,-4.59226 4.291623,-6.88838 0.79338,1.64755 2.48106,4.5596 5.10908,5.77136 1.98517,-2.0479 2.29416,-4.8405 2.86105,-6.51605 1.78972,2.03097 3.86986,3.79738 6.74395,4.8405 1.49588,-2.72969 1.54471,-5.01997 1.43059,-7.26075 2.52048,2.64606 5.04095,3.39204 7.56142,4.0958 0.62882,-2.48228 0.45515,-4.96459 0,-7.44688 2.6567,1.90182 5.31343,2.81223 7.97014,2.23405 0.13497,-2.73827 -0.74468,-4.78886 -1.63492,-7.07454 2.6734,0.46476 5.22475,0.7072 7.35707,0.18613 0,0 -1.45468,-3.2571 -3.26982,-4.84046 -2.33747,-2.039 -5.49927,-3.53149 -7.83009,-5.57683 -1.34838,-1.18324 -4.38299,-4.13811 -4.38299,-4.13811 2.24936,0.0234 3.19915,-0.1123 5.81713,0.24046 -1.40238,-5.448788 -1.81227,-7.380768 -6.55253,-11.055908 3.57939,0.55333 4.03077,0.0676 6.25193,0.27834 -4.93311,-8.1911 -4.03143,-16.48834 -11.39963,-20.726421 2.30597,-5.57046 0.79713,-6.700977 -1.20305,-11.752608 z",id:"path28-8",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 133.03125,143.06188 -0.40304,3.65817 c -0.0572,-3.42696 -1.78233,-6.48133 -2.55016,-8.42972 1.23363,1.83735 3.60993,4.20932 6.3848,5.12773 z m -2.88545,7.96739 -4.03334,-1.17075 -1.3359,3.33037 c 0.82075,-3.25341 0.0148,-9.32168 -0.11895,-11.20657 0.66654,2.04802 1.99531,7.63884 5.48819,9.04695 z m -9.04294,4.21185 -2.51401,-1.60248 -1.49239,3.08447 c 0.54309,-2.51223 -0.2549,-10.23386 -0.38859,-12.11875 0.66655,2.04802 2.58108,8.93716 4.39499,10.63676 z m -9.44175,4.08005 -3.07733,-2.87135 -1.98002,3.58106 c 1.24628,-3.2523 1.07965,-9.84686 0.94596,-11.73176 0.66655,2.04802 1.84061,8.67296 4.11139,11.02205 z m -10.32805,0.94187 -3.090643,-2.53387 -2.02877,3.67942 c 1.24399,-2.6173 1.13413,-10.09229 1.00044,-11.97718 0.66655,2.04802 1.42285,7.65857 4.118973,10.83163 z m -16.088152,-0.23789 3.158458,-2.29596 1.824679,3.23975 c -1.369652,-3.33777 -1.146635,-7.50731 -1.012944,-9.39221 -0.666544,2.04802 -1.496618,5.92938 -3.970193,8.44842 z m -9.578154,-4.30195 2.815638,-1.36408 1.502996,3.08247 c -0.776553,-3.64011 -0.669288,-7.71786 -0.535597,-9.60275 -0.666544,2.04802 -1.522851,5.78342 -3.783037,7.88436 z",id:"path29-5",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 140.57257,123.12675 -0.1905,3.50077 c -0.33153,-4.12032 -2.63893,-7.51451 -3.71203,-9.13068 1.34012,1.61111 4.39986,5.36979 9.56306,5.9684 z m -3.92756,6.66821 -3.8204,-1.50711 -0.75333,3.75491 c 0.31558,-3.94886 -1.66835,-7.15009 -2.63994,-8.8187 1.53098,1.61797 4.32027,5.15256 7.21367,6.5709 z m -8.41273,5.1878 -3.80453,-1.67567 -1.05071,3.89446 c 0.38305,-3.50164 -0.47511,-7.34972 -1.11746,-9.14563 1.20297,1.8336 2.90663,5.15696 5.9727,6.92684 z m -9.45105,4.36153 -3.13162,-2.48307 -1.41024,3.87177 c 0.95926,-3.44892 0.14761,-8.22254 -0.24878,-10.07653 0.94773,1.95386 2.0045,6.09081 4.79064,8.68783 z m -20.729153,5.03157 -2.32588,-3.14137 -2.37451,3.32999 c 1.52278,-2.74686 2.25754,-8.58541 2.34888,-10.47241 0.41899,2.10173 0.93148,7.56138 2.35151,10.28379 z m 10.683333,-1.78716 -3.32695,-2.17335 -1.48902,3.91482 c 0.92847,-3.16591 0.15781,-8.81427 -0.23857,-10.66826 0.94773,1.95387 2.45266,6.57607 5.05454,8.92679 z m -26.100625,0.0926 3.409166,-2.26596 1.474274,3.86269 c -0.926087,-3.24453 -0.153472,-8.05753 0.153934,-10.11521 -0.947738,1.95387 -3.070115,6.86423 -5.037374,8.51848 z m -9.78068,-3.48839 2.948698,-2.3317 1.435062,3.95127 c -0.998795,-3.30965 0.361052,-9.4226 0.757446,-11.27659 -0.947739,1.95386 -3.264453,8.12627 -5.141206,9.65702 z m -8.514696,-5.10155 2.685259,-0.78428 1.017867,3.29831 c -0.24034,-2.9858 1.217616,-7.62116 1.8522,-9.41934 -1.195031,1.8379 -3.773745,6.22525 -5.555326,6.90531 z",id:"path30-7",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 114.64579,58.150915 c -4.06791,2.900542 -6.45378,3.374735 -6.59896,9.09862 4.0471,-1.782092 5.56589,-1.43128 6.95566,2.76208 3.29557,-5.840538 -0.79084,-6.164451 -0.3567,-11.8607 z M 75.854639,74.154732 c -3.404757,2.0793 -4.039344,7.1089 1.426801,9.17986 -4.166379,3.56224 -3.443902,11.54989 0.3567,15.43516 -1.568168,2.099338 -4.546158,6.740408 -5.834958,9.384988 2.587959,-2.1048 5.286039,-5.86739 7.261759,-8.166428 0.877454,0.632958 1.873361,1.121498 2.942777,1.543518 -1.100349,2.08603 -3.297337,7.59883 -4.102053,10.5609 2.339554,-2.70801 4.409129,-7.46859 5.974729,-9.911 0.76973,0.20355 1.588999,0.29625 2.407726,0.40619 -0.609701,1.74956 -0.389089,3.59039 0.624225,5.11797 -1.106712,1.97724 -3.420869,7.71743 -4.280402,10.72338 2.211027,-2.49589 4.156499,-6.71455 5.707203,-9.2611 0.893034,0.71588 1.981541,1.26045 3.299477,1.62475 -0.497783,2.54439 -1.064251,7.86927 -1.070101,10.72338 1.45528,-2.92126 2.230005,-7.49833 3.031955,-10.31719 0.89239,0.17821 1.77767,0.16762 2.67525,0.0814 0.55913,2.87727 0.94149,7.37064 2.1402,10.31719 0.21202,-2.78535 0.10558,-7.92628 -0.17835,-10.5609 1.00495,-0.20979 1.882923,-0.5657 2.675253,-0.97485 1.26189,2.6517 2.68356,7.30039 4.6371,10.07347 -0.50352,-3.11087 -2.08564,-9.20981 -2.94277,-11.2108 1.61598,-1.22989 2.05602,-3.17415 1.96185,-5.11798 2.65456,2.16553 6.99925,6.01799 9.89843,7.71758 -1.72067,-2.41976 -6.4621,-7.16947 -8.64998,-9.17985 2.24963,-0.47958 4.34406,-1.27584 5.97473,-2.518368 2.52172,2.095098 7.96848,6.995328 11.1039,8.833428 -1.82351,-2.5644 -7.82423,-8.2838 -9.76628,-10.133228 3.55325,-3.85133 4.33879,-11.63656 0.17835,-15.19145 5.46618,-2.071 4.83154,-7.1006 1.4268,-9.17986 0.62694,1.78669 1.09045,3.20789 0.53505,5.28045 -0.96715,2.71978 -3.98384,2.76991 -6.4206,3.08703 1.85788,1.09675 3.66286,2.29977 4.72628,4.22436 2.57993,9.12476 -5.95679,15.396088 -13.911313,14.297828 -3.21418,-0.44377 -3.30339,-1.176158 -3.29948,-3.818168 0.60014,-0.0621 1.34773,-0.21758 2.05103,-0.56866 0.63844,-0.31884 0.89503,-0.6577 1.15927,-0.97485 0.26425,-0.31728 0.479703,-0.54527 0.535063,-0.56867 0.83716,-0.36056 2.1402,-0.24358 2.1402,-0.24358 l 1.0701,0.24358 0.089,-1.05609 c 0.0716,-0.91625 0.29249,-1.50246 -0.44588,-2.99984 -0.59877,-1.21425 -1.51086,-1.94596 -2.1402,-2.35589 -0.31466,-0.20485 -0.49752,-0.29882 -0.62422,-0.40619 -0.1267,-0.10736 -0.15552,-0.15467 -0.17835,-0.24358 -0.821383,-3.03988 -1.075613,-5.67294 -0.267393,-8.21096 0.483663,-1.51908 2.137553,-2.80344 4.280413,-3.08703 2.30828,-0.30548 5.12161,0.33964 6.4206,0.56866 -3.6779,-4.19171 -11.177963,-2.6323 -12.662863,2.03095 -0.92442,2.90313 -0.57928,5.97116 0.26739,9.10457 0.21974,0.81357 0.75086,1.23028 1.60515,1.78723 0.548173,0.35705 1.088563,0.67673 1.515973,1.54351 0.36698,0.74404 0.22373,0.7195 0.17835,1.37509 -0.64166,-0.0481 -1.03494,-0.51891 -2.051023,-0.0811 -0.67477,0.29061 -1.04605,0.78729 -1.33763,1.13733 -0.29149,0.35004 -0.55174,0.62144 -0.44587,0.56866 -0.27766,0.13856 -0.86753,0.27634 -1.33763,0.32495 -0.25568,0.0264 -1.52694,0.0265 -1.7835,0 -0.4701,-0.0486 -1.06003,-0.18639 -1.33763,-0.32495 0.10587,0.0528 -0.15438,-0.21862 -0.44587,-0.56866 -0.291583,-0.35004 -0.662865,-0.84672 -1.337627,-1.13733 -1.016082,-0.43767 -1.409365,0.033 -2.051026,0.0811 -0.04537,-0.65559 -0.188623,-0.63105 0.17835,-1.37509 0.427412,-0.86678 0.967799,-1.18646 1.515976,-1.54351 0.854,-0.55677 1.385167,-0.97332 1.605147,-1.78723 0.84681,-3.13341 1.19195,-6.20144 0.26739,-9.10457 -1.484889,-4.66323 -8.984925,-6.22268 -12.662861,-2.03095 1.298988,-0.22902 4.112325,-0.87414 6.420604,-0.56866 2.142855,0.28359 3.796745,1.56795 4.280402,3.08703 0.808083,2.53802 0.553855,5.17108 -0.267383,8.21096 -0.02283,0.0892 -0.05165,0.13648 -0.17835,0.24358 -0.1267,0.10737 -0.309558,0.20121 -0.624225,0.40619 -0.629333,0.40993 -1.54143,1.14164 -2.140201,2.35589 -0.73837,1.49738 -0.517387,2.08359 -0.445875,2.99984 l 0.08903,1.05609 1.070101,-0.24358 c 0,0 1.30304,-0.11672 2.140201,0.24358 0.05536,0.0234 0.270806,0.25139 0.53505,0.56867 0.264243,0.31715 0.520839,0.65601 1.159276,0.97485 0.703301,0.35121 1.450891,0.50651 2.051031,0.56866 0.19347,2.798688 -0.29829,3.325628 -3.299482,3.818168 -7.614798,1.24977 -16.533598,-5.023478 -13.911307,-14.297828 0.989073,-1.97554 2.927981,-3.08471 4.726277,-4.22436 -2.534705,-0.27567 -5.300655,-0.43665 -6.420603,-3.08703 -0.555397,-2.07256 -0.09189,-3.49376 0.53505,-5.28045 z m 7.223179,5.36169 c 0.368001,2.07233 2.768878,4.81816 6.866479,2.59961 -1.699766,-4.13455 -4.547586,-3.63682 -6.866479,-2.59961 z m 17.567492,2.59961 c 4.0976,2.21855 6.49847,-0.52728 6.86647,-2.59961 -2.32053,-1.0377 -5.16661,-1.53523 -6.86647,2.59961 z m -5.350513,19.253318 c 2.48914,1.40066 4.53271,1.5051 7.044833,1.46215 1.32893,2.91665 -1.64789,6.01159 -7.044833,6.01159 -5.152911,0 -8.528135,-2.82239 -7.044826,-6.01159 2.965507,0.18329 5.372916,-0.52142 7.044826,-1.46215 z m -24.879836,3.89941 c -3.35164,2.3605 -5.73174,6.57999 -9.610381,7.52448 l 3.011499,0.0854 0.168017,2.95099 c 1.642743,-6.34441 5.547769,-6.7042 6.430865,-10.56087 z m 6.153079,1.29981 c -2.938325,2.7802 -5.817181,10.30513 -9.531558,12.12783 l 3.646332,-1.23036 0.622325,3.51085 c -0.16682,-6.25891 4.649062,-9.86008 5.262901,-14.40832 z m 48.33288,1.13732 c 0.90422,3.70824 6.74163,5.02003 8.29651,10.72338 l -0.30248,-3.30904 4.21364,-0.37224 c -4.05148,0.003 -6.38276,-2.62986 -12.20767,-7.0421 z m -7.21023,0.6062 c 0.14382,3.79639 8.15711,9.17541 8.4271,15.17927 l 0.44194,-3.53064 3.83689,1.11179 c -4.87135,-2.09683 -9.9885,-10.55223 -12.70593,-12.76042 z m -36.931423,4.51178 c -2.367776,3.20032 -2.857968,7.73472 -6.331312,9.91422 l 3.350425,-1.72728 1.181689,3.17918 c -1.05833,-5.80299 2.055879,-6.7896 1.799198,-11.36612 z m 33.262293,0.24358 c -0.15637,3.79597 5.03875,6.97739 4.03497,13.56669 l 0.94178,-3.32234 3.65903,1.77165 c -3.85025,-2.50486 -6.09981,-9.63541 -8.63578,-12.016 z m -6.24225,1.13733 c -1.00766,4.48962 3.37232,8.35569 1.32066,14.47904 l 1.7238,-2.95177 3.10671,1.84722 c -3.55978,-2.93621 -4.33739,-9.88671 -6.15117,-13.37449 z m -20.866965,2.5996 c -1.813778,3.48779 -0.791842,6.76499 -4.633302,9.30388 l 3.281593,-1.34414 1.807059,3.29915 c -2.127265,-5.86993 0.546367,-6.75026 -0.45535,-11.25889 z m 14.089665,0.56867 c -1.377523,4.40706 2.24118,5.88782 -0.10496,12.18565 l 1.95659,-3.08196 2.51794,2.51329 c -2.66901,-3.09754 -2.85146,-8.01388 -4.36957,-11.61698 z m -6.153083,2.5996 c -1.51812,3.60311 -0.52453,5.98142 -2.893335,9.00175 l 2.531735,-2.33363 2.15816,2.91025 c -2.52049,-4.93383 -0.41502,-5.16821 -1.79656,-9.57837 z M 77.37078,58.150913 c 4.06791,2.900542 6.45378,3.374735 6.59896,9.09862 -4.0471,-1.782092 -5.56589,-1.43128 -6.95566,2.762077 -3.29557,-5.840535 0.79084,-6.164448 0.3567,-11.860697 z",id:"path31-6",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 67.383068,195.76753 c -8.82265,-1.02707 -17.82382,2.60372 -14.62485,10.39843 l 1.87268,-0.73114 c -2.18341,-7.35945 7.52529,-8.73325 12.75217,-9.66729 z M 202.39405,148.08102 c 0.95176,6.89405 3.21378,12.20673 7.22318,16.16629 4.00939,3.95957 9.61546,6.50726 16.94326,8.12377 -2.53614,-3.72032 -10.99833,-6.50307 -14.80306,-9.82976 -5.12989,-4.48533 -6.1004,-12.10899 -9.36338,-14.4603 z m 21.82677,44.67084 c 1.10354,-2.19339 3.18841,-4.82594 3.55949,-7.69678 0.37109,-2.87085 0.15039,-5.79715 -1.25918,-7.97357 -1.73253,1.09925 -3.09179,15.23543 -2.30031,15.67035 z m -25.2132,-48.24372 c 0.46806,-3.31442 -1.26409,-4.59917 -3.31931,-5.36651 -2.86979,-1.07147 -5.65998,0.0823 -6.48144,2.49078 3.21379,-1.60705 7.64928,-0.20693 9.80075,2.87573 z m -69.36728,11.37333 c -0.50888,3.36113 6.42856,10.25617 10.46305,10.42398 l 4.56794,-1.07676 c -7.324,0.01 -13.725,-5.99737 -15.03099,-9.34722 z m -36.755563,13.23769 c 0.43285,2.47315 4.01374,2.72238 6.24334,2.26873 2.922353,-0.59486 4.373103,-3.34826 3.354293,-5.66579 -0.79461,3.11385 -5.794273,4.55401 -9.597633,3.39706 z m 0.11728,6.57994 c 0.43867,2.50637 4.11052,2.72868 6.33245,2.25008 2.771893,-0.597 4.302013,-3.28864 3.265183,-5.64715 -0.79461,3.11386 -5.794263,4.55402 -9.597633,3.39707 z m -12.424922,19.98368 c 2.162088,-1.39362 5.414937,-2.7189 7.316206,-5.03322 1.901269,-2.31433 3.321079,-4.94692 3.299477,-7.47387 -2.104046,0.15962 -11.061073,11.76925 -10.615683,12.50709 z m 130.835405,1.87733 c -8.82265,-1.02707 -17.82382,2.60372 -14.62485,10.39843 l 1.87268,-0.73114 c -2.18341,-7.35945 7.52529,-8.73325 12.75217,-9.66729 z m -52.32858,0.14501 c -8.82265,-1.02707 -17.82382,2.60372 -14.62485,10.39843 l 1.87268,-0.73114 c -2.18341,-7.35945 7.52529,-8.73325 12.75217,-9.66729 z m -6.96289,-55.34233 c 0.86942,4.00406 15.82425,12.34527 21.35524,9.73951 l 3.0176,-2.35774 c -7.24365,3.1125 -20.8105,-3.45981 -24.37284,-7.38177 z m -7.70844,1.11261 c -0.23687,4.11636 17.25232,14.09377 22.00278,13.17295 l 3.79087,-2.29117 c -5.03679,2.8139 -23.52869,-6.51841 -25.79365,-10.88178 z m -4.07389,4.86022 c 0.77433,5.14571 15.09686,13.29443 18.41813,12.10043 l 4.59405,-2.14807 c -7.56604,1.6894 -20.20598,-4.96844 -23.01218,-9.95236 z m -4.43561,4.70882 c -0.362,3.93193 8.78339,10.1846 13.11119,10.95866 l 5.10294,-1.70505 c -6.91071,1.1122 -16.79111,-5.68271 -18.21413,-9.25361 z m -11.11255,6.25239 c -0.16612,1.50942 1.65445,6.62474 6.02142,8.57181 l 4.6022,-0.67093 c -5.97067,-0.89105 -9.33683,-5.55289 -10.62362,-7.90088 z m -6.25409,2.89846 c 0.0246,1.84116 0.54212,4.72588 2.92705,6.35456 l 4.47086,-0.19955 c -4.66672,-1.54429 -6.76997,-4.87426 -7.39791,-6.15501 z m 49.87028,-0.0518 c -1.63229,-0.61211 -3.96734,-1.81507 -5.05585,-3.85551 l 1.96759,-1.033 c 0.80558,2.56758 2.4504,4.27045 3.08834,4.88854 z m -3.2,2.69096 c -4.29971,-1.57492 -5.16722,-4.01487 -5.46325,-4.83183 l 2.12911,-1.01731 c 0.0582,0.64926 0.95446,3.54341 3.33424,5.84916 z m -9.35029,-3.20646 2.49082,-1.0163 c -0.14858,1.84697 1.99138,5.0118 3.63413,6.86359 -2.44977,-1.47665 -5.06981,-3.08627 -6.12495,-5.84729 z m 17.83399,35.34242 c 1.4847,-1.99806 4.01673,-4.28212 4.90137,-7.05822 0.88465,-2.77606 1.19566,-5.69553 0.19833,-8.0536 -1.90752,0.82449 -5.80194,14.56416 -5.09982,15.11182 z m 10.70172,-22.10596 c -0.45615,2.60627 -4.40833,2.74278 -6.59091,2.18962 -2.34086,-0.59362 -4.09312,-3.11541 -3.00672,-5.58668 0.79461,3.11386 5.79426,4.55402 9.59763,3.39706 z m 0.73845,-6.95158 c -0.44591,2.54778 -4.23268,2.73541 -6.44133,2.2258 -2.587,-0.59637 -4.21519,-3.21416 -3.1563,-5.62286 0.79461,3.11386 5.79427,4.55402 9.59763,3.39706 z",id:"path32-1",style:{strokeWidth:1.65117}}),d.exports.createElement("path",{fill:"#000000",stroke:"none",d:"m 211.53596,125.56724 c 7.72839,0 9.58248,4.30199 19.25195,4.05034 l -6.90255,0.9567 c 3.35576,3.01422 4.92908,5.8114 4.898,8.35278 -3.13814,-9.16417 -11.03238,-10.24138 -17.2474,-13.35982 z",id:"path33-8",style:{strokeWidth:1.65117}}))),eo="/statics/logo.e8dba2f4.svg",wa=()=>localStorage.getItem("token"),ju=t=>{localStorage.setItem("token",t)},eh=()=>{localStorage.removeItem("token")},th=bd.create({baseURL:"https://bot.mazholl.com:8585/api"}),rh=(t,n={})=>(wa()&&(n.headers={...(n==null?void 0:n.headers)||{},Authorization:`Bearer ${wa()}`}),th(t,n)),Ee=rh,sh=()=>Ee("/ads"),nh=(t=!0)=>yr({queryKey:["ads"],queryFn:sh,enabled:t,staleTime:1e3*60*30,cacheTime:1e3*60*60});var Ye=(t=>(t.Standard="standard",t.Reseller="reseller",t.Sudo="sudo",t.FullAccess="full_access",t))(Ye||{}),Ls=(t=>(t.Active="active",t.Disabled="disabled",t.Deleted="deleted",t))(Ls||{}),nt=(t=>(t.Create="create",t.Delete="delete",t.ResetUsage="reset_usage",t.Revoke="revoke",t.CreateOnHold="create_on_hold",t.AllowUnlimitedData="allow_unlimited_data",t.AllowUnlimitedExpire="allow_unlimited_expire",t.AllowNextPlan="allow_next_plan",t.AdvancedActions="advanced_actions",t.SetFlow="set_flow",t.AllowCustomKey="allow_custom_key",t))(nt||{}),Nr=(t=>(t.View="can_view",t.Edit="can_edit",t.ManageSudo="can_manage_sudo",t))(Nr||{}),Et=(t=>(t.Usage="usage",t.Admins="admins",t.Services="services",t.Hosts="hosts",t.Nodes="nodes",t.Integrations="integrations",t.Xray="xray",t))(Et||{}),ba=(t=>(t.SelfMyAccount="self_myaccount",t.SelfChangePassword="self_change_password",t.SelfApiKeys="self_api_keys",t))(ba||{});const ih=t=>JSON.parse(JSON.stringify(t)),Eo={users:{[nt.Create]:!0,[nt.Delete]:!0,[nt.ResetUsage]:!0,[nt.Revoke]:!0,[nt.CreateOnHold]:!0,[nt.AllowUnlimitedData]:!0,[nt.AllowUnlimitedExpire]:!0,[nt.AllowNextPlan]:!0,[nt.AdvancedActions]:!0,[nt.SetFlow]:!1,[nt.AllowCustomKey]:!1,max_data_limit_per_user:null},admin_management:{[Nr.View]:!1,[Nr.Edit]:!1,[Nr.ManageSudo]:!1},sections:{[Et.Usage]:!1,[Et.Admins]:!1,[Et.Services]:!1,[Et.Hosts]:!1,[Et.Nodes]:!1,[Et.Integrations]:!1,[Et.Xray]:!1},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0}},ah={users:{[nt.Create]:!0,[nt.Delete]:!0,[nt.ResetUsage]:!0,[nt.Revoke]:!0,[nt.CreateOnHold]:!0,[nt.AllowUnlimitedData]:!0,[nt.AllowUnlimitedExpire]:!0,[nt.AllowNextPlan]:!0,[nt.AdvancedActions]:!0,[nt.SetFlow]:!0,[nt.AllowCustomKey]:!0,max_data_limit_per_user:null},admin_management:{[Nr.View]:!0,[Nr.Edit]:!0,[Nr.ManageSudo]:!1},sections:{[Et.Usage]:!0,[Et.Admins]:!0,[Et.Services]:!0,[Et.Hosts]:!0,[Et.Nodes]:!0,[Et.Integrations]:!0,[Et.Xray]:!0},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0}},oh={users:{[nt.Create]:!0,[nt.Delete]:!0,[nt.ResetUsage]:!0,[nt.Revoke]:!0,[nt.CreateOnHold]:!0,[nt.AllowUnlimitedData]:!0,[nt.AllowUnlimitedExpire]:!0,[nt.AllowNextPlan]:!0,[nt.AdvancedActions]:!0,[nt.SetFlow]:!0,[nt.AllowCustomKey]:!0,max_data_limit_per_user:null},admin_management:{[Nr.View]:!0,[Nr.Edit]:!0,[Nr.ManageSudo]:!0},sections:{[Et.Usage]:!0,[Et.Admins]:!0,[Et.Services]:!0,[Et.Hosts]:!0,[Et.Nodes]:!0,[Et.Integrations]:!0,[Et.Xray]:!0},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0}},zo={[Ye.Standard]:Eo,[Ye.Reseller]:Eo,[Ye.Sudo]:ah,[Ye.FullAccess]:oh},Hi=(t=Ye.Standard)=>{var n;return ih((n=zo[t])!=null?n:zo[Ye.Standard])},To=t=>typeof t=="object"&&t!==null&&!Array.isArray(t),Cc=(t,n)=>{const r={...t};return Object.entries(n).forEach(([o,a])=>{if(a!==void 0){if(To(a)&&To(r[o])){r[o]=Cc(r[o],a);return}r[o]=a}}),r},lh=(t,n)=>n?Cc(Hi(t),n):Hi(t),ji=Hi(Ye.Standard),ch=async()=>await Ee("/admin"),Dr=()=>{const{data:t,isError:n,isLoading:r,isSuccess:o,error:a}=yr({queryFn:()=>ch()}),i={role:Ye.Standard,permissions:Hi(Ye.Standard),telegram_id:"",username:"",users_usage:0,status:Ls.Active,disabled_reason:null},l=(t==null?void 0:t.role)||Ye.Standard,c=t!=null&&t.permissions?lh(l,t.permissions):Hi(l);return{userData:t?{...t,role:l,permissions:c}:{...i,role:l,permissions:c},getUserIsPending:r,getUserIsSuccess:o,getUserIsError:n,getUserError:a}},dh=t=>(t||"en").split(/[-_]/)[0].toLowerCase(),uh=(t,n,r)=>{var l,c,h;if(!t)return;const o=dh(r),a=(c=(l=t.locales)==null?void 0:l[o])==null?void 0:c[n];if(a!=null&&a.length)return a[0];const i=(h=t.default)==null?void 0:h[n];return i==null?void 0:i[0]},hh=({ad:t,compact:n=!1,maxSize:r})=>{const o=Fe("gray.200","whiteAlpha.200"),a=Fe("gray.600","gray.300"),i=Fe("primary.600","primary.200"),l=Fe("white","gray.800"),c=n?2:3,h=n?2:3,p=t.type==="image"||Boolean(t.image_url),m=r!=null?r:460,g=p&&n,v=p?e(P,{w:"100%",h:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",children:e(yd,{alt:t.title||t.text||"Advertisement",borderRadius:g?"lg":"md",objectFit:g?"cover":"contain",src:t.image_url,maxH:"100%",maxW:"100%",h:g?"100%":"auto",w:g?"100%":"auto"})}):s(we,{spacing:1,children:[t.title&&e(u,{fontSize:n?"sm":"md",fontWeight:"semibold",children:t.title}),t.text&&e(u,{fontSize:n?"xs":"sm",color:a,noOfLines:n?3:4,children:t.text})]}),b=s(P,{borderColor:g?"transparent":o,borderWidth:g?"0":"1px",borderRadius:"md",bg:g?"transparent":l,px:g?0:h,py:g?0:c,w:g?"100%":"full",h:g?"100%":"auto",maxW:g?"100%":`${m}px`,maxH:g?"100%":"none",shadow:g?"none":"sm",transition:"box-shadow 0.2s ease",display:g?"flex":"block",alignItems:g?"center":"flex-start",justifyContent:g?"center":"flex-start",overflow:"hidden",_hover:{shadow:g?"none":"md"},children:[v,!p&&t.cta&&e(u,{fontSize:n?"xs":"sm",fontWeight:"semibold",color:i,mt:t.image_url?2:3,children:t.cta})]});return t.link?e(xd,{href:t.link,isExternal:!0,display:"block",_hover:{textDecoration:"none"},children:b}):b},Rs={baseStyle:{w:5,h:5}},ph=ue(Sd,Rs),mh=ue(vd,Rs),gh=ue(wd,Rs),Ua=ue(kd,Rs),fh=ue(_d,Rs),bh=ue(Cd,Rs),yh=ue(_a,Rs),xh=ue(Vl,Rs),Sh=ue(Kl,Rs),vh=ue(Ad,Rs),wh=ue($l,Rs),Mo=ue("img",{baseStyle:{w:8,h:8}}),No=({collapsed:t,inDrawer:n=!1,onRequestExpand:r})=>{var $,Q;const{t:o,i18n:a}=je(),i=co(),{colorMode:l}=fs(),{userData:c,getUserIsSuccess:h}=Dr(),p=h,{data:m}=nh(p),g=a.language||"en",v=p?uh(m,"sidebar",g):void 0,b=d.exports.useMemo(()=>{switch(c.role){case Ye.FullAccess:return o("admins.roles.fullAccess","Full access");case Ye.Sudo:return o("admins.roles.sudo","Sudo");default:return o("admins.roles.standard","Standard")}},[o,c.role]),S=($=c.permissions)==null?void 0:$.sections,f=c.role===Ye.FullAccess,w=((Q=c.permissions)==null?void 0:Q.self_permissions)||{self_myaccount:!0,self_change_password:!0,self_api_keys:!0},W=f?{self_myaccount:!0,self_change_password:!0,self_api_keys:!0}:w,z=Boolean(S==null?void 0:S[Et.Usage]),le=Boolean(S==null?void 0:S[Et.Admins]),R=Boolean(S==null?void 0:S[Et.Services]),y=[...[S!=null&&S[Et.Hosts]?{title:o("header.hostSettings"),url:"/hosts",icon:gh}:null,S!=null&&S[Et.Nodes]?{title:o("header.nodeSettings"),url:"/node-settings",icon:fh}:null,S!=null&&S[Et.Integrations]?{title:o("header.integrationSettings","Master Settings"),url:"/integrations",icon:Ua}:null,S!=null&&S[Et.Xray]?{title:o("header.xraySettings"),url:"/xray-settings",icon:Ua}:null,S!=null&&S[Et.Xray]?{title:o("header.accessInsights","Access insights"),url:"/access-insights",icon:wh}:null].filter(Boolean)],ae=()=>{n&&r&&r()};R&&y.unshift({title:o("services.menu","Services"),url:"/services",icon:xh});const Se=y.some(U=>i.pathname===U.url),[ve,T]=d.exports.useState(Se);d.exports.useEffect(()=>{Se&&T(!0)},[Se]);const F=[{title:o("dashboard"),url:"/",icon:ph},{title:o("users"),url:"/users",icon:mh}];W.self_myaccount&&F.splice(1,0,{title:o("myaccount.menu"),url:"/myaccount",icon:vh}),z&&F.push({title:o("usage.menu","Usage"),url:"/usage",icon:Sh}),le&&F.push({title:o("admins","Admins"),url:"/admins",icon:bh}),y.length>0&&F.push({title:o("header.settings"),icon:Ua,subItems:y});const q=g==="fa";return e(P,{w:n?"full":t?"16":"60",h:n?"100%":"100vh",maxH:n?"100%":"100vh",bg:"surface.light",borderRight:n||q?void 0:"1px",borderLeft:n||!q?void 0:"1px",borderColor:n?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:n?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:n?"relative":"fixed",top:n?void 0:"0",left:n||q?void 0:"0",right:n||!q?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:s(pe,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[s(P,{flex:"1",overflowY:"auto",children:[t?e(O,{justify:"center",mb:6,children:e(kt,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(Mo,{src:eo,alt:"Rebecca",filter:l==="dark"?"brightness(0) invert(1)":"none"})})}):s(O,{spacing:3,align:"center",mb:6,px:2,children:[e(Mo,{src:eo,alt:"Rebecca",filter:l==="dark"?"brightness(0) invert(1)":"none"}),e(u,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:o("menu")})]}),F.map(U=>{var be;const Z=U.url,se=typeof Z=="string"&&i.pathname===Z||typeof Z=="string"&&Z!=="/"&&i.pathname.startsWith(Z)||((be=U.subItems)==null?void 0:be.some(ee=>i.pathname===ee.url)),M=U.icon;return e(P,{children:U.subItems?s(Wt,{children:[e(kt,{label:t?U.title:"",placement:"right",hasArrow:!0,children:s(O,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:se?"primary.50":"transparent",color:se?"primary.600":"gray.700",_dark:{bg:se?"primary.900":"transparent",color:se?"primary.200":"gray.300"},_hover:{bg:se?"primary.50":"gray.50",_dark:{bg:se?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r==null||r(),T(!0)):T(!ve)},children:[s(O,{spacing:3,children:[e(M,{w:t?5:void 0,h:t?5:void 0}),!t&&e(u,{fontSize:"sm",fontWeight:se?"semibold":"normal",children:U.title})]}),!t&&e(yh,{transform:ve?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e($n,{in:ve,animateOpacity:!0,children:e(pe,{align:"stretch",pl:6,spacing:1,mt:2,children:U.subItems.map(ee=>{const Ie=i.pathname===ee.url,me=ee.icon;return e(Do,{to:ee.url,onClick:ae,children:s(O,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:Ie?"primary.50":"transparent",color:Ie?"primary.600":"gray.700",_dark:{bg:Ie?"primary.900":"transparent",color:Ie?"primary.200":"gray.300"},_hover:{bg:Ie?"primary.50":"gray.50",_dark:{bg:Ie?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(me,{w:t?5:void 0,h:t?5:void 0}),e(u,{fontSize:"sm",fontWeight:Ie?"semibold":"normal",children:ee.title})]})},ee.url)})})})]}):U.url?e(Do,{to:U.url,onClick:ae,children:e(kt,{label:t?U.title:"",placement:"right",hasArrow:!0,children:s(O,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:se?"primary.50":"transparent",color:se?"primary.600":"gray.700",_dark:{bg:se?"primary.900":"transparent",color:se?"primary.200":"gray.300"},_hover:{bg:se?"primary.50":"gray.50",_dark:{bg:se?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(M,{w:t?5:void 0,h:t?5:void 0}),!t&&e(u,{fontSize:"sm",fontWeight:se?"semibold":"normal",children:U.title})]})})}):null},U.title)})]}),v&&!t&&e(P,{px:t?2:2.5,py:2.5,mt:4,w:"full",children:e(hh,{ad:v,maxSize:440})}),h&&c.username&&e(P,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(kt,{label:`${c.username} \xB7 ${b}`,placement:"right",hasArrow:!0,children:e(P,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(u,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:c.username.charAt(0).toUpperCase()})})}):s(pe,{align:"flex-start",spacing:1,children:[e(u,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:o("sidebar.username","username:")}),e(u,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:c.username}),e(u,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:o("admins.roleLabel","Admin role")}),e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b})]})})]})})},kh=()=>{const[t,n]=d.exports.useState(null);return d.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(o=>o.json()).then(o=>{o.stargazers_count&&n(o.stargazers_count)}).catch(()=>{})},[]),e(P,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:s(O,{spacing:2,align:"center",children:[s("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[e("title",{children:"GitHub"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})]}),s(O,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(Dd,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(u,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(u,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},Lo="rb-theme",Ro="rb-custom-themes",_h=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],qr={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},_r={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Uo=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:_r.primary,colorModeTarget:"dark",className:"rb-theme-dark"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],Oo=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],Oa=.14,Wa=.22,Wo=ue($i,{baseStyle:{w:4,h:4}}),Fo=ue(Id,{baseStyle:{w:4,h:4}}),Ch=ue(Pd,{baseStyle:{w:4,h:4}}),Ah=ue(Za,{baseStyle:{w:4,h:4}}),Dh=ue(Vs,{baseStyle:{w:4,h:4}}),Ho=ue(Cn,{baseStyle:{w:4,h:4}}),Ih=ue(uo,{baseStyle:{w:4,h:4}}),Ph=ue(ho,{baseStyle:{w:4,h:4}}),Eh=ue(Ed,{baseStyle:{w:4,h:4}}),Ac=(t,n=0,r=1)=>Math.min(r,Math.max(n,t)),to=t=>{const n=t.replace("#",""),r=parseInt(n,16);if(n.length===3){const o=r>>8&15,a=r>>4&15,i=r&15;return{r:o<<4|o,g:a<<4|a,b:i<<4|i}}return{r:r>>16&255,g:r>>8&255,b:r&255}},Dc=(t,n,r)=>{const o=a=>a.toString(16).padStart(2,"0");return`#${o(t)}${o(n)}${o(r)}`},zh=(t,n,r)=>{t/=255,n/=255,r/=255;const o=Math.max(t,n,r),a=Math.min(t,n,r);let i=0,l=0;const c=(o+a)/2;if(o!==a){const h=o-a;switch(l=c>.5?h/(2-o-a):h/(o+a),o){case t:i=(n-r)/h+(n<r?6:0);break;case n:i=(r-t)/h+2;break;default:i=(t-n)/h+4}i/=6}return{h:i,s:l,l:c}},Th=(t,n,r)=>{let o,a,i;if(n===0)o=a=i=r;else{const l=(p,m,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?p+(m-p)*6*g:g<.5?m:g<.6666666666666666?p+(m-p)*(.6666666666666666-g)*6:p),c=r<.5?r*(1+n):r+n-r*n,h=2*r-c;o=l(h,c,t+1/3),a=l(h,c,t),i=l(h,c,t-1/3)}return{r:Math.round(o*255),g:Math.round(a*255),b:Math.round(i*255)}},ea=t=>{try{const{r:n,g:r,b:o}=to(t),{h:a,s:i,l}=zh(n,r,o);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((h,[p,m])=>{const{r:g,g:v,b}=Th(a,i,Ac(l+m));return h[`--primary-${p}`]=Dc(g,v,b),h},{})}catch{return{}}},Mh=(t,n,r)=>{const o=Ac(r,0,1),a=to(t),i=to(n),l=(c,h)=>Math.round(c*(1-o)+h*o);return Dc(l(a.r,i.r),l(a.g,i.g),l(a.b,i.b))},Mn=(t,n,r,o)=>{try{return Mh(t,n,r)}catch{return o}},Nh=()=>{const t=document.documentElement;_h.forEach(n=>{t.style.removeProperty(n)}),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},Bo=(t,n)=>{const r=document.documentElement;Object.entries(t).forEach(([o,a])=>{r.style.setProperty(o,a)}),r.style.setProperty("--bg-light",n.bgLight),r.style.setProperty("--bg-dark",n.bgDark),r.style.setProperty("--surface-light",n.surfaceLight),r.style.setProperty("--surface-dark",n.surfaceDark)},Fa=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},Vo=()=>({name:"",light:{...qr},dark:{..._r}}),Pr=(t,n)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:n,Ic=({minimal:t=!1,portalContainer:n,trigger:r="icon",triggerLabel:o})=>{const{t:a}=je(),i=cr(),{colorMode:l,toggleColorMode:c}=fs(),h=sr(),p=sr(),m=Fe("surface.light","surface.dark"),g=Fe("blackAlpha.50","whiteAlpha.100"),v=Fe("blackAlpha.200","whiteAlpha.200"),b=Fe("gray.800","gray.100"),S=Fe("gray.600","gray.300"),f=Fe("blackAlpha.400","blackAlpha.700"),w=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:S}}),[S]),[W,z]=d.exports.useState(()=>{try{return localStorage.getItem(Lo)||"default"}catch{return"default"}}),[le,R]=d.exports.useState(()=>{try{const A=localStorage.getItem(Ro);if(!A)return[];const k=JSON.parse(A);return Array.isArray(k)?k.map(L=>{var Je,H,ke,Me,Be,ot;const te=Pr(((Je=L.light)==null?void 0:Je.primary)||qr.primary,qr.primary),Oe=Pr(((H=L.light)==null?void 0:H.bg)||qr.bg,qr.bg),ne=Mn(Oe,te,Oa,qr.surface),I=Pr(((ke=L.light)==null?void 0:ke.surface)||ne,ne),E=Pr(((Me=L.dark)==null?void 0:Me.primary)||_r.primary,_r.primary),G=Pr(((Be=L.dark)==null?void 0:Be.bg)||_r.bg,_r.bg),ze=Mn(G,E,Wa,_r.surface),Ne=Pr(((ot=L.dark)==null?void 0:ot.surface)||ze,ze);return{id:L.id||Fa(),name:L.name||"Custom",light:{primary:te,bg:Oe,surface:I},dark:{primary:E,bg:G,surface:Ne}}}):[]}catch{return[]}}),[K,y]=d.exports.useState(Vo),[ae,Se]=d.exports.useState(null),[ve,T]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(Ro,JSON.stringify(le))}catch{}},[le]),d.exports.useEffect(()=>{try{localStorage.setItem(Lo,W)}catch{}},[W]),d.exports.useEffect(()=>{W.startsWith("custom:")&&(le.some(k=>`custom:${k.id}`===W)||z("dark"))},[W,le]),d.exports.useEffect(()=>{const A=document.documentElement;Array.from(A.classList).filter(L=>L.startsWith("rb-theme-")).forEach(L=>{A.classList.remove(L)}),Nh();const k=Uo.find(L=>L.key===W);if(k){if(k.className&&A.classList.add(k.className),k.key==="dark"){const L=ea(_r.primary);Bo(L,{bgLight:qr.bg,bgDark:_r.bg,surfaceLight:qr.surface,surfaceDark:_r.surface}),Pi("dark",_r.bg)}else Pi(k.key);return}if(W.startsWith("custom:")){const L=le.find(ne=>`custom:${ne.id}`===W);if(!L)return;const te=l==="dark"?L.dark:L.light,Oe=ea(te.primary);Bo(Oe,{bgLight:L.light.bg,bgDark:L.dark.bg,surfaceLight:L.light.surface,surfaceDark:L.dark.surface}),Pi("custom",l==="dark"?L.dark.bg:L.light.bg)}else Pi("dark")},[W,le,l]);const F=d.exports.useCallback(A=>{A.colorModeTarget&&l!==A.colorModeTarget&&c(),z(A.key)},[l,c]),q=A=>{z(`custom:${A}`)},$=A=>{Se(null),y(A?{name:a(`theme.presets.${A.key}.name`),light:{...A.light},dark:{...A.dark}}:Vo()),h.onOpen()},Q=A=>{Se(A.id),y({name:A.name,light:{...A.light},dark:{...A.dark}}),h.onOpen()},U=()=>{const A=K.name.trim()||a("theme.untitled"),k=Pr(K.light.primary,qr.primary),L=Pr(K.light.bg,qr.bg),te=Mn(L,k,Oa,qr.surface),Oe=Pr(K.light.surface,te),ne=Pr(K.dark.primary,_r.primary),I=Pr(K.dark.bg,_r.bg),E=Mn(I,ne,Wa,_r.surface),G=Pr(K.dark.surface,E),ze={id:ae||Fa(),name:A,light:{primary:k,bg:L,surface:Oe},dark:{primary:ne,bg:I,surface:G}};R(Ne=>ae?Ne.map(Je=>Je.id===ae?ze:Je):[...Ne,ze]),z(`custom:${ze.id}`),h.onClose(),Se(null),i({status:"success",title:a("theme.customSaved")})},Z=A=>{R(k=>k.filter(L=>L.id!==A)),W===`custom:${A}`&&z("dark"),i({status:"info",title:a("theme.customDeleted")})},se=()=>{z("default"),i({status:"info",title:a("theme.resetSuccess")})},M=async()=>{if(!le.length){i({status:"warning",title:a("theme.exportEmpty")});return}const A=le.map(({id:L,...te})=>te),k=JSON.stringify(A,null,2);try{await navigator.clipboard.writeText(k),i({status:"success",title:a("theme.exportSuccess")})}catch{try{const L=new Blob([k],{type:"application/json"}),te=URL.createObjectURL(L),Oe=document.createElement("a");Oe.href=te,Oe.download="rebecca-themes.json",Oe.click(),URL.revokeObjectURL(te),i({status:"success",title:a("theme.exportSuccessDownload")})}catch{i({status:"error",title:a("theme.exportError")})}}},be=()=>{try{const A=JSON.parse(ve),L=(Array.isArray(A)?A:[A]).map(te=>{var H,ke,Me,Be,ot,X;const Oe=Pr(((H=te==null?void 0:te.light)==null?void 0:H.primary)||qr.primary,qr.primary),ne=Pr(((ke=te==null?void 0:te.light)==null?void 0:ke.bg)||qr.bg,qr.bg),I=Mn(ne,Oe,Oa,qr.surface),E=Pr(((Me=te==null?void 0:te.light)==null?void 0:Me.surface)||I,I),G=Pr(((Be=te==null?void 0:te.dark)==null?void 0:Be.primary)||_r.primary,_r.primary),ze=Pr(((ot=te==null?void 0:te.dark)==null?void 0:ot.bg)||_r.bg,_r.bg),Ne=Mn(ze,G,Wa,_r.surface),Je=Pr(((X=te==null?void 0:te.dark)==null?void 0:X.surface)||Ne,Ne);return{id:Fa(),name:(te==null?void 0:te.name)||"Custom",light:{primary:Oe,bg:ne,surface:E},dark:{primary:G,bg:ze,surface:Je}}}).filter(te=>te.name);if(!L.length){i({status:"warning",title:a("theme.importError")});return}R(te=>[...te,...L]),p.onClose(),T(""),i({status:"success",title:a("theme.importSuccess")})}catch{i({status:"error",title:a("theme.importError")})}},ee=d.exports.useCallback((A,k)=>{A.preventDefault(),A.stopPropagation(),k()},[]),Ie=d.exports.useMemo(()=>ea(K.light.primary),[K.light.primary]),me=d.exports.useMemo(()=>ea(K.dark.primary),[K.dark.primary]),J=A=>{const k=K[A],L=A==="dark"?me:Ie,te=L["--primary-500"]||k.primary,Oe=L["--primary-300"]||L["--primary-400"]||te,ne=A==="dark"?"whiteAlpha.900":"gray.800",I=A==="dark"?"whiteAlpha.700":"gray.600",E=A==="dark"?"whiteAlpha.200":"blackAlpha.200",G=A==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(P,{borderWidth:"1px",borderRadius:"md",bg:k.bg,p:4,borderColor:E,children:s(we,{spacing:3,children:[e(u,{fontWeight:"semibold",color:ne,children:a(A==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(P,{borderRadius:"lg",bg:k.surface,p:4,borderWidth:"1px",borderColor:E,children:s(we,{spacing:2,children:[e(u,{fontSize:"lg",fontWeight:"bold",color:ne,children:a("theme.previewSampleTitle")}),e(u,{fontSize:"sm",color:I,children:a("theme.previewSampleBody")}),e(V,{size:"sm",bg:te,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:a("theme.previewSampleAction")}),s(O,{spacing:2,pt:2,children:[e(P,{flex:"1",h:"2",borderRadius:"full",bg:Oe,opacity:.8}),e(P,{flex:"1",h:"2",borderRadius:"full",bg:te,opacity:.9})]})]})}),s(O,{spacing:1,pt:1,flexWrap:"wrap",children:[e(P,{w:6,h:6,borderRadius:"sm",bg:k.bg,borderWidth:"1px",borderColor:G}),e(P,{w:6,h:6,borderRadius:"sm",bg:k.surface,borderWidth:"1px",borderColor:G}),Object.entries(L).map(([ze,Ne])=>e(P,{w:6,h:6,borderRadius:"sm",bg:Ne,borderWidth:"1px",borderColor:G,title:ze},ze))]})]})})},N=s(Ui,{minW:{base:"82vw",sm:"240px"},maxW:"320px",zIndex:9999,bg:m,color:b,borderColor:v,maxH:"70vh",overflowY:"auto",children:[e(Io,{title:a("theme.builtIn"),sx:w,children:Uo.map(A=>{const k=W===A.key;return e(zr,{onClick:()=>F(A),_hover:{bg:g},children:s(O,{justify:"space-between",w:"full",children:[s(O,{children:[e(P,{w:"4",h:"3",bg:A.accent,borderRadius:"xs",borderWidth:"1px",borderColor:v}),e(u,{children:a(`theme.${A.key}`)})]}),k&&e(Wo,{})]})},A.key)})}),!t&&s(Wt,{children:[e(xa,{borderColor:v}),s(Io,{title:a("theme.customGroup"),sx:w,children:[le.length?le.map(A=>{const k=W===`custom:${A.id}`;return e(zr,{onClick:()=>q(A.id),_hover:{bg:g},children:s(O,{justify:"space-between",w:"full",children:[s(O,{children:[e(P,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${A.light.surface}, ${A.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:v}),e(u,{children:A.name})]}),s(O,{spacing:1,children:[k&&e(Wo,{}),[{icon:e(Ah,{}),label:a("theme.edit"),onClick:()=>Q(A)},{icon:e(Dh,{}),label:a("theme.delete"),onClick:()=>Z(A.id)}].map(({icon:L,label:te,onClick:Oe})=>e(P,{as:"span",role:"button",tabIndex:0,"aria-label":te,onClick:ne=>ee(ne,Oe),onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&ee(ne,Oe)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:g},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:L},te))]})]})},A.id)}):e(zr,{isDisabled:!0,children:a("theme.noCustom")}),e(zr,{icon:e(Ch,{}),onClick:()=>$(),_hover:{bg:g},children:a("theme.createCustom")})]}),e(xa,{borderColor:v}),e(zr,{icon:e(Ho,{}),onClick:()=>$(Oo[0]),_hover:{bg:g},children:a("theme.quickPreset")}),e(zr,{icon:e(Ih,{}),onClick:M,_hover:{bg:g},children:a("theme.export")}),e(zr,{icon:e(Ph,{}),onClick:()=>p.onOpen(),_hover:{bg:g},children:a("theme.import")}),e(zr,{icon:e(Eh,{}),onClick:se,_hover:{bg:g},children:a("theme.reset")})]})]}),B=r==="icon"?e(qn,{as:qe,size:"sm",variant:"outline",icon:e(Fo,{}),position:"relative"}):e(qn,{as:V,w:"full",justifyContent:"space-between",variant:"ghost",rightIcon:e(Fo,{}),children:o||a("theme.triggerLabel","Theme")});return s(Wt,{children:[s(Oi,{placement:"bottom-end",children:[B,n?e(Wi,{containerRef:n,children:N}):N]}),s(Gt,{isOpen:h.isOpen,onClose:h.onClose,isCentered:!0,size:"xl",children:[e(Dt,{bg:f,backdropFilter:"blur(4px)"}),s(Xt,{mx:4,bg:m,borderColor:v,borderWidth:"1px",color:b,children:[e(Tt,{color:b,children:a(ae?"theme.editThemeTitle":"theme.customTitle")}),e(Qt,{}),e(It,{children:s(pe,{spacing:6,align:"stretch",children:[s(_,{children:[e(D,{color:S,children:a("theme.customName")}),e(Ce,{placeholder:a("theme.customNamePlaceholder")||"",value:K.name,onChange:A=>y(k=>({...k,name:A.target.value}))})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[J("light"),J("dark")]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(we,{spacing:4,children:[s(_,{children:[e(D,{color:S,children:a("theme.lightPrimary")}),e(Ce,{type:"color",value:K.light.primary,onChange:A=>y(k=>({...k,light:{...k.light,primary:A.target.value}}))}),e(br,{color:S,children:a("theme.lightPrimaryHint")})]}),s(_,{children:[e(D,{color:S,children:a("theme.lightSurface")}),e(Ce,{type:"color",value:K.light.surface,onChange:A=>y(k=>({...k,light:{...k.light,surface:A.target.value}}))}),e(br,{color:S,children:a("theme.lightSurfaceHint")})]}),s(_,{children:[e(D,{color:S,children:a("theme.lightBackground")}),e(Ce,{type:"color",value:K.light.bg,onChange:A=>y(k=>({...k,light:{...k.light,bg:A.target.value}}))})]})]}),s(we,{spacing:4,children:[s(_,{children:[e(D,{color:S,children:a("theme.darkPrimary")}),e(Ce,{type:"color",value:K.dark.primary,onChange:A=>y(k=>({...k,dark:{...k.dark,primary:A.target.value}}))}),e(br,{color:S,children:a("theme.darkPrimaryHint")})]}),s(_,{children:[e(D,{color:S,children:a("theme.darkSurface")}),e(Ce,{type:"color",value:K.dark.surface,onChange:A=>y(k=>({...k,dark:{...k.dark,surface:A.target.value}}))}),e(br,{color:S,children:a("theme.darkSurfaceHint")})]}),s(_,{children:[e(D,{color:S,children:a("theme.darkBackground")}),e(Ce,{type:"color",value:K.dark.bg,onChange:A=>y(k=>({...k,dark:{...k.dark,bg:A.target.value}}))})]})]})]}),s(P,{children:[s(O,{mb:2,children:[e(Ho,{}),e(u,{fontWeight:"semibold",children:a("theme.presets")})]}),e(Ve,{columns:{base:1,md:3},spacing:3,children:Oo.map(A=>e(V,{size:"sm",variant:"outline",onClick:()=>y({name:a(`theme.presets.${A.key}.name`),light:{...A.light},dark:{...A.dark}}),children:a(`theme.presets.${A.key}.name`)},A.key))})]})]})}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:h.onClose,children:a("cancel")}),e(V,{colorScheme:"primary",onClick:U,children:a(ae?"theme.customUpdate":"theme.customSave")})]})]})]}),s(Gt,{isOpen:p.isOpen,onClose:p.onClose,size:"lg",isCentered:!0,children:[e(Dt,{bg:f,backdropFilter:"blur(4px)"}),s(Xt,{mx:4,bg:m,borderColor:v,borderWidth:"1px",color:b,children:[e(Tt,{color:b,children:a("theme.importTitle")}),e(Qt,{}),e(It,{children:s(pe,{spacing:4,align:"stretch",children:[e(u,{fontSize:"sm",color:S,children:a("theme.importDescription")}),e(ns,{rows:8,placeholder:a("theme.importPlaceholder")||"",value:ve,onChange:A=>T(A.target.value),bg:"transparent",borderColor:v,color:b})]})}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:p.onClose,children:a("cancel")}),e(V,{colorScheme:"primary",onClick:be,children:a("theme.importAction")})]})]})]})]})},Ta={baseStyle:{w:4,h:4}},Lh=ue(zd,Ta),Rh=ue(ql,Ta),Uh=ue(Jl,Ta),Oh=ue(Yl,Ta);function Wh(){const[t,n]=d.exports.useState(!1),r=Br({base:!0,md:!1}),o=sr(),a=sr(),i=d.exports.useRef(null),{t:l,i18n:c}=je();Zu();const h=c.language==="fa",p=[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u067E\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}],m=g=>{c.changeLanguage(g)};return s(xt,{minH:"100vh",maxH:"100vh",overflow:"hidden",direction:h?"row-reverse":"row",children:[r?null:e(No,{collapsed:t,onRequestExpand:()=>n(!1)}),s(xt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r||h?"0":t?"16":"60",mr:r||!h?"0":t?"16":"60",transition:h?"margin-right 0.3s":"margin-left 0.3s",children:[s(P,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,position:"relative",overflow:"hidden",children:[e(qe,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?o.onOpen():n(!t)},icon:e(Rh,{}),flexShrink:0}),s(O,{spacing:2,alignItems:"center",flexShrink:0,children:[e(kh,{}),s(ei,{isOpen:a.isOpen,onOpen:a.onOpen,onClose:a.onClose,placement:"bottom-end",children:[e(ti,{children:e(qe,{size:"sm",variant:"outline",icon:e(Uh,{}),"aria-label":"quick actions",onClick:()=>a.isOpen?a.onClose():a.onOpen()})}),e(Wi,{children:s(ri,{ref:i,w:"full",maxW:{base:"calc(100vw - 2rem)",sm:"56"},mx:{base:4,sm:0},children:[e(qi,{}),e(si,{children:s(we,{spacing:2,children:[s(Oi,{placement:"left-start",isLazy:!0,children:[e(qn,{as:V,justifyContent:"space-between",rightIcon:e(Oh,{}),variant:"ghost",children:l("header.language","Language")}),e(Wi,{containerRef:i,children:e(Ui,{minW:{base:"100%",sm:"200px"},maxW:{base:"100%",sm:"240px"},maxH:"60vh",overflowY:"auto",children:p.map(({code:g,label:v,flag:b})=>{const S=c.language===g;return e(zr,{onClick:()=>{m(g),a.onClose()},children:s(O,{justify:"space-between",w:"full",children:[s(O,{spacing:2,children:[g==="fa"?e(_c,{style:{width:"16px",height:"12px"}}):e(Gl,{countryCode:b,svg:!0,style:{width:"16px",height:"12px"}}),e(u,{children:v})]}),S&&e($i,{width:16})]})},g)})})})]}),e(nn,{}),e(Ic,{trigger:"menu",triggerLabel:l("header.theme","Theme"),portalContainer:i}),e(nn,{}),e(V,{colorScheme:"red",leftIcon:e(Lh,{}),justifyContent:"flex-start",as:Td,to:"/login",onClick:a.onClose,children:l("header.logout","Log out")})]})})]})})]})]})]}),e(P,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Md,{})})]}),r&&s(Nd,{isOpen:o.isOpen,placement:h?"right":"left",onClose:o.onClose,size:"xs",children:[e(Dt,{}),e(Ld,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(It,{p:0,children:e(No,{collapsed:!1,inDrawer:!0,onRequestExpand:o.onClose})})})]})]})}const Fh=async()=>Ee("/settings/telegram"),Hh=async t=>Ee("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),Ma=async()=>Ee("/settings/panel"),Bh=async t=>Ee("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),Vh="/statics/irancell-svgrepo-com.f221f2c6.svg",Kh="/statics/mci-svgrepo-com.315cd4c9.svg",$h="/statics/rightel-svgrepo-com.0c99930f.svg",qh="/statics/tci-svgrepo-com.1d3c5a74.svg",Jh=5e3,Yh=250,Gh=120,kr=t=>t,Ko=t=>{const n=t.toLowerCase();return n.includes("telegram")?e(lr,{as:kr(Ud)}):n.includes("instagram")?e(lr,{as:kr(Od)}):n.includes("facebook")?e(lr,{as:kr(Wd)}):n.includes("whatsapp")?e(lr,{as:kr(Fd)}):n.includes("youtube")?e(lr,{as:kr(Hd)}):n.includes("twitter")||n==="x"?e(lr,{as:kr(Bd)}):n.includes("tiktok")?e(lr,{as:kr(Vd)}):n.includes("snapchat")?e(lr,{as:kr(Kd)}):n.includes("google")?e(lr,{as:kr($d)}):n.includes("cloudflare")?e(lr,{as:kr(qd)}):n.includes("apple")||n.includes("icloud")?e(lr,{as:kr(Jd)}):n.includes("microsoft")||n.includes("windows")?e(lr,{as:kr(pa)}):n.includes("netflix")?e(lr,{as:kr(Yd)}):n.includes("samsung")?e(lr,{as:kr(Gd)}):n.includes("porn")||n.includes("xvideo")||n.includes("xhamster")||n.includes("redtube")?e(lr,{as:kr(pa)}):n.includes("crypto")||n.includes("wallet")||n.includes("binance")||n.includes("trust")||n.includes("btc")?n.includes("binance")?e(lr,{as:kr(Xd)}):e(lr,{as:kr(Qd)}):e(lr,{as:kr(pa)})},$o=t=>{const n=t.toLowerCase(),r={filter:"invert(1) brightness(2)",width:"28px",height:"28px"};return n.includes("mci")||n.includes("hamrah")?e(P,{as:"img",src:Kh,style:r}):n.includes("irancell")||n.includes("mtn")?e(P,{as:"img",src:Vh,style:r}):n.includes("tci")||n.includes("mokhaberat")?e(P,{as:"img",src:qh,style:r}):n.includes("rightel")||n.includes("righ tel")||n.includes("righ-tel")?e(P,{as:"img",src:$h,style:r}):e(lr,{as:kr(pa)})},Xh=()=>{var Se,ve;const{t}=je(),{userData:n,getUserIsSuccess:r}=Dr(),o=r&&Boolean((Se=n.permissions)==null?void 0:Se.sections.xray),{data:a}=yr(["panel-settings"],Ma),i=(ve=a==null?void 0:a.access_insights_enabled)!=null?ve:!1,[l,c]=d.exports.useState(null),[h,p]=d.exports.useState(!1),[m,g]=d.exports.useState(""),[v,b]=d.exports.useState(!1),[S,f]=d.exports.useState(null),w=d.exports.useCallback(async()=>{if(!(!o||!i)){p(!0),f(null);try{const T=new URLSearchParams({limit:String(Yh),window_seconds:String(Gh)}),F=await Ee(`/core/access/insights?${T.toString()}`);F!=null&&F.error&&f(F.detail||F.error),c(F)}catch(T){f((T==null?void 0:T.message)||t("pages.accessInsights.errors.loadFailed","Failed to load access insights"))}finally{p(!1)}}},[o,i,t]);d.exports.useEffect(()=>{i&&w()},[w,i]),d.exports.useEffect(()=>{if(!v||!o||!i)return;const T=window.setInterval(w,Jh);return()=>window.clearInterval(T)},[v,o,i,w]),d.exports.useEffect(()=>{i||b(!1)},[i]);const W=d.exports.useMemo(()=>(l==null?void 0:l.items)||[],[l]),z=d.exports.useMemo(()=>{const T=(l==null?void 0:l.platform_counts)||{};return new Map(Object.entries(T))},[l]),le=d.exports.useMemo(()=>{if((l==null?void 0:l.platforms)&&Array.isArray(l.platforms))return l.platforms.slice(0,6).map(q=>[q.platform,q.count,q.percent]);const T=W.length||0;return Array.from(z.entries()).sort((q,$)=>$[1]-q[1]).slice(0,6).map(([q,$])=>[q,$,T?$/T:void 0])},[l,z,W]),R=d.exports.useMemo(()=>(l==null?void 0:l.unmatched)||[],[l]),K=d.exports.useMemo(()=>{const T=new Map;return W.forEach(F=>{(F.operators||[]).forEach(q=>{var Q;const $=(q.short_name||q.owner||"Unknown").trim()||"Unknown";T.has($)||T.set($,new Set),q.ip&&((Q=T.get($))==null||Q.add(q.ip))})}),T},[W]),y=d.exports.useMemo(()=>Array.from(K.entries()).map(([F,q])=>[F,q.size]).sort((F,q)=>q[1]-F[1]),[K]),ae=d.exports.useMemo(()=>{const T=m.trim().toLowerCase();return T?W.filter(F=>{if(F.user_label.toLowerCase().includes(T)||(F.route||"").toLowerCase().includes(T))return!0;for(const q of F.platforms||[]){if(q.platform.toLowerCase().includes(T))return!0;for(const $ of q.destinations||[])if($.toLowerCase().includes(T))return!0}return!1}):W},[W,m]);return l!=null&&l.items,o?s(P,{p:6,display:"flex",flexDirection:"column",gap:4,children:[s(we,{spacing:2,position:"relative",children:[e(u,{fontSize:"2xl",fontWeight:"bold",children:t("pages.accessInsights.title","Live Access Insights")}),e(u,{color:"gray.500",children:t("pages.accessInsights.subtitle","Recent connections are grouped using geosite/geoip data to highlight which platforms users are reaching.")}),i?null:e(P,{position:"absolute",inset:0,bg:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1,borderRadius:"md",children:e(u,{fontSize:"lg",fontWeight:"bold",color:"white",textAlign:"center",px:4,children:t("pages.accessInsights.disabled","Access Insights is disabled in panel settings")})})]}),s(O,{spacing:3,flexWrap:"wrap",children:[s(Ar,{maxW:{base:"full",md:"360px"},children:[e(Ca,{pointerEvents:"none",children:e(Aa,{width:18})}),e(Ce,{placeholder:t("pages.accessInsights.search","Search platform, host, or email"),value:m,onChange:T=>g(T.target.value),onKeyDown:T=>{T.key==="Enter"&&w()},isDisabled:!i})]}),s(O,{spacing:2,children:[e(_t,{isChecked:v,onChange:T=>b(T.target.checked),isDisabled:!i,children:t("pages.accessInsights.autoRefresh","Auto refresh")}),e(kt,{label:t("pages.accessInsights.refreshNow","Refresh now"),children:e(qe,{"aria-label":"refresh",icon:e(gs,{width:18}),onClick:w,isDisabled:h||!i})})]}),s(O,{spacing:2,color:"gray.500",fontSize:"sm",children:[s(u,{children:[t("pages.accessInsights.logPath","Log"),":"," ",e(fr,{colorScheme:"gray",children:(l==null?void 0:l.log_path)||t("pages.accessInsights.unknown","Unknown")})]}),s(u,{children:[t("pages.accessInsights.geoPath","Geo assets"),":"," ",e(fr,{colorScheme:"gray",children:(l==null?void 0:l.geo_assets_path)||t("pages.accessInsights.unknown","Unknown")})]}),l?s(fr,{colorScheme:l.geo_assets.geosite&&l.geo_assets.geoip?"green":"orange",children:[l.geo_assets.geosite?"geosite":"geosite missing"," /"," ",l.geo_assets.geoip?"geoip":"geoip missing"]}):null]})]}),S?s(Tr,{status:"error",children:[e(Mr,{}),S]}):null,s(Ve,{columns:{base:1,md:3},spacing:4,opacity:i?1:.3,filter:i?"none":"blur(2px)",children:[le.map(([T,F,q])=>s(Xl,{borderWidth:"1px",borderRadius:"md",p:4,children:[e(Ql,{children:s(O,{spacing:2,children:[e(P,{fontSize:"lg",children:Ko(T)}),e(u,{children:T})]})}),s(Zl,{children:[F,q!==void 0?s(u,{as:"span",ml:2,fontSize:"sm",color:"gray.500",children:[Math.round((q||0)*100),"%"]}):null]})]},T)),le.length===0&&!h?e(P,{borderWidth:"1px",borderRadius:"md",p:4,children:e(u,{color:"gray.500",children:t("pages.accessInsights.noData","No recent connections found.")})}):null]}),y.length>0?s(P,{borderWidth:"1px",borderRadius:"md",p:4,children:[e(u,{fontWeight:"bold",mb:2,children:t("pages.accessInsights.operatorSummary","Operators by unique IPs")}),e(O,{spacing:3,flexWrap:"wrap",children:y.map(([T,F])=>s(fr,{variant:"outline",px:3,py:2,display:"flex",alignItems:"center",gap:2,children:[$o(T),e(u,{children:T}),e(u,{fontWeight:"bold",children:F})]},T))})]}):null,R.length>0?s(P,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(O,{justify:"space-between",align:"center",mb:2,children:[e(u,{fontWeight:"bold",children:t("pages.accessInsights.unmatchedTitle","Unmapped destinations")}),e(kt,{label:t("pages.accessInsights.copyUnmatched","Copy as JSON"),children:e(qe,{"aria-label":"copy-unmatched",icon:e(Rd,{width:18}),size:"sm",onClick:()=>navigator.clipboard.writeText(JSON.stringify(R,null,2))})})]}),s(Ks,{size:"sm",variant:"simple",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:t("pages.accessInsights.destination","Destination")}),e(Xe,{children:t("pages.accessInsights.ip","IP")})]})}),e(as,{children:R.slice(0,50).map((T,F)=>s(Lt,{children:[e(Le,{fontFamily:"mono",fontSize:"sm",children:T.destination||"-"}),e(Le,{fontFamily:"mono",fontSize:"sm",children:T.destination_ip||"-"})]},`${T.destination}-${T.destination_ip||"noip"}-${F}`))})]}),R.length>50?e(u,{mt:2,color:"gray.500",fontSize:"sm",children:t("pages.accessInsights.unmatchedMore","{{count}} more entries not shown",{count:R.length-50})}):null]}):null,s(we,{spacing:4,opacity:i?1:.3,filter:i?"none":"blur(2px)",children:[ae.map(T=>s(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(O,{justify:"space-between",align:"start",flexWrap:"wrap",children:[s(pe,{align:"start",spacing:1,children:[e(u,{fontWeight:"bold",children:T.user_label}),s(u,{fontSize:"sm",color:"gray.500",children:[t("pages.accessInsights.ips","IPs"),":"," ",(T.sources||[]).join(", ")||"-"]}),s(u,{fontSize:"sm",color:"gray.500",children:[t("pages.accessInsights.route","Route"),":"," ",T.route||"-"]}),s(u,{fontSize:"sm",color:"gray.500",children:[t("pages.accessInsights.lastSeen","Last seen"),":"," ",Ue(T.last_seen).format("HH:mm:ss")]}),T.operator_counts&&Object.keys(T.operator_counts).length>0?e(O,{spacing:2,wrap:"wrap",children:Object.entries(T.operator_counts).map(([F,q])=>s(fr,{variant:"outline",display:"flex",alignItems:"center",gap:2,children:[$o(F),e(u,{children:F}),s(u,{as:"span",children:["(",q,")"]})]},F))}):null]}),s(fr,{colorScheme:"purple",children:[t("pages.accessInsights.connections","Connections"),":"," ",T.connections]})]}),s(Ks,{size:"sm",mt:3,children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:t("pages.accessInsights.platform","Platform")}),e(Xe,{isNumeric:!0,children:t("pages.accessInsights.connections","Connections")}),e(Xe,{children:t("pages.accessInsights.destination","Destination")})]})}),e(as,{children:T.platforms.map(F=>s(Lt,{children:[e(Le,{children:s(O,{spacing:2,children:[e(P,{fontSize:"lg",color:"inherit",children:Ko(F.platform)}),e(u,{fontWeight:"semibold",color:"inherit",children:F.platform})]})}),e(Le,{isNumeric:!0,children:F.connections}),e(Le,{children:e(u,{fontSize:"sm",color:"gray.600",children:(F.destinations||[]).slice(0,3).join(", ")})})]},F.platform))})]})]},T.user_key)),ae.length===0&&!h?e(P,{borderWidth:"1px",borderRadius:"md",p:4,children:e(u,{color:"gray.500",children:t("pages.accessInsights.noData","No recent connections found.")})}):null,h?s(O,{spacing:2,justify:"center",children:[e(zt,{size:"sm"}),e(u,{color:"gray.500",children:t("pages.accessInsights.loading","Loading access log...")})]}):null]})]}):e(P,{p:6,children:e(u,{color:"gray.500",children:t("pages.accessInsights.noPermission","You do not have access to Xray insights.")})})},Qh={search:"",limit:10,offset:0,sort:"username"},Us=ni((t,n)=>({admins:[],total:0,loading:!1,lastFetchedAt:null,currentRequestKey:null,inflight:null,filters:Qh,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r,o){const{filters:a,lastFetchedAt:i,loading:l,currentRequestKey:c,inflight:h}=n(),p=Date.now(),m=(o==null?void 0:o.force)===!0,g=Boolean(r&&Object.keys(r).length);if(!m&&!g&&i&&p-i<6e4)return;const v={...a,...r},b={};v.search&&(b.username=v.search),v.offset!==void 0&&(b.offset=v.offset),v.limit!==void 0&&(b.limit=v.limit),v.sort&&(v.sort==="data_usage"?b.sort="users_usage":v.sort==="data_limit"?b.sort="data_limit":b.sort=v.sort);const S=JSON.stringify(b);if(l&&c===S&&h)return h;if(!m&&i&&p-i<6e4&&c===S)return;t({loading:!0});const f=(async()=>{try{const w=await Ee("/admins",{query:b}),{admins:W,total:z}=Array.isArray(w)?{admins:w,total:w.length}:{admins:w.admins||[],total:w.total||0};t(le=>{const R=le.adminInDetails?W.find(K=>{var y;return K.username===((y=le.adminInDetails)==null?void 0:y.username)})||le.adminInDetails:null;return{admins:W,total:z,adminInDetails:R,lastFetchedAt:p,currentRequestKey:S}})}catch(w){console.error("Failed to fetch admins:",w),t({admins:[],total:0,adminInDetails:null,lastFetchedAt:p,currentRequestKey:S})}finally{t({loading:!1,inflight:null})}})();return t({inflight:f,currentRequestKey:S}),f},setFilters(r){t(o=>({filters:{...o.filters,...r}}))},onFilterChange(r){t(o=>({filters:{...o.filters,...r}})),n().fetchAdmins(r,{force:!0})},async createAdmin(r){await Ee("/admin",{method:"POST",body:r}),await n().fetchAdmins(void 0,{force:!0})},async updateAdmin(r,o){await Ee(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:o}),await n().fetchAdmins(void 0,{force:!0})},async deleteAdmin(r){await Ee(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await n().fetchAdmins(void 0,{force:!0})},async resetUsage(r){await Ee(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await n().fetchAdmins(void 0,{force:!0})},async disableAdmin(r,o){await Ee(`/admin/${encodeURIComponent(r)}/disable`,{method:"POST",body:{reason:o}}),await n().fetchAdmins(void 0,{force:!0})},async enableAdmin(r){await Ee(`/admin/${encodeURIComponent(r)}/enable`,{method:"POST"}),await n().fetchAdmins(void 0,{force:!0})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}}));function Ke(t,n=2,r=!1){if(!+t){const h=[0,"B"];return r?h:`${h[0]} ${h[1]}`}const o=1024,a=n<0?0:n,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(t)/Math.log(o)),c=parseFloat((t/o**l).toFixed(a));return r?[c,i[l]]:`${c} ${i[l]}`}const Zh=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},jh=(t,n)=>!t||t<=0?n!=null?n:"\u221E":`${t}`,Ha=(t,n)=>!t||t<=0?n!=null?n:"\u221E":Ke(t,2),ep=()=>{var K,y,ae,Se,ve,T,F,q,$,Q,U,Z,se,M,be,ee;const{t}=je(),{isAdminDetailsOpen:n,adminInDetails:r,closeAdminDetails:o}=Us(Ie=>({isAdminDetailsOpen:Ie.isAdminDetailsOpen,adminInDetails:Ie.adminInDetails,closeAdminDetails:Ie.closeAdminDetails})),a=Fe("gray.50","whiteAlpha.50"),i=(K=r==null?void 0:r.active_users)!=null?K:0,l=(y=r==null?void 0:r.users_limit)!=null?y:null,c=t("admins.details.unlimited","Unlimited"),h=l&&l>0?String(l):c;(ae=r==null?void 0:r.users_count)!=null;const p=(Se=r==null?void 0:r.limited_users)!=null?Se:0,m=(ve=r==null?void 0:r.expired_users)!=null?ve:0,g=(T=r==null?void 0:r.online_users)!=null?T:0,v=(F=r==null?void 0:r.on_hold_users)!=null?F:0,b=(q=r==null?void 0:r.disabled_users)!=null?q:0,S=($=r==null?void 0:r.users_usage)!=null?$:0,f=(Q=r==null?void 0:r.data_limit)!=null?Q:null,w=f&&f>0?Math.max(f-S,0):null,W=(U=r==null?void 0:r.lifetime_usage)!=null?U:null,z=(Z=r==null?void 0:r.data_limit_allocated)!=null?Z:0,le=(se=r==null?void 0:r.reset_bytes)!=null?se:0,R=(M=r==null?void 0:r.unlimited_users_usage)!=null?M:0;return s(Gt,{isCentered:!0,isOpen:n,onClose:o,scrollBehavior:"inside",size:"xl",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{bg:a,children:s(we,{spacing:1,children:[s(O,{spacing:2,children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:(be=r==null?void 0:r.username)!=null?be:t("admins.details.title","Admin details")}),r&&e(fr,{fontSize:"xs",px:2,py:.5,borderRadius:"full",colorScheme:r.role===Ye.FullAccess?"orange":r.role===Ye.Sudo?"purple":"gray",children:r.role===Ye.FullAccess?t("admins.roles.fullAccess","Full access"):r.role===Ye.Sudo?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard")})]}),r&&e(u,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:i,limit:h})})]})}),e(Qt,{}),e(It,{children:r?s(we,{spacing:8,children:[s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),s(Ve,{columns:{base:2,md:3},spacing:4,children:[e(Xr,{label:t("admins.details.activeLabel","Active"),value:String(i),valueColor:"blue.600"}),e(Xr,{label:t("admins.details.onlineLabel","Online"),value:String(g),valueColor:"green.600"}),e(Xr,{label:t("admins.details.limitedLabel","Limited"),value:String(p),valueColor:"orange.600"}),e(Xr,{label:t("status.expired","Expired"),value:String(m),valueColor:"red.600"}),e(Xr,{label:t("status.on_hold","On hold"),value:String(v),valueColor:"yellow.600"}),e(Xr,{label:t("status.disabled","Disabled"),value:String(b),valueColor:"gray.600"})]}),s(Ve,{columns:{base:2,md:2},spacing:4,mt:3,children:[e(Xr,{label:t("admins.details.totalUsers","Total users"),value:String((ee=r.users_count)!=null?ee:0),valueColor:"blue.600"}),e(Xr,{label:t("admins.details.usersLimit","Users limit"),value:jh(l,c)})]})]}),s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),s(Ve,{columns:{base:2,md:4},spacing:4,children:[e(Xr,{label:t("admins.details.used","Used"),value:Ke(S,2)}),e(Xr,{label:t("admins.details.limit","Limit"),value:Ha(f,c)}),e(Xr,{label:t("admins.details.remaining","Remaining"),value:Ha(w,c)}),e(Xr,{label:t("admins.details.lifetime","Lifetime usage"),value:Ha(W,void 0)})]})]}),s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:t("admins.details.allocationSection","Data allocation")}),s(Ve,{columns:{base:2,md:3},spacing:4,children:[e(Xr,{label:t("admins.details.dataAllocated","Allocated data"),value:Ke(z,2)}),e(Xr,{label:t("admins.details.resetVolume","Reset volume"),value:Ke(le,2)}),e(Xr,{label:t("admins.details.unlimitedUsage","Unlimited users usage"),value:Ke(R,2)})]})]})]}):e(P,{py:8,children:e(u,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(Bt,{children:e(V,{variant:"outline",mr:3,onClick:o,children:t("close","Close")})})]})]})},Xr=({label:t,value:n,valueColor:r})=>s(P,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(u,{fontWeight:"semibold",color:r||void 0,children:n})]}),ir=(t,n,r)=>{var o;if((o=t.response)!=null&&o._data){if(typeof t.response._data.detail=="string")return n({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(a=>{r.setError(a,{message:t.response._data.detail[a]})});return}}return n({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},gr=(t,n)=>n({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),tp=[{key:nt.Create,label:"admins.permissions.createUser"},{key:nt.Delete,label:"admins.permissions.deleteUser"},{key:nt.ResetUsage,label:"admins.permissions.resetUsage"},{key:nt.Revoke,label:"admins.permissions.revoke"},{key:nt.CreateOnHold,label:"admins.permissions.createOnHold"},{key:nt.AllowUnlimitedData,label:"admins.permissions.unlimitedData"},{key:nt.AllowUnlimitedExpire,label:"admins.permissions.unlimitedExpire"},{key:nt.AllowNextPlan,label:"admins.permissions.nextPlan"},{key:nt.AdvancedActions,label:"admins.permissions.advancedActions"},{key:nt.SetFlow,label:"admins.permissions.setFlow"},{key:nt.AllowCustomKey,label:"admins.permissions.customKey"}],rp=[{key:Nr.View,label:"admins.permissions.viewAdmins"},{key:Nr.Edit,label:"admins.permissions.editAdmins"},{key:Nr.ManageSudo,label:"admins.permissions.manageSudo"}],sp=[{key:Et.Usage,label:"admins.sections.usage"},{key:Et.Admins,label:"admins.sections.admins"},{key:Et.Services,label:"admins.sections.services"},{key:Et.Hosts,label:"admins.sections.hosts"},{key:Et.Nodes,label:"admins.sections.nodes"},{key:Et.Integrations,label:"admins.sections.integrations"},{key:Et.Xray,label:"admins.sections.xray"}],np=[{key:ba.SelfMyAccount,label:"admins.self.myaccount"},{key:ba.SelfChangePassword,label:"admins.self.changePassword"},{key:ba.SelfApiKeys,label:"admins.self.apiKeys"}],Pc=({value:t,onChange:n,maxDataLimitValue:r,onMaxDataLimitChange:o,maxDataLimitError:a,showReset:i=!1,onReset:l,hideExtendedSections:c=!1,isReadOnly:h=!1})=>{const{t:p}=je(),m=(v,b,S)=>{if(h)return;const f={...t[v],[b]:S},w={...t,[v]:f};n(w)},g=v=>{o==null||o(v.target.value)};return s(we,{spacing:6,children:[s(O,{justify:"space-between",align:"center",children:[e(u,{fontWeight:"semibold",children:p("admins.permissions.userCapabilities","User capabilities")}),i&&l&&e(V,{size:"xs",variant:"ghost",onClick:l,isDisabled:h,children:p("admins.permissions.resetToDefaults","Reset to defaults")})]}),e(Ve,{columns:{base:1,md:2},spacing:3,children:tp.map(({key:v,label:b})=>s(O,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(u,{fontSize:"sm",children:p(b)}),e(_t,{isChecked:Boolean(t.users[v]),isDisabled:h,onChange:S=>m("users",v,S.target.checked)})]},v))}),s(_,{isInvalid:Boolean(a),children:[e(D,{children:p("admins.permissions.maxDataPerUser","Max per user data (GB)")}),e(kt,{label:p("admins.permissions.enableUnlimitedFirst","Enable unlimited data first to set this value."),isDisabled:Boolean(t.users.allow_unlimited_data),hasArrow:!0,openDelay:200,placement:"top",gutter:6,shouldWrapChildren:!0,children:e(Ce,{type:"number",min:"0",step:"1",placeholder:p("admins.permissions.maxDataHint","Leave empty for unlimited"),value:r,onChange:g,isDisabled:!t.users.allow_unlimited_data||h})}),a?e(Ps,{children:a}):e(br,{children:t.users.allow_unlimited_data?p("admins.permissions.maxDataDescription","Applies when this admin creates or edits users."):p("admins.permissions.limitDisabledHint","Unlimited data must be allowed before setting a cap.")})]}),!c&&s(we,{spacing:3,children:[e(u,{fontWeight:"semibold",children:p("admins.permissions.manageAdminsTitle","Admin management")}),e(Ve,{columns:{base:1,md:2},spacing:3,children:rp.map(({key:v,label:b})=>s(O,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(u,{fontSize:"sm",children:p(b)}),e(_t,{isChecked:Boolean(t.admin_management[v]),isDisabled:h,onChange:S=>m("admin_management",v,S.target.checked)})]},v))})]}),!c&&s(we,{spacing:3,children:[e(u,{fontWeight:"semibold",children:p("admins.permissions.sectionAccess","Section access")}),e(Ve,{columns:{base:1,md:2},spacing:3,children:sp.map(({key:v,label:b})=>s(O,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(u,{fontSize:"sm",children:p(b)}),e(_t,{isChecked:Boolean(t.sections[v]),isDisabled:h,onChange:S=>m("sections",v,S.target.checked)})]},v))})]}),s(we,{spacing:3,children:[e(u,{fontWeight:"semibold",children:p("admins.permissions.self.title")}),e(Ve,{columns:{base:1,md:2},spacing:3,children:np.map(({key:v,label:b})=>{var S;return s(O,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(u,{fontSize:"sm",children:p(b)}),e(_t,{isChecked:Boolean((S=t.self_permissions)==null?void 0:S[v]),isDisabled:h,onChange:f=>m("self_permissions",v,f.target.checked)})]},v)})})]})]})},Ec=({isOpen:t,onClose:n,admin:r})=>{var S,f;const{t:o}=je(),a=cr(),i=Us(w=>w.updateAdmin),[l,c]=d.exports.useState((S=r==null?void 0:r.permissions)!=null?S:ji),[h,p]=d.exports.useState(""),[m,g]=d.exports.useState(!1),v=(r==null?void 0:r.role)===Ye.FullAccess;d.exports.useEffect(()=>{var w;r?(c((w=r.permissions)!=null?w:ji),p(r.permissions.users.max_data_limit_per_user?String(Math.floor(r.permissions.users.max_data_limit_per_user/(1024*1024*1024))):"")):(c(ji),p(""))},[r]);const b=async()=>{if(!!r&&!v){g(!0);try{await i(r.username,{permissions:l}),gr(o("admins.permissions.updateSuccess","Permissions updated"),a),n()}catch(w){ir(w,a)}finally{g(!1)}}};return s(Gt,{isOpen:t,onClose:n,size:"lg",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:o("admins.permissions.modalTitle",{username:(f=r==null?void 0:r.username)!=null?f:""})}),e(Qt,{}),s(It,{children:[v&&e(u,{color:"gray.500",mb:3,children:o("admins.permissions.fullAccessLocked")}),e(Pc,{value:l,onChange:c,showReset:!v,onReset:()=>c(ji),maxDataLimitValue:h,onMaxDataLimitChange:w=>{p(w);const W=Number(w);c(z=>({...z,users:{...z.users,max_data_limit_per_user:!w||Number.isNaN(W)?null:Math.max(0,W)*1024*1024*1024}}))},hideExtendedSections:(r==null?void 0:r.role)===Ye.Standard,isReadOnly:v})]}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:n,children:o("cancel")}),e(V,{colorScheme:"primary",onClick:b,isLoading:m,isDisabled:!r||v,children:o("save")})]})]})]})},Ei=1024*1024*1024,ip={[Ye.Standard]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,set_flow:!1,allow_custom_key:!1,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},[Ye.Reseller]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,set_flow:!1,allow_custom_key:!1,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},[Ye.Sudo]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,set_flow:!0,allow_custom_key:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!1},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}},[Ye.FullAccess]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,set_flow:!0,allow_custom_key:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!0},self_permissions:{self_myaccount:!0,self_change_password:!0,self_api_keys:!0},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}}},xn=t=>JSON.parse(JSON.stringify(ip[t])),ap=t=>t&&t>0?String(Math.floor(t/Ei)):"",op=ye.object({users:ye.object({create:ye.boolean(),delete:ye.boolean(),reset_usage:ye.boolean(),revoke:ye.boolean(),create_on_hold:ye.boolean(),allow_unlimited_data:ye.boolean(),allow_unlimited_expire:ye.boolean(),allow_next_plan:ye.boolean(),advanced_actions:ye.boolean(),set_flow:ye.boolean(),allow_custom_key:ye.boolean(),max_data_limit_per_user:ye.number().nullable()}),admin_management:ye.object({can_view:ye.boolean(),can_edit:ye.boolean(),can_manage_sudo:ye.boolean()}),self_permissions:ye.object({self_myaccount:ye.boolean(),self_change_password:ye.boolean(),self_api_keys:ye.boolean()}),sections:ye.object({usage:ye.boolean(),admins:ye.boolean(),services:ye.boolean(),hosts:ye.boolean(),nodes:ye.boolean(),integrations:ye.boolean(),xray:ye.boolean()})}),lp=()=>{var N,B,A,k,L,te,Oe,ne;const{t}=je(),{userData:n}=Dr(),r=n.role===Ye.FullAccess,o=cr(),{admins:a,adminInDialog:i,isAdminDialogOpen:l,closeAdminDialog:c,createAdmin:h,updateAdmin:p}=Us(),m=d.exports.useMemo(()=>{var I;return i?(I=a.find(E=>E.username===i.username))!=null?I:i:null},[i,a]),g=d.exports.useMemo(()=>m?"edit":"create",[m]),v=d.exports.useMemo(()=>({[Ls.Active]:t("admins.statusActive","Active"),[Ls.Disabled]:t("admins.statusDisabled","Disabled"),[Ls.Deleted]:t("admins.statusDeleted","Deleted")}),[t]),b=m?(N=v[m.status])!=null?N:m.status:t("admins.statusNew","New admin"),S=d.exports.useMemo(()=>ye.object({username:g==="create"?ye.string().trim().min(3,{message:t("admins.validation.usernameMin")}):ye.string().optional(),password:ye.string().trim().optional().transform(E=>E===""?void 0:E).refine(E=>!E||E.length>=6,t("admins.validation.passwordMin")),telegram_id:ye.string().trim().optional().transform(E=>E===""?void 0:E).refine(E=>E===void 0||/^\d+$/.test(E),t("admins.validation.telegramNumeric")),role:ye.nativeEnum(Ye).optional(),data_limit:ye.string().trim().optional().transform(E=>E===""?void 0:E).refine(E=>E===void 0||/^\d+$/.test(E),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:ye.string().trim().optional().transform(E=>E===""?void 0:E).refine(E=>E===void 0||/^\d+$/.test(E),t("admins.validation.usersLimitNumeric","Users limit must be a number")),maxDataLimitPerUserGb:ye.string().trim().optional().transform(E=>E===""?void 0:E),permissions:op}).superRefine((E,G)=>{g==="create"&&!E.password&&G.addIssue({code:ye.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[g,t]),f=Es({resolver:Da(S),defaultValues:{username:"",password:"",telegram_id:"",role:Ye.Standard,permissions:xn(Ye.Standard),maxDataLimitPerUserGb:"",data_limit:"",users_limit:""}}),{register:w,handleSubmit:W,reset:z,formState:le,setValue:R,watch:K,setError:y}=f,[ae,Se]=d.exports.useState(!1),[ve,T]=d.exports.useState(!1),F=d.exports.useCallback(I=>{var ze;const E="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",G=E.length;if(typeof window<"u"&&((ze=window.crypto)==null?void 0:ze.getRandomValues)){const Ne=new Uint32Array(I);return window.crypto.getRandomValues(Ne),Array.from(Ne,Je=>E[Je%G]).join("")}return Array.from({length:I},()=>{const Ne=Math.floor(Math.random()*G);return E[Ne]}).join("")},[]),q=d.exports.useCallback(()=>{if(g==="edit")return;const I=F(8);R("username",I,{shouldDirty:!0,shouldValidate:!0})},[F,g,R]),$=d.exports.useCallback(()=>{const I=F(12);R("password",I,{shouldDirty:!0,shouldValidate:!0})},[F,R]),{errors:Q,isSubmitting:U}=le,Z=K("role");Ye.Standard;const se=K("permissions"),M=(B=K("maxDataLimitPerUserGb"))!=null?B:"",be=d.exports.useCallback(()=>{const I=Z!=null?Z:Ye.Standard;R("permissions",xn(I),{shouldDirty:!0}),R("maxDataLimitPerUserGb","",{shouldDirty:!0})},[R,Z]),ee=d.exports.useCallback(I=>{R("permissions",I,{shouldDirty:!0})},[R]),Ie=d.exports.useCallback(I=>{R("maxDataLimitPerUserGb",I,{shouldDirty:!0})},[R]);d.exports.useEffect(()=>{w("maxDataLimitPerUserGb"),w("permissions")},[w]),d.exports.useEffect(()=>{var I,E,G;if(l){const ze=(I=m==null?void 0:m.role)!=null?I:Ye.Standard,Ne=m&&(E=JSON.parse(JSON.stringify(m.permissions)))!=null?E:xn(ze);z({username:(G=m==null?void 0:m.username)!=null?G:"",password:"",telegram_id:(m==null?void 0:m.telegram_id)!==void 0&&(m==null?void 0:m.telegram_id)!==null?String(m.telegram_id):"",role:ze,permissions:Ne,maxDataLimitPerUserGb:ap(Ne.users.max_data_limit_per_user),data_limit:(m==null?void 0:m.data_limit)!==void 0&&(m==null?void 0:m.data_limit)!==null?String(Math.floor(m.data_limit/Ei)):"",users_limit:(m==null?void 0:m.users_limit)!==void 0&&(m==null?void 0:m.users_limit)!==null?String(m.users_limit):""})}},[m,l,z]),d.exports.useEffect(()=>{l||T(!1)},[l]);const me=W(async I=>{var ze,Ne,Je,H,ke;const E=(ze=I.role)!=null?ze:Ye.Standard;let G;if(g==="create"){const Me=JSON.parse(JSON.stringify((Ne=I.permissions)!=null?Ne:xn(E))),Be=(Je=I.maxDataLimitPerUserGb)==null?void 0:Je.trim();if(Be){const ot=Number(Be);if(Number.isNaN(ot)||ot<0){y("maxDataLimitPerUserGb",{type:"manual",message:t("admins.validation.invalidMaxDataLimit","Enter a positive number or leave empty.")});return}Me.users.max_data_limit_per_user=ot===0?null:Math.round(ot*Ei)}else Me.users.max_data_limit_per_user=null;G=Me}if(g==="edit"&&m){const Me=(H=m.active_users)!=null?H:0;if(I.users_limit){const Be=Number(I.users_limit);if(!Number.isNaN(Be)&&Be>0&&Be<Me){y("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:Me})});return}}}try{if(g==="create"){const Me={username:I.username.trim(),password:(ke=I.password)!=null?ke:"",role:E,permissions:G!=null?G:xn(E),telegram_id:I.telegram_id?Number(I.telegram_id):void 0,data_limit:I.data_limit?Number(I.data_limit)*Ei:void 0,users_limit:I.users_limit?Number(I.users_limit):void 0};await h(Me),gr(t("admins.createSuccess","Admin created"),o)}else if(m){const Me={role:E,telegram_id:I.telegram_id?Number(I.telegram_id):void 0,data_limit:I.data_limit?Number(I.data_limit)*Ei:void 0,users_limit:I.users_limit?Number(I.users_limit):void 0};I.password&&(Me.password=I.password),await p(m.username,Me),gr(t("admins.updateSuccess","Admin updated"),o)}c()}catch(Me){ir(Me,o,f)}}),J=s(pe,{spacing:4,align:"stretch",children:[g==="edit"&&(m==null?void 0:m.id)!==void 0&&s(_,{children:[e(D,{children:t("admins.idLabel","Admin ID")}),e(Ce,{value:String(m.id),isReadOnly:!0})]}),g==="edit"&&s(_,{children:[e(D,{children:t("admins.status","Status")}),e(Ce,{value:b,isReadOnly:!0})]}),s(_,{isInvalid:!!Q.username,children:[e(D,{children:t("username")}),s(Ar,{children:[e(Ce,{placeholder:t("admins.usernamePlaceholder","Admin username"),...w("username"),isDisabled:g==="edit"}),g==="create"&&e(Vr,{children:e(qe,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(Cn,{width:20}),onClick:q})})]}),e(Ps,{children:(A=Q.username)==null?void 0:A.message})]}),s(_,{isInvalid:!!Q.password,children:[e(D,{children:t("password")}),s(O,{spacing:2,children:[s(Ar,{children:[e(Ce,{placeholder:t("admins.passwordPlaceholder","Password"),type:ae?"text":"password",...w("password")}),e(Vr,{children:e(qe,{"aria-label":ae?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:ae?e(Jn,{width:16}):e(ln,{width:16}),onClick:()=>Se(!ae)})})]}),e(qe,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(Cn,{width:20}),onClick:$})]}),e(Ps,{children:(k=Q.password)==null?void 0:k.message}),g==="edit"&&e(u,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),s(_,{children:[e(D,{children:t("admins.roleLabel","Admin role")}),e(Fi,{value:Z!=null?Z:Ye.Standard,onChange:I=>R("role",I,{shouldDirty:!0}),children:s(pe,{align:"flex-start",spacing:2,children:[s(is,{value:Ye.Standard,children:[e(u,{fontWeight:"medium",children:t("admins.roles.standard","Standard")}),e(br,{m:0,children:t("admins.roles.standardDescription","Can manage own users; only user-related permissions are available.")})]}),s(is,{value:Ye.Reseller,children:[e(u,{fontWeight:"medium",children:t("admins.roles.reseller","Reseller")}),e(br,{m:0,children:t("admins.roles.resellerDescription","Can create and manage their own admins.")})]}),s(is,{value:Ye.Sudo,children:[e(u,{fontWeight:"medium",children:t("admins.roles.sudo","Sudo")}),e(br,{m:0,children:t("admins.roles.sudoDescription","Extended access to settings and other admins.")})]}),r&&s(is,{value:Ye.FullAccess,children:[e(u,{fontWeight:"medium",children:t("admins.roles.fullAccess","Full access")}),e(br,{m:0,children:t("admins.roles.fullAccessDescription","Complete control, including other sudo admins.")})]})]})})]}),g==="edit"&&((m==null?void 0:m.role)===Ye.FullAccess?e(u,{fontSize:"sm",color:"gray.500",children:t("admins.permissions.fullAccessLocked")}):e(V,{alignSelf:"flex-start",onClick:()=>T(!0),variant:"outline",children:t("admins.editPermissionsButton","Edit permissions")})),s(_,{isInvalid:!!Q.telegram_id,children:[e(D,{children:t("admins.telegramId","Telegram ID")}),e(Ce,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...w("telegram_id")}),e(Ps,{children:(L=Q.telegram_id)==null?void 0:L.message})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{isInvalid:!!Q.data_limit,children:[e(D,{children:t("admins.dataLimit","Data Limit (GB)")}),e(Ce,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...w("data_limit")}),e(Ps,{children:(te=Q.data_limit)==null?void 0:te.message}),e(u,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),s(_,{isInvalid:!!Q.users_limit,children:[e(D,{children:t("admins.usersLimit","Users Limit")}),e(Ce,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...w("users_limit")}),e(Ps,{children:(Oe=Q.users_limit)==null?void 0:Oe.message}),e(u,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})]});return s(Wt,{children:[s(Gt,{isOpen:l,onClose:c,size:"lg",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:g==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Qt,{}),e(It,{children:g==="create"?s(dn,{colorScheme:"primary",isFitted:!0,variant:"enclosed",children:[s(un,{children:[e(hr,{children:t("admins.detailsTabLabel","Details")}),e(hr,{children:t("admins.permissionsTabLabel","Permissions")})]}),s(hn,{children:[e(pr,{px:0,children:J}),e(pr,{px:0,children:e(Pc,{value:se!=null?se:xn(Z!=null?Z:Ye.Standard),onChange:ee,showReset:!0,onReset:be,maxDataLimitValue:M,onMaxDataLimitChange:Ie,maxDataLimitError:(ne=Q.maxDataLimitPerUserGb)==null?void 0:ne.message,hideExtendedSections:Z===Ye.Standard,isReadOnly:Z===Ye.FullAccess})})]})]}):J}),e(Bt,{children:s(O,{spacing:3,children:[e(V,{variant:"ghost",onClick:c,children:t("cancel")}),e(V,{colorScheme:"primary",onClick:me,isLoading:U,children:g==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]}),e(Ec,{isOpen:ve,onClose:()=>T(!1),admin:m})]})},cp="admin_data_limit_exhausted",zc={baseStyle:{strokeWidth:"2px",w:3,h:3}},dp=ue(Zd,zc),up=ue(jd,zc),hp=({status:t})=>{const{t:n}=je(),r=t===Ls.Active,o=r?dp:up,a=Fe({bg:r?"green.100":"red.100",color:r?"green.800":"red.800"},{bg:r?"green.900":"red.900",color:r?"green.200":"red.200"});return s(P,{display:"inline-flex",alignItems:"center",columnGap:1,px:2,py:.5,borderRadius:"md",bg:a.bg,color:a.color,fontSize:"xs",fontWeight:"medium",lineHeight:"1",w:"fit-content",children:[e(o,{w:3,h:3}),e(u,{textTransform:"capitalize",children:r?n("status.active","Active"):n("admins.disabledLabel","Disabled")})]})},pp=t=>{const{used:n,total:r,lifetimeUsage:o,...a}=t,i=r===0||r===null,l=!i&&n/r*100>=100;return s(we,{spacing:2,width:"100%",children:[e(ec,{orientation:"horizontal",value:i?100:Math.min(n/r*100,100),colorScheme:l?"red":"primary",...a,children:e(tc,{h:"6px",borderRadius:"full",children:e(rc,{borderRadius:"full"})})}),s(O,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},flexWrap:"wrap",children:[s(u,{children:[Ke(n,2)," /"," ",i?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ke(r,2)]}),o!=null&&s(u,{color:"blue.500",_dark:{color:"blue.300"},children:["lifetime: ",Ke(o,2)]})]})]})},mp=()=>{var lt,Mt,er;const{t,i18n:n}=je(),r=cr(),{userData:o}=Dr(),a=n.language==="fa",i=Fe("gray.50","whiteAlpha.100"),l=Fe("primary.50","primary.900"),c=Fe("white","gray.900"),h=Fe("gray.100","whiteAlpha.200"),p=Fe("gray.50","whiteAlpha.100");Fe("gray.100","whiteAlpha.200");const m=Fe("gray.600","gray.300"),g=Fe("surface.light","surface.dark"),v=Fe("light-border","gray.700"),{admins:b,loading:S,total:f,filters:w,onFilterChange:W,fetchAdmins:z,deleteAdmin:le,resetUsage:R,disableAdmin:K,enableAdmin:y,openAdminDialog:ae,openAdminDetails:Se,adminInDetails:ve}=Us(),T=d.exports.useRef(null),F=d.exports.useRef(null),{isOpen:q,onOpen:$,onClose:Q}=sr(),{isOpen:U,onOpen:Z,onClose:se}=sr(),{isOpen:M,onOpen:be,onClose:ee}=sr(),[Ie,me]=d.exports.useState(null),[J,N]=d.exports.useState(null),[B,A]=d.exports.useState(""),[k,L]=d.exports.useState(null),[te,Oe]=d.exports.useState(null),ne=d.exports.useMemo(()=>b.length?b.reduce((ie,st)=>{var Qe;return Math.max(ie,String((Qe=st.id)!=null?Qe:"").length)},0):0,[b]),I=ne?`calc(${ne}ch + 5px)`:void 0,E="120px",G=o.username,ze=o.role===Ye.FullAccess,Ne=(lt=o.permissions)==null?void 0:lt.admin_management,Je=Boolean((Ne==null?void 0:Ne[Nr.Edit])||ze),H=Boolean((Ne==null?void 0:Ne[Nr.ManageSudo])||ze),ke=ie=>ie.username===G?!0:ie.role===Ye.FullAccess||!Je?!1:ie.role===Ye.Sudo?H:!0,Me=ie=>{if(ie==="data_usage"||ie==="data_limit"){const st=w.sort===ie?`-${ie}`:ie;W({sort:st,offset:0})}else{const st=w.sort===ie?`-${ie}`:w.sort===`-${ie}`?void 0:ie;W({sort:st,offset:0})}},Be=ie=>{me(ie),$()},ot=async()=>{if(!!Ie)try{await le(Ie.username),gr(t("admins.deleteSuccess","Admin removed"),r),Q(),me(null)}catch(ie){ir(ie,r)}},X=async ie=>{L({type:"reset",username:ie.username});try{await R(ie.username),gr(t("admins.resetUsageSuccess","Usage reset"),r),z()}catch(st){ir(st,r)}finally{L(null)}},Ae=ie=>{N(ie),A(""),Z()},xe=()=>{se(),N(null),A("")},$e=ie=>{Oe(ie),be()},Ze=()=>{Oe(null),ee()},Vt=async()=>{if(!J)return;const ie=B.trim();if(!(ie.length<3)){L({type:"disableAdmin",username:J.username});try{await K(J.username,ie),gr(t("admins.disableAdminSuccess","Admin disabled"),r),xe(),z()}catch(st){ir(st,r)}finally{L(null)}}},ge=async ie=>{L({type:"enableAdmin",username:ie.username});try{await y(ie.username),gr(t("admins.enableAdminSuccess","Admin re-enabled"),r),z()}catch(st){ir(st,r)}finally{L(null)}},Te=({column:ie})=>{var Pt,Rt,Ft,We,ce;let st=!1,Qe=!1;return ie==="data"?(st=((Pt=w.sort)==null?void 0:Pt.includes("data_usage"))||((Rt=w.sort)==null?void 0:Rt.includes("data_limit")),Qe=st&&((Ft=w.sort)==null?void 0:Ft.startsWith("-"))):(st=(We=w.sort)==null?void 0:We.includes(ie),Qe=st&&((ce=w.sort)==null?void 0:ce.startsWith("-"))),e(_a,{style:{width:"1rem",height:"1rem",opacity:st?1:0,transform:st&&!Qe?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},Re=d.exports.useMemo(()=>[{key:"id",label:"ID"},{key:"username",label:t("username")},{key:"status",label:t("status")},{key:"users_count",label:t("users")},{key:"data",label:`${t("dataUsage")} / ${t("dataLimit")}`},{key:"actions",label:""}],[t]),ut=a?{className:"rb-rtl-table",dir:"ltr",sx:{"& th":{textAlign:"right"},"& td":{textAlign:"right"}}}:{};return S&&!b.length?e(P,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(zt,{})}):f?s(Wt,{children:[e(P,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",bg:c,borderColor:h,children:s(Ks,{variant:"simple",size:"sm",minW:{base:"100%",md:"800px"},...ut,children:[e(hs,{bg:p,color:m,children:e(Lt,{children:Re.map(ie=>e(Xe,{onClick:()=>ie.key==="username"||ie.key==="users_count"||ie.key==="data"||ie.key==="id"?Me(ie.key):void 0,cursor:ie.key==="username"||ie.key==="users_count"||ie.key==="data"||ie.key==="id"?"pointer":"default",textAlign:ie.key==="actions"?"right":ie.key==="id"?"center":a?"right":"left",display:{base:ie.key==="id"?"none":"table-cell",md:"table-cell"},px:ie.key==="id"?2:void 0,pr:ie.key==="id"?1:void 0,pl:ie.key==="id"?2:void 0,width:ie.key==="id"?I:void 0,minW:ie.key==="id"?I:void 0,maxW:ie.key==="id"?E:void 0,whiteSpace:ie.key==="id"?"nowrap":void 0,children:ie.key==="id"?e(u,{textAlign:"center",w:"full",children:ie.label}):s(O,{direction:a?"row-reverse":"row",justify:ie.key==="actions"?a?"flex-start":"flex-end":a?"flex-end":"flex-start",children:[e(u,{children:ie.label}),ie.key==="data"?s(Oi,{children:[e(qn,{as:qe,size:"xs",variant:"ghost",icon:e(Te,{column:"data"})}),s(Ui,{children:[e(zr,{onClick:()=>Me("data_usage"),children:t("admins.sortByUsage")}),e(zr,{onClick:()=>Me("data_limit"),children:t("admins.sortByLimit")})]})]}):ie.key==="username"||ie.key==="users_count"?e(Te,{column:ie.key}):null]})},ie.key))})}),e(as,{children:b.map((ie,st)=>{var Kt,$t,Ut,ft;const Qe=(ve==null?void 0:ve.username)===ie.username,Pt=ie.users_limit&&ie.users_limit>0?String(ie.users_limit):"\u221E",Rt=`${(Kt=ie.active_users)!=null?Kt:0}/${Pt}`,Ft=ke(ie),We=Ft&&ie.username!==G,ce=We&&ie.status!==Ls.Disabled,Pe=ie.disabled_reason===cp,fe=ie.disabled_reason?Pe?t("admins.disabledReason.dataLimitExceeded","Your data limit has been reached"):ie.disabled_reason:null,dt=We&&ie.status===Ls.Disabled&&!Pe,yt=We;return s(Lt,{className:st===b.length-1?"last-row":void 0,onClick:()=>Se(ie),cursor:"pointer",bg:Qe?l:void 0,_hover:{bg:i},transition:"background-color 0.15s ease-in-out",children:[e(Le,{display:{base:"none",md:"table-cell"},px:2,pr:1,pl:2,width:I,minW:I,maxW:E,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center",children:e(u,{fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},fontSize:"sm",children:ie.id})}),e(Le,{px:2,textAlign:a?"right":"left",children:e(kt,{label:ie.role===Ye.FullAccess?t("admins.roles.fullAccess","Full access"):ie.role===Ye.Sudo?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard"),placement:"top",children:e(u,{fontWeight:"medium",px:2,py:1,borderRadius:"md",bg:ie.role===Ye.FullAccess?"yellow.100":ie.role===Ye.Sudo?"purple.100":"gray.100",color:ie.role===Ye.FullAccess?"yellow.800":ie.role===Ye.Sudo?"purple.800":"gray.800",_dark:{bg:ie.role===Ye.FullAccess?"yellow.900":ie.role===Ye.Sudo?"purple.900":"gray.700",color:ie.role===Ye.FullAccess?"yellow.200":ie.role===Ye.Sudo?"purple.200":"gray.200"},display:"inline-block",children:ie.username})})}),e(Le,{textAlign:a?"right":"left",children:s(we,{spacing:1,align:a?"flex-end":"flex-start",maxW:"full",children:[e(hp,{status:ie.status}),ie.status===Ls.Disabled&&fe&&e(u,{fontSize:"xs",color:"red.400",mt:1,children:fe})]})}),e(Le,{textAlign:a?"right":"left",children:s(we,{spacing:0,align:a?"flex-end":"flex-start",children:[e(u,{fontSize:"xs",fontWeight:"semibold",children:Rt}),ie.online_users!==null&&ie.online_users!==void 0&&s(u,{fontSize:"xs",color:"green.600",_dark:{color:"green.400"},mt:1,children:[t("admins.details.onlineLabel","Online"),":"," ",ie.online_users]})]})}),e(Le,{textAlign:a?"right":"left",children:e(pp,{used:($t=ie.users_usage)!=null?$t:0,total:(Ut=ie.data_limit)!=null?Ut:null,lifetimeUsage:(ft=ie.lifetime_usage)!=null?ft:null})}),e(Le,{textAlign:a?"left":"right",children:s(Oi,{children:[e(qn,{as:qe,icon:e(Jl,{width:20}),variant:"ghost",isDisabled:!Ft&&!We,onClick:et=>et.stopPropagation()}),s(Ui,{onClick:et=>et.stopPropagation(),children:[Ft&&s(Wt,{children:[e(zr,{icon:e(cn,{width:20}),onClick:et=>{et.stopPropagation(),ae(ie)},children:t("edit")}),e(zr,{icon:e(jl,{width:20}),onClick:et=>{et.stopPropagation(),$e(ie)},children:t("admins.editPermissionsButton","Edit permissions")}),e(zr,{icon:e(gs,{width:20}),onClick:et=>{et.stopPropagation(),X(ie)},isDisabled:(k==null?void 0:k.username)===ie.username&&(k==null?void 0:k.type)==="reset",children:t("admins.resetUsage")})]}),(ce||dt||yt)&&Ft&&e(xa,{}),ce&&e(zr,{icon:e(eu,{width:20}),onClick:et=>{et.stopPropagation(),Ae(ie)},isDisabled:(k==null?void 0:k.username)===ie.username&&(k==null?void 0:k.type)==="disableAdmin",children:t("admins.disableAdmin","Disable admin")}),dt&&e(zr,{icon:e(tu,{width:20}),onClick:et=>{et.stopPropagation(),ge(ie)},isDisabled:(k==null?void 0:k.username)===ie.username&&(k==null?void 0:k.type)==="enableAdmin",children:t("admins.enableAdmin","Enable admin")}),yt&&(ce||dt)&&e(xa,{}),yt&&e(zr,{color:"red.500",icon:e(Vs,{width:20}),onClick:et=>{et.stopPropagation(),Be(ie)},children:t("delete")})]})]})})]},ie.username)})})]})}),e(Yn,{isOpen:q,leastDestructiveRef:T,onClose:Q,children:e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:s(Gn,{bg:g,borderWidth:"1px",borderColor:v,children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(It,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(Mt=Ie==null?void 0:Ie.username)!=null?Mt:""})}),s(Bt,{children:[e(V,{ref:T,onClick:Q,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(V,{colorScheme:"red",onClick:ot,ml:3,children:t("delete")})]})]})})}),e(Yn,{isOpen:U,leastDestructiveRef:F,onClose:xe,children:e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:s(Gn,{bg:g,borderWidth:"1px",borderColor:v,children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("admins.disableAdminTitle","Disable admin")}),s(It,{children:[e(u,{mb:3,children:t("admins.disableAdminMessage","All users owned by {{username}} will be disabled. Provide a reason for this action.",{username:(er=J==null?void 0:J.username)!=null?er:""})}),e(ns,{value:B,onChange:ie=>A(ie.target.value),placeholder:t("admins.disableAdminReasonPlaceholder","Reason for disabling")})]}),s(Bt,{children:[e(V,{ref:F,onClick:xe,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(V,{colorScheme:"red",onClick:Vt,ml:3,isDisabled:B.trim().length<3,isLoading:(k==null?void 0:k.type)==="disableAdmin"&&(k==null?void 0:k.username)===(J==null?void 0:J.username),children:t("admins.disableAdminConfirm","Disable admin")})]})]})})}),e(Ec,{isOpen:M,onClose:Ze,admin:te})]}):e(P,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(u,{children:t("admins.noAdmins")})})},gp=[{label:"d",seconds:24*60*60},{label:"h",seconds:60*60},{label:"m",seconds:60},{label:"s",seconds:1}],ya=(t=0)=>{const n=Math.max(0,Math.floor(t));if(n===0)return"0s";const r=[];let o=n;for(const a of gp){const i=Math.floor(o/a.seconds);i>0&&(r.push(`${i}${a.label}`),o-=i*a.seconds)}return r.join(" ")},ta="statistics-query-key",fp={baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}},bp=ue(ru,fp),Hr=t=>{var n;return(n=Zh(t))!=null?n:t.toString()},sn=t=>t?t.trim().replace(/^v+/i,"").split(/[-_]/)[0].trim():"",Tc=[{labelKey:"historyInterval.2m",seconds:120},{labelKey:"historyInterval.10m",seconds:600},{labelKey:"historyInterval.30m",seconds:1800},{labelKey:"historyInterval.1h",seconds:3600},{labelKey:"historyInterval.3h",seconds:10800},{labelKey:"historyInterval.5h",seconds:18e3}],yp=({isOpen:t,onClose:n,payload:r,intervalSeconds:o,onIntervalChange:a,t:i})=>{var f;const{colorMode:l}=fs(),h=Math.floor(Date.now()/1e3)-o,p=d.exports.useMemo(()=>!r||r.type==="network"||r.type==="panel"?[]:r.entries.filter(w=>w.timestamp>=h),[r,h]),m=d.exports.useMemo(()=>!r||r.type!=="network"?[]:r.entries.filter(w=>w.timestamp>=h),[r,h]),g=d.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.cpuEntries.filter(w=>w.timestamp>=h),[r,h]),v=d.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.memoryEntries.filter(w=>w.timestamp>=h),[r,h]),b=d.exports.useMemo(()=>r?r.type==="network"?[{name:i("networkIncoming"),data:m.map(w=>[w.timestamp*1e3,w.incoming])},{name:i("networkOutgoing"),data:m.map(w=>[w.timestamp*1e3,w.outgoing])}]:r.type==="panel"?[{name:i("cpuUsage"),data:g.map(w=>[w.timestamp*1e3,w.value])},{name:i("memoryUsage"),data:v.map(w=>[w.timestamp*1e3,w.value])}]:[{name:r.metricLabel,data:p.map(w=>[w.timestamp*1e3,w.value])}]:[],[p,m,g,v,r,i]),S=d.exports.useMemo(()=>({chart:{type:"line",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1},background:"transparent"},theme:{mode:l},stroke:{curve:"smooth"},xaxis:{type:"datetime",labels:{datetimeFormatter:{hour:"HH:mm"}}},yaxis:{decimalsInFloat:0},tooltip:{x:{format:"HH:mm:ss"}}}),[l]);return s(Gt,{isOpen:t,onClose:n,size:"xl",scrollBehavior:"inside",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:i("historyModalTitle",{metric:(f=r==null?void 0:r.title)!=null?f:""})}),e(Qt,{}),e(It,{children:s(we,{spacing:3,children:[e(xt,{wrap:"wrap",gap:2,children:Tc.map(w=>e(V,{size:"sm",variant:o===w.seconds?"solid":"outline",onClick:()=>a(w.seconds),children:i(w.labelKey)},w.seconds))}),e(ps,{options:S,series:b,type:"line",height:300})]})}),e(Bt,{children:e(V,{onClick:n,children:i("close")})})]})]})},xp=({values:t,accent:n})=>{const r=Fe("gray.600","gray.300"),o=t.length?t:[0],a=Math.max(...o,1),i=o.map((l,c)=>({value:l,id:`${c}-${l}`}));return e(O,{alignItems:"flex-end",spacing:"2px",mt:2,minH:"42px",w:"full",overflow:"hidden",children:i.map(({value:l,id:c})=>{const h=a>0?l/a*100:0,p=Math.max(4,Math.round(h/100*40));return e(P,{flex:"0 1 4px",minW:"2px",maxW:"4px",h:`${p}px`,bg:n!=null?n:r,borderRadius:"1px",transition:"all 0.2s"},c)})})},Ri=({label:t,value:n,history:r,accent:o,onOpen:a,actionLabel:i})=>s(we,{spacing:1,children:[s(O,{justifyContent:"space-between",alignItems:"center",children:[s(P,{children:[e(u,{fontSize:"xs",color:"gray.500",children:t}),e(u,{fontSize:"lg",fontWeight:"semibold",children:n})]}),a&&e(V,{size:"xs",variant:"ghost",onClick:a,children:i})]}),e(xp,{values:r,accent:o})]}),Zt=({label:t,value:n,colorScheme:r="gray"})=>{const o=Fe("gray.200","gray.700"),a=Fe("white","gray.900"),i=Fe(r==="gray"?"gray.800":`${r}.600`,r==="gray"?"gray.100":`${r}.300`);return s(P,{px:3,py:2,borderRadius:"md",borderWidth:"1px",borderColor:o,bg:a,_dark:{bg:"gray.800",borderColor:"gray.700"},children:[e(u,{fontSize:"xs",color:"gray.500",children:t}),e(u,{fontWeight:"semibold",color:i,children:n})]})},Sp=({data:t,t:n,onOpenHistory:r})=>{var p,m;const o=t.cpu_history.map(g=>g.value),a=t.memory_history.map(g=>g.value),i=t.network_history.map(g=>g.incoming),l=yr({queryKey:["panel-latest-release"],queryFn:async()=>{const g=await window.fetch("https://api.github.com/repos/rebeccapanel/Rebecca/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!g.ok)throw new Error("Failed to load latest panel release");return g.json()},refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:1}),c=((p=l.data)==null?void 0:p.tag_name)||((m=l.data)==null?void 0:m.name)||"",h=sn(c)&&sn(t.version)&&sn(c)!==sn(t.version);return e(jr,{p:5,borderRadius:"12px",boxShadow:"none",children:s(we,{spacing:4,children:[s(we,{direction:{base:"column",md:"row"},spacing:{base:2,md:4},justifyContent:"space-between",align:{base:"flex-start",md:"center"},children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:n("systemOverview")}),s(Bn,{spacing:2,justify:{base:"flex-start",md:"flex-end"},children:[e(an,{children:s(pt,{colorScheme:"gray",children:["v",t.version]})}),c&&e(an,{children:e(pt,{colorScheme:h?"green":"blue",children:h?n("system.updateAvailable",{version:c}):n("system.latestRelease",{version:c})})}),e(an,{children:s(pt,{colorScheme:"gray",children:[n("loadAverage"),":"," ",t.load_avg.length?t.load_avg.map(g=>g.toFixed(2)).join(" | "):"-"]})})]})]}),s(Ve,{columns:{base:1,md:3},gap:4,children:[e(Ri,{label:n("cpuUsage"),value:`${t.cpu_usage.toFixed(1)}%`,history:o,actionLabel:n("viewHistory"),onOpen:()=>r({type:"cpu",title:n("cpuUsage"),metricLabel:n("cpuUsage"),entries:t.cpu_history})}),e(Ri,{label:n("memoryUsage"),value:`${t.memory.percent.toFixed(1)}%`,history:a,actionLabel:n("viewHistory"),onOpen:()=>r({type:"memory",title:n("memoryUsage"),metricLabel:n("memoryUsage"),entries:t.memory_history})}),e(Ri,{label:n("networkHistory"),value:`${Ke(t.incoming_bandwidth_speed)}/s`,history:i,actionLabel:n("viewHistory"),onOpen:()=>r({type:"network",title:n("networkHistory"),entries:t.network_history})})]}),s(Ve,{columns:{base:1,md:2},gap:4,children:[e(Zt,{label:n("incomingSpeed"),value:`${Ke(t.incoming_bandwidth_speed)}/s`,colorScheme:"green"}),e(Zt,{label:n("outgoingSpeed"),value:`${Ke(t.outgoing_bandwidth_speed)}/s`,colorScheme:"blue"})]}),s(Ve,{columns:{base:1,md:3},gap:4,children:[e(Zt,{label:n("memoryUsage"),value:`${Ke(t.memory.current)} / ${Ke(t.memory.total)}`}),e(Zt,{label:n("swapUsage"),value:`${Ke(t.swap.current)} / ${Ke(t.swap.total)}`}),e(Zt,{label:n("diskUsage"),value:`${Ke(t.disk.current)} / ${Ke(t.disk.total)}`})]}),s(we,{direction:{base:"column",md:"row"},spacing:2,flexWrap:"wrap",alignItems:"flex-start",children:[s(pt,{colorScheme:"green",children:[n("systemUptime"),": ",ya(t.uptime_seconds)]}),s(pt,{colorScheme:"blue",children:[n("panelUptime"),": ",ya(t.panel_uptime_seconds)]}),s(pt,{colorScheme:"orange",children:[n("xrayUptime"),": ",ya(t.xray_uptime_seconds)]})]}),t.last_xray_error&&!t.xray_running&&s(P,{mt:4,p:4,borderRadius:"md",bg:"red.50",borderWidth:"1px",borderColor:"red.200",_dark:{bg:"rgba(239, 68, 68, 0.1)",borderColor:"red.800"},children:[e(O,{spacing:2,mb:2,alignItems:"center",children:s(u,{fontSize:"sm",fontWeight:"semibold",color:"red.600",_dark:{color:"red.400"},children:[n("coreError","Core Error"),":"]})}),e(u,{fontSize:"sm",color:"red.700",fontFamily:"mono",whiteSpace:"pre-wrap",wordBreak:"break-word",_dark:{color:"red.300"},children:t.last_xray_error})]}),t.last_telegram_error&&s(P,{mt:4,p:4,borderRadius:"md",bg:"orange.50",borderWidth:"1px",borderColor:"orange.200",_dark:{bg:"rgba(237, 137, 54, 0.1)",borderColor:"orange.800"},children:[s(O,{spacing:2,mb:2,alignItems:"center",justifyContent:"space-between",children:[s(u,{fontSize:"sm",fontWeight:"semibold",color:"orange.600",_dark:{color:"orange.400"},children:[n("telegramError","Telegram Error"),":"]}),e(V,{size:"xs",colorScheme:"orange",variant:"outline",onClick:()=>{window.location.href="/integrations"},children:n("goToTelegramSettings","Go to Telegram Settings")})]}),e(u,{fontSize:"sm",color:"orange.700",fontFamily:"mono",whiteSpace:"pre-wrap",wordBreak:"break-word",_dark:{color:"orange.300"},children:t.last_telegram_error})]})]})})},vp=({data:t,t:n,onOpenHistory:r})=>{const o=t.panel_cpu_history.map(i=>i.value),a=t.panel_memory_history.map(i=>i.value);return e(jr,{p:5,borderRadius:"12px",boxShadow:"none",children:s(we,{spacing:4,children:[s(O,{justifyContent:"space-between",alignItems:"center",children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:n("panelUsage")}),e(fr,{colorScheme:t.xray_running?"green":"red",children:t.xray_running?n("status.running"):n("status.stopped")})]}),s(Ve,{columns:{base:1,md:2},gap:4,children:[e(Ri,{label:n("cpuUsage"),value:`${t.panel_cpu_percent.toFixed(1)}%`,history:o,actionLabel:n("viewHistory"),onOpen:()=>r({type:"panel",title:n("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})}),e(Ri,{label:n("memoryUsage"),value:`${t.panel_memory_percent.toFixed(1)}%`,history:a,actionLabel:n("viewHistory"),onOpen:()=>r({type:"panel",title:n("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})})]}),s(Ve,{columns:{base:1,md:3},gap:4,children:[e(Zt,{label:n("threads"),value:Hr(t.app_threads),colorScheme:"purple"}),e(Zt,{label:n("appMemory"),value:Ke(t.app_memory),colorScheme:"blue"})]})]})})},wp=({value:t,t:n})=>{const r=Fe("gray.200","gray.700"),o=Fe("gray.50","gray.900"),a=Fe("primary.100","primary.900"),i=Fe("primary.500","primary.200");return e(P,{borderWidth:"1px",borderColor:r,borderRadius:"md",bg:o,p:4,children:s(O,{justifyContent:"space-between",alignItems:"center",children:[s(O,{alignItems:"center",spacing:3,children:[e(P,{p:2,borderRadius:"md",bg:a,children:e(bp,{color:i})}),e(u,{fontSize:"xs",color:"gray.500",children:n("UsersUsage")})]}),e(u,{fontSize:"2xl",fontWeight:"semibold",children:Ke(t)})]})})},kp=({data:t,t:n})=>e(jr,{p:5,borderRadius:"12px",boxShadow:"none",children:s(we,{spacing:4,children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:n("usersOverview")}),e(Zt,{label:n("totalUsersLabel"),value:Hr(t.total_user),colorScheme:"blue"}),e(wp,{value:t.panel_total_bandwidth,t:n}),s(Ve,{columns:{base:1,sm:2},gap:3,children:[e(Zt,{label:n("status.active"),value:Hr(t.users_active),colorScheme:"green"}),e(Zt,{label:n("status.disabled"),value:Hr(t.users_disabled),colorScheme:"red"}),e(Zt,{label:n("status.expired"),value:Hr(t.users_expired),colorScheme:"orange"}),e(Zt,{label:n("status.limited"),value:Hr(t.users_limited),colorScheme:"yellow"}),e(Zt,{label:n("status.on_hold"),value:Hr(t.users_on_hold),colorScheme:"purple"})]})]})}),_p=({data:t,t:n})=>t?e(jr,{p:5,borderRadius:"12px",boxShadow:"none",children:s(we,{spacing:4,children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:n("yourUsage")}),s(Ve,{columns:{base:1,md:2},gap:4,children:[e(Zt,{label:n("totalUsersLabel"),value:Hr(t.total_users),colorScheme:"blue"}),e(Zt,{label:n("consumedData"),value:Ke(t.consumed_bytes),colorScheme:"green"}),e(Zt,{label:n("builtData"),value:Ke(t.built_bytes),colorScheme:"purple"}),e(Zt,{label:n("resetData"),value:Ke(t.reset_bytes),colorScheme:"orange"})]})]})}):null,Cp=({data:t,t:n})=>t?e(jr,{p:5,borderRadius:"12px",boxShadow:"none",children:s(we,{spacing:4,children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:n("adminOverview")}),s(Ve,{columns:{base:1,md:2},gap:3,children:[e(Zt,{label:n("totalAdmins"),value:Hr(t.total_admins),colorScheme:"blue"}),e(Zt,{label:n("sudoAdmins"),value:Hr(t.sudo_admins),colorScheme:"purple"}),e(Zt,{label:n("fullAccessAdmins"),value:Hr(t.full_access_admins),colorScheme:"green"}),e(Zt,{label:n("standardAdmins"),value:Hr(t.standard_admins),colorScheme:"orange"})]}),t.top_admin_username&&s(P,{children:[s(u,{fontSize:"sm",color:"gray.500",children:[n("topAdmin"),":"," ",e(u,{as:"span",fontWeight:"semibold",children:t.top_admin_username})]}),s(u,{fontSize:"sm",color:"gray.500",children:[n("topAdminUsage"),": ",Ke(t.top_admin_usage)]})]})]})}):null,Ap=({data:t,t:n})=>{if(!t||!t.enabled)return null;const r=t.connected?"green":"red",o=t.connected?n("status.connected","Connected"):n("status.disconnected","Disconnected"),a=t.connected&&t.keys_cached>0,i=a?"green":"yellow",l=a?n("redis.warmedUp","Warmed Up"):n("redis.notWarmedUp","Not Warmed Up");return e(jr,{p:5,borderRadius:"12px",boxShadow:"none",children:s(we,{spacing:4,children:[s(O,{justifyContent:"space-between",alignItems:"center",children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:n("redisUsage","Redis Usage")}),s(O,{spacing:2,children:[e(fr,{colorScheme:i,children:l}),e(fr,{colorScheme:r,children:o})]})]}),t.connected?s(Wt,{children:[s(Ve,{columns:{base:1,md:2},gap:4,children:[e(Zt,{label:n("redisMemoryUsage","Memory Usage"),value:t.memory_percent>0?`${t.memory_percent.toFixed(1)}%`:n("noLimit","No Limit"),colorScheme:"blue"}),e(Zt,{label:n("redisUptime","Uptime"),value:ya(t.uptime_seconds),colorScheme:"green"})]}),s(Ve,{columns:{base:1,md:2},gap:4,children:[e(Zt,{label:n("redisMemoryUsed","Memory Used"),value:t.memory_percent>0?`${Ke(t.memory_used)} / ${Ke(t.memory_total)}`:Ke(t.memory_used),colorScheme:"purple"}),t.version&&e(Zt,{label:n("redisVersion","Version"),value:`v${t.version}`,colorScheme:"gray"})]}),s(Ve,{columns:{base:1,md:3},gap:4,children:[e(Zt,{label:n("redis.keysCached","Cached Keys"),value:Hr(t.keys_cached),colorScheme:a?"green":"yellow"}),e(Zt,{label:n("redis.totalKeys","Total Keys"),value:Hr(t.keys_count),colorScheme:"blue"}),e(Zt,{label:n("redis.hitRate","Hit Rate"),value:`${t.hit_rate.toFixed(1)}%`,colorScheme:t.hit_rate>80?"green":t.hit_rate>50?"yellow":"orange"})]}),s(Ve,{columns:{base:1,md:2},gap:4,children:[e(Zt,{label:n("redis.commandsProcessed","Commands Processed"),value:Hr(t.commands_processed),colorScheme:"purple"}),e(Zt,{label:n("redis.cacheHits","Cache Hits/Misses"),value:`${Hr(t.hits)} / ${Hr(t.misses)}`,colorScheme:"blue"})]})]}):e(P,{p:4,borderRadius:"md",bg:"red.50",borderWidth:"1px",borderColor:"red.200",_dark:{bg:"rgba(239, 68, 68, 0.1)",borderColor:"red.800"},children:e(u,{fontSize:"sm",color:"red.700",_dark:{color:"red.300"},children:n("redisNotConnected","Redis is not connected")})})]})})},Dp=t=>{var W,z;const{version:n}=Ot(),{userData:r}=Dr(),{t:o}=je(),{data:a}=yr({queryKey:"statistics-query-key",queryFn:()=>Ee("/system"),refetchInterval:3e3,onSuccess:({version:le})=>{n!==le&&Ot.setState({version:le})}}),[i,l]=d.exports.useState(null),[c,h]=d.exports.useState(Tc[0].seconds),p=yr({queryKey:["panel-latest-release"],queryFn:async()=>{const le=await window.fetch("https://api.github.com/repos/rebeccapanel/Rebecca/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!le.ok)throw new Error("Failed to load latest panel release");return le.json()},refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:1}),m=((W=p.data)==null?void 0:W.tag_name)||((z=p.data)==null?void 0:z.name)||"",g=(a==null?void 0:a.version)||n||"";sn(m)&&sn(g)&&(sn(m),sn(g));const v=r.role===Ye.Sudo||r.role===Ye.FullAccess,b=le=>{l(le)},S=[];a&&S.push(e(kp,{data:a,t:o},"users-overview"));const f=(a==null?void 0:a.personal_usage)&&e(_p,{data:a.personal_usage,t:o},"your-usage");f&&S.push(f);const w=S.length>1?2:1;return s(we,{spacing:4,width:"full",...t,children:[a&&s(Wt,{children:[e(Sp,{data:a,t:o,onOpenHistory:b}),e(vp,{data:a,t:o,onOpenHistory:b}),e(Ap,{data:a.redis_stats,t:o})]}),S.length>0&&e(Ve,{columns:{base:1,md:w},gap:4,children:S}),v&&a&&e(Cp,{data:a.admin_overview,t:o}),e(yp,{isOpen:Boolean(i),onClose:()=>l(null),payload:i,intervalSeconds:c,onIntervalChange:h,t:o})]})},Mc="rebecca-num-users-per-page",qo=10,Ip=()=>{const t=localStorage.getItem(Mc)||qo.toString();return parseInt(t,10)||qo},Pp=t=>localStorage.setItem(Mc,t),Nc="-created_at",Ep=60*60*1e3,zp=t=>{const n={sort:t.sort||Nc};return Object.keys(t).forEach(r=>{if(r==="sort")return;const o=t[r];if(Array.isArray(o)){if(o.length===0)return;n[r]=o;return}o==null||o===""||(n[r]=o)}),n},Tp=t=>JSON.stringify(Object.keys(t).sort().map(n=>[n,t[n]])),Mp=(t,n={})=>{var p;const r=zp(t),o=Tp(r),{lastUsersFetchAt:a,usersCacheKey:i,users:l}=Ot.getState(),c=Date.now();if(!n.force&&a&&i===o&&c-a<Ep)return Promise.resolve(l);Ot.setState({loading:!0});const h={...r};return(p=r.advancedFilters)!=null&&p.length&&(h.filter=r.advancedFilters),r.owner&&(h.admin=r.owner),r.serviceId!==void 0&&(h.service_id=r.serviceId),delete h.advancedFilters,delete h.owner,delete h.serviceId,Ee("/users",{query:h}).then(m=>{var S,f;const g=(S=m.users_limit)!=null?S:null,v=(f=m.active_total)!=null?f:null,b=g!=null&&g>0&&v!==null?v>=g:!1;return Ot.setState({users:m,linkTemplates:m.link_templates,isUserLimitReached:b,lastUsersFetchAt:Date.now(),usersCacheKey:o}),m}).finally(()=>{Ot.setState({loading:!1})})},Bi=()=>Ee("/inbounds").then(t=>{Ot.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{Ot.setState({loading:!1})}),Ot=ni(su((t,n)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{limit:Ip(),sort:Nc,advancedFilters:[],owner:void 0,serviceId:void 0},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{Mp(n().filters,{force:r})},resetAllUsage:()=>Ee("/users/reset",{method:"POST"}).then(()=>{n().onResetAllUsage(!1),n().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{if(!r){t({editingUser:null});return}Ee(`/user/${r.username}`).then(o=>{t({editingUser:o})}).catch(()=>t({editingUser:null}))},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...n().filters,...r}}),n().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),Ee(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),n().refetchUsers(!0),Ii.invalidateQueries(ta)})),createUser:r=>Ee("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(!0),Ii.invalidateQueries(ta)}),createUserWithService:r=>Ee("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(!0),Ii.invalidateQueries(ta)}),editUser:(r,o)=>Ee(`/v2/users/${r}`,{method:"PUT",body:o}).then(()=>{n().onEditingUser(null),n().refetchUsers(!0)}),fetchUserUsage:(r,o)=>{for(const a in o)o[a]||delete o[a];return Ee(`/user/${r.username}/usage`,{method:"GET",query:o})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>Ee(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),n().refetchUsers(!0)}),revokeSubscription:r=>Ee(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(o=>{t({revokeSubscriptionUser:null,editingUser:o}),n().refetchUsers(!0)}),performBulkUserAction:r=>Ee("/users/actions",{method:"POST",body:r}).then(o=>(n().refetchUsers(!0),Ii.invalidateQueries(ta),o)),onEditingCore:r=>t({isEditingCore:r})}))),on=ni((t,n)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const o=await Ee("/v2/services",{query:r});t({services:o.services,total:o.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const o=await Ee(`/v2/services/${r}`);return t({serviceDetail:o}),o}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const o=await Ee("/v2/services",{method:"POST",body:r});return t({serviceDetail:o}),await n().fetchServices(),o}finally{t({isSaving:!1})}},async updateService(r,o){t({isSaving:!0});try{const a=await Ee(`/v2/services/${r}`,{method:"PUT",body:o});return t({serviceDetail:a}),await n().fetchServices(),a}finally{t({isSaving:!1})}},async deleteService(r,o){t({isSaving:!0});try{await Ee(`/v2/services/${r}`,{method:"DELETE",body:o}),t({serviceDetail:null}),await n().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const o=await Ee(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:o}),await n().fetchServices(),o}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})},async performServiceUserAction(r,o){return Ee(`/v2/services/${r}/users/actions`,{method:"POST",body:o})}})),Np=["expired","limited"],Lp=()=>{var G,ze,Ne,Je;const{t}=je(),n=cr(),{performBulkUserAction:r}=Ot(),{userData:o}=Dr(),{isOpen:a,onOpen:i,onClose:l}=sr(),[c,h]=d.exports.useState(""),[p,m]=d.exports.useState(""),[g,v]=d.exports.useState(""),[b,S]=d.exports.useState(["expired","limited"]),[f,w]=d.exports.useState(!1),[W,z]=d.exports.useState(!1),[le,R]=d.exports.useState(!1),[K,y]=d.exports.useState(!1),[ae,Se]=d.exports.useState(!1),[ve,T]=d.exports.useState("my_users"),[F,q]=d.exports.useState(""),[$,Q]=d.exports.useState(""),[U,Z]=d.exports.useState(!1),{admins:se,fetchAdmins:M}=Us(),be=on(),ee=o.role===Ye.Sudo||o.role===Ye.FullAccess,Ie=ee,me=Boolean((Ne=(ze=(G=o.permissions)==null?void 0:G.users)==null?void 0:ze.advanced_actions)!=null?Ne:!0);d.exports.useEffect(()=>{a&&ee&&M({limit:200,offset:0}),a&&be.services.length===0&&be.fetchServices({limit:200,offset:0})},[M,ee,a,be]);const J=()=>ee?ve==="all_users"?null:ve==="my_users"?o.username:ve.startsWith("admin:")?ve.replace(/^admin:/,""):o.username:o.username,N=(H,ke)=>{n({title:t("filters.advancedActions.modalTitle","Advanced actions"),description:H,status:ke,isClosable:!0})},B=(H,ke)=>{var Me;return((Me=H==null?void 0:H.data)==null?void 0:Me.detail)||(H==null?void 0:H.message)||ke},A=H=>{N(H!=null?H:t("filters.advancedActions.error.general","Unable to perform action"),"error")},k=()=>F==="no_service"?{service_id_is_null:!0}:F?{service_id:Number(F)}:{},L=async H=>{var Be;const ke=Number(c);if(!Number.isFinite(ke)||ke<=0){N(t("filters.advancedActions.error.invalidDays","Enter a positive number of days"),"warning");return}const Me=H==="extend_expire"?w:z;Me(!0);try{const ot=J(),X={action:H,days:Math.floor(ke),admin_username:ot,...k()},Ae=await r(X);N(t("filters.advancedActions.success.expire",{count:(Be=Ae.count)!=null?Be:0}),"success"),h("")}catch(ot){A(B(ot))}finally{Me(!1)}},te=async H=>{var Be;const ke=Number(p);if(!Number.isFinite(ke)||ke<=0){N(t("filters.advancedActions.error.invalidGigabytes","Enter a positive traffic value"),"warning");return}const Me=H==="increase_traffic"?R:y;Me(!0);try{const ot=J(),X={action:H,gigabytes:ke,admin_username:ot,...k()},Ae=await r(X);N(t("filters.advancedActions.success.traffic",{count:(Be=Ae.count)!=null?Be:0,value:ke}),"success"),m("")}catch(ot){A(B(ot))}finally{Me(!1)}},Oe=async()=>{var ke;const H=Number(g);if(!Number.isFinite(H)||H<=0){N(t("filters.advancedActions.error.invalidDays","Enter a positive number of days"),"warning");return}if(!b.length){N(t("filters.advancedActions.error.noStatuses","Select at least one status"),"warning");return}Se(!0);try{const Me=J(),Be={action:"cleanup_status",days:Math.floor(H),statuses:b,admin_username:Me,...k()},ot=await r(Be);N(t("filters.advancedActions.success.cleanup",{count:(ke=ot.count)!=null?ke:0}),"success"),v("")}catch(Me){A(B(Me))}finally{Se(!1)}},ne=async()=>{var ke;if(!$){N(t("filters.advancedActions.error.targetServiceRequired","Select a target service first"),"warning");return}const H=$==="no_service"?null:Number($);Z(!0);try{const Me={action:"change_service",admin_username:J(),...k(),target_service_id:H},Be=await r(Me);N(t("filters.advancedActions.success.changeService",{count:(ke=Be.count)!=null?ke:0}),"success")}catch(Me){A(B(Me))}finally{Z(!1)}},I=H=>{S(ke=>ke.includes(H)?ke.filter(Me=>Me!==H):[...ke,H])},E=(Je=Br({base:!0,sm:!1}))!=null?Je:!1;return me?s(Wt,{children:[e(V,{leftIcon:e(Cn,{className:"w-4 h-4"}),onClick:i,size:E?"sm":"md",variant:"outline",h:E?"36px":void 0,minW:E?"auto":"8.5rem",fontSize:E?"xs":"sm",fontWeight:"semibold",whiteSpace:"nowrap",children:t("filters.advancedActions.button","Advanced actions")}),s(Gt,{isOpen:a,onClose:l,size:"lg",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:t("filters.advancedActions.modalTitle","Advanced actions")}),e(Qt,{}),e(It,{children:s(pe,{spacing:6,align:"stretch",children:[s(Tr,{status:"warning",borderRadius:"md",children:[e(Mr,{}),e(u,{children:t("filters.advancedActions.modalDescription","These tools update every user and cannot be undone. Please double-check the values before confirming.")})]}),ee&&s(_,{children:[e(D,{fontWeight:"semibold",children:t("filters.advancedActions.scope.label","Scope")}),s(at,{value:ve,onChange:H=>{const ke=H.target.value;(ke==="my_users"||ke==="all_users"||ke.startsWith("admin:"))&&T(ke)},size:"sm",children:[e("option",{value:"my_users",children:t("filters.advancedActions.scope.myUsers","My users")}),e("option",{value:"all_users",children:t("filters.advancedActions.scope.allUsers","All users")}),se.filter(H=>H.username!==o.username).map(H=>e("option",{value:`admin:${H.username}`,children:H.username},H.username))]}),e(br,{fontSize:"sm",children:t("filters.advancedActions.scope.helper","Select an admin or all users for this action.")})]}),Ie&&s(Wt,{children:[s(_,{children:[e(D,{fontWeight:"semibold",children:t("filters.advancedActions.service.label","Service scope")}),s(at,{value:F,onChange:H=>{q(H.target.value)},size:"sm",children:[e("option",{value:"",children:t("filters.advancedActions.service.all","All services")}),e("option",{value:"no_service",children:t("filters.advancedActions.serviceChange.noService","No service")}),be.services.map(H=>e("option",{value:String(H.id),children:H.name},H.id))]}),e(br,{fontSize:"sm",children:t("filters.advancedActions.service.helper","Apply these actions only to users of the selected service.")})]}),e(P,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:s(we,{spacing:3,children:[e(u,{fontWeight:"semibold",children:t("filters.advancedActions.serviceChange.title","Change users' service")}),e(u,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.serviceChange.helper","Move the filtered users to another service.")}),s(at,{placeholder:t("filters.advancedActions.serviceChange.placeholder","Select target service"),value:$,onChange:H=>Q(H.target.value),size:"sm",children:[e("option",{value:"no_service",children:t("filters.advancedActions.serviceChange.noService","No service")}),be.services.map(H=>e("option",{value:String(H.id),children:H.name},H.id))]}),e(V,{colorScheme:"primary",size:"sm",alignSelf:"flex-start",isLoading:U,onClick:ne,children:t("filters.advancedActions.serviceChange.button","Move to service")})]})})]}),s(we,{spacing:4,children:[e(P,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:s(we,{spacing:2,children:[e(u,{fontWeight:"semibold",children:t("filters.advancedActions.expireSection.title","Expiration dates")}),e(u,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.expireSection.description","Add or subtract days from every user's expiration timestamp.")}),s(_,{children:[e(D,{children:t("filters.advancedActions.expireSection.inputLabel","Days")}),e(Hs,{value:c,onChange:H=>h(H),min:1,step:1,w:"full",children:e(Bs,{})}),e(br,{children:t("filters.advancedActions.expireSection.helper","The entered value will be added or removed when you click a button.")})]}),s(O,{spacing:2,flexWrap:"wrap",children:[e(V,{colorScheme:"primary",isLoading:f,flex:"1",minW:"150px",onClick:()=>L("extend_expire"),children:t("filters.advancedActions.expireSection.addButton","Add days to all users")}),e(V,{colorScheme:"gray",variant:"outline",isLoading:W,flex:"1",minW:"150px",onClick:()=>L("reduce_expire"),children:t("filters.advancedActions.expireSection.removeButton","Subtract days from all users")})]})]})}),e(P,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:s(we,{spacing:2,children:[e(u,{fontWeight:"semibold",children:t("filters.advancedActions.trafficSection.title","Usage and traffic")}),e(u,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.trafficSection.description","Apply a data limit adjustment to all users.")}),s(_,{children:[e(D,{children:t("filters.advancedActions.trafficSection.inputLabel","Gigabytes")}),e(Hs,{value:p,onChange:H=>m(H),min:.01,step:.1,w:"full",children:e(Bs,{})})]}),s(O,{spacing:2,flexWrap:"wrap",children:[e(V,{colorScheme:"primary",isLoading:le,flex:"1",minW:"150px",onClick:()=>te("increase_traffic"),children:t("filters.advancedActions.trafficSection.addButton","Add traffic to all users")}),e(V,{colorScheme:"gray",variant:"outline",isLoading:K,flex:"1",minW:"150px",onClick:()=>te("decrease_traffic"),children:t("filters.advancedActions.trafficSection.removeButton","Subtract traffic from all users")})]})]})}),e(P,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:s(we,{spacing:2,children:[e(u,{fontWeight:"semibold",children:t("filters.advancedActions.cleanupSection.title","Cleanup expired or limited")}),e(u,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.cleanupSection.description","Remove users that have been expired/limited for the selected number of days.")}),s(_,{children:[e(D,{children:t("filters.advancedActions.cleanupSection.daysLabel","Days since status change")}),e(Hs,{value:g,onChange:H=>v(H),min:1,step:1,w:"full",children:e(Bs,{})})]}),e(O,{spacing:3,children:Np.map(H=>e(Yr,{isChecked:b.includes(H),onChange:()=>I(H),children:t(`filters.advancedActions.cleanupSection.statuses.${H}`,H.charAt(0).toUpperCase()+H.slice(1))},H))}),e(V,{colorScheme:"primary",isLoading:ae,w:"full",onClick:Oe,children:t("filters.advancedActions.cleanupSection.button","Delete selected users")})]})})]})]})}),e(Bt,{children:e(V,{variant:"ghost",onClick:l,children:t("filters.advancedActions.close","Close")})})]})]})]}):null},Yi={baseStyle:{w:4,h:4}},Rp=ue(Aa,Yi),Up=ue(nu,Yi),Op=ue(Ia,Yi),Wp=ue(gs,Yi),Fp=ue(en,Yi),Jo=[{key:"online",labelKey:"filters.advanced.online",fallback:"Online right now"},{key:"offline",labelKey:"filters.advanced.offline",fallback:"Offline for 24h"},{key:"sub_not_updated",labelKey:"filters.advanced.subNotUpdated",fallback:"Sub link stale for 24h"},{key:"sub_never_updated",labelKey:"filters.advanced.subNeverUpdated",fallback:"Sub link never updated"},{key:"limit",labelKey:"filters.advanced.limit",fallback:"Has data limit"},{key:"unlimited",labelKey:"filters.advanced.unlimited",fallback:"Unlimited users"},{key:"finished",labelKey:"filters.advanced.finished",fallback:"Finished (limited or expired)"},{key:"expired",labelKey:"filters.advanced.statusExpired",fallback:"Expired users"},{key:"limited",labelKey:"filters.advanced.statusLimited",fallback:"Limited users"},{key:"disabled",labelKey:"filters.advanced.statusDisabled",fallback:"Disabled users"},{key:"on_hold",labelKey:"filters.advanced.statusOnHold",fallback:"On-hold users"}],Hp=iu((t,n)=>{n==="users"?Ot.getState().onFilterChange({search:t,offset:0}):Us.getState().onFilterChange({search:t,offset:0})},300),Lc=({for:t="users",...n})=>{var A,k,L,te,Oe,ne,I,E;const{loading:r,filters:o,onFilterChange:a,refetchUsers:i,onCreateUser:l}=Ot(),{loading:c,filters:h,onFilterChange:p,fetchAdmins:m,openAdminDialog:g,admins:v}=Us(),{t:b}=je(),[S,f]=d.exports.useState(""),{userData:w}=Dr(),W=w.role===Ye.Sudo||w.role===Ye.FullAccess,z=!W&&w.status===Ls.Disabled,le=Boolean(((k=(A=w.permissions)==null?void 0:A.admin_management)==null?void 0:k[Nr.Edit])||w.role===Ye.FullAccess),R=W||Boolean((te=(L=w.permissions)==null?void 0:L.users)==null?void 0:te[nt.Create]),K=t==="users"?R&&!z:le,y=t==="users"?r:c,ae=t==="users",Se=ae?o:h,ve=ae?o:void 0,T=Boolean(ve),F=(Oe=ve==null?void 0:ve.advancedFilters)!=null?Oe:[],q=ve==null?void 0:ve.serviceId,$=ve==null?void 0:ve.owner,{services:Q,fetchServices:U}=on();d.exports.useEffect(()=>{U({limit:500})},[U]),d.exports.useEffect(()=>{W&&m({limit:200,offset:0})},[m,W]),d.exports.useEffect(()=>{var ze,Ne;const G=ae?(ze=o.search)!=null?ze:"":(Ne=h.search)!=null?Ne:"";f(G)},[ae,o.search,h.search]);const Z=G=>{const ze=Jo.find(Ne=>Ne.key===G);return ze?b(ze.labelKey,ze.fallback):G},se=G=>{if(!T)return;const ze=F.includes(G)?F.filter(Ne=>Ne!==G):[...F,G];a({advancedFilters:ze,offset:0})},M=()=>{!T||F.length===0||a({advancedFilters:[],offset:0})},be=G=>{a({serviceId:G?Number(G):void 0,offset:0})},ee=G=>{a({owner:G||void 0,offset:0})},Ie=G=>{f(G.target.value),Hp(G.target.value,t)},me=()=>{f(""),ae?a({...o,offset:0,search:""}):p({search:"",offset:0})},J=()=>{t==="users"?i(!0):m()},N=()=>{if(t==="users"){if(z||!R)return;l(!0)}else le&&g()},B=(ne=Br({base:!0,sm:!1}))!=null?ne:!1;return s(An,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(2, 1fr)",base:"1fr"},mx:"0",rowGap:4,gap:{lg:4,md:4,base:4},py:4,...n,children:[e(Jr,{colSpan:{base:1,md:1,lg:1},order:{base:2,md:1},children:s(pe,{spacing:2,align:"stretch",w:"full",children:[s(O,{spacing:2,align:"center",w:"full",flexWrap:"wrap",children:[s(Ar,{flex:{base:"1 1 100%",sm:"1 1 auto"},minW:{base:"100%",sm:"200px"},maxW:{base:"100%",sm:"none"},children:[e(Ca,{pointerEvents:"none",children:e(Rp,{})}),e(Ce,{placeholder:t==="users"?b("search"):b("admins.searchPlaceholder","Search admins..."),value:S,borderColor:"light-border",w:"full",onChange:Ie}),s(Vr,{children:[y&&e(zt,{size:"xs"}),Se.search&&Se.search.length>0&&e(qe,{onClick:me,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Op,{})})]})]}),T&&s(ei,{placement:"bottom-start",children:[e(ti,{children:e(V,{leftIcon:e(Up,{}),size:B?"sm":"md",variant:"outline",minW:B?"auto":"8rem",h:B?"36px":void 0,fontSize:B?"xs":"sm",flex:{base:"1 1 auto",sm:"0 1 auto"},children:b("filters.advancedButton","Filters")})}),s(ri,{borderColor:"light-border",minW:"250px",children:[e(qi,{}),e(po,{}),e(sc,{fontWeight:"semibold",children:b("filters.advancedTitle","Advanced filters")}),s(si,{children:[e(we,{spacing:2,children:Jo.map(G=>e(Yr,{isChecked:F.includes(G.key),onChange:()=>se(G.key),children:Z(G.key)},G.key))}),s(we,{spacing:3,mt:3,children:[s(P,{children:[e(u,{fontSize:"sm",fontWeight:"semibold",mb:1,children:b("filters.advanced.serviceLabel","Service filter")}),s(at,{value:q?String(q):"",onChange:G=>be(G.target.value),size:"sm",children:[e("option",{value:"",children:b("filters.advanced.serviceAll","All services")}),Q.map(G=>e("option",{value:String(G.id),children:G.name},G.id))]})]}),W&&s(P,{children:[e(u,{fontSize:"sm",fontWeight:"semibold",mb:1,children:b("filters.advanced.adminLabel","Admin filter")}),s(at,{value:$!=null?$:"",onChange:G=>ee(G.target.value),size:"sm",children:[e("option",{value:"",children:b("filters.advanced.adminAll","All admins")}),e("option",{value:w.username,children:b("filters.advanced.adminMyUsers","My users")}),v.map(G=>e("option",{value:G.username,children:G.username},G.username))]})]})]}),e(V,{variant:"ghost",size:"sm",mt:3,w:"full",onClick:M,isDisabled:F.length===0,children:b("filters.advancedClear","Clear filters")})]})]})]}),e(V,{"aria-label":"refresh",isDisabled:y,onClick:J,size:B?"sm":"md",variant:"outline",leftIcon:e(Wp,{className:Sa({"animate-spin":y})}),minW:B?"auto":"8rem",h:B?"36px":void 0,fontSize:B?"xs":"sm",flex:{base:"1 1 auto",sm:"0 1 auto"},children:b("refresh","Refresh")})]}),T&&(F.length>0||Boolean(q)||Boolean($))&&s(Bn,{mt:2,spacing:2,children:[F.map(G=>s(pt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(Li,{children:Z(G)}),e(ma,{onClick:ze=>{ze.preventDefault(),ze.stopPropagation(),se(G)}})]},G)),q&&s(pt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(Li,{children:b("filters.advanced.serviceTag","Service: {{name}}",{name:(E=(I=Q.find(G=>G.id===q))==null?void 0:I.name)!=null?E:q})}),e(ma,{onClick:G=>{G.preventDefault(),G.stopPropagation(),be("")}})]},"service"),$&&s(pt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(Li,{children:$===w.username?b("filters.advanced.adminTagMine","My users"):$}),e(ma,{onClick:G=>{G.preventDefault(),G.stopPropagation(),ee("")}})]},"owner")]})]})}),e(Jr,{colSpan:{base:1,md:1,lg:2},order:{base:1,md:2},children:s(we,{direction:{base:"column",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:{base:"stretch",sm:"center"},w:"full",flexWrap:"wrap",children:[t==="users"&&e(Lp,{}),K&&e(V,{colorScheme:"primary",size:B?"sm":"md",onClick:N,isDisabled:t==="admins"&&!le,leftIcon:B?void 0:e(Fp,{}),h:B?"36px":void 0,minW:B?"auto":"8.5rem",fontSize:B?"xs":"sm",fontWeight:"semibold",whiteSpace:"nowrap",w:{base:"full",sm:"auto"},children:t==="users"?b("createUser"):b("admins.addAdmin","Add admin")})]})})]})},Bp=ue(au,{baseStyle:{w:4,h:4}}),Vp=ue(ou,{baseStyle:{w:4,h:4}}),Yo=5;function Kp(t,n,r){if(r<Yo)throw new Error(`Must allow at least ${Yo} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const o=Math.max(0,Math.min(t-r,n-Math.floor(r/2))),a=new Array(r);for(let i=0;i<r;i+=1)a[i]=i+o;return typeof a[0]=="number"&&a[0]>0&&(a[0]=0,a[1]="prev-more"),a[a.length-1]<t-1&&(a[a.length-1]=t-1,a[a.length-2]="next-more"),a}const Rc=({for:t="users"})=>{const{filters:n,onFilterChange:r,users:{total:o}}=Ot(),{filters:a,onFilterChange:i,total:l}=Us(),{t:c}=je(),{filters:h,total:p,onFilterChange:m}=d.exports.useMemo(()=>t==="admins"?{filters:a,total:l,onFilterChange:i}:{filters:n,total:o,onFilterChange:r},[t,a,l,i,n,o,r]),{limit:g,offset:v}=h,b=Number(g||10),S=Number(v||0),f=Math.floor(S/b),w=Math.ceil(p/b),W=Kp(w,f,7),z=y=>{m({...h,offset:y*b})},le=y=>{const ae=parseInt(y.target.value,10);m({...h,limit:ae,offset:0}),t==="users"&&Pp(y.target.value)},R=d.exports.useMemo(()=>f>0&&w>0,[f,w]),K=d.exports.useMemo(()=>f+1<w&&w>0,[f,w]);return p<=b&&f===0?null:s(O,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(P,{order:{base:2,md:1},children:s(O,{children:[s(at,{minW:"60px",value:String(b),onChange:le,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(u,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),s(nc,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(V,{leftIcon:e(Bp,{}),onClick:()=>z(f-1),isDisabled:!R,children:c("previous")}),W.map(y=>typeof y=="string"?e(V,{children:"..."},y):e(V,{variant:y===f?"solid":"outline",onClick:()=>z(y),children:y+1},y)),e(V,{rightIcon:e(Vp,{}),onClick:()=>z(f+1),isDisabled:!K,children:c("next")})]})]})},$p=()=>{var i;const{t}=je(),n=Us(l=>l.fetchAdmins),{userData:r,getUserIsSuccess:o}=Dr(),a=o&&Boolean((i=r.permissions)==null?void 0:i.sections.admins);return d.exports.useEffect(()=>{a&&n()},[n,a]),a?s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Lc,{for:"admins"}),e(mp,{}),e(Rc,{for:"admins"}),e(lp,{}),e(ep,{})]}):s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(u,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},qp=ue(Ji,{baseStyle:{w:4,h:4}}),Jp=ue(mo,{baseStyle:{w:4,h:4}}),Uc=({triggerLabel:t,title:n,children:r})=>{const o=Br({base:!0,md:!1});return s(ei,{placement:o?"bottom":"right",isLazy:!0,children:[e(ti,{children:e(V,{size:"xs",variant:"outline",children:t!=null?t:e(qp,{})})}),s(ri,{children:[e(qi,{}),e(po,{}),n&&e(sc,{fontWeight:"semibold",children:n}),e(si,{children:r})]})]})},Yp=({chips:t,color:n="blue"})=>{const r=t[0],o=t.slice(1);return s(O,{spacing:2,align:"center",children:[r?e(pt,{size:"sm",colorScheme:n,children:r}):e(u,{color:"gray.400",children:"-"}),o.length>0&&e(Uc,{triggerLabel:s(pt,{size:"sm",children:["+",o.length]}),title:"Details",children:e(pe,{align:"stretch",children:t.map(a=>e(O,{justify:"space-between",children:e(u,{children:a})},a))})})]})},Ba=({text:t,label:n})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:o,onCopy:a}=Pa(t!=null?t:"");return e(O,{spacing:2,align:"center",children:e(Uc,{triggerLabel:r,title:n,children:s(pe,{align:"stretch",children:[e(u,{wordBreak:"break-all",children:t}),s(O,{children:[e(qe,{"aria-label":"copy",size:"sm",icon:e(Jp,{}),onClick:a}),e(u,{fontSize:"sm",children:o?"Copied":"Copy"})]})]})})})},Gp=ni(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([Ee("/core").then(({version:n,started:r,logs_websocket:o})=>{t({version:n,started:r,logs_websocket:o})}).catch(n=>{throw console.error("Error fetching /core:",n),n}),Ee("/core/config").then(n=>{t({config:n})}).catch(n=>{throw console.error("Error fetching /core/config:",n),n})])}finally{t({isLoading:!1})}},updateConfig:n=>(t({isPostLoading:!0}),Ee("/core/config",{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>Ee("/core/restart",{method:"POST"})})),Xp=({isOpen:t,onClose:n,form:r,setBalancersData:o,balancerIndex:a})=>{const{t:i}=je(),l=Es({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=l.handleSubmit(h=>{const p={tag:h.tag,strategy:{type:h.strategy},selector:h.selector?h.selector.split(","):[],fallbackTag:h.fallbackTag},m=r.getValues("config.routing.balancers")||[];a!==void 0?m[a]=p:m.push(p),r.setValue("config.routing.balancers",m,{shouldDirty:!0}),o(m.map((g,v)=>{var b;return{key:v,tag:g.tag||"",strategy:((b=g.strategy)==null?void 0:b.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),n()});return s(Gt,{isOpen:t,onClose:n,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(u,{fontWeight:"semibold",fontSize:"lg",children:i(a!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Qt,{mt:3}),e(It,{children:e("form",{onSubmit:c,children:s(pe,{spacing:4,children:[s(_,{children:[e(D,{children:i("pages.xray.balancer.tag")}),e(Ce,{...l.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),s(_,{children:[e(D,{children:i("pages.xray.balancer.balancerStrategy")}),e(at,{...l.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(h=>e("option",{value:h,children:h},h))})]}),s(_,{children:[e(D,{children:i("pages.xray.balancer.balancerSelectors")}),e(Ce,{...l.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),s(_,{children:[e(D,{children:i("pages.xray.balancer.fallbackTag")}),e(Ce,{...l.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(V,{type:"submit",colorScheme:"primary",size:"sm",children:i(a!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},Qp=({isOpen:t,onClose:n,form:r,setDnsServers:o,dnsIndex:a,currentDnsData:i})=>{const{t:l}=je(),c=Es({defaultValues:{address:"",domains:"",expectIPs:""}});d.exports.useEffect(()=>{var p,m,g,v;if(t&&i&&a!==null){const b=typeof i=="object"?i:{address:i};c.reset({address:b.address||"",domains:Array.isArray((p=b.domains)!=null?p:[])?((m=b.domains)!=null?m:[]).join(","):"",expectIPs:Array.isArray((g=b.expectIPs)!=null?g:[])?((v=b.expectIPs)!=null?v:[]).join(","):""})}else t&&a===null&&c.reset({address:"",domains:"",expectIPs:""})},[t,i,a,c]);const h=c.handleSubmit(p=>{const m={address:p.address,domains:p.domains?p.domains.split(",").map(v=>v.trim()).filter(Boolean):[],expectIPs:p.expectIPs?p.expectIPs.split(",").map(v=>v.trim()).filter(Boolean):[]},g=r.getValues("config.dns.servers")||[];a!=null?g[a]=m:g.push(m),r.setValue("config.dns.servers",g,{shouldDirty:!0}),o(g),n()});return s(Gt,{isOpen:t,onClose:n,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(u,{fontWeight:"semibold",fontSize:"lg",children:l(a!==null?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Qt,{mt:3}),e(It,{children:e("form",{onSubmit:h,children:s(pe,{spacing:4,children:[s(_,{children:[e(D,{children:l("pages.xray.dns.address")}),e(Ce,{...c.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),s(_,{children:[e(D,{children:l("pages.xray.dns.domains")}),e(Ce,{...c.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),s(_,{children:[e(D,{children:l("pages.xray.dns.expectIPs")}),e(Ce,{...c.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(V,{type:"submit",colorScheme:"primary",size:"sm",w:"full",children:l(a!==null?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},Zp=({isOpen:t,onClose:n,form:r,setFakeDns:o,fakeDnsIndex:a})=>{const{t:i}=je(),l=Es({defaultValues:{ipPool:"",poolSize:""}}),c=l.handleSubmit(h=>{const p={ipPool:h.ipPool,poolSize:parseInt(h.poolSize,10)},m=r.getValues("config.fakedns")||[];a!==void 0?m[a]=p:m.push(p),r.setValue("config.fakedns",m.length>0?m:void 0,{shouldDirty:!0}),o(m),n()});return s(Gt,{isOpen:t,onClose:n,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(u,{fontWeight:"semibold",fontSize:"lg",children:i(a!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Qt,{mt:3}),e(It,{children:e("form",{onSubmit:c,children:s(pe,{spacing:4,children:[s(_,{children:[e(D,{children:i("pages.xray.fakedns.ipPool")}),e(Ce,{...l.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),s(_,{children:[e(D,{children:i("pages.xray.fakedns.poolSize")}),e(Ce,{...l.register("poolSize"),size:"sm",placeholder:"100"})]}),e(V,{type:"submit",colorScheme:"primary",size:"sm",children:i(a!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})};const ro=d.exports.forwardRef(({json:t,onChange:n,mode:r="code"},o)=>{const{colorMode:a}=fs(),i=d.exports.useRef(null),l=d.exports.useRef(null),c=d.exports.useRef(n),h=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=n},[n]);const p=d.exports.useCallback(b=>{h.current=b,c.current(b)},[]);d.exports.useEffect(()=>{if(!i.current)return;const b=new lu(i.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:a==="dark"?"ace/theme/one_dark":"ace/theme/github"});l.current=b;const S=b.aceEditor;S&&(S.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),S.setTheme(a==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?b.setText(t):t!==void 0&&b.set(t)}catch{typeof t=="string"&&b.updateText(t)}return()=>{b.destroy(),l.current=null}},[a,p,t,r]),d.exports.useEffect(()=>{const b=l.current;if(!b)return;const f=(W=>{if(W==null)return"";if(typeof W=="string")return W;try{return JSON.stringify(W,null,2)}catch{return""}})(t);if(f===null)return;if(h.current!==null){let W=h.current;try{W=JSON.stringify(JSON.parse(h.current),null,2)}catch{}if(h.current=null,W===f)return}let w=null;try{w=b.getText()}catch{w=null}if(w!==f)if(typeof t=="string")try{b.updateText(f)}catch{b.setText(f)}else{const W=t==null?{}:t;try{b.update(W)}catch{b.set(W)}}},[t]),d.exports.useEffect(()=>{const b=l.current;if(!!b)try{b.getMode&&b.getMode()!==r?b.setMode(r):b.getMode||b.setMode(r)}catch{b.setMode(r)}},[r]),d.exports.useEffect(()=>{var S;const b=(S=l.current)==null?void 0:S.aceEditor;!b||b.setTheme(a==="dark"?"ace/theme/one_dark":"ace/theme/github")},[a]);const m=Fe("gray.300","whiteAlpha.300"),g=Fe("surface.light","surface.dark"),v=Fe("sm","none");return e(P,{ref:o,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:v,overflow:"hidden",children:e(P,{height:"full",ref:i})})}),jp=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Go=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(jp(t))}catch{}return""},em=t=>{if(typeof t!="string"||t.length===0)return"";const n=globalThis.Wireguard;if(n!=null&&n.generateKeypair)try{const r=n.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class us{static isEmpty(n){return n==null?!0:typeof n=="string"?n.trim().length===0:Array.isArray(n)?n.length===0:typeof n=="object"?Object.keys(n).length===0:!1}static isArrEmpty(n){return!Array.isArray(n)||n.length===0}}const de=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),Oc=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const tm=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),rm=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const sm=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Va=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class Yt{static toJsonArray(n){return n.map(r=>r.toJson())}static fromJson(n){return new Yt}toJson(){return{}}toString(n=!0){const r=this.toJson();return n?JSON.stringify(r,null,2):JSON.stringify(r)}}class js extends Yt{constructor(r="none",o="",a=""){super();oe(this,"type");oe(this,"host");oe(this,"path");this.type=r,this.host=o,this.path=a}static fromJson(r={}){var a,i,l,c,h,p,m,g,v,b;const o=r==null?void 0:r.header;if(!o)return new js;if(o.type==="http"&&o.request){const S=((i=(a=o.request)==null?void 0:a.headers)==null?void 0:i.Host)&&Array.isArray(o.request.headers.Host)?o.request.headers.Host.join(","):(h=(c=(l=o.request)==null?void 0:l.headers)==null?void 0:c.Host)!=null?h:"",f=((p=o.request)==null?void 0:p.path)&&Array.isArray(o.request.path)?o.request.path.join(","):(g=(m=o.request)==null?void 0:m.path)!=null?g:"";return new js((v=o.type)!=null?v:"http",S,f)}return new js((b=o.type)!=null?b:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:us.isEmpty(this.host)?[]:this.host.split(",")},path:us.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Xn extends Yt{constructor(r=1350,o=50,a=5,i=20,l=!1,c=2,h=2,p="none",m=""){super();oe(this,"mtu");oe(this,"tti");oe(this,"upCap");oe(this,"downCap");oe(this,"congestion");oe(this,"readBuffer");oe(this,"writeBuffer");oe(this,"type");oe(this,"seed");this.mtu=r!=null?r:1350,this.tti=o!=null?o:50,this.upCap=a!=null?a:5,this.downCap=i!=null?i:20,this.congestion=Boolean(l),this.readBuffer=c!=null?c:2,this.writeBuffer=h!=null?h:2,this.type=p!=null?p:"none",this.seed=m!=null?m:""}static fromJson(r={}){var o,a,i;return new Xn(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(a=(o=r==null?void 0:r.header)==null?void 0:o.type)!=null?a:"none",(i=r==null?void 0:r.seed)!=null?i:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class Dn extends Yt{constructor(r="/",o="",a=0){super();oe(this,"path");oe(this,"host");oe(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=o!=null?o:"",this.heartbeatPeriod=a!=null?a:0}static fromJson(r={}){var o,a,i;return new Dn((o=r==null?void 0:r.path)!=null?o:"/",(a=r==null?void 0:r.host)!=null?a:"",(i=r==null?void 0:r.heartbeatPeriod)!=null?i:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class In extends Yt{constructor(r="",o="",a=!1){super();oe(this,"serviceName");oe(this,"authority");oe(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=o!=null?o:"",this.multiMode=Boolean(a)}static fromJson(r={}){var o,a;return new In((o=r==null?void 0:r.serviceName)!=null?o:"",(a=r==null?void 0:r.authority)!=null?a:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Qn extends Yt{constructor(r="/",o=""){super();oe(this,"path");oe(this,"host");this.path=r!=null?r:"/",this.host=o!=null?o:""}static fromJson(r={}){var o,a;return new Qn((o=r==null?void 0:r.path)!=null?o:"/",(a=r==null?void 0:r.host)!=null?a:"")}toJson(){return{path:this.path,host:this.host}}}class Zn extends Yt{constructor(r="/",o="",a="",i=!1,l="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var h,p,m,g,v,b;super();oe(this,"path");oe(this,"host");oe(this,"mode");oe(this,"noGRPCHeader");oe(this,"scMinPostsIntervalMs");oe(this,"xmux");this.path=r!=null?r:"/",this.host=o!=null?o:"",this.mode=a!=null?a:"",this.noGRPCHeader=Boolean(i),this.scMinPostsIntervalMs=l!=null?l:"30",this.xmux={maxConcurrency:(h=c==null?void 0:c.maxConcurrency)!=null?h:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(m=c==null?void 0:c.cMaxReuseTimes)!=null?m:0,hMaxRequestTimes:(g=c==null?void 0:c.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(v=c==null?void 0:c.hMaxReusableSecs)!=null?v:"1800-3000",hKeepAlivePeriod:(b=c==null?void 0:c.hKeepAlivePeriod)!=null?b:0}}static fromJson(r={}){var o,a,i,l;return new Zn((o=r==null?void 0:r.path)!=null?o:"/",(a=r==null?void 0:r.host)!=null?a:"",(i=r==null?void 0:r.mode)!=null?i:"",Boolean(r==null?void 0:r.noGRPCHeader),(l=r==null?void 0:r.scMinPostsIntervalMs)!=null?l:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class Pn extends Yt{constructor(r="",o=[],a="",i=!1,l=""){super();oe(this,"serverName");oe(this,"alpn");oe(this,"fingerprint");oe(this,"allowInsecure");oe(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=o!=null?o:[],this.fingerprint=a!=null?a:"",this.allowInsecure=Boolean(i),this.echConfigList=l!=null?l:""}static fromJson(r={}){var o,a,i;return new Pn((o=r==null?void 0:r.serverName)!=null?o:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(a=r==null?void 0:r.fingerprint)!=null?a:"",Boolean(r==null?void 0:r.allowInsecure),(i=r==null?void 0:r.echConfigList)!=null?i:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class jn extends Yt{constructor(r="",o="",a="",i="",l="",c=""){super();oe(this,"publicKey");oe(this,"fingerprint");oe(this,"serverName");oe(this,"shortId");oe(this,"spiderX");oe(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=o!=null?o:"",this.serverName=a!=null?a:"",this.shortId=i!=null?i:"",this.spiderX=l!=null?l:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var o,a,i,l,c,h;return new jn((o=r==null?void 0:r.publicKey)!=null?o:"",(a=r==null?void 0:r.fingerprint)!=null?a:"",(i=r==null?void 0:r.serverName)!=null?i:"",(l=r==null?void 0:r.shortId)!=null?l:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(h=r==null?void 0:r.mldsa65Verify)!=null?h:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class Vi extends Yt{constructor(r="",o=!1,a=0,i=!1,l=!1,c=Va.NONE){super();oe(this,"dialerProxy");oe(this,"tcpFastOpen");oe(this,"tcpKeepAliveInterval");oe(this,"tcpMptcp");oe(this,"penetrate");oe(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(o),this.tcpKeepAliveInterval=a!=null?a:0,this.tcpMptcp=Boolean(i),this.penetrate=Boolean(l),this.addressPortStrategy=c!=null?c:Va.NONE}static fromJson(r={}){var o,a,i;return!r||Object.keys(r).length===0?new Vi:new Vi((o=r==null?void 0:r.dialerProxy)!=null?o:"",Boolean(r==null?void 0:r.tcpFastOpen),(a=r==null?void 0:r.tcpKeepAliveInterval)!=null?a:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(i=r==null?void 0:r.addressPortStrategy)!=null?i:Va.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class rn extends Yt{constructor(r="tcp",o="none",a=new Pn,i=new jn,l=new js,c=new Xn,h=new Dn,p=new In,m=new Qn,g=new Zn,v){super();oe(this,"network");oe(this,"security");oe(this,"tls");oe(this,"reality");oe(this,"tcp");oe(this,"kcp");oe(this,"ws");oe(this,"grpc");oe(this,"httpupgrade");oe(this,"xhttp");oe(this,"sockopt");this.network=r!=null?r:"tcp",this.security=o!=null?o:"none",this.tls=a,this.reality=i,this.tcp=l,this.kcp=c,this.ws=h,this.grpc=p,this.httpupgrade=m,this.xhttp=g,this.sockopt=v}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new Vi:void 0}static fromJson(r={}){var o,a;return new rn((o=r==null?void 0:r.network)!=null?o:"tcp",(a=r==null?void 0:r.security)!=null?a:"none",Pn.fromJson(r==null?void 0:r.tlsSettings),jn.fromJson(r==null?void 0:r.realitySettings),js.fromJson(r==null?void 0:r.tcpSettings),Xn.fromJson(r==null?void 0:r.kcpSettings),Dn.fromJson(r==null?void 0:r.wsSettings),In.fromJson(r==null?void 0:r.grpcSettings),Qn.fromJson(r==null?void 0:r.httpupgradeSettings),Zn.fromJson(r==null?void 0:r.xhttpSettings),Vi.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class Ki extends Yt{constructor(r=!1,o=8,a=16,i="reject"){super();oe(this,"enabled");oe(this,"concurrency");oe(this,"xudpConcurrency");oe(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=o!=null?o:8,this.xudpConcurrency=a!=null?a:16,this.xudpProxyUDP443=i!=null?i:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new Ki:new Ki(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var Qs,Ns;const gt=class extends Yt{constructor(r="",o=de.VLESS,a=gt.Settings.getSettings(de.VLESS),i=new rn,l,c=new Ki){super();oe(this,"tag");oe(this,"_protocol");oe(this,"settings");oe(this,"stream");oe(this,"sendThrough");oe(this,"mux");this.tag=r!=null?r:"",this._protocol=o!=null?o:de.VLESS,this.settings=a!=null?a:gt.Settings.getSettings(this._protocol),this.stream=i,this.sendThrough=l,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=gt.Settings.getSettings(r),this.stream=new rn}canEnableTls(){return[de.VMess,de.VLESS,de.Trojan,de.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===de.VLESS:!1}canEnableReality(){return[de.VLESS,de.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[de.VMess,de.VLESS,de.Trojan,de.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[de.VMess,de.VLESS,de.Trojan,de.Shadowsocks,de.HTTP,de.Socks].includes(this.protocol)}hasVnext(){return[de.VMess,de.VLESS].includes(this.protocol)}hasServers(){return[de.Trojan,de.Shadowsocks,de.Socks,de.HTTP].includes(this.protocol)}hasAddressPort(){return[de.DNS,de.VMess,de.VLESS,de.Trojan,de.Shadowsocks,de.Socks,de.HTTP].includes(this.protocol)}hasUsername(){return[de.Socks,de.HTTP].includes(this.protocol)}static fromJson(r={}){var o,a,i,l;return new gt((o=r==null?void 0:r.tag)!=null?o:"",(a=r==null?void 0:r.protocol)!=null?a:de.VLESS,gt.Settings.fromProtocol((i=r==null?void 0:r.protocol)!=null?i:de.VLESS,r==null?void 0:r.settings),rn.fromJson(r==null?void 0:r.streamSettings),(l=r==null?void 0:r.sendThrough)!=null?l:"",Ki.fromJson(r==null?void 0:r.mux))}toJson(){var o,a;let r;return this.canEnableStream()?r=this.stream.toJson():(o=this.stream)!=null&&o.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof Yt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(a=this.mux)!=null&&a.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const o=r.split("://");if(o.length!==2)return null;const a=o[0].toLowerCase();try{switch(a){case de.VMess:return gt.fromVmessLink(JSON.parse(Go(o[1])));case de.VLESS:case de.Trojan:case"ss":return gt.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var l,c,h,p,m,g,v,b,S,f,w,W,z,le,R,K,y,ae,Se,ve,T,F,q;if(!r)return null;const o=new rn((l=r==null?void 0:r.net)!=null?l:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),a=r==null?void 0:r.net;a==="tcp"?o.tcp=new js((h=r==null?void 0:r.type)!=null?h:"none",(p=r==null?void 0:r.host)!=null?p:"",(m=r==null?void 0:r.path)!=null?m:""):a==="kcp"?(o.kcp=new Xn,o.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",o.kcp.seed=(v=r==null?void 0:r.path)!=null?v:""):a==="ws"?o.ws=new Dn((b=r==null?void 0:r.path)!=null?b:"/",(S=r==null?void 0:r.host)!=null?S:""):a==="grpc"?o.grpc=new In((f=r==null?void 0:r.path)!=null?f:"",(w=r==null?void 0:r.authority)!=null?w:"",(r==null?void 0:r.type)==="multi"):a==="httpupgrade"?o.httpupgrade=new Qn((W=r==null?void 0:r.path)!=null?W:"/",(z=r==null?void 0:r.host)!=null?z:""):a==="xhttp"&&(o.xhttp=new Zn((le=r==null?void 0:r.path)!=null?le:"/",(R=r==null?void 0:r.host)!=null?R:"",(K=r==null?void 0:r.mode)!=null?K:"")),(r==null?void 0:r.tls)==="tls"&&(o.security="tls",o.tls=new Pn((y=r==null?void 0:r.sni)!=null?y:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(ae=r==null?void 0:r.fp)!=null?ae:"",Boolean(r==null?void 0:r.allowInsecure)));const i=Number((Se=r==null?void 0:r.port)!=null?Se:0);return Number.isNaN(i)?null:new gt((ve=r==null?void 0:r.ps)!=null?ve:"",de.VMess,new gt.VmessSettings((T=r==null?void 0:r.add)!=null?T:"",i,(F=r==null?void 0:r.id)!=null?F:"",(q=r==null?void 0:r.scy)!=null?q:""),o)}static fromParamLink(r){var K,y,ae,Se,ve,T,F,q,$,Q,U,Z,se,M,be,ee,Ie,me,J,N,B;let o;try{o=new URL(r)}catch{return null}const a=(K=o.searchParams.get("type"))!=null?K:"tcp",i=(y=o.searchParams.get("security"))!=null?y:"none",l=new rn(a,i),c=(ae=o.searchParams.get("headerType"))!=null?ae:void 0,h=(Se=o.searchParams.get("host"))!=null?Se:void 0,p=(ve=o.searchParams.get("path"))!=null?ve:void 0,m=(T=o.searchParams.get("mode"))!=null?T:void 0;if(a==="tcp"||a==="none"?l.tcp=new js(c!=null?c:"none",h!=null?h:"",p!=null?p:""):a==="kcp"?(l.kcp=new Xn,l.kcp.type=c!=null?c:"none",l.kcp.seed=p!=null?p:""):a==="ws"?l.ws=new Dn(p!=null?p:"/",h!=null?h:""):a==="grpc"?l.grpc=new In((F=o.searchParams.get("serviceName"))!=null?F:"",(q=o.searchParams.get("authority"))!=null?q:"",o.searchParams.get("mode")==="multi"):a==="httpupgrade"?l.httpupgrade=new Qn(p!=null?p:"/",h!=null?h:""):a==="xhttp"&&(l.xhttp=new Zn(p!=null?p:"/",h!=null?h:"",m!=null?m:"")),i==="tls"){const A=($=o.searchParams.get("fp"))!=null?$:"none",k=o.searchParams.get("alpn"),L=o.searchParams.get("allowInsecure"),te=(Q=o.searchParams.get("sni"))!=null?Q:"",Oe=(U=o.searchParams.get("ech"))!=null?U:"";l.tls=new Pn(te,k?k.split(","):[],A,L==="1",Oe)}if(i==="reality"){const A=(Z=o.searchParams.get("pbk"))!=null?Z:"",k=(se=o.searchParams.get("fp"))!=null?se:"",L=(M=o.searchParams.get("sni"))!=null?M:"",te=(be=o.searchParams.get("sid"))!=null?be:"",Oe=(ee=o.searchParams.get("spx"))!=null?ee:"",ne=(Ie=o.searchParams.get("pqv"))!=null?Ie:"";l.reality=new jn(A,k,L,te,Oe,ne)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,v=r.match(g);if(!v)return null;let[,b,S,f,w]=v,W=Number(w);Number.isNaN(W)&&(W=0),b==="ss"&&(b=de.Shadowsocks,S=Go(S));let z=null;switch(b){case de.VLESS:{const A=(me=o.searchParams.get("encryption"))!=null?me:"none";z=new gt.VLESSSettings(f,W,S,(J=o.searchParams.get("flow"))!=null?J:"",A);break}case de.Trojan:z=new gt.TrojanSettings(f,W,S);break;case de.Shadowsocks:{const A=S.split(":"),k=(N=A.shift())!=null?N:"";z=new gt.ShadowsocksSettings(f,W,A.join(":"),k,!0);break}default:return null}const le=decodeURIComponent((B=o.hash)!=null?B:""),R=le.length>1?le.substring(1):`out-${b}-${W}`;return new gt(R,b,z,l)}};let Er=gt;oe(Er,"Settings",class extends Yt{constructor(a){super();oe(this,"protocol");this.protocol=a}static getSettings(a){switch(a){case de.Freedom:return new gt.FreedomSettings;case de.Blackhole:return new gt.BlackholeSettings;case de.DNS:return new gt.DNSSettings;case de.VMess:return new gt.VmessSettings;case de.VLESS:return new gt.VLESSSettings;case de.Trojan:return new gt.TrojanSettings;case de.Shadowsocks:return new gt.ShadowsocksSettings;case de.Socks:return new gt.SocksSettings;case de.HTTP:return new gt.HttpSettings;case de.Wireguard:return new gt.WireguardSettings;default:return null}}static fromProtocol(a,i){switch(a){case de.Freedom:return gt.FreedomSettings.fromJson(i);case de.Blackhole:return gt.BlackholeSettings.fromJson(i);case de.DNS:return gt.DNSSettings.fromJson(i);case de.VMess:return gt.VmessSettings.fromJson(i);case de.VLESS:return gt.VLESSSettings.fromJson(i);case de.Trojan:return gt.TrojanSettings.fromJson(i);case de.Shadowsocks:return gt.ShadowsocksSettings.fromJson(i);case de.Socks:return gt.SocksSettings.fromJson(i);case de.HTTP:return gt.HttpSettings.fromJson(i);case de.Wireguard:return gt.WireguardSettings.fromJson(i);default:return null}}toJson(){return{}}}),oe(Er,"FreedomSettings",(Qs=class extends Yt{constructor(a="",i="",l={},c=[]){super();oe(this,"domainStrategy");oe(this,"redirect");oe(this,"fragment");oe(this,"noises");this.domainStrategy=a!=null?a:"",this.redirect=i!=null?i:"",this.fragment=l!=null?l:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new gt.FreedomSettings.Noise)}delNoise(a){this.noises.splice(a,1)}static fromJson(a={}){var i,l;return new Qs((i=a==null?void 0:a.domainStrategy)!=null?i:"",(l=a==null?void 0:a.redirect)!=null?l:"",a!=null&&a.fragment?Qs.Fragment.fromJson(a.fragment):{},Array.isArray(a==null?void 0:a.noises)?a.noises.map(c=>Qs.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:us.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:us.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:Yt.toJsonArray(this.noises)}}},oe(Qs,"Fragment",class Wc extends Yt{constructor(l="1-3",c="",h="",p=""){super();oe(this,"packets");oe(this,"length");oe(this,"interval");oe(this,"maxSplit");this.packets=l!=null?l:"1-3",this.length=c!=null?c:"",this.interval=h!=null?h:"",this.maxSplit=p!=null?p:""}static fromJson(l={}){var c,h,p,m;return new Wc((c=l==null?void 0:l.packets)!=null?c:"1-3",(h=l==null?void 0:l.length)!=null?h:"",(p=l==null?void 0:l.interval)!=null?p:"",(m=l==null?void 0:l.maxSplit)!=null?m:"")}}),oe(Qs,"Noise",class Fc extends Yt{constructor(l="rand",c="10-20",h="10-16",p="ip"){super();oe(this,"type");oe(this,"packet");oe(this,"delay");oe(this,"applyTo");this.type=l!=null?l:"rand",this.packet=c!=null?c:"10-20",this.delay=h!=null?h:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(l={}){var c,h,p,m;return new Fc((c=l==null?void 0:l.type)!=null?c:"rand",(h=l==null?void 0:l.packet)!=null?h:"10-20",(p=l==null?void 0:l.delay)!=null?p:"10-16",(m=l==null?void 0:l.applyTo)!=null?m:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),Qs)),oe(Er,"BlackholeSettings",class Hc extends Yt{constructor(a){super();oe(this,"type");this.type=a}static fromJson(a={}){var i;return new Hc((i=a==null?void 0:a.response)==null?void 0:i.type)}toJson(){return{response:us.isEmpty(this.type)?void 0:{type:this.type}}}}),oe(Er,"DNSSettings",class Bc extends Yt{constructor(a="udp",i="",l=53,c="reject",h=[]){super();oe(this,"network");oe(this,"address");oe(this,"port");oe(this,"nonIPQuery");oe(this,"blockTypes");this.network=a!=null?a:"udp",this.address=i!=null?i:"",this.port=l!=null?l:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=h!=null?h:[]}static fromJson(a={}){var i,l,c,h;return new Bc((i=a==null?void 0:a.network)!=null?i:"udp",(l=a==null?void 0:a.address)!=null?l:"",(c=a==null?void 0:a.port)!=null?c:53,(h=a==null?void 0:a.nonIPQuery)!=null?h:"reject",Array.isArray(a==null?void 0:a.blockTypes)?a.blockTypes:[])}}),oe(Er,"VmessSettings",class extends Yt{constructor(a="",i=0,l="",c=""){super();oe(this,"address");oe(this,"port");oe(this,"id");oe(this,"security");this.address=a!=null?a:"",this.port=i!=null?i:0,this.id=l!=null?l:"",this.security=c!=null?c:""}static fromJson(a={}){var c,h,p,m;if(us.isArrEmpty(a==null?void 0:a.vnext))return new gt.VmessSettings;const i=a.vnext[0],l=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new gt.VmessSettings((c=i==null?void 0:i.address)!=null?c:"",(h=i==null?void 0:i.port)!=null?h:0,(p=l==null?void 0:l.id)!=null?p:"",(m=l==null?void 0:l.security)!=null?m:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),oe(Er,"VLESSSettings",class extends Yt{constructor(a="",i=0,l="",c="",h=""){super();oe(this,"address");oe(this,"port");oe(this,"id");oe(this,"flow");oe(this,"encryption");this.address=a!=null?a:"",this.port=i!=null?i:0,this.id=l!=null?l:"",this.flow=c!=null?c:"",this.encryption=h!=null?h:""}static fromJson(a={}){var c,h,p,m,g;if(us.isArrEmpty(a==null?void 0:a.vnext))return new gt.VLESSSettings;const i=a.vnext[0],l=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new gt.VLESSSettings((c=i==null?void 0:i.address)!=null?c:"",(h=i==null?void 0:i.port)!=null?h:0,(p=l==null?void 0:l.id)!=null?p:"",(m=l==null?void 0:l.flow)!=null?m:"",(g=l==null?void 0:l.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),oe(Er,"TrojanSettings",class extends Yt{constructor(a="",i=0,l=""){super();oe(this,"address");oe(this,"port");oe(this,"password");this.address=a!=null?a:"",this.port=i!=null?i:0,this.password=l!=null?l:""}static fromJson(a={}){var l,c,h;if(us.isArrEmpty(a==null?void 0:a.servers))return new gt.TrojanSettings;const i=a.servers[0];return new gt.TrojanSettings((l=i==null?void 0:i.address)!=null?l:"",(c=i==null?void 0:i.port)!=null?c:0,(h=i==null?void 0:i.password)!=null?h:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),oe(Er,"ShadowsocksSettings",class extends Yt{constructor(a="",i=0,l="",c="",h,p){super();oe(this,"address");oe(this,"port");oe(this,"password");oe(this,"method");oe(this,"uot");oe(this,"UoTVersion");this.address=a!=null?a:"",this.port=i!=null?i:0,this.password=l!=null?l:"",this.method=c!=null?c:"",this.uot=h,this.UoTVersion=p}static fromJson(a={}){var c,h,p,m;let i=a==null?void 0:a.servers;us.isArrEmpty(i)&&(i=[{}]);const l=i[0];return new gt.ShadowsocksSettings((c=l==null?void 0:l.address)!=null?c:"",(h=l==null?void 0:l.port)!=null?h:0,(p=l==null?void 0:l.password)!=null?p:"",(m=l==null?void 0:l.method)!=null?m:"",l==null?void 0:l.uot,l==null?void 0:l.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),oe(Er,"SocksSettings",class extends Yt{constructor(a="",i=0,l="",c=""){super();oe(this,"address");oe(this,"port");oe(this,"user");oe(this,"pass");this.address=a!=null?a:"",this.port=i!=null?i:0,this.user=l!=null?l:"",this.pass=c!=null?c:""}static fromJson(a={}){var h,p,m,g;let i=a==null?void 0:a.servers;us.isArrEmpty(i)&&(i=[{users:[{}]}]);const l=i[0],c=Array.isArray(l==null?void 0:l.users)&&l.users[0]?l.users[0]:{};return new gt.SocksSettings((h=l==null?void 0:l.address)!=null?h:"",(p=l==null?void 0:l.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:us.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),oe(Er,"HttpSettings",class extends Yt{constructor(a="",i=0,l="",c=""){super();oe(this,"address");oe(this,"port");oe(this,"user");oe(this,"pass");this.address=a!=null?a:"",this.port=i!=null?i:0,this.user=l!=null?l:"",this.pass=c!=null?c:""}static fromJson(a={}){var h,p,m,g;let i=a==null?void 0:a.servers;us.isArrEmpty(i)&&(i=[{users:[{}]}]);const l=i[0],c=Array.isArray(l==null?void 0:l.users)&&l.users[0]?l.users[0]:{};return new gt.HttpSettings((h=l==null?void 0:l.address)!=null?h:"",(p=l==null?void 0:l.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:us.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),oe(Er,"WireguardSettings",(Ns=class extends Yt{constructor(a=1420,i="",l=[""],c=2,h="",p="",m=[new Ns.Peer],g=!1){super();oe(this,"mtu");oe(this,"secretKey");oe(this,"pubKey");oe(this,"address");oe(this,"workers");oe(this,"domainStrategy");oe(this,"reserved");oe(this,"peers");oe(this,"noKernelTun");this.mtu=a!=null?a:1420,this.secretKey=i!=null?i:"",this.pubKey=this.secretKey.length>0?em(this.secretKey):"",this.address=Array.isArray(l)?l.join(","):l!=null?l:"",this.workers=c!=null?c:2,this.domainStrategy=h!=null?h:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=m!=null?m:[new Ns.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new Ns.Peer)}delPeer(a){this.peers.splice(a,1)}static fromJson(a={}){var i,l,c,h,p,m,g;return new Ns((i=a==null?void 0:a.mtu)!=null?i:1420,(l=a==null?void 0:a.secretKey)!=null?l:"",(c=a==null?void 0:a.address)!=null?c:[""],(h=a==null?void 0:a.workers)!=null?h:2,(p=a==null?void 0:a.domainStrategy)!=null?p:"",(m=a==null?void 0:a.reserved)!=null?m:"",Array.isArray(a==null?void 0:a.peers)?a.peers.map(v=>Ns.Peer.fromJson(v)):[new Ns.Peer],(g=a==null?void 0:a.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:sm.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(a=>Number(a)).filter(a=>!Number.isNaN(a)):void 0,peers:Yt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},oe(Ns,"Peer",class extends Yt{constructor(l="",c="",h=["0.0.0.0/0","::/0"],p="",m=0){super();oe(this,"publicKey");oe(this,"psk");oe(this,"allowedIPs");oe(this,"endpoint");oe(this,"keepAlive");this.publicKey=l!=null?l:"",this.psk=c!=null?c:"",this.allowedIPs=h!=null?h:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=m!=null?m:0}static fromJson(l={}){var c,h,p,m;return new gt.WireguardSettings.Peer((c=l==null?void 0:l.publicKey)!=null?c:"",(h=l==null?void 0:l.preSharedKey)!=null?h:"",Array.isArray(l==null?void 0:l.allowedIPs)?l.allowedIPs:["0.0.0.0/0","::/0"],(p=l==null?void 0:l.endpoint)!=null?p:"",(m=l==null?void 0:l.keepAlive)!=null?m:0)}toJson(){var l;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(l=this.allowedIPs)!=null&&l.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Ns));class wn{static sizeFormat(n){if(n<=0||Number.isNaN(n))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let o=0,a=n;for(;a>=1024&&o<r.length-1;)a/=1024,o++;return`${a.toFixed(2)} ${r[o]}`}}const nm=ue(en),im=ue(ic),Wr={tag:"",protocol:de.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:Oc.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0,presharedKey:""}]},Nn=t=>{const n={},r=t.address||void 0,o=Number(t.port)||void 0;switch(t.protocol){case de.VMess:n.vnext=[{address:r,port:o,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case de.VLESS:n.vnext=[{address:r,port:o,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case de.Trojan:n.servers=[{address:r,port:o,password:t.password||void 0}];break;case de.Shadowsocks:n.servers=[{address:r,port:o,password:t.password||void 0,method:t.method||void 0}];break;case de.Socks:case de.HTTP:n.servers=[{address:r,port:o,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case de.Freedom:n.domainStrategy=t.freedomStrategy||void 0;break;case de.Blackhole:n.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case de.DNS:n.network=t.dnsNetwork,n.address=t.dnsAddress||void 0,n.port=Number(t.dnsPort)||void 0;break;case de.Wireguard:n.secretKey=t.wireguardSecret||void 0,n.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,n.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(h=>h.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0,preSharedKey:c.presharedKey||void 0}));break}const a=new rn;a.network=t.network,a.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?a.tcp=new js(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?a.ws=new Dn(t.wsPath,t.wsHost,0):t.network==="grpc"&&(a.grpc=new In(t.grpcServiceName,"",!1)),t.tlsEnabled&&(a.tls=new Pn(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(a.reality=new jn(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const l=new Er(t.tag,t.protocol,n,a,void 0).toJson();return l.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(l.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),l},am=({isOpen:t,onClose:n,mode:r,initialOutbound:o,onSubmitOutbound:a})=>{const{t:i}=je(),l=cr(),c=Fe("gray.50","whiteAlpha.100"),{control:h,register:p,reset:m,handleSubmit:g,watch:v,getValues:b,setValue:S,formState:{isValid:f}}=Es({defaultValues:Wr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:w,append:W,remove:z}=Fn({control:h,name:"wireguardPeers"}),le=v("protocol"),R=v("network"),K=v("tlsEnabled"),y=v("realityEnabled"),ae=v("tcpType"),Se=v("muxEnabled"),ve=i("validation.required"),T=i("validation.invalidPort"),F=le||de.VLESS,q=F===de.Wireguard,$=![de.Freedom,de.Blackhole,de.DNS,de.Wireguard].includes(F),Q=[de.VMess,de.VLESS].includes(F),U=[de.Trojan,de.Shadowsocks].includes(F),Z=F===de.Shadowsocks,se=F===de.DNS,M=ur({control:h}),[be,ee]=d.exports.useState(0),[Ie,me]=d.exports.useState(()=>Nn(Wr)),[J,N]=d.exports.useState(()=>JSON.stringify(Nn(Wr),null,2)),[B,A]=d.exports.useState(null),[k,L]=d.exports.useState(""),te=d.exports.useRef(!1),Oe=d.exports.useMemo(()=>[de.VMess,de.VLESS,de.Trojan,de.Shadowsocks].includes(F),[F]),ne=d.exports.useMemo(()=>[de.VMess,de.VLESS,de.Trojan,de.Shadowsocks].includes(F),[F]),I=d.exports.useMemo(()=>[de.VLESS,de.Trojan].includes(F)&&(R==="tcp"||R==="grpc"),[R,F]),E=d.exports.useMemo(()=>{var Ae;return!(![de.VMess,de.VLESS,de.Trojan,de.Shadowsocks,de.HTTP,de.Socks].includes(F)||F===de.VLESS&&((Ae=M==null?void 0:M.flow)!=null?Ae:"").trim().length>0)},[M==null?void 0:M.flow,F]),G=ne||I,ze=d.exports.useCallback(X=>{var Vt,ge,Te,Re,ut,lt,Mt,er,ie,st,Qe,Pt,Rt,Ft,We,ce,Pe,fe,dt,yt,Kt,$t,Ut,ft,et,he,De,tt,tr,xr,es,bs,os,ys,xs,Ss,vs,ws,Gr,ls,ar,j,He,ht,St,Ht,Sr,Kr,ks,Lr,Rr,dr,Ur,cs,_s,$r,ts,Cs,zs,Ts,rs,As,Ir;const Ae=Er.fromJson(X),xe={...Wr,tag:(Vt=X==null?void 0:X.tag)!=null?Vt:"",protocol:(Ae==null?void 0:Ae.protocol)||Wr.protocol,sendThrough:(ge=X==null?void 0:X.sendThrough)!=null?ge:"",muxEnabled:Boolean((Te=X==null?void 0:X.mux)==null?void 0:Te.enabled),muxConcurrency:Number((ut=(Re=X==null?void 0:X.mux)==null?void 0:Re.concurrency)!=null?ut:Wr.muxConcurrency)},$e=(Mt=(lt=Ae==null?void 0:Ae.stream)!=null?lt:X==null?void 0:X.streamSettings)!=null?Mt:X==null?void 0:X.stream;xe.network=(er=$e==null?void 0:$e.network)!=null?er:Wr.network;const Ze=$e;switch(xe.tlsEnabled=($e==null?void 0:$e.security)==="tls"||Boolean((Ze==null?void 0:Ze.tls)||(Ze==null?void 0:Ze.tlsSettings)),xe.realityEnabled=($e==null?void 0:$e.security)==="reality"||Boolean((Ze==null?void 0:Ze.reality)||(Ze==null?void 0:Ze.realitySettings)),xe.tlsServerName=(Pt=(Qe=(ie=Ze==null?void 0:Ze.tls)==null?void 0:ie.serverName)!=null?Qe:(st=Ze==null?void 0:Ze.tlsSettings)==null?void 0:st.serverName)!=null?Pt:"",xe.realityPublicKey=(ce=(We=(Rt=Ze==null?void 0:Ze.reality)==null?void 0:Rt.publicKey)!=null?We:(Ft=Ze==null?void 0:Ze.realitySettings)==null?void 0:Ft.publicKey)!=null?ce:"",xe.realityShortId=(yt=(dt=(Pe=Ze==null?void 0:Ze.reality)==null?void 0:Pe.shortId)!=null?dt:(fe=Ze==null?void 0:Ze.realitySettings)==null?void 0:fe.shortId)!=null?yt:"",($e==null?void 0:$e.network)==="tcp"&&$e.tcp&&(xe.tcpType=$e.tcp.type,xe.tcpHost=(Kt=$e.tcp.host)!=null?Kt:"",xe.tcpPath=($t=$e.tcp.path)!=null?$t:""),($e==null?void 0:$e.network)==="ws"&&$e.ws&&(xe.wsHost=(Ut=$e.ws.host)!=null?Ut:"",xe.wsPath=(ft=$e.ws.path)!=null?ft:""),($e==null?void 0:$e.network)==="grpc"&&$e.grpc&&(xe.grpcServiceName=(et=$e.grpc.serviceName)!=null?et:""),Ae!=null&&Ae.hasAddressPort()&&(xe.address=(tr=(tt=(he=Ae.settings)==null?void 0:he.address)!=null?tt:(De=X==null?void 0:X.settings)==null?void 0:De.address)!=null?tr:"",xe.port=Number((os=(bs=(xr=Ae.settings)==null?void 0:xr.port)!=null?bs:(es=X==null?void 0:X.settings)==null?void 0:es.port)!=null?os:Wr.port)),xe.protocol){case de.VMess:{const _e=Ae.settings;xe.id=(ys=_e==null?void 0:_e.id)!=null?ys:"",xe.vnextEncryption=(xs=_e==null?void 0:_e.security)!=null?xs:Wr.vnextEncryption,xe.address=(Ss=_e==null?void 0:_e.address)!=null?Ss:xe.address,xe.port=Number((vs=_e==null?void 0:_e.port)!=null?vs:xe.port);break}case de.VLESS:{const _e=Ae.settings;xe.id=(ws=_e==null?void 0:_e.id)!=null?ws:"",xe.flow=(Gr=_e==null?void 0:_e.flow)!=null?Gr:"",xe.encryption=(ls=_e==null?void 0:_e.encryption)!=null?ls:xe.encryption,xe.address=(ar=_e==null?void 0:_e.address)!=null?ar:xe.address,xe.port=Number((j=_e==null?void 0:_e.port)!=null?j:xe.port);break}case de.Trojan:{const _e=Ae.settings;xe.password=(He=_e==null?void 0:_e.password)!=null?He:"",xe.address=(ht=_e==null?void 0:_e.address)!=null?ht:xe.address,xe.port=Number((St=_e==null?void 0:_e.port)!=null?St:xe.port);break}case de.Shadowsocks:{const _e=Ae.settings;xe.password=(Ht=_e==null?void 0:_e.password)!=null?Ht:"",xe.method=(Sr=_e==null?void 0:_e.method)!=null?Sr:Wr.method,xe.address=(Kr=_e==null?void 0:_e.address)!=null?Kr:xe.address,xe.port=Number((ks=_e==null?void 0:_e.port)!=null?ks:xe.port);break}case de.Socks:case de.HTTP:{const _e=(xe.protocol===de.Socks,Ae.settings);xe.user=(Lr=_e==null?void 0:_e.user)!=null?Lr:"",xe.pass=(Rr=_e==null?void 0:_e.pass)!=null?Rr:"",xe.address=(dr=_e==null?void 0:_e.address)!=null?dr:xe.address,xe.port=Number((Ur=_e==null?void 0:_e.port)!=null?Ur:xe.port);break}case de.DNS:{const _e=Ae.settings;xe.dnsNetwork=(cs=_e==null?void 0:_e.network)!=null?cs:Wr.dnsNetwork,xe.dnsAddress=(_s=_e==null?void 0:_e.address)!=null?_s:"",xe.dnsPort=Number(($r=_e==null?void 0:_e.port)!=null?$r:Wr.dnsPort);break}case de.Freedom:{const _e=Ae.settings;xe.freedomStrategy=(ts=_e==null?void 0:_e.domainStrategy)!=null?ts:"";break}case de.Blackhole:{const _e=Ae.settings;xe.blackholeResponse=(Cs=_e==null?void 0:_e.type)!=null?Cs:"";break}case de.Wireguard:{const _e=Ae.settings;xe.wireguardSecret=(zs=_e==null?void 0:_e.secretKey)!=null?zs:"",xe.wireguardAddress=Array.isArray(_e==null?void 0:_e.address)?_e.address.join(","):(Ts=_e==null?void 0:_e.address)!=null?Ts:"";const Ds=(As=(rs=_e==null?void 0:_e.peers)==null?void 0:rs.map(vt=>{var or,Ct,mr,qt,jt;return{publicKey:(or=vt.publicKey)!=null?or:"",allowedIPs:Array.isArray(vt.allowedIPs)?vt.allowedIPs.join(","):"",endpoint:(Ct=vt.endpoint)!=null?Ct:"",keepAlive:Number((mr=vt.keepAlive)!=null?mr:0),presharedKey:(jt=(qt=vt.preSharedKey)!=null?qt:vt.psk)!=null?jt:""}}))!=null?As:[];xe.wireguardPeers=Ds.length>0?Ds:Wr.wireguardPeers;break}}return xe.protocol===de.Wireguard&&(xe.tlsEnabled=!1,xe.realityEnabled=!1,xe.network="tcp"),((Ir=X==null?void 0:X.mux)==null?void 0:Ir.concurrency)!=null&&(xe.muxConcurrency=Number(X.mux.concurrency)),(!xe.wireguardPeers||xe.wireguardPeers.length===0)&&(xe.wireguardPeers=Wr.wireguardPeers),xe},[]);d.exports.useEffect(()=>{q&&(S("tlsEnabled",!1),S("realityEnabled",!1),S("network","tcp"))},[q,S]),d.exports.useEffect(()=>{if(!t)return;ee(0),A(null),L("");const X=o?ze(o):Wr;te.current=!0,m(X);const Ae=Nn(X);me(Ae),N(JSON.stringify(Ae,null,2))},[o,t,m,ze]),d.exports.useEffect(()=>{if(!M)return;if(te.current){te.current=!1;return}const X=Nn(M);me(X);const Ae=JSON.stringify(X,null,2);N(xe=>xe===Ae?xe:Ae),A(null)},[M]),d.exports.useEffect(()=>{Oe||(S("network",Wr.network),S("tcpType",Wr.tcpType),S("tcpHost",""),S("tcpPath",""),S("wsHost",""),S("wsPath",""),S("grpcServiceName",""))},[Oe,S]),d.exports.useEffect(()=>{!ne&&K&&(S("tlsEnabled",!1),S("tlsServerName",""))},[ne,S,K]),d.exports.useEffect(()=>{!I&&y&&(S("realityEnabled",!1),S("realityPublicKey",""),S("realityShortId",""))},[I,y,S]),d.exports.useEffect(()=>{!E&&Se&&S("muxEnabled",!1)},[E,Se,S]),d.exports.useEffect(()=>{q&&(S("tlsEnabled",!1),S("realityEnabled",!1),S("network","tcp"))},[q,S]);const Ne=d.exports.useMemo(()=>[de.VLESS,de.VMess,de.Trojan,de.Shadowsocks,de.Socks,de.HTTP,de.Freedom,de.Blackhole,de.DNS,de.Wireguard],[]),Je=X=>{N(X);try{const Ae=JSON.parse(X);A(null),me(Ae),te.current=!0;const xe=ze(Ae);m(xe)}catch(Ae){A(Ae.message)}},H=X=>{if(!X.toLowerCase().includes("[interface]"))return null;const Ae=X.split(/\r?\n/);let xe=null;const $e={},Ze=[];if(Ae.forEach(Te=>{const Re=Te.trim();if(!Re||Re.startsWith("#")||Re.startsWith(";"))return;const ut=Re.toLowerCase();if(ut==="[interface]"){xe="interface";return}if(ut==="[peer]"){xe="peer",Ze.push({});return}const[lt,...Mt]=Re.split("=");if(!lt||Mt.length===0)return;const er=Mt.join("=").trim();if(xe==="interface")$e[lt.trim().toLowerCase()]=er;else if(xe==="peer"){const ie=Ze[Ze.length-1];ie&&(ie[lt.trim().toLowerCase()]=er)}}),!$e.privatekey)return null;const Vt=$e.address?$e.address.split(",").map(Te=>Te.trim()).filter(Boolean):[],ge=Ze.map(Te=>({publicKey:Te.publickey||"",preSharedKey:Te.presharedkey||Te.psk||"",allowedIPs:(Te.allowedips||"").split(",").map(Re=>Re.trim()).filter(Boolean),endpoint:Te.endpoint||"",keepAlive:Te.persistentkeepalive&&Number(Te.persistentkeepalive)||0}));return{tag:"wireguard-import",protocol:de.Wireguard,settings:{secretKey:$e.privatekey,address:Vt,peers:ge}}},ke=()=>{const X=k.trim();if(!X){A(i("pages.outbound.configEmpty","Please paste a config link"));return}const Ae=H(X);if(Ae){const Vt=JSON.stringify(Ae,null,2);L(""),Je(Vt),l({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")});return}const xe=Er.fromLink(X);if(!xe){A(i("pages.outbound.invalidConfig","Unsupported or invalid config link")),l({status:"error",duration:2500,position:"top",title:i("pages.outbound.configParseFailedTitle","Conversion failed"),description:i("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const $e=xe.toJson(),Ze=JSON.stringify($e,null,2);L(""),Je(Ze),l({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},Me=g(async X=>{var xe;const Ae=Nn(X);try{await a(Ae),l({title:r==="edit"?i("pages.xray.outbound.updated","Outbound updated"):i("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),n()}catch($e){l({title:((xe=$e==null?void 0:$e.data)==null?void 0:xe.detail)||($e==null?void 0:$e.message)||i("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),Be=()=>{n()},ot=X=>{if(ee(X),X===1){const Ae=Nn(b());me(Ae);const xe=JSON.stringify(Ae,null,2);N($e=>$e===xe?$e:xe),A(null)}};return s(Gt,{size:"4xl",isOpen:t,onClose:Be,scrollBehavior:"inside",children:[e(Dt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),s(Xt,{as:"form",onSubmit:Me,children:[e(Tt,{children:r==="edit"?i("pages.xray.outbound.editOutbound","Edit Outbound"):i("pages.xray.outbound.addOutbound")}),e(Qt,{}),e(It,{children:s(dn,{variant:"enclosed",colorScheme:"primary",index:be,onChange:ot,children:[s(un,{children:[e(hr,{children:i("form")}),e(hr,{children:i("json")})]}),s(hn,{children:[e(pr,{children:s(pe,{spacing:6,align:"stretch",children:[s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.basicSettings","Basic settings")}),s(pe,{spacing:3,align:"stretch",children:[s(_,{isRequired:!0,children:[e(D,{children:i("pages.xray.outbound.tag")}),e(Ce,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:ve})})]}),s(O,{children:[s(_,{isRequired:!0,children:[e(D,{children:i("protocol")}),e(at,{size:"sm",...p("protocol"),children:Ne.map(X=>e("option",{value:X,children:X},X))})]}),s(_,{children:[e(D,{children:i("pages.xray.outbound.sendThrough")}),e(Ce,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),$&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.endpoint","Endpoint")}),s(pe,{spacing:3,align:"stretch",children:[s(_,{isRequired:$,children:[e(D,{children:i("pages.outbound.address","Address")}),e(Ce,{size:"sm",placeholder:"example.com",...p("address",{required:$?ve:!1})})]}),s(O,{children:[s(_,{isRequired:$,children:[e(D,{children:i("pages.outbound.port","Port")}),e(Ce,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:$?ve:!1,valueAsNumber:!0,min:{value:1,message:T},max:{value:65535,message:T}})})]}),Q?s(_,{isRequired:Q,children:[e(D,{children:"ID"}),e(Ce,{size:"sm",placeholder:"UUID",...p("id",{required:Q?ve:!1})})]}):U?s(_,{isRequired:U,children:[e(D,{children:i("password")}),e(Ce,{size:"sm",placeholder:"password",...p("password",{required:U?ve:!1})})]}):s(_,{children:[e(D,{children:i("username")}),e(Ce,{size:"sm",placeholder:"username",...p("user")})]})]}),F===de.Shadowsocks&&s(_,{isRequired:Z,children:[e(D,{children:i("pages.outbound.method","Method")}),e(at,{size:"sm",...p("method",{required:Z?ve:!1}),children:Object.values(Oc).map(X=>e("option",{value:X,children:X},X))})]}),F===de.VLESS&&s(O,{children:[s(_,{children:[e(D,{children:i("pages.outbound.encryption","Encryption")}),e(Ce,{size:"sm",placeholder:"none",...p("encryption")})]}),s(_,{children:[e(D,{children:"Flow"}),e(Ce,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),F===de.VMess&&s(_,{children:[e(D,{children:i("pages.outbound.security","User security")}),e(Ce,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),F===de.DNS&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.dnsSettings","DNS settings")}),s(O,{children:[s(_,{children:[e(D,{children:i("pages.outbound.network")}),s(at,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),s(_,{isRequired:se,children:[e(D,{children:i("pages.outbound.port")}),e(Ce,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:se?ve:!1,valueAsNumber:!0,min:{value:1,message:T},max:{value:65535,message:T}})})]})]}),s(_,{mt:3,isRequired:se,children:[e(D,{children:i("pages.outbound.address")}),e(Ce,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:se?ve:!1})})]})]}),F===de.Freedom&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.freedom","Freedom options")}),s(_,{children:[e(D,{children:i("pages.outbound.strategy","Strategy")}),e(Ce,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),F===de.Blackhole&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.blackhole","Blackhole options")}),s(_,{children:[e(D,{children:i("pages.outbound.response")}),e(Ce,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),F===de.Wireguard&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.wireguard","Wireguard")}),s(pe,{spacing:3,align:"stretch",children:[s(_,{children:[e(D,{children:i("pages.outbound.secretKey","Secret key")}),e(Ce,{size:"sm",...p("wireguardSecret")})]}),s(_,{children:[e(D,{children:i("pages.outbound.address")}),e(Ce,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),s(pe,{spacing:3,align:"stretch",children:[s(O,{justify:"space-between",children:[e(u,{fontWeight:"semibold",children:i("pages.outbound.peer","Peers")}),e(qe,{size:"sm","aria-label":i("add"),icon:e(nm,{boxSize:3}),onClick:()=>W({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0,presharedKey:""})})]}),w.map((X,Ae)=>s(P,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[s(O,{children:[s(_,{children:[e(D,{children:i("pages.outbound.publicKey","Public key")}),e(Ce,{size:"sm",...p(`wireguardPeers.${Ae}.publicKey`)})]}),w.length>1&&e(qe,{mt:6,size:"sm","aria-label":i("delete"),icon:e(im,{boxSize:3}),onClick:()=>z(Ae)})]}),s(O,{mt:2,children:[s(_,{children:[e(D,{children:i("pages.outbound.allowedIPs","Allowed IPs")}),e(Ce,{size:"sm",...p(`wireguardPeers.${Ae}.allowedIPs`)})]}),s(_,{children:[e(D,{children:i("pages.outbound.endpoint","Endpoint")}),e(Ce,{size:"sm",...p(`wireguardPeers.${Ae}.endpoint`)})]})]}),s(_,{mt:2,children:[e(D,{children:i("pages.outbound.keepAlive","Keep alive")}),e(Ce,{size:"sm",type:"number",...p(`wireguardPeers.${Ae}.keepAlive`,{valueAsNumber:!0})})]}),s(_,{mt:2,children:[e(D,{children:i("pages.outbound.presharedKey","Preshared key")}),e(Ce,{size:"sm",...p(`wireguardPeers.${Ae}.presharedKey`)})]})]},X.id))]})]})]}),Oe&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.transport","Transport")}),s(pe,{spacing:3,align:"stretch",children:[s(_,{children:[e(D,{children:i("pages.outbound.network")}),s(at,{size:"sm",...p("network"),onChange:X=>{p("network").onChange(X)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),R==="tcp"&&s(O,{children:[s(_,{children:[e(D,{children:i("pages.outbound.tcpHeader","Header")}),s(at,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),ae==="http"&&s(Wt,{children:[s(_,{children:[e(D,{children:i("host")}),e(Ce,{size:"sm",...p("tcpHost")})]}),s(_,{children:[e(D,{children:i("path")}),e(Ce,{size:"sm",...p("tcpPath")})]})]})]}),R==="ws"&&s(O,{children:[s(_,{children:[e(D,{children:i("host")}),e(Ce,{size:"sm",...p("wsHost")})]}),s(_,{children:[e(D,{children:i("path")}),e(Ce,{size:"sm",...p("wsPath")})]})]}),R==="grpc"&&s(_,{children:[e(D,{children:i("serviceName")}),e(Ce,{size:"sm",...p("grpcServiceName")})]})]})]}),G&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.security")}),s(O,{children:[ne&&s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:"0",children:"TLS"}),e(_t,{size:"sm",isChecked:K,isDisabled:!ne,onChange:X=>{if(!ne)return;const Ae=X.target.checked;S("tlsEnabled",Ae),Ae&&S("realityEnabled",!1)}})]}),I&&s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:"0",children:"Reality"}),e(_t,{size:"sm",isChecked:y,isDisabled:!I,onChange:X=>{if(!I)return;const Ae=X.target.checked;S("realityEnabled",Ae),Ae&&S("tlsEnabled",!1)}})]})]}),K&&ne&&s(_,{mt:3,children:[e(D,{children:"SNI"}),e(Ce,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),y&&I&&s(pe,{spacing:3,align:"stretch",mt:3,children:[s(_,{children:[e(D,{children:"SNI"}),e(Ce,{size:"sm",...p("tlsServerName")})]}),s(_,{children:[e(D,{children:i("pages.outbound.publicKey")}),e(Ce,{size:"sm",...p("realityPublicKey")})]}),s(_,{children:[e(D,{children:i("pages.outbound.shortId")}),e(Ce,{size:"sm",...p("realityShortId")})]})]})]}),E&&s(P,{children:[e(u,{fontWeight:"semibold",mb:3,children:i("pages.outbound.mux")}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:"0",children:i("pages.outbound.enableMux")}),e(_t,{size:"sm",...p("muxEnabled")})]}),Se&&s(_,{mt:3,children:[e(D,{children:i("pages.outbound.concurrency")}),e(Ce,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(pr,{children:s(pe,{align:"stretch",spacing:3,children:[s(_,{children:[e(D,{children:i("pages.outbound.configToJson","Config to JSON")}),s(O,{align:"start",spacing:3,children:[e(ns,{value:k,onChange:X=>L(X.target.value),placeholder:i("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(V,{size:"sm",colorScheme:"primary",onClick:ke,children:i("pages.outbound.convertConfig","Convert")})]})]}),e(P,{height:"420px",children:e(ro,{json:Ie,onChange:Je})}),B&&e(u,{fontSize:"sm",color:"red.500",children:B})]})})]})]})}),s(Bt,{gap:3,children:[e(V,{variant:"outline",onClick:Be,children:i("cancel")}),e(V,{colorScheme:"primary",type:"submit",isDisabled:!f,children:i(r==="edit"?"save":"add")})]})]})]})},om=["tcp","udp","http","quic","grpc"],lm=["http","tls","bittorrent","quic"],cm=["field","chained"],dm=["","hybrid","linear"],Vc={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},Ln=t=>t?Array.isArray(t)?t.join(", "):t:"",mi=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(Boolean),um=t=>{var r,o,a,i;if(!t)return{...Vc};const n=t.attrs?Object.entries(t.attrs).map(([l,c])=>({key:l,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(o=t.domainMatcher)!=null?o:"",outboundTag:(a=t.outboundTag)!=null?a:"",balancerTag:(i=t.balancerTag)!=null?i:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:Ln(t.source),sourcePort:Ln(t.sourcePort),domain:Ln(t.domain),ip:Ln(t.ip),user:Ln(t.user),port:Ln(t.port),attrs:n}},hm=t=>{const n={};t.type&&(n.type=t.type),t.domainMatcher&&(n.domainMatcher=t.domainMatcher),t.outboundTag&&(n.outboundTag=t.outboundTag),t.balancerTag&&(n.balancerTag=t.balancerTag),t.inboundTags.length&&(n.inboundTag=t.inboundTags),t.networks.length&&(n.network=t.networks),t.protocols.length&&(n.protocol=t.protocols);const r=mi(t.sourceIps);r.length&&(n.source=r);const o=mi(t.sourcePort);o.length&&(n.sourcePort=o);const a=mi(t.domain);a.length&&(n.domain=a);const i=mi(t.ip);i.length&&(n.ip=i);const l=mi(t.user);l.length&&(n.user=l);const c=t.port.trim();if(c&&(n.port=c),t.attrs.length){const h={};t.attrs.forEach(({key:p,value:m})=>{!p.trim()||(h[p.trim()]=m)}),Object.keys(h).length&&(n.attrs=h)}return n.type||(n.type="field"),n},pm=({isOpen:t,mode:n,initialRule:r,availableInboundTags:o,availableOutboundTags:a,availableBalancerTags:i,onSubmit:l,onClose:c})=>{const{t:h}=je(),p=Fe("white","gray.900"),{control:m,register:g,handleSubmit:v,reset:b,formState:{isSubmitting:S}}=Es({defaultValues:Vc}),{fields:f,append:w,remove:W}=Fn({control:m,name:"attrs"});d.exports.useEffect(()=>{t&&b(um(r))},[t,r,b]);const z=()=>w({key:"",value:""}),le=()=>{c()},R=v(y=>{const ae=hm(y);l(ae),le()}),K=d.exports.useMemo(()=>n==="edit"?h("pages.xray.rules.edit","Edit Rule"):h("pages.xray.rules.add","Add Rule"),[n,h]);return s(Gt,{isOpen:t,onClose:le,size:"xl",scrollBehavior:"inside",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{as:"form",onSubmit:R,bg:p,children:[e(Tt,{children:K}),e(Qt,{}),e(It,{children:s(we,{spacing:5,children:[s(_,{children:[e(D,{children:h("pages.xray.rules.type","Rule Type")}),e(at,{...g("type"),size:"sm",children:cm.map(y=>e("option",{value:y,children:y||h("core.none","None")},y))})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.outboundTag","Outbound Tag")}),e(at,{...g("outboundTag"),size:"sm",placeholder:h("core.none","None"),children:a.map(y=>e("option",{value:y,children:y},y))})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.balancer","Balancer Tag")}),e(at,{...g("balancerTag"),size:"sm",placeholder:h("core.none","None"),children:i.map(y=>e("option",{value:y,children:y},y))})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.inboundTag","Inbound Tags")}),e(At,{control:m,name:"inboundTags",render:({field:y})=>e(ga,{...y,children:e(Bn,{spacing:3,children:o.map(ae=>e(an,{children:e(Yr,{value:ae,children:ae})},ae))})})})]}),e(nn,{}),s(_,{children:[e(D,{children:h("pages.xray.rules.domainMatcher","Domain Matcher")}),e(at,{...g("domainMatcher"),size:"sm",children:dm.map(y=>e("option",{value:y,children:y||h("core.default","Default")},y||"empty"))})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.network","Network")}),e(At,{control:m,name:"networks",render:({field:y})=>e(ga,{...y,children:e(Bn,{spacing:3,children:om.map(ae=>e(an,{children:e(Yr,{value:ae,children:ae})},ae))})})})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.protocol","Protocol")}),e(At,{control:m,name:"protocols",render:({field:y})=>e(ga,{...y,children:e(Bn,{spacing:3,children:lm.map(ae=>e(an,{children:e(Yr,{value:ae,children:ae})},ae))})})})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.source","Source IPs")}),e(ns,{...g("sourceIps"),size:"sm",placeholder:h("pages.xray.rules.useComma","Comma or space separated")})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.sourcePort","Source Ports")}),e(ns,{...g("sourcePort"),size:"sm",placeholder:h("pages.xray.rules.useComma","Comma or space separated")})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.ip","Destination IPs")}),e(ns,{...g("ip"),size:"sm",placeholder:h("pages.xray.rules.useComma","Comma or space separated")})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.domain","Domains")}),e(ns,{...g("domain"),size:"sm",placeholder:h("pages.xray.rules.useComma","Comma or space separated")})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.user","Users")}),e(ns,{...g("user"),size:"sm",placeholder:h("pages.xray.rules.useComma","Comma or space separated")})]}),s(_,{children:[e(D,{children:h("pages.xray.rules.port","Ports")}),e(ns,{...g("port"),size:"sm",placeholder:h("pages.xray.rules.useComma","Comma or space separated")})]}),e(nn,{}),s(P,{children:[s(_,{children:[e(D,{children:h("pages.xray.rules.attrs","Attributes")}),e(V,{onClick:z,size:"xs",leftIcon:e(en,{width:16}),variant:"outline",colorScheme:"primary",children:h("core.add","Add")})]}),s(we,{spacing:2,mt:3,children:[f.length===0&&e(u,{fontSize:"sm",color:"gray.500",children:h("pages.xray.rules.attrsHelper","No custom attributes defined.")}),f.map((y,ae)=>s(O,{spacing:2,align:"flex-start",children:[e(Ce,{size:"sm",placeholder:h("pages.inbounds.stream.general.name","Key"),...g(`attrs.${ae}.key`)}),e(Ce,{size:"sm",placeholder:h("pages.inbounds.stream.general.value","Value"),...g(`attrs.${ae}.value`)}),e(qe,{"aria-label":"Remove attribute",icon:e(Ia,{width:16}),size:"sm",variant:"ghost",onClick:()=>W(ae)})]},y.id))]})]})]})}),s(Bt,{gap:3,children:[e(V,{variant:"outline",onClick:le,children:h("cancel")}),e(V,{colorScheme:"primary",type:"submit",isLoading:S,children:n==="edit"?h("pages.xray.rules.edit","Save Changes"):h("pages.xray.rules.add","Add Rule")})]})]})]})};class rt{static gf(n){const r=new Float64Array(16);if(n)for(let o=0;o<n.length;++o)r[o]=n[o];return r}static pack(n,r){let o=0;const a=rt.gf(),i=rt.gf();for(let l=0;l<16;++l)i[l]=r[l];rt.carry(i),rt.carry(i),rt.carry(i);for(let l=0;l<2;++l){a[0]=i[0]-65517;for(let c=1;c<15;++c)a[c]=i[c]-65535-(a[c-1]>>16&1),a[c-1]&=65535;a[15]=i[15]-32767-(a[14]>>16&1),o=a[15]>>16&1,a[14]&=65535,rt.cswap(i,a,1-o)}for(let l=0;l<16;++l)n[2*l]=i[l]&255,n[2*l+1]=i[l]>>8}static carry(n){for(let r=0;r<16;++r)n[(r+1)%16]+=(r<15?1:38)*Math.floor(n[r]/65536),n[r]&=65535}static cswap(n,r,o){const a=~(o-1);for(let i=0;i<16;++i){const l=a&(n[i]^r[i]);n[i]^=l,r[i]^=l}}static add(n,r,o){for(let a=0;a<16;++a)n[a]=r[a]+o[a]|0}static subtract(n,r,o){for(let a=0;a<16;++a)n[a]=r[a]-o[a]|0}static multmod(n,r,o){const a=new Float64Array(31);for(let i=0;i<16;++i)for(let l=0;l<16;++l)a[i+l]+=r[i]*o[l];for(let i=0;i<15;++i)a[i]+=38*a[i+16];for(let i=0;i<16;++i)n[i]=a[i];rt.carry(n),rt.carry(n)}static invert(n,r){const o=rt.gf();for(let a=0;a<16;++a)o[a]=r[a];for(let a=253;a>=0;--a)rt.multmod(o,o,o),a!==2&&a!==4&&rt.multmod(o,o,r);for(let a=0;a<16;++a)n[a]=o[a]}static clamp(n){n[31]=n[31]&127|64,n[0]&=248}static generatePublicKey(n){let r=0;const o=new Uint8Array(32),a=rt.gf([1]),i=rt.gf([9]),l=rt.gf(),c=rt.gf([1]),h=rt.gf(),p=rt.gf(),m=rt.gf([56129,1]),g=rt.gf([9]);for(let v=0;v<32;++v)o[v]=n[v];rt.clamp(o);for(let v=254;v>=0;--v)r=o[v>>>3]>>>(v&7)&1,rt.cswap(a,i,r),rt.cswap(l,c,r),rt.add(h,a,l),rt.subtract(a,a,l),rt.add(l,i,c),rt.subtract(i,i,c),rt.multmod(c,h,h),rt.multmod(p,a,a),rt.multmod(a,l,a),rt.multmod(l,i,h),rt.add(h,a,l),rt.subtract(a,a,l),rt.multmod(i,a,a),rt.subtract(l,c,p),rt.multmod(a,l,m),rt.add(a,a,c),rt.multmod(l,l,a),rt.multmod(a,c,p),rt.multmod(c,i,g),rt.multmod(i,h,h),rt.cswap(a,i,r),rt.cswap(l,c,r);return rt.invert(l,l),rt.multmod(a,a,l),rt.pack(o,a),o}static generatePresharedKey(){const n=new Uint8Array(32),r=globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(n),n}static generatePrivateKey(){const n=rt.generatePresharedKey();return rt.clamp(n),n}static encodeBase64(n,r){const o=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let a=0;a<4;++a)n[a]=o[a]+65+(25-o[a]>>8&6)-(51-o[a]>>8&75)-(61-o[a]>>8&15)+(62-o[a]>>8&3)}static keyToBase64(n){let r=0;const o=new Uint8Array(44);for(r=0;r<32/3;++r)rt.encodeBase64(o.subarray(r*4),n.subarray(r*3));return rt.encodeBase64(o.subarray(r*4),Uint8Array.from([n[r*3+0],n[r*3+1],0])),o[43]=61,Array.from(o).map(a=>String.fromCharCode(a)).join("")}static keyFromBase64(n){const r=globalThis.atob(n),o=new Uint8Array(r.length);for(let a=0;a<r.length;a++)o[a]=r.charCodeAt(a);return o}static generateKeypair(n=""){const r=n.length>0?rt.keyFromBase64(n):rt.generatePrivateKey(),o=rt.generatePublicKey(r);return{publicKey:rt.keyToBase64(o),privateKey:n.length>0?n:rt.keyToBase64(r)}}}const so=t=>rt.generateKeypair(t!=null?t:""),mm=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:rt.generateKeypair.bind(rt)})},no={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Xo=t=>{var h,p,m,g,v,b,S,f,w,W,z,le,R;if(!t)return{...no};const n=(h=t.settings)!=null?h:{},o=(p=(Array.isArray(n.peers)?n.peers:[])[0])!=null?p:{},a=Array.isArray(n.address)?n.address:[],i=(g=(m=a.find(K=>typeof K=="string"&&K.endsWith("/32")))==null?void 0:m.replace("/32",""))!=null?g:"",l=(b=(v=a.find(K=>typeof K=="string"&&K.endsWith("/128")))==null?void 0:v.replace("/128",""))!=null?b:"",c=Array.isArray(n.reserved)?n.reserved.filter(K=>Number.isFinite(Number(K))).join(","):"";return{tag:(S=t.tag)!=null?S:"warp",privateKey:(w=(f=n.secretKey)!=null?f:n.privateKey)!=null?w:"",publicKey:(W=o.publicKey)!=null?W:"",endpoint:typeof o.endpoint=="string"?o.endpoint:"engage.cloudflareclient.com:2408",addressV4:i,addressV6:l,reserved:c,mtu:(z=n.mtu)!=null?z:1420,domainStrategy:(le=n.domainStrategy)!=null?le:"ForceIP",notes:typeof t.notes=="string"?t.notes:(R=n.notes)!=null?R:""}},gm=t=>{const n=[];t.addressV4.trim()&&n.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&n.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(i=>Number(i.trim())).filter(i=>Number.isFinite(i)),a=Er.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:n,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?a.notes=t.notes.trim():delete a.notes,a},fm=t=>{if(!t)return[];try{const n=atob(t);return Array.from(n).map(r=>r.charCodeAt(0))}catch{return[]}},bm=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const n=t;return n.host?n.port?`${n.host}:${n.port}`:n.host:""}return""},ym=(t,n)=>{var p,m,g,v,b,S,f,w,W,z,le;if(!t||!(n!=null&&n.config))return null;const r=n.config,o=[],a=(m=(p=r.interface)==null?void 0:p.addresses)!=null?m:{};a.v4&&o.push(`${a.v4}/32`),a.v6&&o.push(`${a.v6}/128`);const l=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},c=(b=(v=l.allowed_ips)!=null?v:l.allowedIPs)!=null?b:["0.0.0.0/0","::/0"];return Er.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(f=(S=r.interface)==null?void 0:S.mtu)!=null?f:1420,secretKey:t.private_key,address:o,reserved:fm(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(W=(w=l.public_key)!=null?w:t.public_key)!=null?W:"",endpoint:bm(l.endpoint),allowedIPs:c,keepAlive:(le=(z=l.keep_alive)!=null?z:l.keepAlive)!=null?le:0}]}})},Qo=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},Ka=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":wn.sizeFormat(t),Qr=({label:t,value:n})=>{const r=Fe("gray.500","gray.400");return s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(u,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:n||"-"})]})},xm=({isOpen:t,onClose:n,initialOutbound:r,onSave:o,onDelete:a})=>{var A,k,L,te,Oe;const{t:i}=je(),l=cr(),[c,h]=d.exports.useState({...no}),[p,m]=d.exports.useState(null),[g,v]=d.exports.useState(null),[b,S]=d.exports.useState(null),[f,w]=d.exports.useState(""),[W,z]=d.exports.useState(!1),[le,R]=d.exports.useState(!1),[K,y]=d.exports.useState(!1),[ae,Se]=d.exports.useState(!1),[ve,T]=d.exports.useState(!1);d.exports.useEffect(()=>{mm()},[]);const F=d.exports.useCallback(async()=>{var ne,I;z(!0);try{const E=await Ee("/core/warp",{method:"GET"});m((ne=E.account)!=null?ne:null),v(null),S(null)}catch(E){l({title:i("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((I=E==null?void 0:E.data)==null?void 0:I.detail)||(E==null?void 0:E.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{z(!1)}},[l,i]);d.exports.useEffect(()=>{t&&F().catch(()=>{})},[t,F]),d.exports.useEffect(()=>{t&&h(Xo(r))},[r,t]),d.exports.useEffect(()=>{var ne;w((ne=p==null?void 0:p.license_key)!=null?ne:"")},[p]);const q=(ne,I)=>{h(E=>({...E,[ne]:I}))},$=Fe("gray.600","gray.300"),Q=Fe("gray.200","whiteAlpha.200"),U=()=>{const ne=so();q("privateKey",ne.privateKey),q("publicKey",ne.publicKey),l({title:i("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},Z=()=>{const ne=Array.from({length:3},()=>Math.floor(Math.random()*256));q("reserved",ne.join(","))},se=d.exports.useCallback((ne,I)=>{if(!ne||!I){S(null);return}const E=ym(ne,I);E&&(S(E),h(Xo(E.toJson())))},[]),M=async()=>{var ne;R(!0);try{const I=so(),E=await Ee("/core/warp/register",{method:"POST",body:{private_key:I.privateKey,public_key:I.publicKey}});m(E.account),v(E.config),se(E.account,E.config),l({title:i("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(I){l({title:i("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((ne=I==null?void 0:I.data)==null?void 0:ne.detail)||(I==null?void 0:I.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{R(!1)}},be=async()=>{var ne;if(!p){l({title:i("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}Se(!0);try{const I=await Ee("/core/warp/config",{method:"GET"});v(I.config),se(p,I.config),l({title:i("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(I){l({title:i("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((ne=I==null?void 0:I.data)==null?void 0:ne.detail)||(I==null?void 0:I.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{Se(!1)}},ee=async()=>{var ne;if(!!f.trim()){y(!0);try{const I=await Ee("/core/warp/license",{method:"POST",body:{license_key:f.trim()}});m(I.account),l({title:i("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(I){l({title:i("pages.xray.warp.licenseFailed","Failed to update license."),description:((ne=I==null?void 0:I.data)==null?void 0:ne.detail)||(I==null?void 0:I.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{y(!1)}}},Ie=async()=>{var ne;T(!0);try{await Ee("/core/warp",{method:"DELETE"}),m(null),v(null),S(null),a(),l({title:i("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(I){l({title:i("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((ne=I==null?void 0:I.data)==null?void 0:ne.detail)||(I==null?void 0:I.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{T(!1)}},me=()=>{if(!b)return;const ne=b.toJson();o(ne),l({title:i("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},J=()=>{a(),h({...no}),l({title:i("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},N=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){l({title:i("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const ne=gm(c);o(ne),n()},B=d.exports.useMemo(()=>Boolean(r),[r]);return s(Gt,{isOpen:t,onClose:n,size:"xl",scrollBehavior:"inside",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),s(Xt,{children:[e(Tt,{children:i("pages.xray.warp.manage","Manage WARP")}),e(Qt,{}),e(It,{children:s(pe,{spacing:5,align:"stretch",children:[s(Tr,{status:"info",borderRadius:"md",children:[e(Mr,{}),e($s,{children:i("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(P,{borderWidth:"1px",borderColor:Q,borderRadius:"lg",p:4,children:p?s(pe,{spacing:4,align:"stretch",children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(Qr,{label:i("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(Qr,{label:i("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(Qr,{label:i("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(Qr,{label:i("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(Qr,{label:i("pages.xray.warp.registeredAt","Registered at"),value:Qo(p.created_at)}),e(Qr,{label:i("pages.xray.warp.updatedAt","Updated at"),value:Qo(p.updated_at)})]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(V,{variant:"outline",onClick:be,isLoading:ae,children:i("pages.xray.warp.fetchInfo","Refresh info")}),e(V,{variant:"ghost",colorScheme:"red",onClick:Ie,isLoading:ve,children:i("pages.xray.warp.removeAccount","Remove account")})]})]}):s(pe,{spacing:3,align:"stretch",children:[e(u,{fontSize:"sm",color:$,children:i("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(V,{colorScheme:"primary",onClick:M,isLoading:le||W,children:i("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&s(P,{borderWidth:"1px",borderColor:Q,borderRadius:"lg",p:4,children:[e(u,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.licenseSection","WARP+/License key")}),s(O,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(Ce,{value:f,onChange:ne=>w(ne.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(V,{colorScheme:"primary",onClick:ee,isLoading:K,isDisabled:!f.trim(),children:i("pages.xray.warp.updateLicense","Update license")})]}),e(u,{fontSize:"xs",color:$,mt:2,children:i("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),s(P,{borderWidth:"1px",borderColor:Q,borderRadius:"lg",p:4,children:[s(O,{justify:"space-between",align:"center",mb:2,children:[e(u,{fontWeight:"semibold",children:i("pages.xray.warp.remoteConfig","Remote configuration")}),g?e(fr,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?i("core.active","Active"):i("core.pending","Pending")}):e(fr,{colorScheme:"gray",children:i("core.empty","Empty")})]}),g?s(we,{spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(Qr,{label:i("core.name","Name"),value:(A=g.name)!=null?A:"-"}),e(Qr,{label:i("core.model","Model"),value:(k=g.model)!=null?k:"-"}),e(Qr,{label:i("core.status","Status"),value:g.enabled?i("core.enabled","Enabled"):i("core.disabled","Disabled")}),e(Qr,{label:i("core.id","ID"),value:(L=g.id)!=null?L:"-"})]}),g.account&&s(Wt,{children:[e(nn,{}),s(Ve,{columns:{base:1,md:3},spacing:4,children:[e(Qr,{label:i("core.type","Type"),value:(te=g.account.account_type)!=null?te:"-"}),e(Qr,{label:i("core.role","Role"),value:(Oe=g.account.role)!=null?Oe:"-"}),e(Qr,{label:i("pages.xray.warp.premiumData","WARP+ data"),value:Ka(g.account.premium_data)}),e(Qr,{label:i("core.quota","Quota"),value:Ka(g.account.quota)}),e(Qr,{label:i("core.usage","Usage"),value:Ka(g.account.usage)})]})]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(V,{colorScheme:"primary",onClick:me,isDisabled:!b,children:i("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(V,{variant:"ghost",onClick:()=>v(null),children:i("core.reset","Reset")})]})]}):e(u,{fontSize:"sm",color:$,children:i("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),s(P,{borderWidth:"1px",borderColor:Q,borderRadius:"lg",p:4,children:[e(u,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.manualTitle","Manual outbound")}),s(we,{spacing:4,children:[s(_,{isRequired:!0,children:[e(D,{children:i("pages.xray.outbound.tag","Tag")}),e(Ce,{size:"sm",value:c.tag,onChange:ne=>q("tag",ne.target.value),placeholder:"warp"})]}),s(_,{isRequired:!0,children:[e(D,{children:i("pages.xray.warp.privateKey")}),e(ns,{size:"sm",value:c.privateKey,onChange:ne=>q("privateKey",ne.target.value),rows:2})]}),s(_,{isRequired:!0,children:[e(D,{children:i("pages.xray.warp.publicKey")}),e(ns,{size:"sm",value:c.publicKey,onChange:ne=>q("publicKey",ne.target.value),rows:2})]}),s(_,{children:[e(V,{size:"sm",colorScheme:"primary",onClick:U,children:i("pages.xray.warp.generateKeys","Generate Keys")}),e(u,{fontSize:"xs",color:$,mt:1,children:i("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),s(_,{isRequired:!0,children:[e(D,{children:i("pages.xray.warp.endpoint")}),e(Ce,{size:"sm",value:c.endpoint,onChange:ne=>q("endpoint",ne.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),s(_,{children:[e(D,{children:i("pages.xray.warp.addressV4","Client IPv4")}),e(Ce,{size:"sm",value:c.addressV4,onChange:ne=>q("addressV4",ne.target.value),placeholder:"172.16.0.2"}),e(br,{children:i("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),s(_,{children:[e(D,{children:i("pages.xray.warp.addressV6","Client IPv6")}),e(Ce,{size:"sm",value:c.addressV6,onChange:ne=>q("addressV6",ne.target.value),placeholder:"2606:4700:****:****::****"})]}),s(_,{children:[e(D,{children:i("pages.xray.warp.reserved")}),e(Ce,{size:"sm",value:c.reserved,onChange:ne=>q("reserved",ne.target.value),placeholder:"0,0,0"}),e(br,{children:i("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(V,{size:"xs",mt:2,variant:"ghost",onClick:Z,children:i("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),s(_,{children:[e(D,{children:i("pages.xray.warp.mtu","MTU")}),e(Hs,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(ne,I)=>q("mtu",I||1420),children:e(Bs,{})})]}),s(_,{children:[e(D,{children:i("pages.xray.warp.notes","Notes (optional)")}),e(ns,{size:"sm",rows:2,value:c.notes,onChange:ne=>q("notes",ne.target.value)})]})]})]})]})}),s(Bt,{display:"flex",justifyContent:"space-between",children:[B?e(V,{colorScheme:"red",variant:"outline",onClick:J,children:i("delete")}):e("span",{}),s(O,{spacing:3,children:[e(V,{variant:"ghost",onClick:n,children:i("cancel")}),e(V,{colorScheme:"primary",onClick:N,children:i(B?"save":"add")})]})]})]})]})},Sm=ye.object({name:ye.string().min(1),address:ye.string().min(1).refine(t=>{const n=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,r=/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:(?:[0-9a-f]{1,4}:){3}(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:(?:[0-9a-f]{1,4}:){2}(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:(?:[0-9a-f]{1,4}:)(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?::[0-9a-f]{1,4}){1,7}|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/,o=/^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;return n.test(t)||r.test(t)||o.test(t)},"Invalid IP address or domain"),port:ye.number().min(1).or(ye.string().transform(t=>parseFloat(t))),api_port:ye.number().min(1).or(ye.string().transform(t=>parseFloat(t))),xray_version:ye.string().nullable().optional(),node_service_version:ye.string().nullable().optional(),id:ye.number().nullable().optional(),status:ye.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:ye.string().nullable().optional(),add_as_new_host:ye.boolean().optional(),usage_coefficient:ye.number().or(ye.string().transform(t=>parseFloat(t))),data_limit:ye.number().nullable().optional(),uplink:ye.number().nullable().optional(),downlink:ye.number().nullable().optional(),use_nobetci:ye.boolean().optional(),access_insights_enabled:ye.boolean().optional(),nobetci_port:ye.number().nullable().optional(),certificate:ye.string().optional(),certificate_key:ye.string().optional(),certificate_token:ye.string().optional(),has_custom_certificate:ye.boolean().optional(),uses_default_certificate:ye.boolean().optional(),certificate_public_key:ye.string().nullable().optional(),node_certificate:ye.string().nullable().optional()}),ra=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,access_insights_enabled:!1,nobetci_port:null}),Zr="fetch-nodes-query-key",fo=t=>{var r;const{isEditingNodes:n}=Ot();return yr({queryKey:Zr,queryFn:Gi.getState().fetchNodes,refetchInterval:n?3e3:void 0,refetchOnWindowFocus:!1,enabled:(r=t==null?void 0:t.enabled)!=null?r:!0})},Gi=ni((t,n)=>({nodes:[],addNode(r){return Ee("/node",{method:"POST",body:r})},fetchNodes(){return Ee("/nodes")},fetchNodesUsage(r){return Ee("/nodes/usage",{query:r})},updateNode(r){return Ee(`/node/${r.id}`,{method:"PUT",body:r})},regenerateNodeCertificate(r){return Ee(`/node/${r.id}/certificate/regenerate`,{method:"POST"})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return Ee(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return Ee(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return Ee(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return Ee(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return Ee("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return Ee("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return Ee(`/node/${(r=n().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),Zo=500,vm=t=>{try{const n=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(n.protocol==="https:"?"wss://":"ws://")+Bl([n.host+n.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+wa()}catch(n){return console.error("Unable to generate websocket url"),console.error(n),null}},Kc=({showTitle:t=!0})=>{var me;const{t:n}=je(),{userData:r,getUserIsSuccess:o}=Dr(),a=o&&Boolean((me=r.permissions)==null?void 0:me.sections.xray),{data:i}=fo({enabled:a}),[l,c]=d.exports.useState(""),[h,p]=d.exports.useState([]),[m,g]=d.exports.useState(""),[v,b]=d.exports.useState(""),[S,f]=d.exports.useState([]),[w,W]=d.exports.useState(!1),z=d.exports.useRef(null),[le,R]=d.exports.useState(!0),{colorMode:K}=fs();d.exports.useEffect(()=>{!a||(W(!0),Ee("/inbounds/full").then(J=>{f(J||[])}).catch(J=>{console.error("Failed to fetch inbounds:",J),f([])}).finally(()=>{W(!1)}))},[a]);const y=J=>{if(J!==l){if(!J){c(""),p([]);return}c(J),p([])}},ae=d.exports.useCallback(cu.exports.debounce(J=>{p(N=>N.length>=Zo?[...N.slice(N.length-Zo+1),J]:[...N,J])},50),[]);d.exports.useEffect(()=>()=>{ae.cancel()},[ae]);const Se=d.exports.useMemo(()=>a?vm(l):null,[a,l]),{readyState:ve}=du(Se,{onMessage:J=>{var N;ae((N=J.data)!=null?N:"")},shouldReconnect:()=>Boolean(Se),reconnectAttempts:10,reconnectInterval:1e3},Boolean(Se));d.exports.useEffect(()=>{const J=z.current;if(!J)return;const N=()=>{const A=J.scrollHeight-J.scrollTop-J.clientHeight<=32;R(A)};return J.addEventListener("scroll",N),N(),()=>{J.removeEventListener("scroll",N)}},[]),d.exports.useEffect(()=>{le&&z.current&&(z.current.scrollTop=z.current.scrollHeight)},[le]);const T=d.exports.useMemo(()=>{const J=K==="dark";return{error:{bg:J?"rgba(239, 68, 68, 0.2)":"rgba(254, 226, 226, 0.8)",color:J?"#fca5a5":"#dc2626",border:J?"#ef4444":"#dc2626"},warn:{bg:J?"rgba(234, 179, 8, 0.2)":"rgba(254, 243, 199, 0.8)",color:J?"#fde047":"#ca8a04",border:J?"#eab308":"#facc15"},info:{bg:J?"rgba(34, 197, 94, 0.2)":"rgba(209, 250, 229, 0.8)",color:J?"#86efac":"#16a34a",border:"#22c55e"},debug:{bg:J?"rgba(148, 163, 184, 0.16)":"rgba(241, 245, 249, 0.8)",color:J?"#cbd5e1":"#475569",border:"#94a3b8"},default:{bg:J?"rgba(51, 65, 85, 0.1)":"rgba(248, 250, 252, 0.8)",color:J?"#e2e8f0":"#64748b",border:J?"#475569":"#cbd5e1"}}},[K]),F=Fe("#f5f7fb","#1f2329"),q=Fe("gray.200","gray.600"),$=Fe("gray.500","gray.400"),Q=Fe("white","gray.700"),U=Fe("white","gray.700"),Z=d.exports.useMemo(()=>{if(!v)return null;const J=S.find(N=>N.tag===v);return(J==null?void 0:J.tag)||null},[v,S]),se=d.exports.useMemo(()=>{let J=h;if(Z&&(J=J.filter(N=>N.toLowerCase().includes(Z.toLowerCase()))),m.trim()){const N=m.toLowerCase();J=J.filter(B=>B.toLowerCase().includes(N))}return J},[h,m,Z]),M=d.exports.useMemo(()=>se.map((J,N)=>({message:J,key:`${N}-${J}`})),[se]),be=ue(Aa,{baseStyle:{w:4,h:4,color:$}}),ee=ue(Ia,{baseStyle:{w:4,h:4}}),Ie=J=>{const N=J.toLowerCase();return/error|failed|exception|fatal|panic|critical/i.test(N)?"error":/warn|warning|deprecated/i.test(N)?"warn":/info|information|success|connected|started|stopped/i.test(N)?"info":/debug|trace|verbose/i.test(N)?"debug":"default"};return a?s(pe,{spacing:6,align:"stretch",children:[t&&e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:n("header.xrayLogs")}),s(we,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[s(we,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},flex:1,children:[(i==null?void 0:i[0])&&s(at,{size:"sm",w:{base:"full",sm:"auto"},bg:Q,onChange:J=>y(J.target.value),value:l,children:[e("option",{value:"",children:n("core.master")}),i.map(J=>e("option",{value:String(J.id),children:n(J.name)},J.address))]}),s(at,{size:"sm",w:{base:"full",sm:"200px"},bg:Q,onChange:J=>b(J.target.value),value:v,placeholder:n("xrayLogs.selectInbound","Select Inbound"),isDisabled:w||S.length===0,children:[e("option",{value:"",children:n("xrayLogs.allInbounds","All Inbounds")}),S.map(J=>s("option",{value:J.tag,children:[J.tag," (",J.protocol,")"]},J.tag))]}),s(Ar,{size:"sm",maxW:{base:"full",sm:"300px"},bg:U,children:[e(Ca,{pointerEvents:"none",children:e(be,{})}),e(Ce,{placeholder:n("xrayLogs.searchPlaceholder","Search logs (UUID, username, email, inbound tag...)"),value:m,onChange:J=>g(J.target.value)}),(m||v)&&e(Vr,{children:e(qe,{"aria-label":"Clear filters",size:"xs",variant:"ghost",onClick:()=>{g(""),b("")},icon:e(ee,{})})})]}),e(u,{fontSize:"sm",color:$,whiteSpace:"nowrap",children:n(`core.socket.${ve}`)})]}),s(we,{direction:"row",spacing:2,align:"center",children:[(m||v)&&e(u,{fontSize:"xs",color:$,whiteSpace:"nowrap",children:n("xrayLogs.filteredCount","{{count}} of {{total}} logs",{count:se.length,total:h.length})}),e(u,{fontSize:"xs",color:$,whiteSpace:"nowrap",children:le?n("core.autoScrollOn","Auto-scroll: On"):n("core.autoScrollOff","Auto-scroll: Off")})]})]}),e(P,{border:"1px solid",borderColor:q,bg:F,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:z,fontFamily:"mono",fontSize:"sm",children:e(pe,{align:"stretch",spacing:2,children:se.length===0?e(P,{textAlign:"center",py:8,color:$,fontSize:"sm",children:m?n("xrayLogs.noMatchingLogs","No logs match your search filter"):n("xrayLogs.noLogs","No logs available")}):M.map(({message:J,key:N})=>{var L;const B=Ie(J),A=(L=T[B])!=null?L:T.default,k=m?(()=>J.split(new RegExp(`(${m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((ne,I)=>({part:ne,key:`${N}-part-${I}`})).map(({part:ne,key:I})=>ne.toLowerCase()===m.toLowerCase()?e(ue.span,{bg:"yellow.300",color:"black",px:1,borderRadius:"sm",fontWeight:"semibold",_dark:{bg:"yellow.500",color:"black"},children:ne},I):e(va.Fragment,{children:ne},I)))():J;return e(P,{bg:A.bg,color:A.color,borderLeftWidth:3,borderLeftColor:A.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(ue.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:k})},N)})})})]}):s(pe,{spacing:4,align:"stretch",children:[t&&e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:n("xrayLogs.title","Xray logs")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:n("xrayLogs.noPermission","You do not have permission to view Xray logs.")})]})},gi=ue(en,{baseStyle:{w:3.5,h:3.5}}),fi=ue(Vs,{baseStyle:{w:4,h:4}}),bi=ue(cn,{baseStyle:{w:4,h:4}}),jo=ue(ac,{baseStyle:{w:4,h:4}}),el=ue(oc,{baseStyle:{w:4,h:4}}),tl=ue(gs,{baseStyle:{w:4,h:4}}),wm=ue(uu,{baseStyle:{w:4,h:4}}),km=ue(hu,{baseStyle:{w:4,h:4}}),_m=ue(jl,{baseStyle:{w:4,h:4}}),Cm=ue(lc,{baseStyle:{w:4,h:4}}),Am=ue(uo,{baseStyle:{w:4,h:4}}),Dm=ue(pu,{baseStyle:{w:4,h:4}}),Im=ue($l,{baseStyle:{w:4,h:4}}),Pm=ue(mu,{baseStyle:{w:4,h:4}}),Em=ue(gu,{baseStyle:{w:4,h:4}}),rl=ue(fu,{baseStyle:{w:4,h:4}}),yi={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},sa=t=>JSON.stringify(t!=null?t:{}),sl=t=>Array.isArray(t)?t.join(","):t!=null?t:"",zm=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],$c="/var/lib/rebecca/xray-core",Tm=`${$c}/access.log`,Mm=`${$c}/error.log`,na=({title:t,children:n})=>{const r=Fe("gray.50","whiteAlpha.100"),o=Fe("gray.200","whiteAlpha.300");return s(P,{borderWidth:"1px",borderColor:o,borderRadius:"lg",overflow:"hidden",children:[e(P,{bg:r,px:{base:3,md:4},py:2,children:e(u,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(P,{overflowX:"auto",children:e(Ks,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(as,{children:n})})})]})},ds=({label:t,controlId:n,children:r})=>{const o=Fe("gray.700","whiteAlpha.800");return s(Lt,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Le,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(D,{htmlFor:n,mb:{base:2,md:0},color:o,children:t})}),e(Le,{py:3,display:{base:"block",md:"table-cell"},children:e(_,{id:n,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(n)})})]})},xi=({children:t})=>{const n=Fe("gray.200","whiteAlpha.200"),r=Fe("white","blackAlpha.400"),o=Fe("sm","none");return e(P,{borderWidth:"1px",borderColor:n,borderRadius:"xl",bg:r,boxShadow:o,overflow:"hidden",children:e(P,{overflowX:"auto",children:t})})},Si=({children:t,...n})=>{const r=Fe("gray.50","whiteAlpha.100"),o=Fe("gray.200","whiteAlpha.300"),a=Fe("gray.300","whiteAlpha.300"),i=Fe("gray.100","whiteAlpha.200"),l=Fe("gray.50","whiteAlpha.100");return e(Ks,{size:"sm",w:"full",...n,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:o},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:o},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:a,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:i,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:l}},children:t})},Nm=()=>{var qs,Js,pn,mn,gn;const{t}=je(),{fetchCoreSettings:n,updateConfig:r,isLoading:o,config:a,isPostLoading:i,restartCore:l}=Gp(),{userData:c,getUserIsSuccess:h}=Dr(),{onEditingCore:p}=Ot(),m=h&&Boolean((qs=c.permissions)==null?void 0:qs.sections.xray),{data:g}=yr(["server-ips"],()=>Ee("/core/ips"),{staleTime:5*60*1e3,enabled:m}),v=cr(),{isOpen:b,onOpen:S,onClose:f}=sr(),{isOpen:w,onOpen:W,onClose:z}=sr(),{isOpen:le,onOpen:R,onClose:K}=sr(),{isOpen:y,onOpen:ae,onClose:Se}=sr(),{isOpen:ve,onOpen:T,onClose:F}=sr(),{isOpen:q,onOpen:$,onClose:Q}=sr(),U=Es({defaultValues:{config:a||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),Z=d.exports.useRef(sa(U.getValues("config"))),se=ur({control:U.control,name:"config"}),M=d.exports.useMemo(()=>sa(se)!==Z.current,[se]),[be,ee]=d.exports.useState([]),[Ie,me]=d.exports.useState([]),[J,N]=d.exports.useState([]),[B,A]=d.exports.useState([]),[k,L]=d.exports.useState([]),[te,Oe]=d.exports.useState([]),[ne,I]=d.exports.useState(null),[E,G]=d.exports.useState(null),[ze,Ne]=d.exports.useState(null),[Je,H]=d.exports.useState(!1),[ke,Me]=d.exports.useState("xraySetting"),[Be,ot]=d.exports.useState(""),X=Br({base:!0,md:!1}),[Ae,xe]=d.exports.useState(0),[$e,Ze]=d.exports.useState(""),[Vt,ge]=d.exports.useState(""),Te=Fe("gray.200","whiteAlpha.300"),Re=d.exports.useCallback(x=>x.map((C,Y)=>{var Ge,mt;return{key:`${Y}-${(mt=(Ge=C.tag)!=null?Ge:C.protocol)!=null?mt:"outbound"}`,...C}}),[]),ut=d.exports.useCallback(x=>{ee(Re(x))},[Re]),lt=d.exports.useCallback(()=>{const x=U.getValues("config.outbounds");return Array.isArray(x)?JSON.parse(JSON.stringify(x)):[]},[U]),Mt=d.exports.useCallback(x=>{U.setValue("config.outbounds",x,{shouldDirty:!0}),ut(x),xe(C=>C+1)},[U,ut]),er=d.exports.useCallback(x=>x.map((C,Y)=>{var Ge,mt,it,Nt,Or,Ws,Ms,ai,oi,li,ci,di,ui,hi,pi;return{key:`${Y}-${(mt=(Ge=C.outboundTag)!=null?Ge:C.balancerTag)!=null?mt:"rule"}`,source:(it=C.source)!=null?it:[],sourcePort:(Nt=C.sourcePort)!=null?Nt:[],network:(Or=C.network)!=null?Or:[],protocol:(Ws=C.protocol)!=null?Ws:[],attrs:C.attrs?JSON.stringify(C.attrs,null,2):"",ip:(Ms=C.ip)!=null?Ms:[],domain:(ai=C.domain)!=null?ai:[],port:(oi=C.port)!=null?oi:[],inboundTag:(li=C.inboundTag)!=null?li:[],user:(ci=C.user)!=null?ci:[],outboundTag:(di=C.outboundTag)!=null?di:"",balancerTag:(ui=C.balancerTag)!=null?ui:"",type:(hi=C.type)!=null?hi:"field",domainMatcher:(pi=C.domainMatcher)!=null?pi:""}}),[]),ie=d.exports.useCallback(x=>{me(er(x))},[er]),st=d.exports.useCallback(x=>{U.setValue("config.routing.rules",x,{shouldDirty:!0}),ie(x),xe(C=>C+1)},[U,ie]),Qe=d.exports.useCallback(()=>{const x=U.getValues("config.routing.rules");return Array.isArray(x)?JSON.parse(JSON.stringify(x)):[]},[U]);d.exports.useEffect(()=>{const x=()=>{H(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",x),()=>{document.removeEventListener("fullscreenchange",x)}},[]),d.exports.useEffect(()=>{if(!m){p(!1);return}return p(!0),n().then(()=>{console.log("Core settings fetched successfully")}).catch(x=>{v({title:t("core.errorFetchingConfig"),description:x.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>p(!1)},[m,n,p,v,t]),d.exports.useEffect(()=>{var x,C,Y,Ge;a&&(U.reset({config:a}),Z.current=sa(a),ut((a==null?void 0:a.outbounds)||[]),ie(((x=a==null?void 0:a.routing)==null?void 0:x.rules)||[]),N(((Y=(C=a==null?void 0:a.routing)==null?void 0:C.balancers)==null?void 0:Y.map((mt,it)=>{var Nt;return{key:it,tag:mt.tag||"",strategy:((Nt=mt.strategy)==null?void 0:Nt.type)||"random",selector:mt.selector||[],fallbackTag:mt.fallbackTag||""}}))||[]),A(((Ge=a==null?void 0:a.dns)==null?void 0:Ge.servers)||[]),L((a==null?void 0:a.fakedns)||[]),ot(a!=null&&a.observatory?"observatory":a!=null&&a.burstObservatory?"burstObservatory":""),xe(mt=>mt+1))},[a,U,ut,ie]);const{mutate:Pt,isLoading:Rt}=vr(l,{onSuccess:()=>{v({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:x=>{var C,Y;v({title:t("core.generalErrorMessage"),description:((Y=(C=x.response)==null?void 0:C.data)==null?void 0:Y.detail)||x.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Ft=U.handleSubmit(({config:x})=>{r(x).then(()=>{U.reset({config:x}),Z.current=sa(x),v({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(C=>{let Y=t("core.generalErrorMessage");typeof C.response._data.detail=="object"&&(Y=C.response._data.detail[Object.keys(C.response._data.detail)[0]]),typeof C.response._data.detail=="string"&&(Y=C.response._data.detail),v({title:Y,status:"error",isClosable:!0,position:"top",duration:3e3})})}),We=async()=>{const x=await Ee("/panel/xray/getOutboundsTraffic");x!=null&&x.success&&Oe(x.obj)},ce=()=>{G(null),f()},Pe=()=>{G(null),S()},fe=x=>{G(x),S()},dt=x=>{const C=lt();x<0||x>=C.length||(C.splice(x,1),Mt(C))},yt=(x,C)=>{const Y=lt();if(x<0||x>=Y.length||C<0||C>=Y.length)return;const[Ge]=Y.splice(x,1);Y.splice(C,0,Ge),Mt(Y)},Kt=x=>{yt(x,x-1)},$t=x=>{yt(x,x+1)},Ut=()=>{I(null),W()},ft=x=>{I(x),W()},et=x=>{const C=Qe();C.splice(x,1),st(C)},he=(x,C)=>{const Y=Qe();if(x<0||x>=Y.length||C<0||C>=Y.length)return;const[Ge]=Y.splice(x,1);Y.splice(C,0,Ge),st(Y)},De=x=>{const C=Qe();ne!==null&&ne>=0&&ne<C.length?C[ne]=x:C.push(x),st(C),I(null)},tt=()=>{I(null),z()},tr=()=>{R()},xr=x=>{R()},es=x=>{const C=[...J],Y=C.splice(x,1)[0];U.setValue("config.routing.balancers",C,{shouldDirty:!0}),N(C);const Ge={...U.getValues("config")};Ge.observatory&&(Ge.observatory.subjectSelector=Ge.observatory.subjectSelector.filter(mt=>mt!==Y.tag)),Ge.burstObservatory&&(Ge.burstObservatory.subjectSelector=Ge.burstObservatory.subjectSelector.filter(mt=>mt!==Y.tag)),U.setValue("config",Ge,{shouldDirty:!0})},bs=()=>{Ne(null),ae()},os=x=>{Ne(x),ae()},ys=()=>{Ne(null),Se()},xs=x=>{const C=[...B];C.splice(x,1),U.setValue("config.dns.servers",C,{shouldDirty:!0}),A(C)},Ss=()=>{T()},vs=x=>{T()},ws=x=>{const C=[...k];C.splice(x,1),U.setValue("config.fakedns",C.length>0?C:null,{shouldDirty:!0}),L(C)},Gr=x=>{var C,Y,Ge,mt,it;switch(x.protocol){case"vmess":case"vless":return((C=x.settings.vnext)==null?void 0:C.map(Nt=>`${Nt.address}:${Nt.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((Y=x.settings.servers)==null?void 0:Y.map(Nt=>`${Nt.address}:${Nt.port}`))||[];case"dns":return[`${(Ge=x.settings)==null?void 0:Ge.address}:${(mt=x.settings)==null?void 0:mt.port}`];case"wireguard":return((it=x.settings.peers)==null?void 0:it.map(Nt=>Nt.endpoint))||[];default:return[]}},ls=x=>{const C=te.find(Y=>Y.tag===x.tag);return C?`${wn.sizeFormat(C.up)} / ${wn.sizeFormat(C.down)}`:`${wn.sizeFormat(0)} / ${wn.sizeFormat(0)}`},ar=d.exports.useMemo(()=>Array.isArray(se==null?void 0:se.outbounds)?se.outbounds:[],[se]),j=d.exports.useMemo(()=>{var x;return Array.isArray((x=se==null?void 0:se.routing)==null?void 0:x.rules)?se.routing.rules:[]},[se]),He=d.exports.useMemo(()=>{var x;return Array.from(new Set(((x=se==null?void 0:se.inbounds)!=null?x:[]).map(C=>C==null?void 0:C.tag).filter(C=>Boolean(C))))},[se]),ht=d.exports.useMemo(()=>Array.from(new Set(ar.map(x=>x==null?void 0:x.tag).filter(x=>Boolean(x)))),[ar]),St=d.exports.useMemo(()=>{var x,C;return Array.from(new Set(((C=(x=se==null?void 0:se.routing)==null?void 0:x.balancers)!=null?C:[]).map(Y=>Y==null?void 0:Y.tag).filter(Y=>Boolean(Y))))},[se]),Ht=d.exports.useMemo(()=>ar.length===0?-1:ar.findIndex(x=>(x==null?void 0:x.protocol)==="freedom"),[ar]),Sr=d.exports.useMemo(()=>{var C,Y;if(Ht<0)return"";const x=ar[Ht];return(Y=(C=x==null?void 0:x.settings)==null?void 0:C.domainStrategy)!=null?Y:""},[Ht,ar]),Kr=x=>{const C=U.getValues("config")||{},Y=Array.isArray(C.outbounds)?JSON.parse(JSON.stringify(C.outbounds)):[],Ge=Y.findIndex(Nt=>(Nt==null?void 0:Nt.protocol)==="freedom");if(Ge===-1)return;const mt={...Y[Ge]},it={...mt.settings||{}};x?it.domainStrategy=x:delete it.domainStrategy,mt.settings=it,Y[Ge]=mt,U.setValue("config.outbounds",Y,{shouldDirty:!0}),ee(Y.map((Nt,Or)=>({key:Or,...Nt}))),xe(Nt=>Nt+1)},ks=d.exports.useMemo(()=>{var x;return(x=ar.find(C=>(C==null?void 0:C.tag)==="warp"))!=null?x:null},[ar]),Rr=d.exports.useMemo(()=>ar.findIndex(x=>(x==null?void 0:x.tag)==="warp"),[ar])!==-1,dr=d.exports.useMemo(()=>{const x=j.find(C=>C.outboundTag==="warp");return Array.isArray(x==null?void 0:x.domain)?x.domain:[]},[j]),Ur=x=>{const C=x.map(it=>it.trim()).filter((it,Nt,Or)=>it.length>0&&Or.indexOf(it)===Nt),Y=Qe(),Ge=Y.findIndex(it=>it.outboundTag==="warp");if(C.length===0){Ge!==-1&&(Y.splice(Ge,1),st(Y));return}const mt={type:"field",outboundTag:"warp",domain:C};Ge!==-1?Y[Ge]={...Y[Ge],...mt}:Y.push(mt),st(Y)},cs=x=>{const C=x.trim();if(!!C){if(dr.includes(C)){v({title:t("pages.xray.warp.domainExists","This domain already exists in the list."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}Ur([...dr,C])}},_s=x=>{Ur(dr.filter(C=>C!==x))},$r=d.exports.useMemo(()=>zm.filter(x=>!dr.includes(x.value)),[dr]),ts=Fe("white","blackAlpha.400"),Cs=Fe("gray.200","whiteAlpha.200"),zs=Fe("gray.600","gray.300"),Ts=x=>{var mt;const C=lt(),Y=(mt=x.tag)!=null?mt:"warp",Ge=C.findIndex(it=>(it==null?void 0:it.tag)===Y);Ge>=0?C[Ge]=x:C.push(x),Mt(C)},rs=()=>{const x=lt(),C=x.findIndex(Y=>(Y==null?void 0:Y.tag)==="warp");C!==-1&&(x.splice(C,1),Mt(x),Ur([]),Ze(""),ge(""))},As=x=>{const C=lt();E!==null&&E>=0&&E<C.length?C[E]=x:C.push(x),Mt(C),G(null)},Ir=()=>{Q()},_e=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{H(!1)}).catch(x=>{console.error("Error exiting fullscreen:",x)}):document.documentElement.requestFullscreen().then(()=>{H(!0)}).catch(x=>{console.error("Error entering fullscreen:",x)})},Ds=()=>{var C,Y,Ge,mt;const x=U.getValues("config")||{};switch(ke){case"inboundSettings":return JSON.stringify((C=x.inbounds)!=null?C:[],null,2);case"outboundSettings":return JSON.stringify((Y=x.outbounds)!=null?Y:[],null,2);case"routingRuleSettings":return JSON.stringify((mt=(Ge=x.routing)==null?void 0:Ge.rules)!=null?mt:[],null,2);default:return JSON.stringify(x!=null?x:{},null,2)}},vt=x=>{var C,Y,Ge,mt;try{const it=JSON.parse(x),Nt={...U.getValues("config")||{}};switch(ke){case"inboundSettings":Nt.inbounds=it;break;case"outboundSettings":Nt.outbounds=it,ut(it);break;case"routingRuleSettings":Nt.routing||(Nt.routing={}),Nt.routing.rules=it,ie(it);break;default:U.setValue("config",it,{shouldDirty:!0}),ut((it==null?void 0:it.outbounds)||[]),ie(((C=it==null?void 0:it.routing)==null?void 0:C.rules)||[]),N(((Ge=(Y=it==null?void 0:it.routing)==null?void 0:Y.balancers)==null?void 0:Ge.map((Or,Ws)=>{var Ms;return{key:Ws,tag:Or.tag||"",strategy:((Ms=Or.strategy)==null?void 0:Ms.type)||"random",selector:Or.selector||[],fallbackTag:Or.fallbackTag||""}}))||[]),A(((mt=it==null?void 0:it.dns)==null?void 0:mt.servers)||[]),L((it==null?void 0:it.fakedns)||[]);return}U.setValue("config",Nt,{shouldDirty:!0})}catch{}},or=()=>{var C,Y;const x=U.getValues("config")||{};return Be==="observatory"?JSON.stringify((C=x.observatory)!=null?C:{},null,2):Be==="burstObservatory"?JSON.stringify((Y=x.burstObservatory)!=null?Y:{},null,2):""},Ct=x=>{try{const C=JSON.parse(x),Y={...U.getValues("config")||{}};Be==="observatory"&&(Y.observatory=C),Be==="burstObservatory"&&(Y.burstObservatory=C),U.setValue("config",Y,{shouldDirty:!0})}catch{}},mr=x=>!x&&x!==0?[]:Array.isArray(x)?x.map(C=>typeof C=="string"?C.trim():String(C)).filter(Boolean):typeof x=="string"?x.split(",").map(C=>C.trim()).filter(Boolean):[String(x)],qt=(x,C="blue")=>{const Y=mr(x);return Y.length?e(Yp,{chips:Y,color:C}):e(u,{color:"gray.400",children:"-"})},jt=x=>{if(x==null||x===""||typeof x=="string"&&!x.trim())return e(u,{color:"gray.400",children:"-"});const C=typeof x=="string"?x:String(x);return C.length>30?e(Ba,{text:C,label:t("details")}):e(u,{children:C})},wr=x=>{if(!x)return e(u,{color:"gray.400",children:"-"});try{const C=JSON.parse(x);if(C&&typeof C=="object"&&!Array.isArray(C)){const Y=Object.entries(C);return Y.length?e(P,{display:"flex",flexWrap:"wrap",gap:"1",children:Y.map(([Ge,mt])=>e(pt,{colorScheme:"purple",size:"sm",children:`${Ge}: ${String(mt)}`},Ge))}):e(u,{color:"gray.400",children:"-"})}}catch{}return e(u,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:x})};if(!h)return e(pe,{spacing:4,align:"center",py:10,children:e(zt,{size:"lg"})});if(!m)return s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.xraySettings","Xray settings")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("xraySettings.noPermission","You do not have permission to manage Xray settings.")})]});const ss=or(),Os=Ds();return s(pe,{spacing:6,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(u,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(we,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:s(we,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(V,{size:"sm",colorScheme:"primary",isLoading:i,isDisabled:!M||i,onClick:Ft,w:{base:"full",sm:"auto"},children:t("core.save")}),e(V,{size:"sm",leftIcon:e(tl,{}),isLoading:Rt,onClick:()=>Pt(),variant:"outline",w:{base:"full",sm:"auto"},children:t(Rt?"core.restarting":"core.restartCore")})]})}),s(dn,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[s(un,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(hr,{children:s(O,{spacing:2,align:"center",children:[e(_m,{}),e(u,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(hr,{children:s(O,{spacing:2,align:"center",children:[e(Cm,{}),e(u,{as:"span",children:t("pages.xray.Routings")})]})}),e(hr,{children:s(O,{spacing:2,align:"center",children:[e(Am,{}),e(u,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(hr,{children:s(O,{spacing:2,align:"center",children:[e(Dm,{}),e(u,{as:"span",children:t("pages.xray.Balancers")})]})}),e(hr,{children:s(O,{spacing:2,align:"center",children:[e(Im,{}),e(u,{as:"span",children:t("DNS")})]})}),e(hr,{children:s(O,{spacing:2,align:"center",children:[e(Pm,{}),e(u,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(hr,{children:s(O,{spacing:2,align:"center",children:[e(Em,{}),e(u,{as:"span",children:t("pages.xray.logs")})]})})]}),s(hn,{children:[e(pr,{children:e(pe,{spacing:4,align:"stretch",children:e(P,{borderWidth:"1px",borderColor:Te,borderRadius:"lg",p:{base:3,md:4},children:s(pe,{spacing:4,align:"stretch",children:[s(na,{title:t("pages.xray.serverIPs","Server IPs"),children:[e(ds,{label:"IPv4",controlId:"server-ipv4",children:x=>e(Ba,{text:(g==null?void 0:g.ipv4)||"Loading..."})}),e(ds,{label:"IPv6",controlId:"server-ipv6",children:x=>e(Ba,{text:(g==null?void 0:g.ipv6)||"Loading..."})})]}),s(na,{title:t("pages.xray.generalConfigs"),children:[e(ds,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:x=>s(at,{id:x,size:"sm",maxW:"220px",value:Sr,onChange:C=>Kr(C.target.value),isDisabled:Ht===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(C=>e("option",{value:C,children:C},C))]})}),e(ds,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:x=>e(At,{name:"config.routing.domainStrategy",control:U.control,render:({field:C})=>e(at,{...C,id:x,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(Y=>e("option",{value:Y,children:Y},Y))})})})]}),e(P,{borderWidth:"1px",borderColor:Cs,borderRadius:"lg",bg:ts,p:{base:3,md:4},children:s(pe,{align:"stretch",spacing:3,children:[s(O,{justify:"space-between",align:"center",children:[e(u,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(V,{variant:"outline",size:"sm",leftIcon:e(rl,{}),onClick:$,children:Rr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(u,{fontSize:"sm",color:zs,children:t("pages.xray.warpRoutingDesc")}),s(Bn,{children:[dr.length===0&&e(an,{children:e(pt,{colorScheme:"gray",variant:"subtle",children:e(Li,{children:t("core.empty","Empty")})})}),dr.map(x=>e(an,{children:s(pt,{colorScheme:"primary",borderRadius:"full",children:[e(Li,{children:x}),e(ma,{"aria-label":t("core.remove"),onClick:()=>_s(x)})]})},x))]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(at,{placeholder:t("core.select","Select..."),size:"sm",maxW:"240px",value:$e,onChange:x=>{const{value:C}=x.target;C&&cs(C),Ze("")},isDisabled:$r.length===0,children:$r.map(x=>e("option",{value:x.value,children:x.label},x.value))}),s(O,{spacing:2,maxW:"320px",flex:"1",children:[e(Ce,{size:"sm",value:Vt,onChange:x=>ge(x.target.value),placeholder:"geosite:google"}),e(V,{size:"sm",colorScheme:"primary",onClick:()=>{cs(Vt),ge("")},isDisabled:!Vt.trim(),children:t("core.add")})]})]})]})}),s(na,{title:t("pages.xray.statistics"),children:[e(ds,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:x=>e(At,{name:"config.policy.system.statsInboundUplink",control:U.control,render:({field:C})=>e(_t,{id:x,isChecked:!!C.value,onChange:Y=>C.onChange(Y.target.checked)})})}),e(ds,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:x=>e(At,{name:"config.policy.system.statsInboundDownlink",control:U.control,render:({field:C})=>e(_t,{id:x,isChecked:!!C.value,onChange:Y=>C.onChange(Y.target.checked)})})}),e(ds,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:x=>e(At,{name:"config.policy.system.statsOutboundUplink",control:U.control,render:({field:C})=>e(_t,{id:x,isChecked:!!C.value,onChange:Y=>C.onChange(Y.target.checked)})})}),e(ds,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:x=>e(At,{name:"config.policy.system.statsOutboundDownlink",control:U.control,render:({field:C})=>e(_t,{id:x,isChecked:!!C.value,onChange:Y=>C.onChange(Y.target.checked)})})})]}),s(na,{title:t("pages.xray.logConfigs"),children:[e(ds,{label:t("pages.xray.logLevel"),controlId:"log-level",children:x=>e(At,{name:"config.log.loglevel",control:U.control,render:({field:C})=>e(at,{...C,id:x,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(Y=>e("option",{value:Y,children:Y},Y))})})}),e(ds,{label:t("pages.xray.accessLog"),controlId:"access-log",children:x=>e(At,{name:"config.log.access",control:U.control,render:({field:C})=>s(at,{...C,id:x,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none",Tm].map(Y=>e("option",{value:Y,children:Y},Y))]})})}),e(ds,{label:t("pages.xray.errorLog"),controlId:"error-log",children:x=>e(At,{name:"config.log.error",control:U.control,render:({field:C})=>s(at,{...C,id:x,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none",Mm].map(Y=>e("option",{value:Y,children:Y},Y))]})})}),e(ds,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:x=>e(At,{name:"config.log.maskAddress",control:U.control,render:({field:C})=>s(at,{...C,id:x,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(Y=>e("option",{value:Y,children:Y},Y))]})})}),e(ds,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:x=>e(At,{name:"config.log.dnsLog",control:U.control,render:({field:C})=>e(_t,{id:x,isChecked:!!C.value,onChange:Y=>C.onChange(Y.target.checked)})})})]})]})})})}),e(pr,{children:s(pe,{spacing:4,align:"stretch",children:[e(V,{leftIcon:e(gi,{}),...yi,onClick:Ut,children:t("pages.xray.rules.add")}),e(xi,{children:s(Si,{minW:"1100px",children:[s(hs,{children:[s(Lt,{children:[e(Xe,{rowSpan:2,w:"80px",children:t("common.index")}),e(Xe,{colSpan:2,children:t("pages.xray.rules.sourceGroup")}),e(Xe,{colSpan:3,children:t("pages.xray.rules.networkGroup")}),e(Xe,{colSpan:3,children:t("pages.xray.rules.destinationGroup")}),e(Xe,{colSpan:2,children:t("pages.xray.rules.inboundGroup")}),e(Xe,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Xe,{rowSpan:2,children:t("pages.xray.rules.balancer")}),e(Xe,{rowSpan:2,children:t("actions")})]}),s(Lt,{children:[e(Xe,{children:t("IP")}),e(Xe,{children:t("port")}),e(Xe,{children:t("network")}),e(Xe,{children:t("pages.xray.rules.protocol")}),e(Xe,{children:t("pages.xray.rules.attrs")}),e(Xe,{children:t("IP")}),e(Xe,{children:t("pages.xray.rules.domain")}),e(Xe,{children:t("port")}),e(Xe,{children:t("pages.xray.rules.inboundTag")}),e(Xe,{children:t("pages.xray.rules.user")})]})]}),s(as,{children:[Ie.length===0&&e(Lt,{children:e(Le,{colSpan:14,children:e(u,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty")})})}),Ie.map((x,C)=>s(Lt,{children:[e(Le,{children:s(pe,{align:"flex-start",spacing:1,children:[e(u,{fontWeight:"semibold",children:C+1}),s(O,{spacing:1,children:[e(qe,{"aria-label":"move up",icon:e(jo,{}),size:"xs",variant:"ghost",isDisabled:C===0,onClick:()=>he(C,C-1)}),e(qe,{"aria-label":"move down",icon:e(el,{}),size:"xs",variant:"ghost",isDisabled:C===Ie.length-1,onClick:()=>he(C,C+1)})]})]})}),e(Le,{children:qt(x.source,"blue")}),e(Le,{children:jt(x.sourcePort)}),e(Le,{children:qt(x.network,"purple")}),e(Le,{children:qt(x.protocol,"green")}),e(Le,{children:wr(x.attrs)}),e(Le,{children:qt(x.ip,"blue")}),e(Le,{children:qt(x.domain,"blue")}),e(Le,{children:jt(x.port)}),e(Le,{children:qt(x.inboundTag,"teal")}),e(Le,{children:qt(x.user,"cyan")}),e(Le,{children:jt(x.outboundTag)}),e(Le,{children:jt(x.balancerTag)}),e(Le,{children:s(O,{spacing:1,children:[e(qe,{"aria-label":"edit",icon:e(bi,{}),size:"xs",variant:"ghost",onClick:()=>ft(C)}),e(qe,{"aria-label":"delete",icon:e(fi,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>et(C)})]})})]},x.key))]})]})})]})}),e(pr,{children:s(pe,{spacing:4,align:"stretch",children:[s(O,{children:[e(V,{leftIcon:e(gi,{}),...yi,onClick:Pe,children:t("pages.xray.outbound.addOutbound")}),e(V,{leftIcon:e(rl,{}),size:"xs",variant:"ghost",onClick:$,children:Rr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(V,{leftIcon:e(tl,{}),size:"xs",variant:"ghost",onClick:We,children:t("refresh")})]}),e(xi,{children:s(Si,{minW:"880px",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:"#"}),e(Xe,{children:t("pages.xray.outbound.tag")}),e(Xe,{children:t("protocol")}),e(Xe,{children:t("pages.xray.outbound.address")}),e(Xe,{children:t("pages.inbounds.traffic")})]})}),e(as,{children:be.map((x,C)=>{var Y,Ge,mt;return s(Lt,{children:[e(Le,{children:s(O,{children:[e(u,{children:C+1}),e(qe,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(jo,{}),size:"xs",variant:"ghost",isDisabled:C===0,onClick:()=>Kt(C)}),e(qe,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(el,{}),size:"xs",variant:"ghost",isDisabled:C===be.length-1,onClick:()=>$t(C)}),e(qe,{"aria-label":"edit",icon:e(bi,{}),size:"xs",variant:"ghost",onClick:()=>fe(C)}),e(qe,{"aria-label":"delete",icon:e(fi,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>dt(C)})]})}),e(Le,{children:x.tag}),s(Le,{children:[e(pt,{colorScheme:"purple",children:x.protocol}),["vmess","vless","trojan","shadowsocks"].includes(x.protocol)&&s(Wt,{children:[e(pt,{colorScheme:"blue",children:(Y=x.streamSettings)==null?void 0:Y.network}),((Ge=x.streamSettings)==null?void 0:Ge.security)==="tls"&&e(pt,{colorScheme:"green",children:"tls"}),((mt=x.streamSettings)==null?void 0:mt.security)==="reality"&&e(pt,{colorScheme:"green",children:"reality"})]})]}),e(Le,{children:Gr(x).map(it=>e(u,{children:it},it))}),e(Le,{children:e(pt,{colorScheme:"green",children:ls(x)})})]},x.key)})})]})})]})}),e(pr,{children:s(pe,{spacing:4,align:"stretch",children:[e(V,{leftIcon:e(gi,{}),...yi,onClick:tr,children:t("pages.xray.balancer.addBalancer")}),e(xi,{children:s(Si,{minW:"680px",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:"#"}),e(Xe,{children:t("pages.xray.balancer.tag")}),e(Xe,{children:t("pages.xray.balancer.balancerStrategy")}),e(Xe,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(as,{children:J.map((x,C)=>s(Lt,{children:[e(Le,{children:s(O,{children:[e(u,{children:C+1}),e(qe,{"aria-label":"edit",icon:e(bi,{}),size:"xs",variant:"ghost",onClick:()=>xr()}),e(qe,{"aria-label":"delete",icon:e(fi,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>es(C)})]})}),e(Le,{children:x.tag}),e(Le,{children:e(pt,{colorScheme:x.strategy==="random"?"purple":"green",children:x.strategy==="random"?"Random":x.strategy==="roundRobin"?"Round Robin":x.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Le,{children:x.selector.map(Y=>e(pt,{colorScheme:"blue",m:1,children:Y},Y))})]},x.key))})]})}),(((Js=U.getValues("config"))==null?void 0:Js.observatory)||((pn=U.getValues("config"))==null?void 0:pn.burstObservatory))&&s(pe,{spacing:3,align:"stretch",children:[e(Fi,{onChange:x=>{ot(x),xe(C=>C+1)},value:Be,children:s(O,{spacing:3,children:[((mn=U.getValues("config"))==null?void 0:mn.observatory)&&e(is,{value:"observatory",children:"Observatory"}),((gn=U.getValues("config"))==null?void 0:gn.burstObservatory)&&e(is,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(P,{h:"300px",children:e(ro,{json:ss,onChange:x=>Ct(x)},`obs-${Be}-${Ae}`)})]})]})}),e(pr,{children:s(pe,{spacing:4,align:"stretch",children:[s(_,{display:"flex",alignItems:"center",children:[e(D,{children:t("pages.xray.dns.enable")}),e(At,{name:"config.dns",control:U.control,render:({field:x})=>e(_t,{isChecked:!!x.value,onChange:C=>{const Y={...U.getValues("config")};C.target.checked?(Y.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"},A([]),L([])):(delete Y.dns,delete Y.fakedns,A([]),L([])),U.setValue("config",Y,{shouldDirty:!0}),x.onChange(Y.dns)}})})]}),U.watch("config.dns")&&s(Wt,{children:[e(V,{leftIcon:e(gi,{}),...yi,onClick:bs,children:t("pages.xray.dns.add")}),B.length>0&&e(xi,{children:s(Si,{minW:"720px",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:"#"}),e(Xe,{children:t("pages.xray.outbound.address")}),e(Xe,{children:t("pages.xray.dns.domains")}),e(Xe,{children:t("pages.xray.dns.expectIPs")})]})}),e(as,{children:B.map((x,C)=>{var Y;return s(Lt,{children:[e(Le,{children:s(O,{children:[e(u,{children:C+1}),e(qe,{"aria-label":"edit",icon:e(bi,{}),size:"xs",variant:"ghost",onClick:()=>os(C)}),e(qe,{"aria-label":"delete",icon:e(fi,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>xs(C)})]})}),e(Le,{children:typeof x=="object"?x.address:x}),e(Le,{children:typeof x=="object"?sl(x.domains):""}),e(Le,{children:typeof x=="object"?sl(x.expectIPs):""})]},(Y=x.address)!=null?Y:JSON.stringify(x))})})]})})]}),k.length>0&&s(Wt,{children:[e(V,{leftIcon:e(gi,{}),...yi,onClick:Ss,children:t("pages.xray.fakedns.add")}),e(xi,{children:s(Si,{minW:"520px",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:"#"}),e(Xe,{children:t("pages.xray.fakedns.ipPool")}),e(Xe,{children:t("pages.xray.fakedns.poolSize")})]})}),e(as,{children:k.map((x,C)=>{var Y;return s(Lt,{children:[e(Le,{children:s(O,{children:[e(u,{children:C+1}),e(qe,{"aria-label":"edit",icon:e(bi,{}),size:"xs",variant:"ghost",onClick:()=>vs()}),e(qe,{"aria-label":"delete",icon:e(fi,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ws(C)})]})}),e(Le,{children:x.ipPool}),e(Le,{children:x.poolSize})]},(Y=x.ipPool)!=null?Y:JSON.stringify(x))})})]})})]})]})}),e(pr,{children:s(pe,{spacing:4,align:"stretch",children:[s(P,{px:2,children:[e(u,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(P,{px:2,children:e(Fi,{onChange:x=>{Me(x),xe(C=>C+1)},value:ke,children:s(O,{spacing:3,wrap:"wrap",children:[e(is,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(is,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(is,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(is,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),s(P,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(qe,{position:Je?"fixed":"absolute",top:2,right:2,"aria-label":Je?"Exit Full Screen":"Full Screen",icon:Je?e(km,{}):e(wm,{}),onClick:_e,zIndex:Je?1101:10}),e(P,{w:Je?"100vw":"100%",h:Je?"100vh":"100%",position:Je?"fixed":"relative",top:Je?0:"auto",left:Je?0:"auto",zIndex:Je?1e3:"auto",children:e(ro,{json:Os,onChange:x=>{vt(x)}},`advanced-${ke}-${Ae}`)}),Je&&X&&e(V,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:_e,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(pr,{children:e(P,{children:e(Kc,{showTitle:!1})})})]})]}),e(am,{isOpen:b,onClose:ce,mode:E!==null?"edit":"create",initialOutbound:E!==null?ar[E]:null,onSubmitOutbound:As}),e(pm,{isOpen:w,mode:ne!==null?"edit":"create",initialRule:ne!==null&&j[ne]||null,availableInboundTags:He,availableOutboundTags:ht,availableBalancerTags:St,onSubmit:De,onClose:tt}),e(xm,{isOpen:q,onClose:Ir,initialOutbound:ks,onSave:Ts,onDelete:rs}),e(Xp,{isOpen:le,onClose:K,form:U,setBalancersData:N}),e(Qp,{isOpen:y,onClose:ys,form:U,setDnsServers:A,dnsIndex:ze,currentDnsData:ze!==null?B[ze]:null}),e(Zp,{isOpen:ve,onClose:F,form:U,setFakeDns:L})]})},Lm=()=>{const{t}=je();return e(pe,{spacing:6,align:"stretch",children:s(P,{children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(Dp,{})]})})},Rm=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Um=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],Om=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],qc=ni(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),Ee("/hosts").then(n=>t({hosts:n})).finally(()=>t({isLoading:!1}))},setHosts:n=>(t({isPostLoading:!0}),Ee("/hosts",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})}))})),En=({children:t,color:n})=>e(P,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${n}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${n}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${n}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${n}.400`}},children:e(u,{color:`${n}.500`,_dark:{color:`${n}.900`},position:"relative",zIndex:"2",children:t})}),Xi=ue(Vs,{baseStyle:{w:5,h:5}}),Wm=()=>{const[t,n]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:o,deleteUser:a}=Ot(),{t:i}=je(),l=cr(),c=()=>{o(null)},h=()=>{r&&(n(!0),a(r).then(()=>{l({title:i("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(n.bind(null,!1)))};return s(Gt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(En,{color:"red",children:e(Xi,{})})}),e(Qt,{mt:3}),s(It,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),r&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ea,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:r.username})})})]}),s(Bt,{display:"flex",children:[e(V,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(V,{size:"sm",w:"full",colorScheme:"red",onClick:h,leftIcon:t?e(zt,{size:"xs"}):void 0,children:i("delete")})]})]})]})},Fm=ue(cn,{baseStyle:{w:4,h:4}}),Jc=ue(en,{baseStyle:{w:4,h:4}}),Yc=ue(ql,{baseStyle:{w:4,h:4}}),Hm=ue(Ji,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Bm=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Kn=()=>{const{t}=je();return s(ei,{isLazy:!0,placement:"right",children:[e(ti,{children:e(P,{mt:"-1",children:e(Hm,{})})}),e(Wi,{children:s(ri,{maxW:"xs",fontSize:"xs",children:[e(qi,{}),e(po,{}),e(si,{children:s(P,{pr:5,lineHeight:"1.4",children:[e(u,{mb:2,children:t("hostsDialog.desc")}),Bm.map(({token:n,labelKey:r})=>s(u,{mt:1,children:[e(fr,{mr:2,children:n}),t(r)]},n))]})})]})})]})},Gc=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Is=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,Fs=t=>(t!=null?t:"").trim(),vi=(t,n=!1)=>typeof t=="boolean"?t:n,Vm=(t,n)=>{var r,o,a,i,l,c,h,p;return{id:(r=t.id)!=null?r:null,remark:(o=t.remark)!=null?o:"",address:(a=t.address)!=null?a:"",sort:(i=t.sort)!=null?i:n,port:(l=t.port)!=null?l:null,path:Fs(t.path),sni:Fs(t.sni),host:Fs(t.host),mux_enable:vi(t.mux_enable),allowinsecure:vi(t.allowinsecure),is_disabled:vi(t.is_disabled,!1),fragment_setting:Fs(t.fragment_setting),noise_setting:Fs(t.noise_setting),random_user_agent:vi(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(h=t.alpn)!=null?h:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:vi(t.use_sni_as_host)}},io=t=>{var n,r;return{id:(n=t.id)!=null?n:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},nl=t=>{var n,r;return{...t,id:(n=t.id)!=null?n:null,port:(r=t.port)!=null?r:null,path:Fs(t.path),sni:Fs(t.sni),host:Fs(t.host),fragment_setting:Fs(t.fragment_setting),noise_setting:Fs(t.noise_setting)}},Xc=t=>{const n=nl(t.data),r=nl(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(n)!==JSON.stringify(r)},Km=t=>{var n;return{id:(n=t.id)!=null?n:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},zi=t=>[...t].sort((n,r)=>{const o=Is(n.data.sort)-Is(r.data.sort);return o!==0?o:n.data.remark.localeCompare(r.data.remark)}),$m=t=>{const n=[];return Object.entries(t).forEach(([r,o])=>{o.forEach((a,i)=>{const l=Vm(a,i),c=l.id!=null?`host-${l.id}`:Gc();n.push({uid:c,inboundTag:r,initialInboundTag:r,data:io(l),original:io(l)})})}),zi(n)},Qc=t=>{const n=new Map;t.forEach(o=>{var i;const a=(i=n.get(o.inboundTag))!=null?i:[];a.push(o.data),n.set(o.inboundTag,a)});const r={};return n.forEach((o,a)=>{r[a]=o.map(i=>Km(i)).sort((i,l)=>Is(i.sort)-Is(l.sort))}),r},$a=(t,n)=>{const r=Qc(t),o=Array.from(new Set(n)),a={};return o.forEach(i=>{var l;a[i]=(l=r[i])!=null?l:[]}),a},qm=({host:t,inboundOptions:n,orderIndex:r,onToggleActive:o,onEdit:a,onDelete:i,saving:l,deleting:c})=>{const{t:h}=je(),p=n.find(b=>b.value===t.inboundTag),m=!t.data.is_disabled,g=Xc(t),v=t.data.remark||h("hostsPage.untitledHost");return e(jr,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>a(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:s(Zs,{as:we,spacing:4,children:[s(O,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(pe,{align:"flex-start",spacing:1,flex:"1",children:[e(kt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(u,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:v})}),s(O,{spacing:2,flexWrap:"wrap",children:[e(pt,{colorScheme:"gray",size:"sm",children:h("hostsPage.orderIndex",{value:r+1})}),p&&e(pt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(pt,{colorScheme:"blue",size:"sm",children:h("hostsPage.portTag",{value:t.data.port})}),g&&e(pt,{colorScheme:"orange",size:"sm",children:h("hostsPage.unsaved")})]})]}),s(O,{spacing:2,onClick:b=>b.stopPropagation(),onPointerDown:b=>b.stopPropagation(),children:[e(_t,{size:"sm",colorScheme:"primary",isChecked:m,onChange:b=>{b.stopPropagation(),o(t.uid,b.target.checked)},onClick:b=>b.stopPropagation(),onPointerDown:b=>b.stopPropagation(),"aria-label":h("hostsPage.toggleActive")}),e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:h(m?"hostsPage.enabled":"hostsPage.disabled")})]})]}),s(pe,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(u,{fontSize:"sm",children:t.data.address||h("hostsPage.noAddress")}),t.data.path&&s(u,{fontSize:"sm",noOfLines:1,children:[h("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&s(u,{fontSize:"sm",noOfLines:1,children:[h("hostsDialog.sni"),": ",t.data.sni]})]}),s(O,{justify:"space-between",children:[e(V,{size:"sm",variant:"outline",leftIcon:e(Fm,{}),onClick:b=>{b.stopPropagation(),a(t.uid)},isLoading:l,children:h("hostsPage.edit")}),e(qe,{"aria-label":h("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:b=>{b.stopPropagation(),i(t.uid)},icon:e(Xi,{}),isLoading:c})]})]})})},Jm=({host:t,index:n})=>{const{t:r}=je(),o=bu(),a=t.data.remark||r("hostsPage.untitledHost"),i=d.exports.useCallback(l=>{l.pointerType==="mouse"&&l.button!==0||(l.preventDefault(),o.start(l))},[o]);return e(cc.Item,{value:t,id:t.uid,dragListener:!1,dragControls:o,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:s(O,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(kt,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(qe,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(Yc,{}),cursor:"grab",onPointerDown:i,style:{touchAction:"none"}})}),e(pt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:n+1})}),s(pe,{align:"flex-start",spacing:0,flex:"1",children:[e(kt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(u,{fontWeight:"medium",noOfLines:1,maxW:"full",children:a})}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Ym=({host:t,inboundOptions:n,isOpen:r,onClose:o,onChange:a,onChangeInbound:i,onSave:l,onReset:c,onDelete:h,saving:p,deleting:m})=>{var S;const{t:g}=je();if(!t)return null;const v=n.find(f=>f.value===t.inboundTag),b=Xc(t);return s(Gt,{isOpen:r,onClose:o,size:"4xl",scrollBehavior:"inside",isCentered:!0,returnFocusOnClose:!1,children:[e(Dt,{}),s(Xt,{children:[e(Qt,{}),e(Tt,{pb:1,children:s(pe,{align:"stretch",spacing:1,children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),v&&e(pt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${v.value} (${v.protocol.toUpperCase()} - ${v.network})`})]})}),e(It,{children:s(pe,{align:"stretch",spacing:5,children:[s(jr,{variant:"outline",children:[e(Vn,{pb:2,children:e(u,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(Zs,{pt:0,children:s(pe,{align:"stretch",spacing:4,children:[s(_,{children:[e(D,{children:g("hostsDialog.remark")}),s(Ar,{children:[e(Ce,{value:t.data.remark,onChange:f=>a(t.uid,"remark",f.target.value)}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Kn,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:g("hostsPage.inboundLabel")}),e(at,{value:t.inboundTag,onChange:f=>i(t.uid,f.target.value),children:n.map(f=>e("option",{value:f.value,children:f.label},f.value))})]}),s(_,{children:[e(D,{children:g("hostsDialog.sort")}),e(Hs,{value:t.data.sort,allowMouseWheel:!0,onChange:(f,w)=>a(t.uid,"sort",Number.isNaN(w)?t.data.sort:w),children:e(Bs,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:g("hostsDialog.address")}),s(Ar,{children:[e(Ce,{value:t.data.address,onChange:f=>a(t.uid,"address",f.target.value)}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Kn,{})})]})]}),s(_,{children:[e(D,{children:g("hostsDialog.port")}),e(Hs,{value:(S=t.data.port)!=null?S:"",allowMouseWheel:!0,onChange:(f,w)=>a(t.uid,"port",Number.isNaN(w)?null:w),children:e(Bs,{})})]})]}),s(_,{children:[e(D,{children:g("hostsDialog.path")}),e(Ce,{value:t.data.path,onChange:f=>a(t.uid,"path",f.target.value),placeholder:"/"})]})]})})]}),s(jr,{variant:"outline",children:[e(Vn,{pb:2,children:e(u,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(Zs,{pt:0,children:s(pe,{align:"stretch",spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:g("hostsDialog.sni")}),e(Ce,{value:t.data.sni,onChange:f=>a(t.uid,"sni",f.target.value)})]}),s(_,{children:[e(D,{children:g("hostsDialog.host")}),s(Ar,{children:[e(Ce,{value:t.data.host,onChange:f=>a(t.uid,"host",f.target.value)}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Kn,{})})]})]})]}),s(Ve,{columns:{base:1,md:3},spacing:4,children:[s(_,{children:[e(D,{children:g("hostsDialog.security")}),e(at,{value:t.data.security,onChange:f=>a(t.uid,"security",f.target.value),children:Rm.map(f=>e("option",{value:f.value,children:f.title},f.value))})]}),s(_,{children:[e(D,{children:g("hostsDialog.alpn")}),e(at,{value:t.data.alpn,onChange:f=>a(t.uid,"alpn",f.target.value),children:Um.map(f=>e("option",{value:f.value,children:f.title},f.value))})]}),s(_,{children:[e(D,{children:g("hostsDialog.fingerprint")}),e(at,{value:t.data.fingerprint,onChange:f=>a(t.uid,"fingerprint",f.target.value),children:Om.map(f=>e("option",{value:f.value,children:f.title},f.value))})]})]})]})})]}),s(jr,{variant:"outline",children:[e(Vn,{pb:2,children:e(u,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(Zs,{pt:0,children:s(pe,{align:"stretch",spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:g("hostsDialog.fragment")}),e(Ce,{value:t.data.fragment_setting,onChange:f=>a(t.uid,"fragment_setting",f.target.value)})]}),s(_,{children:[e(D,{children:g("hostsDialog.noise")}),e(Ce,{value:t.data.noise_setting,onChange:f=>a(t.uid,"noise_setting",f.target.value)})]})]}),s(we,{direction:{base:"column",md:"row"},spacing:4,children:[e(Yr,{isChecked:t.data.allowinsecure,onChange:f=>a(t.uid,"allowinsecure",f.target.checked),children:g("hostsDialog.allowinsecure")}),e(Yr,{isChecked:t.data.mux_enable,onChange:f=>a(t.uid,"mux_enable",f.target.checked),children:g("hostsDialog.muxEnable")}),e(Yr,{isChecked:t.data.random_user_agent,onChange:f=>a(t.uid,"random_user_agent",f.target.checked),children:g("hostsDialog.randomUserAgent")}),e(Yr,{isChecked:t.data.use_sni_as_host,onChange:f=>a(t.uid,"use_sni_as_host",f.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),s(Bt,{justifyContent:"space-between",children:[e(V,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(Xi,{}),onClick:()=>h(t.uid),isLoading:m,children:g("hostsPage.delete")}),s(O,{spacing:3,children:[e(V,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!b||p,children:g("hostsPage.reset")}),e(V,{size:"sm",colorScheme:"primary",onClick:()=>l(t.uid),isDisabled:!b,isLoading:p,children:g("hostsPage.save")})]})]})]})]})},Gm=({isOpen:t,onClose:n,inboundOptions:r,onSubmit:o,isSubmitting:a,defaultSort:i})=>{var g,v,b,S;const{t:l}=je(),c=d.exports.useRef(null),[h,p]=d.exports.useState({inboundTag:(v=(g=r[0])==null?void 0:g.value)!=null?v:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var f,w;t&&(p({inboundTag:(w=(f=r[0])==null?void 0:f.value)!=null?w:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var W;return(W=c.current)==null?void 0:W.focus()},150))},[i,r,t]);const m=()=>{!h.inboundTag||!h.remark.trim()||!h.address.trim()||o(h)};return s(Gt,{isOpen:t,onClose:n,size:"lg",initialFocusRef:c,returnFocusOnClose:!1,children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(Xt,{children:[e(Tt,{children:s(O,{spacing:3,children:[e(Jc,{}),e(u,{fontWeight:"semibold",children:l("hostsPage.create.title")})]})}),e(Qt,{mt:2}),s(It,{as:pe,align:"stretch",spacing:4,pt:2,children:[e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:l("hostsPage.create.description")}),s(_,{children:[e(D,{children:l("hostsPage.inboundLabel")}),e(at,{value:h.inboundTag,onChange:f=>p(w=>({...w,inboundTag:f.target.value})),children:r.map(f=>e("option",{value:f.value,children:f.label},f.value))})]}),s(_,{isRequired:!0,children:[e(D,{children:l("hostsDialog.remark")}),s(Ar,{children:[e(Ce,{ref:c,value:h.remark,onChange:f=>p(w=>({...w,remark:f.target.value}))}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Kn,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{isRequired:!0,children:[e(D,{children:l("hostsDialog.address")}),s(Ar,{children:[e(Ce,{value:h.address,onChange:f=>p(w=>({...w,address:f.target.value}))}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Kn,{})})]})]}),s(_,{children:[e(D,{children:l("hostsDialog.port")}),e(Hs,{value:(b=h.port)!=null?b:"",onChange:(f,w)=>p(W=>({...W,port:Number.isNaN(w)?null:w})),children:e(Bs,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:l("hostsDialog.path")}),e(Ce,{value:h.path,onChange:f=>p(w=>({...w,path:f.target.value}))})]}),s(_,{children:[e(D,{children:l("hostsDialog.sni")}),e(Ce,{value:h.sni,onChange:f=>p(w=>({...w,sni:f.target.value}))})]})]}),s(_,{children:[e(D,{children:l("hostsDialog.host")}),s(Ar,{children:[e(Ce,{value:h.host,onChange:f=>p(w=>({...w,host:f.target.value}))}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Kn,{})})]})]}),s(_,{children:[e(D,{children:l("hostsDialog.sort")}),e(Hs,{value:Number.isFinite(h.sort)?h.sort:"",onChange:(f,w)=>p(W=>({...W,sort:Number.isNaN(w)?W.sort:w})),children:e(Bs,{})})]}),e(P,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:l("hostsPage.create.sortHint",{value:(S=h.sort)!=null?S:i})})]}),s(Bt,{gap:2,children:[e(V,{variant:"ghost",onClick:n,children:l("hostsPage.cancel")}),e(V,{colorScheme:"primary",onClick:m,isLoading:a,children:l("hostsPage.create.submit")})]})]})]})},Xm=()=>{var Vt;const{t}=je(),n=cr(),{hosts:r,fetchHosts:o,isLoading:a,isPostLoading:i,setHosts:l}=qc(),{inbounds:c}=Ot(),[h,p]=d.exports.useState([]),m=d.exports.useRef([]),g=d.exports.useCallback(ge=>{typeof ge=="function"?p(Te=>{const Re=ge(Te);return m.current=Re,Re}):(m.current=ge,p(ge))},[]),[v,b]=d.exports.useState(null),[S,f]=d.exports.useState(!1),[w,W]=d.exports.useState(""),[z,le]=d.exports.useState(!1),[R,K]=d.exports.useState(null),[y,ae]=d.exports.useState(null),[Se,ve]=d.exports.useState(null),T=d.exports.useRef(null),[F,q]=d.exports.useState(!1),$=d.exports.useRef(!1),[Q,U]=d.exports.useState(!1),[Z,se]=d.exports.useState(!1),[M,be]=d.exports.useState(null);d.exports.useEffect(()=>{o()},[o]),d.exports.useEffect(()=>{c.size||Bi()},[c]),d.exports.useEffect(()=>{const ge=$m(r);g(ge)},[r,g]),d.exports.useEffect(()=>{v&&!m.current.some(ge=>ge.uid===v)&&b(null)},[v]);const ee=d.exports.useCallback(ge=>{$.current=ge,q(ge)},[]);d.exports.useEffect(()=>{Z||(be(null),ee(!1))},[Z,ee]),d.exports.useEffect(()=>{if(!Z||!M)return;const ge=new Set(m.current.map(Re=>Re.uid));M.every(Re=>ge.has(Re.uid))||(be(null),ee(!1))},[Z,ee,M]);const Ie=d.exports.useMemo(()=>{const ge=[];return c.forEach(Te=>{Te.forEach(Re=>{ge.push({label:`${Re.tag} (${Re.protocol.toUpperCase()} - ${Re.network})`,value:Re.tag,protocol:Re.protocol,network:Re.network})})}),ge.sort((Te,Re)=>Te.label.localeCompare(Re.label))},[c]),me=d.exports.useMemo(()=>m.current.filter(ge=>!ge.data.is_disabled).sort((ge,Te)=>Is(ge.data.sort)-Is(Te.data.sort)),[]),J=d.exports.useMemo(()=>[...m.current].sort((ge,Te)=>Is(ge.data.sort)-Is(Te.data.sort)),[]),N=d.exports.useMemo(()=>S?J:me,[me,J,S]),B=w.trim().toLowerCase(),A=d.exports.useMemo(()=>B?N.filter(ge=>[ge.data.remark,ge.data.address,ge.data.host,ge.data.path,ge.data.sni,ge.inboundTag,ge.data.port!=null?String(ge.data.port):""].some(Re=>Re==null?void 0:Re.toLowerCase().includes(B))):N,[N,B]);d.exports.useEffect(()=>{Z&&be(ge=>ge!=null?ge:[...me])},[me,Z]);const k=Z?M!=null?M:me:A,L=m.current.length>0,te=a&&!L,Oe=a&&L,ne=B.length>0,I=!Z&&!te&&ne&&N.length>0&&A.length===0,E=d.exports.useMemo(()=>{const ge=new Map;return k.forEach((Te,Re)=>{ge.set(Te.uid,Re)}),ge},[k]),G=v&&(Vt=m.current.find(ge=>ge.uid===v))!=null?Vt:null,ze=(ge,Te,Re)=>{g(ut=>zi(ut.map(lt=>lt.uid===ge?{...lt,data:{...lt.data,[Te]:Re}}:lt)))},Ne=(ge,Te)=>{g(Re=>zi(Re.map(ut=>ut.uid===ge?{...ut,inboundTag:Te}:ut)))},Je=d.exports.useCallback(async()=>{if(!Z||Q)return!1;const ge=me,Te=M!=null?M:ge;if(!(Te.length!==ge.length||Te.some((Qe,Pt)=>{var Rt;return Qe.uid!==((Rt=ge[Pt])==null?void 0:Rt.uid)}))||!M||Te.length===0)return se(!1),be(null),ee(!1),!0;const ut=Te.map(Qe=>Qe.uid),lt=new Map;ut.forEach((Qe,Pt)=>{lt.set(Qe,Pt)});const Mt=m.current,er=m.current.filter(Qe=>lt.has(Qe.uid)).sort((Qe,Pt)=>{var Rt,Ft;return((Rt=lt.get(Qe.uid))!=null?Rt:Number.MAX_SAFE_INTEGER)-((Ft=lt.get(Pt.uid))!=null?Ft:Number.MAX_SAFE_INTEGER)}),ie=m.current.filter(Qe=>!lt.has(Qe.uid)).sort((Qe,Pt)=>Is(Qe.data.sort)-Is(Pt.data.sort)),st=[...er,...ie].map((Qe,Pt)=>({...Qe,data:{...Qe.data,sort:Pt},original:{...Qe.original,sort:Pt}}));g(st),be(st.filter(Qe=>!Qe.data.is_disabled)),U(!0);try{const Qe=Qc(st);return await l(Qe),await o(),ee(!1),se(!1),be(null),n({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(Mt);const Pt=Mt.filter(Rt=>!Rt.data.is_disabled).sort((Rt,Ft)=>Is(Rt.data.sort)-Is(Ft.data.sort));return be(Pt),ee(!0),n({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{U(!1)}},[g,me,o,Z,Q,l,ee,t,n,M]),H=d.exports.useCallback(ge=>{if(!Z||!ge.length)return;const Te=M!=null?M:me;!(ge.length!==Te.length||ge.some((ut,lt)=>{var Mt;return ut.uid!==((Mt=Te[lt])==null?void 0:Mt.uid)}))||(be(ge),$.current||ee(!0))},[me,Z,ee,M]),ke=d.exports.useCallback(()=>{be([...me]),ee(!1),se(!0)},[me,ee]),Me=d.exports.useCallback(()=>{se(!1),be(null),ee(!1)},[ee]),Be=d.exports.useCallback(()=>{Je()},[Je]),ot=async ge=>{const Te=m.current.find(Re=>Re.uid===ge);if(!!Te){K(ge);try{const Re=$a(m.current,[Te.inboundTag,Te.initialInboundTag]);await l(Re),await o(),n({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"}),b(null)}catch{n({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{K(null)}}},X=ge=>{g(Te=>zi(Te.map(Re=>Re.uid===ge?{...Re,inboundTag:Re.initialInboundTag,data:io(Re.original)}:Re)))},Ae=(ge,Te)=>{ze(ge,"is_disabled",!Te),Te||f(!0)},xe=ge=>{ve(ge)},$e=async()=>{if(!Se)return;const ge=m.current.find(Te=>Te.uid===Se);if(!!ge){ae(Se);try{const Te=m.current.filter(ut=>ut.uid!==Se);g(Te);const Re=$a(Te,[ge.inboundTag,ge.initialInboundTag]);await l(Re),await o(),n({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),v===Se&&b(null)}catch{n({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{ae(null),ve(null)}}},Ze=async ge=>{const Te=m.current.length?Math.max(...m.current.map(Re=>Re.data.sort))+1:0;K("create");try{const Re={uid:Gc(),inboundTag:ge.inboundTag,initialInboundTag:ge.inboundTag,data:{id:null,remark:ge.remark,address:ge.address,sort:Number.isFinite(ge.sort)?ge.sort:Te,port:ge.port,path:ge.path,sni:ge.sni,host:ge.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:ge.remark,address:ge.address,sort:Number.isFinite(ge.sort)?ge.sort:Te,port:ge.port,path:ge.path,sni:ge.sni,host:ge.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},ut=zi([...m.current,Re]);g(ut);const lt=$a(ut,[ge.inboundTag]);await l(lt),await o(),n({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),le(!1)}catch{n({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{K(null)}};return s(pe,{align:"stretch",spacing:4,children:[Z?s(pe,{align:"stretch",spacing:2,children:[s(O,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(u,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),s(O,{spacing:2,children:[e(V,{variant:"ghost",onClick:Me,isDisabled:Q,children:t("hostsPage.cancel")}),e(V,{colorScheme:"primary",onClick:Be,isLoading:Q,isDisabled:!F&&!Q,children:t("hostsPage.saveOrder")})]})]}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),Q?s(O,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(zt,{size:"xs"}),e(u,{children:t("hostsPage.orderSaving")})]}):F?e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):s(we,{direction:{base:"column",md:"row"},spacing:3,align:{base:"stretch",md:"center"},justify:"space-between",children:[s(O,{spacing:3,flexWrap:"wrap",children:[e(V,{colorScheme:"primary",size:"sm",onClick:()=>le(!0),leftIcon:e(Jc,{}),isDisabled:!Ie.length,children:t("hostsPage.addHost")}),e(_t,{isChecked:S,onChange:ge=>f(ge.target.checked),children:t("hostsPage.showDisabled")})]}),s(we,{direction:{base:"column",sm:"row"},spacing:2,align:{base:"stretch",sm:"center"},justify:"flex-end",w:"full",children:[e(Ce,{value:w,onChange:ge=>W(ge.target.value),placeholder:t("hostsPage.searchPlaceholder"),size:"sm",w:"100%"}),s(O,{spacing:2,justify:"flex-end",children:[Oe&&e(zt,{size:"sm"}),e(V,{size:"sm",variant:"outline",leftIcon:e(Yc,{}),onClick:ke,isDisabled:te||!me.length,children:t("hostsPage.enterSort")})]})]})]}),te?e(O,{justify:"center",py:10,children:e(zt,{})}):k.length===0?e(P,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(u,{children:t(I?"hostsPage.searchEmpty":"hostsPage.emptyState")})}):Z?e(cc.Group,{axis:"y",values:k,onReorder:H,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:k.map((ge,Te)=>e(Jm,{host:ge,index:Te},ge.uid))}):e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:k.map((ge,Te)=>{var Re;return e(qm,{host:ge,inboundOptions:Ie,orderIndex:(Re=E.get(ge.uid))!=null?Re:Te,onToggleActive:Ae,onEdit:b,onDelete:xe,saving:R===ge.uid&&i,deleting:y===ge.uid&&i},ge.uid)})}),e(Gm,{isOpen:z,onClose:()=>le(!1),inboundOptions:Ie,onSubmit:Ze,isSubmitting:R==="create"&&i,defaultSort:m.current.length?Math.max(...m.current.map(ge=>ge.data.sort))+1:0}),e(Ym,{host:G,inboundOptions:Ie,isOpen:Boolean(G),onClose:()=>b(null),onChange:ze,onChangeInbound:Ne,onSave:ot,onReset:X,onDelete:xe,saving:!!G&&R===G.uid&&i,deleting:!!G&&y===G.uid&&i}),e(Yn,{isOpen:Boolean(Se),leastDestructiveRef:T,onClose:()=>ve(null),children:e(Dt,{children:s(Gn,{children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(It,{children:t("hostsPage.deleteConfirmation")}),s(Bt,{children:[e(V,{ref:T,onClick:()=>ve(null),children:t("hostsPage.cancel")}),e(V,{colorScheme:"red",onClick:$e,ml:3,isLoading:Boolean(y),children:t("hostsPage.delete")})]})]})})})]})},Qm=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(rm);const Zm=Object.values(tm),bo=["vmess","vless","trojan","shadowsocks","http","socks"],jm=["tcp","ws","grpc","kcp","quic","http","httpupgrade","splithttp","xhttp"],eg=["none","tls","reality"],wi=t=>t.split(/[\n,]/).map(n=>n.trim()).filter(Boolean),ia=t=>t!=null&&t.length?t.join(`
`):"",Rn=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",Zc=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),tg=t=>{if(!t)return 0;const n=Number(t);return!Number.isNaN(n)&&n>0?n:t.trim()},Cr=t=>(Object.keys(t).forEach(n=>{const r=t[n];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[n]}),t),il=()=>({user:"",pass:""}),Hn=()=>({name:"",value:""}),al=t=>{var n,r;return{user:(n=t==null?void 0:t.user)!=null?n:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},ol=t=>{var n,r;return Cr({user:(n=t.user)==null?void 0:n.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Gs=t=>{if(t===""||t===null||typeof t>"u")return;const n=Number(t);return Number.isFinite(n)?n:void 0},rg=t=>{if(!t.sockoptEnabled)return;const n=t.sockopt,r={acceptProxyProtocol:n.acceptProxyProtocol,tcpFastOpen:n.tcpFastOpen,mark:Gs(n.mark),tproxy:n.tproxy||void 0,tcpMptcp:n.tcpMptcp,penetrate:n.penetrate,domainStrategy:n.domainStrategy||void 0,tcpMaxSeg:Gs(n.tcpMaxSeg),dialerProxy:n.dialerProxy||void 0,tcpKeepAliveInterval:Gs(n.tcpKeepAliveInterval),tcpKeepAliveIdle:Gs(n.tcpKeepAliveIdle),tcpUserTimeout:Gs(n.tcpUserTimeout),tcpcongestion:n.tcpcongestion||void 0,V6Only:n.V6Only,tcpWindowClamp:Gs(n.tcpWindowClamp),interface:n.interfaceName||void 0};return Cr(r)},ao=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,tcpAcceptProxyProtocol:!1,wsAcceptProxyProtocol:!1,httpupgradeAcceptProxyProtocol:!1,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",tlsRawSettings:{},realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",wsHeaders:[Hn()],tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpPath:"/",httpHost:"",httpupgradePath:"/",httpupgradeHost:"",httpupgradeHeaders:[Hn()],splithttpPath:"/",splithttpHost:"",splithttpScMaxConcurrentPosts:"100-200",splithttpScMaxEachPostBytes:"1000000-2000000",splithttpScMinPostsIntervalMs:"10-50",splithttpNoSSEHeader:!1,splithttpXPaddingBytes:"100-1000",splithttpXmuxMaxConcurrency:"16-32",splithttpXmuxMaxConnections:"0",splithttpXmuxCMaxReuseTimes:"64-128",splithttpXmuxCMaxLifetimeMs:"0",splithttpMode:"auto",splithttpNoGRPCHeader:!1,splithttpHeaders:[Hn()],xhttpHost:"",xhttpPath:"/",xhttpHeaders:[Hn()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScMinPostsIntervalMs:"30",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,xhttpNoGRPCHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:Zc(),httpAccounts:[il()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[il()],socksUdpEnabled:!1,socksUdpIp:""}),sg=t=>{var n,r,o,a,i,l,c;return{dest:(r=(n=t==null?void 0:t.dest)==null?void 0:n.toString())!=null?r:"",path:(o=t==null?void 0:t.path)!=null?o:"",type:(a=t==null?void 0:t.type)!=null?a:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(i=t==null?void 0:t.alpn)!=null?i:"",xver:(c=(l=t==null?void 0:t.xver)==null?void 0:l.toString())!=null?c:""}},ll=t=>{var r,o,a;const n={dest:(r=t.dest)==null?void 0:r.trim(),path:(o=t.path)==null?void 0:o.trim(),type:(a=t.type)==null?void 0:a.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(n.alpn=t.alpn.split(",").map(i=>i.trim()).filter(Boolean)),Cr(n)},ng=t=>{var p,m,g,v,b,S,f,w,W,z,le,R,K,y,ae,Se,ve,T,F,q,$,Q,U,Z,se,M,be,ee,Ie,me,J,N,B,A,k,L,te,Oe,ne,I,E,G,ze,Ne,Je,H,ke,Me,Be,ot,X,Ae,xe,$e,Ze,Vt,ge,Te,Re,ut,lt,Mt,er,ie,st,Qe,Pt,Rt,Ft,We,ce,Pe,fe,dt,yt,Kt,$t,Ut,ft,et,he,De,tt,tr,xr,es,bs,os,ys,xs,Ss,vs,ws,Gr,ls,ar,j,He,ht,St,Ht,Sr,Kr,ks,Lr,Rr,dr,Ur,cs,_s,$r,ts,Cs,zs,Ts,rs,As,Ir,_e,Ds,vt,or,Ct,mr,qt,jt,wr,ss,Os,qs,Js,pn,mn,gn,x,C;const n=bo.includes(t.protocol)?t.protocol:"vless",r=ao(n),o=(p=t.settings)!=null?p:{},a=(m=t.sniffing)!=null?m:{},i=(g=t.streamSettings)!=null?g:{},l=(v=i.tlsSettings)!=null?v:{},c=i.tlsSettings!==void 0&&i.tlsSettings!==null?JSON.parse(JSON.stringify(i.tlsSettings)):{},h=(b=i.realitySettings)!=null?b:{};return{...r,tag:(S=t.tag)!=null?S:"",listen:(f=t.listen)!=null?f:"",port:(W=(w=t.port)==null?void 0:w.toString())!=null?W:"",disableInsecureEncryption:Boolean((z=o.disableInsecureEncryption)!=null?z:r.disableInsecureEncryption),vlessDecryption:(le=o.decryption)!=null?le:r.vlessDecryption,vlessEncryption:(R=o.encryption)!=null?R:r.vlessEncryption,fallbacks:Array.isArray(o.fallbacks)?o.fallbacks.map(Y=>sg(Y)):r.fallbacks,shadowsocksNetwork:(K=o.network)!=null?K:r.shadowsocksNetwork,sniffingEnabled:Boolean((y=a.enabled)!=null?y:r.sniffingEnabled),sniffingDestinations:Array.isArray(a.destOverride)&&a.destOverride.length?a.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((ae=a.routeOnly)!=null?ae:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((Se=a.metadataOnly)!=null?Se:r.sniffingMetadataOnly),streamNetwork:(ve=i.network)!=null?ve:r.streamNetwork,streamSecurity:(T=i.security)!=null?T:r.streamSecurity,tcpAcceptProxyProtocol:Boolean((q=(F=i==null?void 0:i.tcpSettings)==null?void 0:F.acceptProxyProtocol)!=null?q:r.tcpAcceptProxyProtocol),wsAcceptProxyProtocol:Boolean((Q=($=i==null?void 0:i.wsSettings)==null?void 0:$.acceptProxyProtocol)!=null?Q:r.wsAcceptProxyProtocol),tlsServerName:(U=l.serverName)!=null?U:r.tlsServerName,tlsAlpn:Array.isArray(l.alpn)?l.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((Z=l.allowInsecure)!=null?Z:r.tlsAllowInsecure),tlsFingerprint:(se=l.fingerprint)!=null?se:r.tlsFingerprint,tlsRawSettings:c,realityPrivateKey:(M=h.privateKey)!=null?M:r.realityPrivateKey,realityServerNames:ia(h.serverNames),realityShortIds:ia(h.shortIds),realityDest:(be=h.dest)!=null?be:r.realityDest,realitySpiderX:(ee=h.spiderX)!=null?ee:r.realitySpiderX,realityXver:(me=(Ie=h.xver)==null?void 0:Ie.toString())!=null?me:r.realityXver,wsPath:(N=(J=i==null?void 0:i.wsSettings)==null?void 0:J.path)!=null?N:r.wsPath,wsHost:((A=(B=i==null?void 0:i.wsSettings)==null?void 0:B.headers)==null?void 0:A.Host)!==void 0?Array.isArray(i.wsSettings.headers.Host)?i.wsSettings.headers.Host.join(","):String(i.wsSettings.headers.Host):r.wsHost,wsHeaders:(k=i==null?void 0:i.wsSettings)!=null&&k.headers?aa(i.wsSettings.headers):r.wsHeaders,tcpHeaderType:(Oe=(te=(L=i==null?void 0:i.tcpSettings)==null?void 0:L.header)==null?void 0:te.type)!=null?Oe:r.tcpHeaderType,tcpHttpHosts:ia((G=(E=(I=(ne=i==null?void 0:i.tcpSettings)==null?void 0:ne.header)==null?void 0:I.request)==null?void 0:E.headers)==null?void 0:G.Host),tcpHttpPath:Array.isArray((Je=(Ne=(ze=i==null?void 0:i.tcpSettings)==null?void 0:ze.header)==null?void 0:Ne.request)==null?void 0:Je.path)?i.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(ke=(H=i==null?void 0:i.grpcSettings)==null?void 0:H.serviceName)!=null?ke:r.grpcServiceName,grpcAuthority:(Be=(Me=i==null?void 0:i.grpcSettings)==null?void 0:Me.authority)!=null?Be:r.grpcAuthority,grpcMultiMode:Boolean((X=(ot=i==null?void 0:i.grpcSettings)==null?void 0:ot.multiMode)!=null?X:r.grpcMultiMode),kcpHeaderType:($e=(xe=(Ae=i==null?void 0:i.kcpSettings)==null?void 0:Ae.header)==null?void 0:xe.type)!=null?$e:r.kcpHeaderType,kcpSeed:(Vt=(Ze=i==null?void 0:i.kcpSettings)==null?void 0:Ze.seed)!=null?Vt:r.kcpSeed,quicSecurity:(Te=(ge=i==null?void 0:i.quicSettings)==null?void 0:ge.security)!=null?Te:r.quicSecurity,quicKey:(ut=(Re=i==null?void 0:i.quicSettings)==null?void 0:Re.key)!=null?ut:r.quicKey,quicHeaderType:(er=(Mt=(lt=i==null?void 0:i.quicSettings)==null?void 0:lt.header)==null?void 0:Mt.type)!=null?er:r.quicHeaderType,httpPath:(st=(ie=i==null?void 0:i.httpSettings)==null?void 0:ie.path)!=null?st:r.httpPath,httpHost:ia((Qe=i==null?void 0:i.httpSettings)==null?void 0:Qe.host),httpupgradePath:(Rt=(Pt=i==null?void 0:i.httpupgradeSettings)==null?void 0:Pt.path)!=null?Rt:r.httpupgradePath,httpupgradeHost:(We=(Ft=i==null?void 0:i.httpupgradeSettings)==null?void 0:Ft.host)!=null?We:r.httpupgradeHost,httpupgradeHeaders:(ce=i==null?void 0:i.httpupgradeSettings)!=null&&ce.headers?aa(i.httpupgradeSettings.headers):r.httpupgradeHeaders,splithttpPath:(fe=(Pe=i==null?void 0:i.splithttpSettings)==null?void 0:Pe.path)!=null?fe:r.splithttpPath,splithttpHost:(yt=(dt=i==null?void 0:i.splithttpSettings)==null?void 0:dt.host)!=null?yt:r.splithttpHost,splithttpScMaxConcurrentPosts:(Ut=($t=(Kt=i==null?void 0:i.splithttpSettings)==null?void 0:Kt.scMaxConcurrentPosts)==null?void 0:$t.toString())!=null?Ut:r.splithttpScMaxConcurrentPosts,splithttpScMaxEachPostBytes:(he=(et=(ft=i==null?void 0:i.splithttpSettings)==null?void 0:ft.scMaxEachPostBytes)==null?void 0:et.toString())!=null?he:r.splithttpScMaxEachPostBytes,splithttpScMinPostsIntervalMs:(tr=(tt=(De=i==null?void 0:i.splithttpSettings)==null?void 0:De.scMinPostsIntervalMs)==null?void 0:tt.toString())!=null?tr:r.splithttpScMinPostsIntervalMs,splithttpNoSSEHeader:Boolean((es=(xr=i==null?void 0:i.splithttpSettings)==null?void 0:xr.noSSEHeader)!=null?es:r.splithttpNoSSEHeader),splithttpXPaddingBytes:(ys=(os=(bs=i==null?void 0:i.splithttpSettings)==null?void 0:bs.xPaddingBytes)==null?void 0:os.toString())!=null?ys:r.splithttpXPaddingBytes,splithttpXmuxMaxConcurrency:(ws=(vs=(Ss=(xs=i==null?void 0:i.splithttpSettings)==null?void 0:xs.xmux)==null?void 0:Ss.maxConcurrency)==null?void 0:vs.toString())!=null?ws:r.splithttpXmuxMaxConcurrency,splithttpXmuxMaxConnections:(j=(ar=(ls=(Gr=i==null?void 0:i.splithttpSettings)==null?void 0:Gr.xmux)==null?void 0:ls.maxConnections)==null?void 0:ar.toString())!=null?j:r.splithttpXmuxMaxConnections,splithttpXmuxCMaxReuseTimes:(Ht=(St=(ht=(He=i==null?void 0:i.splithttpSettings)==null?void 0:He.xmux)==null?void 0:ht.cMaxReuseTimes)==null?void 0:St.toString())!=null?Ht:r.splithttpXmuxCMaxReuseTimes,splithttpXmuxCMaxLifetimeMs:(Lr=(ks=(Kr=(Sr=i==null?void 0:i.splithttpSettings)==null?void 0:Sr.xmux)==null?void 0:Kr.cMaxLifetimeMs)==null?void 0:ks.toString())!=null?Lr:r.splithttpXmuxCMaxLifetimeMs,splithttpMode:(dr=(Rr=i==null?void 0:i.splithttpSettings)==null?void 0:Rr.mode)!=null?dr:r.splithttpMode,splithttpNoGRPCHeader:Boolean((cs=(Ur=i==null?void 0:i.splithttpSettings)==null?void 0:Ur.noGRPCHeader)!=null?cs:r.splithttpNoGRPCHeader),splithttpHeaders:(_s=i==null?void 0:i.splithttpSettings)!=null&&_s.headers?aa(i.splithttpSettings.headers):r.splithttpHeaders,xhttpHost:(ts=($r=i==null?void 0:i.xhttpSettings)==null?void 0:$r.host)!=null?ts:r.xhttpHost,xhttpPath:(zs=(Cs=i==null?void 0:i.xhttpSettings)==null?void 0:Cs.path)!=null?zs:r.xhttpPath,xhttpHeaders:(Ts=i==null?void 0:i.xhttpSettings)!=null&&Ts.headers?aa(i.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(As=(rs=i==null?void 0:i.xhttpSettings)==null?void 0:rs.mode)!=null?As:r.xhttpMode,xhttpScMaxBufferedPosts:(Ds=(_e=(Ir=i==null?void 0:i.xhttpSettings)==null?void 0:Ir.scMaxBufferedPosts)==null?void 0:_e.toString())!=null?Ds:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Ct=(or=(vt=i==null?void 0:i.xhttpSettings)==null?void 0:vt.scMaxEachPostBytes)==null?void 0:or.toString())!=null?Ct:r.xhttpScMaxEachPostBytes,xhttpScMinPostsIntervalMs:(jt=(qt=(mr=i==null?void 0:i.xhttpSettings)==null?void 0:mr.scMinPostsIntervalMs)==null?void 0:qt.toString())!=null?jt:r.xhttpScMinPostsIntervalMs,xhttpScStreamUpServerSecs:(Os=(ss=(wr=i==null?void 0:i.xhttpSettings)==null?void 0:wr.scStreamUpServerSecs)==null?void 0:ss.toString())!=null?Os:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(Js=(qs=i==null?void 0:i.xhttpSettings)==null?void 0:qs.xPaddingBytes)!=null?Js:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((mn=(pn=i==null?void 0:i.xhttpSettings)==null?void 0:pn.noSSEHeader)!=null?mn:r.xhttpNoSSEHeader),xhttpNoGRPCHeader:Boolean((x=(gn=i==null?void 0:i.xhttpSettings)==null?void 0:gn.noGRPCHeader)!=null?x:r.xhttpNoGRPCHeader),vlessSelectedAuth:(C=o.selectedAuth)!=null?C:r.vlessSelectedAuth,sockoptEnabled:Boolean(i==null?void 0:i.sockopt),sockopt:(()=>{var mt,it,Nt,Or,Ws,Ms;const Y=Zc(),Ge=(mt=i==null?void 0:i.sockopt)!=null?mt:{};return Y.acceptProxyProtocol=Boolean(Ge.acceptProxyProtocol),Y.tcpFastOpen=Boolean(Ge.tcpFastOpen),Y.mark=Rn(Ge.mark),Y.tproxy=(it=Ge.tproxy)!=null?it:Y.tproxy,Y.tcpMptcp=Boolean(Ge.tcpMptcp),Y.penetrate=Boolean(Ge.penetrate),Y.domainStrategy=(Nt=Ge.domainStrategy)!=null?Nt:Y.domainStrategy,Y.tcpMaxSeg=Rn(Ge.tcpMaxSeg),Y.dialerProxy=(Or=Ge.dialerProxy)!=null?Or:Y.dialerProxy,Y.tcpKeepAliveInterval=Rn(Ge.tcpKeepAliveInterval),Y.tcpKeepAliveIdle=Rn(Ge.tcpKeepAliveIdle),Y.tcpUserTimeout=Rn(Ge.tcpUserTimeout),Y.tcpcongestion=(Ws=Ge.tcpcongestion)!=null?Ws:Y.tcpcongestion,Y.V6Only=Boolean(Ge.V6Only),Y.tcpWindowClamp=Rn(Ge.tcpWindowClamp),Y.interfaceName=(Ms=Ge.interface)!=null?Ms:Y.interfaceName,Y})(),httpAccounts:n==="http"&&Array.isArray(o.accounts)?o.accounts.map(Y=>al(Y)):r.httpAccounts,httpAllowTransparent:n==="http"&&typeof o.allowTransparent=="boolean"?o.allowTransparent:r.httpAllowTransparent,socksAuth:n==="socks"&&o.auth==="password"?"password":r.socksAuth,socksAccounts:n==="socks"&&Array.isArray(o.accounts)?o.accounts.map(Y=>al(Y)):r.socksAccounts,socksUdpEnabled:n==="socks"&&typeof o.udp=="boolean"?o.udp:r.socksUdpEnabled,socksUdpIp:n==="socks"&&o.ip!==void 0&&o.ip!==null?String(o.ip):r.socksUdpIp}},ig=t=>{const n={};return t.forEach(({name:r,value:o})=>{const a=r==null?void 0:r.trim(),i=o==null?void 0:o.trim();if(!a||!i)return;const l=i.split(",").map(c=>c.trim()).filter(Boolean);n[a]=l.length>1?l:i}),Object.keys(n).length?n:void 0},aa=t=>{if(!t)return[Hn()];const n=[];return Object.entries(t).forEach(([r,o])=>{var a;Array.isArray(o)?o.forEach(i=>{var l;n.push({name:r,value:(l=i==null?void 0:i.toString())!=null?l:""})}):n.push({name:r,value:(a=o==null?void 0:o.toString())!=null?a:""})}),n.length?n:[Hn()]},oa=t=>ig(t),ag=t=>{var o,a,i,l,c,h,p,m,g,v,b,S,f,w;const n={network:t.streamNetwork,security:t.streamSecurity};if(t.streamNetwork==="ws"){let W=oa(t.wsHeaders);const z=t.wsHost.trim();z&&(W?"Host"in W||(W.Host=z):W={Host:z}),n.wsSettings=Cr({acceptProxyProtocol:t.wsAcceptProxyProtocol||void 0,path:t.wsPath||void 0,headers:W})}if(t.streamNetwork==="tcp"){const W={acceptProxyProtocol:t.tcpAcceptProxyProtocol||void 0};t.tcpHeaderType==="http"?W.header=Cr({type:"http",request:{version:"1.1",method:"GET",path:wi(t.tcpHttpPath),headers:Cr({Host:wi(t.tcpHttpHosts)})},response:{version:"1.1",status:"200",reason:"OK",headers:{}}}):W.header={type:"none"},n.tcpSettings=Cr(W)}if(t.streamNetwork==="grpc"&&(n.grpcSettings=Cr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(n.kcpSettings=Cr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(n.quicSettings=Cr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="http"&&(n.httpSettings=Cr({path:t.httpPath||void 0,host:wi(t.httpHost)})),t.streamNetwork==="httpupgrade"&&(n.httpupgradeSettings=Cr({acceptProxyProtocol:t.httpupgradeAcceptProxyProtocol||void 0,path:t.httpupgradePath,host:t.httpupgradeHost,headers:oa(t.httpupgradeHeaders)})),t.streamNetwork==="splithttp"&&(n.splithttpSettings=Cr({path:t.splithttpPath,host:t.splithttpHost,headers:oa(t.splithttpHeaders),scMaxConcurrentPosts:((o=t.splithttpScMaxConcurrentPosts)==null?void 0:o.trim())||void 0,scMaxEachPostBytes:((a=t.splithttpScMaxEachPostBytes)==null?void 0:a.trim())||void 0,scMinPostsIntervalMs:((i=t.splithttpScMinPostsIntervalMs)==null?void 0:i.trim())||void 0,noSSEHeader:t.splithttpNoSSEHeader||void 0,xPaddingBytes:((l=t.splithttpXPaddingBytes)==null?void 0:l.trim())||void 0,xmux:Cr({maxConcurrency:((c=t.splithttpXmuxMaxConcurrency)==null?void 0:c.trim())||void 0,maxConnections:Gs(t.splithttpXmuxMaxConnections),cMaxReuseTimes:((h=t.splithttpXmuxCMaxReuseTimes)==null?void 0:h.trim())||void 0,cMaxLifetimeMs:Gs(t.splithttpXmuxCMaxLifetimeMs)}),mode:t.splithttpMode,noGRPCHeader:t.splithttpNoGRPCHeader||void 0})),t.streamNetwork==="xhttp"){const W=t.xhttpMode;n.xhttpSettings=Cr({path:t.xhttpPath,host:t.xhttpHost,headers:oa(t.xhttpHeaders),scMaxBufferedPosts:W==="packet-up"?Gs(t.xhttpScMaxBufferedPosts):void 0,scMaxEachPostBytes:W==="packet-up"&&((p=t.xhttpScMaxEachPostBytes)==null?void 0:p.trim())||void 0,scMinPostsIntervalMs:W==="packet-up"&&((m=t.xhttpScMinPostsIntervalMs)==null?void 0:m.trim())||void 0,scStreamUpServerSecs:((g=t.xhttpScStreamUpServerSecs)==null?void 0:g.trim())||void 0,xPaddingBytes:((v=t.xhttpPaddingBytes)==null?void 0:v.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0,noGRPCHeader:["stream-up","stream-one"].includes(W)&&t.xhttpNoGRPCHeader||void 0,mode:W})}if(t.streamSecurity==="tls"){const W=t.tlsRawSettings&&typeof t.tlsRawSettings=="object"?{...t.tlsRawSettings}:{};W.serverName=t.tlsServerName||void 0,W.alpn=(b=t.tlsAlpn)!=null&&b.length?t.tlsAlpn:void 0,W.allowInsecure=t.tlsAllowInsecure,W.fingerprint=t.tlsFingerprint||void 0,n.tlsSettings=Cr(W)}if(t.streamSecurity==="reality"){const W=wi(t.realityServerNames),z=wi(t.realityShortIds);n.realitySettings=Cr({privateKey:((S=t.realityPrivateKey)==null?void 0:S.trim())||void 0,dest:((f=t.realityDest)==null?void 0:f.trim())||void 0,serverNames:W.length?W:void 0,shortIds:z.length?z:void 0,spiderX:((w=t.realitySpiderX)==null?void 0:w.trim())||void 0,xver:t.realityXver?Number(t.realityXver):void 0})}const r=rg(t);return r&&(n.sockopt=r),Cr(n)},og=t=>{const n={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(n.clients=[]),t.protocol){case"vmess":n.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":n.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(n.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(n.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(ll).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(ll).filter(r=>Object.keys(r).length));break;case"shadowsocks":n.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(ol).filter(o=>Object.keys(o).length);r.length&&(n.accounts=r),t.httpAllowTransparent&&(n.allowTransparent=!0);break}case"socks":{if(n.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(ol).filter(o=>Object.keys(o).length);r.length&&(n.accounts=r)}n.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(n.ip=t.socksUdpIp.trim());break}}return n},lg=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?ag(t):void 0,o={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:tg(t.port),protocol:t.protocol,settings:og(t)};return r&&(o.streamSettings=r),t.sniffingEnabled?o.sniffing=Cr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly}):o.sniffing={enabled:!1},o},cg=async()=>Ee("/xray/vlessenc"),dg=async()=>Ee("/xray/reality-keypair"),ug=async()=>Ee("/xray/reality-shortid"),bt=d.exports.forwardRef((t,n)=>e(Ce,{size:"sm",ref:n,...t}));bt.displayName="InboundFormInput";const vn=d.exports.forwardRef((t,n)=>e(at,{size:"sm",ref:n,...t}));vn.displayName="InboundFormSelect";const Ti=d.exports.forwardRef((t,n)=>e(ns,{size:"sm",resize:"vertical",ref:n,...t}));Ti.displayName="InboundFormTextarea";const cl=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),hg=t=>{const n=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!n)return"";const r=n.length%4;return r===0?n:`${n}${"=".repeat(4-r)}`},pg=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],mg=["bbr","cubic","reno"],gg=["off","redirect","tproxy"],dl=["tcp","grpc","splithttp","xhttp"],fg=["auto","packet-up","stream-up","stream-one"],bg=({isOpen:t,mode:n,initialValue:r,isSubmitting:o,existingInbounds:a,onClose:i,onSubmit:l})=>{var $t,Ut,ft,et;const{t:c}=je(),h=cr(),[p,m]=d.exports.useState([]),[g,v]=d.exports.useState(!1),b=Es({defaultValues:ao()}),{control:S,register:f,handleSubmit:w,reset:W,watch:z,formState:le}=b,{errors:R}=le,[K,y]=d.exports.useState(!1),[ae,Se]=d.exports.useState(null),[ve,T]=d.exports.useState(null),[F,q]=d.exports.useState(null),[$,Q]=d.exports.useState(!1),{fields:U,append:Z,remove:se}=Fn({control:S,name:"fallbacks"}),{fields:M,append:be,remove:ee}=Fn({control:S,name:"httpAccounts"}),{fields:Ie,append:me,remove:J}=Fn({control:S,name:"socksAccounts"}),{fields:N,append:B,remove:A}=Fn({control:S,name:"xhttpHeaders"}),k=ur({control:S,name:"protocol"})||z("protocol"),L=ur({control:S,name:"streamNetwork"})||z("streamNetwork"),te=ur({control:S,name:"streamSecurity"})||z("streamSecurity"),Oe=($t=ur({control:S,name:"sniffingEnabled"}))!=null?$t:z("sniffingEnabled"),ne=ur({control:S,name:"realityPrivateKey"})||z("realityPrivateKey"),I=ur({control:S,name:"tcpHeaderType"})||z("tcpHeaderType"),E=(Ut=ur({control:S,name:"sockoptEnabled"}))!=null?Ut:!1,G=ur({control:S,name:"vlessSelectedAuth"})||"",ze=ur({control:S,name:"socksAuth"})||z("socksAuth")||"noauth",Ne=(et=(ft=ur({control:S,name:"socksUdpEnabled"}))!=null?ft:z("socksUdpEnabled"))!=null?et:!1,Je=ur({control:S,name:"xhttpMode"})||z("xhttpMode")||"auto",H=ur({control:S,name:"tag"})||z("tag")||"",ke=ur({control:S,name:"port"})||z("port")||"",Me=k!=="http"&&k!=="socks",Be=Fe("yellow.50","yellow.900"),ot=Fe("yellow.400","yellow.500"),X=Boolean(ve||F),Ae=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),xe=eg,$e=jm,Ze=d.exports.useMemo(()=>k==="vless"||k==="trojan"?xe:xe.filter(he=>he!=="reality"),[xe,k]),Vt=d.exports.useMemo(()=>te==="reality"?dl:$e,[$e,te]),ge=d.exports.useMemo(()=>{const he=[...Ae,...p.map(tt=>tt.label)].filter(Boolean);return Array.from(new Set(he)).map(tt=>({label:tt,value:tt}))},[Ae,p]);d.exports.useEffect(()=>{if(!(k==="vless"||k==="trojan")&&te==="reality"){const he=Ze.includes("tls")?"tls":"none";b.setValue("streamSecurity",he,{shouldDirty:!0})}},[Ze,k,b,te]),d.exports.useEffect(()=>{te==="reality"&&!dl.includes(L)&&b.setValue("streamNetwork","tcp",{shouldDirty:!0})},[b,L,te]),d.exports.useEffect(()=>{if(t)if(r){const he=ng(r);W(he),y(!0),Q(!1)}else W(ao()),y(!1),Se(null),Q(!1)},[r,W,t]);const Te=d.exports.useMemo(()=>new Set([21,22,23,25,53,67,68,110,111,123,137,143,161,162,993]),[]),Re=d.exports.useCallback((he,De,tt)=>{const tr=tt==null?void 0:tt.toString().trim(),xr=[he||"inbound",De||"net"];return tr&&xr.push(tr),xr.join("+")},[]),ut=d.exports.useCallback(()=>{let he=0;for(let De=0;De<10;De+=1){const tt=Math.floor(Math.random()*9e3)+1e3;if(!Te.has(tt)){he=tt;break}}return he||(he=4443),b.setValue("port",he.toString(),{shouldDirty:!0}),he.toString()},[Te,b]);d.exports.useEffect(()=>{if(n!=="create"||r||!t||$)return;const De=b.getValues("port")||ut(),tt=Re(k,L,De);b.setValue("port",De,{shouldDirty:!0}),b.setValue("tag",tt,{shouldDirty:!0}),T(null),q(null),Q(!0)},[n,r,t,$,k,L,Re,ut,b]),d.exports.useEffect(()=>{if(n==="create"&&!K){const he=Re(k,L,ke);b.setValue("tag",he,{shouldDirty:!0})}},[n,K,Re,k,L,ke,b]),d.exports.useEffect(()=>{if(!ke){Se(null);return}const he=Number(ke);Number.isFinite(he)&&Te.has(he)?Se(c("inbounds.portWarningBlocked","This port is commonly blocked by servers/firewalls. Better to avoid it.")):Se(null)},[Te,ke,c]),d.exports.useEffect(()=>{const he=(H||"").trim();if(n==="edit"){T(null),q(null);return}he&&a.some(De=>(De.tag||"").trim().toLowerCase()===he.toLowerCase())?T(c("inbounds.error.tagExists","Inbound tag already exists")):T(null),ke&&a.some(De=>{var tt;return((tt=De.port)==null?void 0:tt.toString())===ke})?q(c("inbounds.error.portExists","Inbound port already exists")):q(null)},[a,n,ke,H,c]);const lt=d.exports.useCallback((he,De)=>s(_,{children:[e(D,{children:De}),e(At,{control:S,name:`sockopt.${he}`,render:({field:tt})=>{const tr=typeof tt.value=="number"||typeof tt.value=="string"?tt.value:void 0;return e(Hs,{min:0,value:tr!=null?tr:"",onChange:xr=>tt.onChange(xr),children:e(Bs,{})})}})]}),[S]),Mt=d.exports.useCallback((he,De)=>s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:De}),e(At,{control:S,name:`sockopt.${he}`,render:({field:tt})=>e(_t,{isChecked:typeof tt.value=="boolean"?tt.value:Boolean(tt.value),onChange:tr=>tt.onChange(tr.target.checked)})})]}),[S]),er=d.exports.useCallback((he,De,tt)=>s(_,{children:[e(D,{children:De}),e(bt,{...f(`sockopt.${he}`),placeholder:tt})]}),[f]),ie=k==="vless"||k==="trojan",st=Fe("gray.200","gray.700"),Qe=async he=>{await l(he)},Pt=d.exports.useCallback(async()=>{try{const{privateKey:he,publicKey:De}=await dg();b.setValue("realityPrivateKey",cl(he),{shouldDirty:!0}),h({status:"success",title:c("inbounds.reality.generateKeys","Generate key pair"),description:"Key pair generated successfully using Xray",duration:2e3,isClosable:!0})}catch(he){h({status:"error",title:c("inbounds.reality.generateError","Unable to generate key pair"),description:he instanceof Error?he.message:void 0})}},[b,h,c]),Rt=d.exports.useCallback(async()=>{try{const{shortId:he}=await ug(),tt=(b.getValues("realityShortIds")||"").split(/[\s,]+/).map(tr=>tr.trim()).filter(Boolean);tt.push(he),b.setValue("realityShortIds",tt.join(`
`),{shouldDirty:!0}),h({status:"success",title:c("inbounds.reality.generateShortId","Generate short ID"),description:"Short ID generated successfully",duration:2e3,isClosable:!0})}catch(he){h({status:"error",title:c("inbounds.reality.shortIdError","Unable to generate short ID"),description:he instanceof Error?he.message:void 0})}},[b,h,c]),Ft=d.exports.useMemo(()=>{const he=hg(ne);if(!he)return"";try{const{publicKey:De}=so(he);return cl(De)}catch{return""}},[ne]),We=()=>Z({dest:"",path:"",type:"",alpn:"",xver:""}),ce=d.exports.useCallback(async()=>{var he;v(!0);try{const De=await cg(),tt=(he=De==null?void 0:De.auths)!=null?he:[];return m(tt),tt}catch(De){return console.error(De),h({status:"error",title:c("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{v(!1)}},[h,c]),Pe=d.exports.useCallback(async()=>p.length?p:ce(),[ce,p]),fe=d.exports.useCallback((he,De)=>{var tr,xr;const tt=De.find(es=>es.label===he);if(!tt){h({status:"warning",title:c("inbounds.vless.authNotFound","Authentication block not available")});return}b.setValue("vlessDecryption",(tr=tt.decryption)!=null?tr:"",{shouldDirty:!0}),b.setValue("vlessEncryption",(xr=tt.encryption)!=null?xr:"",{shouldDirty:!0})},[b,c,h]),dt=d.exports.useCallback(async he=>{if(!he){b.setValue("vlessDecryption","",{shouldDirty:!0}),b.setValue("vlessEncryption","",{shouldDirty:!0});return}const De=await Pe();De.length&&fe(he,De)},[fe,Pe,b]),yt=d.exports.useCallback(async()=>{const he=b.getValues("vlessSelectedAuth");if(!he){h({status:"info",title:c("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const De=await ce();De.length&&fe(he,De)},[fe,ce,b,c,h]),Kt=d.exports.useCallback(()=>{b.setValue("vlessSelectedAuth","",{shouldDirty:!0}),b.setValue("vlessDecryption","",{shouldDirty:!0}),b.setValue("vlessEncryption","",{shouldDirty:!0})},[b]);return d.exports.useEffect(()=>{t&&k==="vless"&&Pe()},[k,Pe,t]),s(Gt,{isOpen:t,onClose:i,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(Dt,{}),s(Xt,{maxW:{base:"95vw",md:"4xl"},children:[e(Tt,{children:n==="create"?c("inbounds.add","Add inbound"):c("inbounds.edit","Edit inbound")}),e(Qt,{}),e(It,{children:s(pe,{align:"stretch",spacing:6,children:[s(we,{spacing:4,borderWidth:"1px",borderColor:st,borderRadius:"lg",p:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{isRequired:!0,isInvalid:!!ve,children:[e(D,{children:c("inbounds.tag","Tag")}),e(bt,{...f("tag",{required:!0,onChange:()=>y(!0)}),isDisabled:n==="edit"}),ve&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:ve})]}),s(_,{children:[e(D,{children:c("inbounds.listen","Listen address")}),e(bt,{placeholder:"::",...f("listen")})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{isRequired:!0,isInvalid:!!F,children:[e(D,{children:c("inbounds.port","Port")}),e(bt,{placeholder:"443",...f("port",{required:!0}),value:ke,onChange:he=>{f("port").onChange(he),b.setValue("port",he.target.value,{shouldDirty:!0})},bg:ae?Be:void 0,_dark:{bg:ae?Be:void 0,color:"white"},borderColor:ae?ot:void 0}),s(O,{justify:"space-between",mt:1,children:["\u0627\u0631",e(V,{size:"xs",variant:"ghost",leftIcon:e(Cn,{width:16,height:16}),onClick:()=>ut(),children:c("inbounds.randomPort","Random")})]}),ae&&e(u,{fontSize:"xs",color:"yellow.600",mt:1,children:ae}),F&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:F})]}),s(_,{isRequired:!0,children:[e(D,{children:c("inbounds.protocol","Protocol")}),e(vn,{...f("protocol",{required:!0}),isDisabled:n==="edit",children:bo.map(he=>e("option",{value:he,children:he.toUpperCase()},he))})]})]}),k==="vmess"&&s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(_t,{...f("disableInsecureEncryption")})]}),k==="shadowsocks"&&s(_,{children:[e(D,{children:c("inbounds.shadowsocks.network","Allowed networks")}),e(bt,{...f("shadowsocksNetwork")})]}),k==="vless"&&s(we,{spacing:3,children:[e(At,{control:S,name:"vlessSelectedAuth",render:({field:he})=>s(_,{children:[e(D,{children:c("inbounds.vless.authentication","Authentication")}),s(at,{placeholder:c("inbounds.vless.authPlaceholder","Select authentication"),value:he.value||"",onChange:async De=>{const tt=De.target.value;he.onChange(tt),await dt(tt)},children:[e("option",{value:"",children:c("common.none","None")}),ge.map(De=>e("option",{value:De.value,children:De.label},De.value))]})]})}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:c("inbounds.vless.decryption","Decryption")}),e(bt,{...f("vlessDecryption")})]}),s(_,{children:[e(D,{children:c("inbounds.vless.encryption","Encryption")}),e(bt,{...f("vlessEncryption")})]})]}),s(O,{spacing:3,children:[e(V,{size:"sm",onClick:yt,isLoading:g,isDisabled:!G,children:c("inbounds.vless.getKeys","Get new keys")}),e(V,{size:"sm",variant:"ghost",onClick:Kt,children:c("inbounds.vless.clearKeys","Clear")})]})]}),k==="http"&&s(we,{spacing:3,children:[s(xt,{justify:"space-between",align:"center",children:[e(u,{fontWeight:"medium",children:c("inbounds.http.accounts","HTTP accounts")}),e(V,{size:"xs",onClick:()=>be({user:"",pass:""}),children:c("inbounds.accounts.add","Add account")})]}),s(we,{spacing:3,children:[M.map((he,De)=>s(P,{borderWidth:"1px",borderRadius:"md",borderColor:st,p:3,children:[s(xt,{justify:"space-between",align:"center",mb:3,children:[s(u,{fontWeight:"semibold",children:[c("inbounds.accounts.label","Account")," #",De+1]}),e(V,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ee(De),children:c("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("username","Username")}),e(bt,{...f(`httpAccounts.${De}.user`)})]}),s(_,{children:[e(D,{children:c("password","Password")}),e(bt,{...f(`httpAccounts.${De}.pass`)})]})]})]},he.id)),!M.length&&e(u,{fontSize:"sm",color:"gray.500",children:c("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.http.allowTransparent","Allow transparent proxy")}),e(_t,{...f("httpAllowTransparent")})]})]}),k==="socks"&&s(we,{spacing:3,children:[s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.socks.udp","Enable UDP")}),e(_t,{...f("socksUdpEnabled")})]}),Ne&&s(_,{children:[e(D,{children:c("inbounds.socks.udpIp","UDP bind IP")}),e(bt,{...f("socksUdpIp"),placeholder:"127.0.0.1"})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.socks.auth","Require authentication")}),e(At,{control:S,name:"socksAuth",render:({field:he})=>e(_t,{isChecked:he.value==="password",onChange:De=>he.onChange(De.target.checked?"password":"noauth")})})]}),ze==="password"&&s(we,{spacing:3,children:[s(xt,{justify:"space-between",align:"center",children:[e(u,{fontWeight:"medium",children:c("inbounds.socks.accounts","SOCKS accounts")}),e(V,{size:"xs",onClick:()=>me({user:"",pass:""}),children:c("inbounds.accounts.add","Add account")})]}),Ie.map((he,De)=>s(P,{borderWidth:"1px",borderRadius:"md",borderColor:st,p:3,children:[s(xt,{justify:"space-between",align:"center",mb:3,children:[s(u,{fontWeight:"semibold",children:[c("inbounds.accounts.label","Account")," #",De+1]}),e(V,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>J(De),children:c("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("username","Username")}),e(bt,{...f(`socksAccounts.${De}.user`)})]}),s(_,{children:[e(D,{children:c("password","Password")}),e(bt,{...f(`socksAccounts.${De}.pass`)})]})]})]},he.id)),!Ie.length&&e(u,{fontSize:"sm",color:"gray.500",children:c("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),Me&&s(we,{spacing:4,borderWidth:"1px",borderColor:st,borderRadius:"lg",p:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:c("inbounds.network","Network")}),e(vn,{...f("streamNetwork"),children:Vt.map(he=>e("option",{value:he,children:he},he))})]}),s(_,{children:[e(D,{children:c("inbounds.security","Security")}),e(vn,{...f("streamSecurity"),children:Ze.map(he=>e("option",{value:he,children:he},he))})]})]}),L==="ws"&&s(Tr,{status:"warning",borderRadius:"md",mt:2,children:[e(Mr,{}),s(P,{children:[e(yu,{fontSize:"sm",children:c("inbounds.wsDeprecatedTitle","WebSocket transport is deprecated in Xray")}),e($s,{fontSize:"xs",children:c("inbounds.wsDeprecatedDescription","Xray recommends migrating WebSocket (ws) configs to XHTTP (H2/H3). Consider using xhttp instead of ws for new inbounds.")})]})]}),L==="ws"&&s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:c("inbounds.ws.path","WebSocket path")}),e(bt,{...f("wsPath"),placeholder:"/ws"})]}),s(_,{children:[e(D,{children:c("inbounds.ws.host","WebSocket host header")}),e(bt,{...f("wsHost")})]})]}),L==="tcp"&&s(we,{spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.tcp.headerType","TCP header type")}),s(vn,{...f("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),I==="http"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.tcp.host","HTTP host list")}),e(Ti,{...f("tcpHttpHosts"),placeholder:"example.com"})]}),s(_,{children:[e(D,{children:c("inbounds.tcp.path","HTTP path")}),e(bt,{...f("tcpHttpPath")})]})]})]}),L==="grpc"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.grpc.serviceName","Service name")}),e(bt,{...f("grpcServiceName")})]}),s(_,{children:[e(D,{children:c("inbounds.grpc.authority","Authority")}),e(bt,{...f("grpcAuthority")})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.grpc.multiMode","Multi mode")}),e(_t,{...f("grpcMultiMode")})]})]}),L==="kcp"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.kcp.headerType","mKCP header")}),e(bt,{...f("kcpHeaderType")})]}),s(_,{children:[e(D,{children:c("inbounds.kcp.seed","mKCP seed")}),e(bt,{...f("kcpSeed")})]})]}),L==="quic"&&s(Ve,{columns:{base:1,md:3},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.quic.security","QUIC security")}),e(bt,{...f("quicSecurity")})]}),s(_,{children:[e(D,{children:c("inbounds.quic.key","QUIC key")}),e(bt,{...f("quicKey")})]}),s(_,{children:[e(D,{children:c("inbounds.quic.headerType","QUIC header type")}),e(bt,{...f("quicHeaderType")})]})]}),L==="httpupgrade"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.httpUpgrade.path","Path")}),e(bt,{...f("httpupgradePath")})]}),s(_,{children:[e(D,{children:c("inbounds.httpUpgrade.host","Host")}),e(bt,{...f("httpupgradeHost")})]})]}),L==="splithttp"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.splitHttp.path","Path")}),e(bt,{...f("splithttpPath")})]}),s(_,{children:[e(D,{children:c("inbounds.splitHttp.host","Host")}),e(bt,{...f("splithttpHost")})]})]}),L==="xhttp"&&s(we,{spacing:3,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.xhttp.host","Host")}),e(bt,{...f("xhttpHost"),placeholder:"example.com"})]}),s(_,{children:[e(D,{children:c("inbounds.xhttp.path","Path")}),e(bt,{...f("xhttpPath"),placeholder:"/"})]})]}),s(we,{spacing:2,children:[s(xt,{justify:"space-between",align:"center",children:[e(u,{fontWeight:"medium",children:c("inbounds.xhttp.headers","Custom headers")}),e(V,{size:"xs",onClick:()=>B({name:"",value:""}),children:c("inbounds.accounts.add","Add")})]}),N.map((he,De)=>s(O,{spacing:2,align:"flex-start",children:[e(_,{children:e(bt,{...f(`xhttpHeaders.${De}.name`),placeholder:c("inbounds.xhttp.headerName","Header name")})}),e(_,{children:e(bt,{...f(`xhttpHeaders.${De}.value`),placeholder:c("inbounds.xhttp.headerValue","Header value")})}),e(V,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>A(De),children:c("hostsPage.delete","Delete")})]},he.id))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.xhttp.mode","Mode")}),e(vn,{...f("xhttpMode"),children:fg.map(he=>e("option",{value:he,children:he},he))})]}),s(_,{children:[e(D,{children:c("inbounds.xhttp.paddingBytes","Padding bytes")}),e(bt,{...f("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),Je==="packet-up"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(bt,{...f("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),s(_,{children:[e(D,{children:c("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(bt,{...f("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),Je==="stream-up"&&s(_,{children:[e(D,{children:c("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(bt,{...f("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.xhttp.noSSE","Disable SSE header")}),e(_t,{...f("xhttpNoSSEHeader")})]})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.sockopt.enable","Enable sockopt")}),e(At,{control:S,name:"sockoptEnabled",render:({field:he})=>e(_t,{isChecked:Boolean(he.value),onChange:De=>he.onChange(De.target.checked)})})]}),e($n,{in:Boolean(E),animateOpacity:!0,children:s(we,{spacing:4,borderWidth:"1px",borderColor:st,borderRadius:"md",p:4,mt:2,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[lt("mark",c("inbounds.sockopt.routeMark","Route mark")),lt("tcpKeepAliveInterval",c("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),lt("tcpKeepAliveIdle",c("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),lt("tcpMaxSeg",c("inbounds.sockopt.tcpMaxSeg","TCP max segment")),lt("tcpUserTimeout",c("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),lt("tcpWindowClamp",c("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[er("dialerProxy",c("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),er("interfaceName",c("inbounds.sockopt.interfaceName","Interface name"))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.sockopt.domainStrategy","Domain strategy")}),e(At,{control:S,name:"sockopt.domainStrategy",render:({field:he})=>s(at,{...he,children:[e("option",{value:"",children:c("common.none","None")}),pg.map(De=>e("option",{value:De,children:De},De))]})})]}),s(_,{children:[e(D,{children:c("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(At,{control:S,name:"sockopt.tcpcongestion",render:({field:he})=>s(at,{...he,children:[e("option",{value:"",children:c("common.none","None")}),mg.map(De=>e("option",{value:De,children:De},De))]})})]}),s(_,{children:[e(D,{children:c("inbounds.sockopt.tproxy","TProxy")}),e(At,{control:S,name:"sockopt.tproxy",render:({field:he})=>e(at,{...he,children:gg.map(De=>e("option",{value:De,children:De},De))})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[Mt("acceptProxyProtocol",c("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),Mt("tcpFastOpen",c("inbounds.sockopt.tcpFastOpen","TCP fast open")),Mt("tcpMptcp",c("inbounds.sockopt.tcpMptcp","Multipath TCP")),Mt("penetrate",c("inbounds.sockopt.penetrate","Penetrate")),Mt("V6Only",c("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),te==="tls"&&s(we,{spacing:4,borderWidth:"1px",borderColor:st,borderRadius:"lg",p:4,children:[s(_,{children:[e(D,{children:c("inbounds.tls.serverName","Server name (SNI)")}),e(bt,{...f("tlsServerName"),placeholder:"example.com"})]}),s(_,{children:[e(D,{children:c("inbounds.tls.fingerprint","uTLS fingerprint")}),s(vn,{...f("tlsFingerprint"),children:[e("option",{value:"",children:c("common.none","None")}),Zm.map(he=>e("option",{value:he,children:he},he))]})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.tls.allowInsecure","Allow insecure")}),e(_t,{...f("tlsAllowInsecure")})]})]}),te==="reality"&&s(we,{spacing:4,borderWidth:"1px",borderColor:st,borderRadius:"lg",p:4,children:[s(_,{isRequired:!0,isInvalid:Boolean(R.realityPrivateKey),children:[e(D,{children:c("inbounds.reality.privateKey","Reality private key")}),e(Ti,{rows:3,...f("realityPrivateKey",{required:!0})}),e(V,{size:"xs",mt:2,variant:"outline",onClick:Pt,alignSelf:"flex-start",children:c("inbounds.reality.generateKeys","Generate key pair")}),R.realityPrivateKey&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:c("validation.required","This field is required")})]}),s(_,{children:[e(D,{children:c("inbounds.reality.publicKey","Reality public key")}),e(bt,{value:Ft,isReadOnly:!0,placeholder:c("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{isRequired:!0,isInvalid:Boolean(R.realityServerNames),children:[e(D,{children:c("inbounds.reality.serverNames","Server names")}),e(Ti,{rows:2,...f("realityServerNames",{required:!0}),placeholder:"domain.com"}),e(P,{fontSize:"sm",color:"gray.500",children:c("inbounds.serverNamesHint","Separate entries with commas or new lines.")}),R.realityServerNames&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:c("validation.required","This field is required")})]}),s(_,{isRequired:!0,isInvalid:Boolean(R.realityDest),children:[e(D,{children:c("inbounds.reality.dest","Destination (host:port)")}),e(bt,{...f("realityDest",{required:!0}),placeholder:"example.com:443"}),R.realityDest&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:c("validation.required","This field is required")})]})]}),s(_,{isInvalid:Boolean(R.realityShortIds),children:[e(D,{children:c("inbounds.reality.shortIds","Short IDs")}),e(Ti,{rows:2,...f("realityShortIds")}),e(V,{size:"xs",mt:2,variant:"outline",onClick:Rt,alignSelf:"flex-start",children:c("inbounds.reality.generateShortId","Generate short ID")}),e(P,{fontSize:"sm",color:"gray.500",children:c("inbounds.shortIdsHint","Separate entries with commas or new lines.")}),R.realityShortIds&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:c("validation.required","This field is required")})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:c("inbounds.reality.spiderX","SpiderX")}),e(bt,{...f("realitySpiderX")})]}),s(_,{children:[e(D,{children:c("inbounds.reality.xver","Xver")}),e(bt,{...f("realityXver")})]})]})]}),ie&&s(we,{spacing:3,borderWidth:"1px",borderColor:st,borderRadius:"lg",p:4,children:[s(xt,{align:"center",justify:"space-between",children:[e(P,{fontWeight:"medium",children:c("inbounds.fallbacks","Fallbacks")}),e(V,{size:"xs",onClick:We,children:c("inbounds.fallbacks.add","Add fallback")})]}),U.length===0?e(u,{fontSize:"sm",color:"gray.500",children:c("inbounds.fallbacks.empty","No fallbacks configured yet.")}):U.map((he,De)=>s(P,{borderWidth:"1px",borderRadius:"md",borderColor:st,p:3,children:[s(xt,{justify:"space-between",align:"center",mb:3,children:[s(u,{fontWeight:"semibold",children:[c("inbounds.fallbacks.type","Fallback")," #",De+1]}),e(V,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>se(De),children:c("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.fallbacks.dest","Destination (host:port)")}),e(bt,{placeholder:"example.com:443",...f(`fallbacks.${De}.dest`)})]}),s(_,{children:[e(D,{children:c("inbounds.fallbacks.path","Path")}),e(bt,{...f(`fallbacks.${De}.path`),placeholder:"/"})]}),s(_,{children:[e(D,{children:c("inbounds.fallbacks.type","Type")}),e(bt,{...f(`fallbacks.${De}.type`),placeholder:"none"})]}),s(_,{children:[e(D,{children:c("inbounds.fallbacks.alpn","ALPN")}),e(bt,{...f(`fallbacks.${De}.alpn`),placeholder:"h2,http/1.1"})]}),s(_,{children:[e(D,{children:"Xver"}),e(bt,{...f(`fallbacks.${De}.xver`),placeholder:"0"})]})]})]},he.id))]}),s(we,{spacing:4,borderWidth:"1px",borderColor:st,borderRadius:"lg",p:4,children:[s(xt,{align:"center",justify:"space-between",children:[s(O,{spacing:2,children:[e(P,{fontWeight:"medium",children:c("inbounds.sniffing","Sniffing")}),e(kt,{label:c("inbounds.sniffingHint","It is recommended to keep the default."),children:e(dc,{width:16,height:16})})]}),e(_t,{...f("sniffingEnabled")})]}),Oe&&s(we,{spacing:3,children:[s(_,{children:[e(D,{children:c("inbounds.sniffingDestinations","Protocols to sniff")}),e(At,{control:S,name:"sniffingDestinations",render:({field:he})=>{var De;return e(ga,{value:(De=he.value)!=null?De:[],onChange:he.onChange,children:e(O,{spacing:4,children:Qm.map(tt=>e(Yr,{value:tt.value,children:tt.label},tt.value))})})}})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.sniffingRouteOnly","Route only")}),e(_t,{...f("sniffingRouteOnly")})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:c("inbounds.sniffingMetadataOnly","Metadata only")}),e(_t,{...f("sniffingMetadataOnly")})]})]})]})]})}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:i,children:c("hostsPage.cancel","Cancel")}),e(V,{colorScheme:"primary",isLoading:o,isDisabled:X,onClick:w(Qe),children:n==="create"?c("common.create","Create"):c("common.save","Save")})]})]})]})},yg=()=>{const{t}=je(),n=cr(),[r,o]=d.exports.useState([]),[a,i]=d.exports.useState(!0),[l,c]=d.exports.useState(!1),[h,p]=d.exports.useState(null),[m,g]=d.exports.useState({protocol:"all",search:""}),[v,b]=d.exports.useState(null),{isOpen:S,onOpen:f,onClose:w}=sr(),[W,z]=d.exports.useState("create"),le=Br({base:!1,md:!0}),R=d.exports.useCallback(()=>{i(!0),p(null),Ee("/inbounds/full").then(T=>{o(T||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>i(!1))},[t]);d.exports.useEffect(()=>{R()},[R]);const K=d.exports.useMemo(()=>{const T=m.search.trim().toLowerCase();return r.filter(F=>{var q;return m.protocol!=="all"&&F.protocol!==m.protocol?!1:T?F.tag.toLowerCase().includes(T)||((q=F.port)==null?void 0:q.toString().includes(T)):!0})},[r,m]),y=()=>{z("create"),b(null),f()},ae=T=>{z("edit"),b(T),f()},Se=async T=>{var F;c(!0);try{const q=(T.tag||"").trim().toLowerCase(),$=r.some(se=>(se.tag||"").trim().toLowerCase()===q&&(W==="create"||se.tag!==(v==null?void 0:v.tag))),Q=r.some(se=>{var M;return((M=se.port)==null?void 0:M.toString())===T.port&&(W==="create"||se.tag!==(v==null?void 0:v.tag))});if($)throw new Error(t("inbounds.error.tagExists","Inbound tag already exists"));if(Q)throw new Error(t("inbounds.error.portExists","Inbound port already exists"));const U=lg(T),Z=W==="create"?"/inbounds":`/inbounds/${encodeURIComponent(U.tag)}`;await Ee(Z,{method:W==="create"?"POST":"PUT",body:U}),n({status:"success",title:W==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),Bi(),await R(),w()}catch(q){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((F=q==null?void 0:q.data)==null?void 0:F.detail)||(q==null?void 0:q.message)})}finally{c(!1)}},ve=async T=>{var q;const F=t("inbounds.confirmDelete",{tag:T.tag});if(!!window.confirm(F)){c(!0);try{await Ee(`/inbounds/${encodeURIComponent(T.tag)}`,{method:"DELETE"}),n({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),Bi(),await R()}catch($){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((q=$==null?void 0:$.data)==null?void 0:q.detail)||($==null?void 0:$.message)})}finally{c(!1)}}};return s(we,{spacing:4,children:[s(xt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(Ce,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:m.search,onChange:T=>g(F=>({...F,search:T.target.value}))}),s(O,{spacing:3,children:[s(at,{width:"180px",value:m.protocol,onChange:T=>g(F=>({...F,protocol:T.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),bo.map(T=>e("option",{value:T,children:T.toUpperCase()},T))]}),e(V,{leftIcon:e(en,{width:18,height:18}),onClick:y,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),h&&s(Tr,{status:"error",children:[e(Mr,{}),h]}),a?e(xt,{justify:"center",py:10,children:e(zt,{})}):K.length===0?e(P,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):le?e(P,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:s(Ks,{variant:"simple",size:"sm",children:[e(hs,{bg:"gray.50",_dark:{bg:"gray.900"},children:s(Lt,{children:[e(Xe,{children:t("inbounds.tag","Tag")}),e(Xe,{children:t("inbounds.protocol","Protocol")}),e(Xe,{children:t("inbounds.portLabel","Port")}),e(Xe,{children:t("inbounds.network","Network")}),e(Xe,{children:t("inbounds.security","Security")}),e(Xe,{children:t("inbounds.sniffing","Sniffing")}),e(Xe,{width:"120px",children:t("actions","Actions")})]})}),e(as,{children:K.map(T=>{var q;const F=T.streamSettings||{};return s(Lt,{children:[s(Le,{children:[e(u,{fontWeight:"semibold",children:T.tag}),T.listen&&e(u,{fontSize:"sm",color:"gray.500",children:T.listen})]}),e(Le,{children:e(pt,{colorScheme:"purple",children:T.protocol})}),e(Le,{children:T.port}),e(Le,{children:F.network||"\u2014"}),e(Le,{children:F.security&&F.security!=="none"?e(pt,{colorScheme:"blue",children:F.security}):"\u2014"}),e(Le,{children:(q=T.sniffing)!=null&&q.enabled?e(pt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(pt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Le,{children:s(O,{spacing:2,children:[e(qe,{"aria-label":t("common.edit","Edit"),icon:e(cn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ae(T)}),e(qe,{"aria-label":t("common.delete","Delete"),icon:e(Vs,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ve(T),isLoading:l})]})})]},T.tag)})})]})}):e(we,{spacing:3,children:K.map(T=>{var q;const F=T.streamSettings||{};return s(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(xt,{justify:"space-between",align:"center",mb:2,children:[s(P,{children:[e(u,{fontWeight:"semibold",children:T.tag}),s(u,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",T.port]})]}),s(O,{spacing:2,children:[e(qe,{"aria-label":t("common.edit","Edit"),icon:e(cn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ae(T)}),e(qe,{"aria-label":t("common.delete","Delete"),icon:e(Vs,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ve(T),isLoading:l})]})]}),s(we,{spacing:2,children:[s(O,{spacing:2,wrap:"wrap",children:[e(pt,{colorScheme:"purple",children:T.protocol}),F.network&&e(pt,{children:F.network}),F.security&&F.security!=="none"&&e(pt,{colorScheme:"blue",children:F.security})]}),s(O,{spacing:2,wrap:"wrap",children:[(q=T.sniffing)!=null&&q.enabled?e(pt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(pt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),T.listen&&e(pt,{size:"sm",colorScheme:"gray",children:T.listen})]})]})]},T.tag)})}),e(bg,{isOpen:S,mode:W,initialValue:v,isSubmitting:l,existingInbounds:r,onClose:w,onSubmit:Se})]})},xg=()=>{var a;const{t}=je(),{userData:n,getUserIsSuccess:r}=Dr();return r&&Boolean((a=n.permissions)==null?void 0:a.sections.hosts)?s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),s(dn,{colorScheme:"primary",isLazy:!0,children:[s(un,{children:[e(hr,{children:s(O,{spacing:2,children:[e(lr,{as:uc,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(hr,{children:s(O,{spacing:2,children:[e(lr,{as:Vl,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),s(hn,{children:[e(pr,{px:0,children:s(pe,{spacing:4,align:"stretch",children:[e(u,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(yg,{})]})}),e(pr,{px:0,children:s(pe,{spacing:4,align:"stretch",children:[e(u,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Xm,{})]})})]})]})]}):s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("hostsPage.noPermission","You do not have permission to manage host or inbound settings.")})]})},jc="__dot__",oo=t=>t.replace(/\./g,jc),Un=t=>t.replace(new RegExp(jc,"g"),"."),Sg=t=>{const n={},r=(o,a)=>{if(a!==void 0){if(typeof a=="boolean"){n[Un(o)]=a;return}if(typeof a=="string"){if(a==="")return;a==="true"||a==="false"?n[Un(o)]=a==="true":n[Un(o)]=Boolean(a);return}if(typeof a=="number"){n[Un(o)]=a!==0;return}if(Array.isArray(a)){n[Un(o)]=a.length>0;return}if(a&&typeof a=="object"){Object.entries(a).forEach(([i,l])=>{const c=o?`${o}.${i}`:i;r(c,l)});return}n[Un(o)]=Boolean(a)}};return Object.entries(t).forEach(([o,a])=>{r(o,a)}),n},ed=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],vg=ed.flatMap(t=>t.events.map(n=>n.key)),ul=ue(gs,{baseStyle:{w:4,h:4}}),hl=ue(xu,{baseStyle:{w:4,h:4}}),qa=t=>{var o,a,i,l;const n={};Object.entries(t.forum_topics||{}).forEach(([c,h])=>{var p;n[c]={title:(p=h.title)!=null?p:"",topic_id:h.topic_id!=null?String(h.topic_id):""}});const r={};return vg.forEach(c=>{var m;const h=oo(c),p=(m=t.event_toggles)==null?void 0:m[c];r[h]=p===void 0?!0:Boolean(p)}),Object.entries(t.event_toggles||{}).forEach(([c,h])=>{const p=oo(c);p in r||(r[p]=Boolean(h))}),{api_token:(o=t.api_token)!=null?o:"",use_telegram:(a=t.use_telegram)!=null?a:!0,proxy_url:(i=t.proxy_url)!=null?i:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(l=t.default_vless_flow)!=null?l:"",forum_topics:n,event_toggles:r}},Ja=({disabled:t,message:n,children:r})=>s(P,{position:"relative",children:[e(P,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(xt,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(u,{children:n})})]}),wg=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(n=>n.length>0).map(n=>Number(n)).filter(n=>Number.isFinite(n)),kg=()=>{var J,N,B,A,k,L,te,Oe,ne;const{t}=je(),n=cr(),{userData:r,getUserIsSuccess:o}=Dr(),a=(r==null?void 0:r.role)==="sudo"||(r==null?void 0:r.role)==="full_access",i=o&&(a||Boolean((J=r.permissions)==null?void 0:J.sections.integrations)),l=za(),{data:c,isLoading:h,refetch:p}=yr("telegram-settings",Fh,{refetchOnWindowFocus:!1,enabled:i}),{data:m,isLoading:g,refetch:v}=yr("panel-settings",Ma,{refetchOnWindowFocus:!1,enabled:i}),b=yr("maintenance-info",()=>Ee("/maintenance/info"),{refetchOnWindowFocus:!1,enabled:i}),[S,f]=d.exports.useState(null);d.exports.useEffect(()=>{if(!S)return;const I=window.setTimeout(()=>f(null),15e3);return()=>window.clearTimeout(I)},[S]);const[w,W]=d.exports.useState((N=m==null?void 0:m.use_nobetci)!=null?N:!1),[z,le]=d.exports.useState((B=m==null?void 0:m.access_insights_enabled)!=null?B:!1),[R,K]=d.exports.useState((A=m==null?void 0:m.default_subscription_type)!=null?A:"key");d.exports.useEffect(()=>{var I,E;m&&(W(m.use_nobetci),le((I=m.access_insights_enabled)!=null?I:!1),K((E=m.default_subscription_type)!=null?E:"key"))},[m]);const y=async I=>{try{return await Ee(I,{method:"POST",timeout:3e3}),{wentOffline:!1}}catch(E){if(!(E!=null&&E.response))return{wentOffline:!0};throw E}},ae=(I,E)=>{f(I);let G="settings.panel.restartTriggered";I==="update"?G="settings.panel.updateTriggered":I==="soft-reload"&&(G="settings.panel.softReloadTriggered"),gr(t(G),n),E.wentOffline&&n({title:t("settings.panel.maintenanceOfflineNotice"),status:"info",duration:4e3,isClosable:!0,position:"top"}),window.setTimeout(()=>b.refetch(),6e3)},Se=vr(()=>y("/maintenance/update"),{retry:!1,onMutate:()=>f("update"),onSuccess:I=>ae("update",I),onError:I=>{f(null),ir(I,n)}}),ve=vr(()=>y("/maintenance/restart"),{retry:!1,onMutate:()=>f("restart"),onSuccess:I=>ae("restart",I),onError:I=>{f(null),ir(I,n)}}),T=vr(()=>y("/maintenance/soft-reload"),{retry:!1,onMutate:()=>f("soft-reload"),onSuccess:I=>ae("soft-reload",I),onError:I=>{f(null),ir(I,n)}}),{register:F,control:q,handleSubmit:$,reset:Q,watch:U,formState:{isDirty:Z}}=Es({defaultValues:qa(c!=null?c:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{c&&Q(qa(c))},[c,Q]);const se=vr(Hh,{onSuccess:I=>{Q(qa(I)),l.setQueryData("telegram-settings",I),n({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{n({title:t("errors.generic"),status:"error"})}}),M=vr(Bh,{onSuccess:I=>{var E,G;W(I.use_nobetci),le((E=I.access_insights_enabled)!=null?E:!1),K((G=I.default_subscription_type)!=null?G:"key"),l.setQueryData("panel-settings",I),n({title:t("settings.panel.saved"),status:"success",duration:3e3})},onError:()=>{n({title:t("errors.generic"),status:"error"})}}),be=I=>{const E=Sg(I.event_toggles||{}),G={api_token:I.api_token.trim()||null,use_telegram:I.use_telegram,proxy_url:I.proxy_url.trim()||null,admin_chat_ids:wg(I.admin_chat_ids),logs_chat_id:I.logs_chat_id.trim()?Number(I.logs_chat_id.trim()):null,logs_chat_is_forum:I.logs_chat_is_forum,default_vless_flow:I.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(I.forum_topics||{}).map(([ze,Ne])=>[ze,{title:Ne.title,topic_id:Ne.topic_id.trim()?Number(Ne.topic_id.trim()):void 0}])),event_toggles:E};se.mutate(G)},ee=U("forum_topics"),Ie=U("use_telegram"),me=t("settings.telegram.disabledOverlay");return o?i?s(P,{px:{base:4,md:8},py:{base:6,md:8},children:[e(Ys,{size:"lg",mb:4,children:t("settings.integrations")}),s(dn,{colorScheme:"primary",children:[s(un,{children:[e(hr,{children:t("settings.panel.tabTitle")}),e(hr,{children:t("settings.telegram")}),e(hr,{isDisabled:!0,children:t("settings.tabs.comingSoon")})]}),s(hn,{children:[e(pr,{px:{base:0,md:2},children:g&&m===void 0?e(xt,{align:"center",justify:"center",py:12,children:e(zt,{size:"lg"})}):s(we,{spacing:6,align:"stretch",children:[e(u,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description")}),e(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:s(xt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[s(P,{children:[e(Ys,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle")}),e(u,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription")})]}),e(_t,{isChecked:w,onChange:I=>W(I.target.checked),isDisabled:M.isLoading||g})]})}),e(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:s(xt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[s(P,{children:[e(Ys,{size:"sm",mb:1,children:t("settings.panel.accessInsightsTitle","Enable Access Insights")}),e(u,{fontSize:"sm",color:"gray.500",children:t("settings.panel.accessInsightsDescription","When enabled, Access Insights will load extra geo/ISP data and may consume more memory.")})]}),e(_t,{isChecked:z,onChange:I=>le(I.target.checked),isDisabled:M.isLoading||g})]})}),e(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:s(xt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[s(P,{children:[e(Ys,{size:"sm",mb:1,children:t("settings.panel.defaultSubscriptionType","Default subscription link format")}),e(u,{fontSize:"sm",color:"gray.500",children:t("settings.panel.defaultSubscriptionTypeDescription","Choose which subscription link format is shown by default. All formats remain valid.")})]}),s(_,{maxW:{base:"full",md:"240px"},children:[e(D,{fontSize:"sm",mb:1,children:t("settings.panel.defaultSubscriptionTypeLabel","Default link format")}),s(at,{size:"sm",value:R,onChange:I=>K(I.target.value),isDisabled:M.isLoading||g,children:[e("option",{value:"username-key",children:t("settings.panel.link.usernameKey","username/key")}),e("option",{value:"key",children:t("settings.panel.link.keyOnly","key only")}),e("option",{value:"token",children:t("settings.panel.link.token","token")})]})]})]})}),s(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(xt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[s(P,{children:[e(Ys,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle")}),e(u,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription")})]}),e(V,{variant:"outline",size:"sm",leftIcon:e(gs,{width:16,height:16}),onClick:()=>b.refetch(),isLoading:b.isFetching,children:t("actions.refresh")})]}),e(we,{spacing:2,mt:4,children:b.isLoading&&!b.data?e(xt,{align:"center",justify:"center",py:4,children:e(zt,{size:"sm"})}):s(Wt,{children:[s(P,{children:[e(u,{fontWeight:"semibold",children:t("settings.panel.panelVersion")}),e(u,{fontSize:"sm",color:"gray.500",children:(L=(k=b.data)==null?void 0:k.panel)!=null&&L.image?`${b.data.panel.image}${b.data.panel.tag?` (${b.data.panel.tag})`:""}`:t("settings.panel.versionUnknown")})]}),s(P,{children:[e(u,{fontWeight:"semibold",children:t("settings.panel.nodeVersion")}),e(u,{fontSize:"sm",color:"gray.500",children:(te=b.data)!=null&&te.node?b.data.node.image?`${b.data.node.image}${b.data.node.tag?` (${b.data.node.tag})`:""}`:t("settings.panel.versionUnknown"):t("settings.panel.nodeVersionUnavailable")})]})]})}),s(we,{spacing:2,mt:4,children:[e(u,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceActionsDescription")}),S&&s(Tr,{status:"info",variant:"subtle",borderRadius:"md",children:[e(Mr,{}),e(u,{fontSize:"sm",children:S==="update"?t("settings.panel.updateInProgressHint"):S==="restart"?t("settings.panel.restartInProgressHint"):t("settings.panel.softReloadInProgressHint","Soft reloading panel...")})]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(V,{size:"sm",colorScheme:"yellow",leftIcon:e(uo,{width:16,height:16}),onClick:()=>Se.mutate(),isLoading:Se.isLoading,children:t("settings.panel.updateAction")}),e(V,{size:"sm",colorScheme:"blue",leftIcon:e(gs,{width:16,height:16}),onClick:()=>T.mutate(),isLoading:T.isLoading,children:t("settings.panel.softReloadAction","Soft Reload")}),e(V,{size:"sm",colorScheme:"red",leftIcon:e(lc,{width:16,height:16}),onClick:()=>ve.mutate(),isLoading:ve.isLoading,children:t("settings.panel.restartAction")})]})]})]}),s(xt,{gap:3,justify:"flex-end",children:[e(V,{variant:"outline",leftIcon:e(ul,{}),onClick:()=>v(),isDisabled:M.isLoading,children:t("actions.refresh")}),e(V,{colorScheme:"primary",leftIcon:e(hl,{}),onClick:()=>M.mutate({use_nobetci:w,access_insights_enabled:z,default_subscription_type:R}),isLoading:M.isLoading,isDisabled:M.isLoading||m===void 0||w===m.use_nobetci&&z===((Oe=m.access_insights_enabled)!=null?Oe:!1)&&R===((ne=m.default_subscription_type)!=null?ne:"key"),children:t("settings.save")})]})]})}),e(pr,{px:{base:0,md:2},children:h&&!c?e(xt,{align:"center",justify:"center",py:12,children:e(zt,{size:"lg"})}):e("form",{onSubmit:$(be),children:s(pe,{align:"stretch",spacing:6,children:[e(u,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description")}),s(xt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[s(P,{children:[e(Ys,{size:"sm",mb:1,children:t("settings.telegram.enableBot")}),e(u,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription")})]}),e(At,{control:q,name:"use_telegram",render:({field:I})=>e(_t,{isChecked:I.value,onChange:E=>I.onChange(E.target.checked)})})]}),e(Ja,{disabled:!Ie,message:me,children:e(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:s(Ve,{columns:{base:1,md:2},spacing:6,children:[s(_,{children:[e(D,{children:t("settings.telegram.apiToken")}),e(Ce,{placeholder:"123456:ABC",...F("api_token")})]}),s(_,{children:[e(D,{children:t("settings.telegram.proxyUrl")}),e(Ce,{placeholder:"socks5://user:pass@host:port",...F("proxy_url")})]}),s(_,{children:[e(D,{children:t("settings.telegram.adminChatIds")}),e(Ce,{placeholder:"12345, 67890",...F("admin_chat_ids")}),e(br,{children:t("settings.telegram.adminChatIdsHint")})]}),s(_,{children:[e(D,{children:t("settings.telegram.logsChatId")}),e(Ce,{placeholder:"-100123456789",...F("logs_chat_id")}),e(br,{children:t("settings.telegram.logsChatIdHint")})]}),s(_,{display:"flex",alignItems:"center",children:[e(D,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum")}),e(At,{control:q,name:"logs_chat_is_forum",render:({field:I})=>e(_t,{id:"logs_chat_is_forum",isChecked:I.value,onChange:I.onChange})})]}),s(_,{children:[e(D,{children:t("settings.telegram.defaultVlessFlow")}),e(Ce,{placeholder:"xtls-rprx-vision",...F("default_vless_flow")})]})]})})}),e(Ja,{disabled:!Ie,message:me,children:s(P,{children:[e(Ys,{size:"sm",mb:4,children:t("settings.telegram.forumTopics")}),ee&&Object.keys(ee).length>0?e(we,{spacing:4,children:Object.entries(ee).map(([I])=>s(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(u,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey"),": ",I]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(_,{children:[e(D,{children:t("settings.telegram.topicTitle")}),e(Ce,{...F(`forum_topics.${I}.title`)})]}),s(_,{children:[e(D,{children:t("settings.telegram.topicId")}),e(Ce,{type:"number",...F(`forum_topics.${I}.topic_id`)}),e(br,{children:t("settings.telegram.topicIdHint")})]})]})]},I))}):e(u,{color:"gray.500",children:t("settings.telegram.emptyTopics")})]})}),e(Ja,{disabled:!Ie,message:me,children:s(P,{children:[e(Ys,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle")}),e(u,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription")}),e(we,{spacing:4,children:ed.map(I=>s(P,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(u,{fontWeight:"semibold",mb:3,children:t(I.titleKey)}),e(Ve,{columns:{base:1,md:2},spacing:4,children:I.events.map(E=>s(_,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[s(P,{flex:"1",children:[e(u,{fontWeight:"medium",children:t(E.labelKey)}),e(u,{fontSize:"sm",color:"gray.500",children:t(E.hintKey)})]}),e(At,{control:q,name:`event_toggles.${oo(E.key)}`,render:({field:G})=>e(_t,{isChecked:Boolean(G.value),onChange:ze=>G.onChange(ze.target.checked)})})]},E.key))})]},I.key))})]})}),s(xt,{gap:3,justify:"flex-end",children:[e(V,{variant:"outline",leftIcon:e(ul,{}),onClick:()=>p(),isDisabled:se.isLoading,children:t("actions.refresh")}),e(V,{colorScheme:"primary",leftIcon:e(hl,{}),type:"submit",isLoading:se.isLoading,isDisabled:!Z&&!se.isLoading,children:t("settings.save")})]})]})})}),e(pr,{children:e(u,{color:"gray.500",children:t("settings.tabs.comingSoon")})})]})]})]}):s(pe,{spacing:4,align:"stretch",children:[e(Ys,{size:"lg",children:t("header.integrationSettings")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("integrations.noPermission")})]}):e(xt,{align:"center",justify:"center",py:12,children:e(zt,{size:"lg"})})},_g=ue(Ia,{baseStyle:{w:4,h:4}}),Fr=va.forwardRef(({disabled:t,step:n,label:r,className:o,startAdornment:a,endAdornment:i,type:l="text",placeholder:c,onChange:h,onBlur:p,name:m,value:g,onClick:v,error:b,clearable:S=!1,...f},w)=>{const W=()=>{h&&h({target:{value:"",name:m}})},{size:z="md"}=f,le=l==="number"?Bs:Ce,R=l==="number"?Hs:va.Fragment,K=l==="number"?{keepWithinRange:!0,precision:5,format:y=>Number.isNaN(parseFloat(String(y)))||Number(parseFloat(String(y)).toFixed(5))===0?y:Number(parseFloat(String(y)).toFixed(5)),min:typeof f.min=="number"?f.min:f.min!==void 0?Number(f.min):0,step:n,name:m,type:l,placeholder:c,onBlur:p,onClick:v,disabled:t,flexGrow:1,size:z,onChange:(y,ae)=>{!h||h({target:{value:y,valueAsNumber:ae,name:m}})}}:{};return s(_,{isInvalid:!!b,children:[r&&e(D,{children:r}),s(Ar,{size:z,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[a&&e(Su,{children:a}),s(R,{...K,children:[e(le,{name:m,ref:w,step:n,className:Sa(o),type:l,placeholder:c,onChange:l==="number"?void 0:h,onBlur:p,value:l==="number"?void 0:g,onClick:v,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...f,roundedLeft:a?"0":"md",roundedRight:i?"0":"md"}),l==="number"&&s(vu,{children:[e(wu,{}),e(ku,{})]})]}),i&&e(_u,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),S&&g&&g.length&&e(Vr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:W,cursor:"pointer",children:e(_g,{})})]}),!!b&&e(Ps,{children:b})]})}),Cg=ue(Yl,{baseStyle:{w:4,h:4}}),Ag=ue($i,{baseStyle:{w:4,h:4}}),Dg=({actions:t})=>{const{i18n:n}=je(),r=Fe("surface.light","surface.dark"),o=Fe("blackAlpha.50","whiteAlpha.100"),a=Fe("blackAlpha.200","whiteAlpha.200"),i=Fe("gray.800","gray.100"),l=h=>{n.changeLanguage(h)};return s(Oi,{placement:"bottom-end",children:[e(qn,{as:qe,size:"sm",variant:"outline",icon:e(Cg,{}),position:"relative"}),e(Ui,{minW:{base:"70vw",sm:"160px"},zIndex:9999,bg:r,borderColor:a,color:i,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u067E\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:h,label:p,flag:m})=>e(zr,{fontSize:"sm",onClick:()=>l(h),_hover:{bg:o},children:s(O,{justify:"space-between",w:"full",children:[s(O,{spacing:2,children:[h==="fa"?e(_c,{style:{width:"16px",height:"12px"}}):e(Gl,{countryCode:m,svg:!0,style:{width:"16px",height:"12px"}}),e(u,{children:p})]}),n.language===h&&e(Ag,{})]})},h))})]})},Ig=ye.object({username:ye.string().min(1,"login.fieldRequired"),password:ye.string().min(1,"login.fieldRequired")}),Pg=ue("img",{baseStyle:{w:12,h:12}}),Eg=ue(Cu,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),zg=ue(ln,{baseStyle:{w:4,h:4}}),Tg=ue(Jn,{baseStyle:{w:4,h:4}}),pl=()=>{var S,f;const[t,n]=d.exports.useState(""),[r,o]=d.exports.useState(!1),[a,i]=d.exports.useState(!1),l=Au(),{t:c}=je(),{colorMode:h}=fs(),p=co(),{register:m,formState:{errors:g},handleSubmit:v}=Es({resolver:Da(Ig)});d.exports.useEffect(()=>{eh(),p.pathname!=="/login"&&l("/login",{replace:!0})},[p.pathname,l]);const b=w=>{n("");const W=new FormData;W.append("username",w.username),W.append("password",w.password),W.append("grant_type","password"),o(!0),Ee("/admin/token",{method:"post",body:W}).then(({access_token:z})=>{console.log("Token received:",z),ju(z),l("/")}).catch(z=>{var le,R;n(((R=(le=z.response)==null?void 0:le._data)==null?void 0:R.detail)||"Login failed")}).finally(()=>o(!1))};return e(pe,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(jr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:s(Zs,{children:[s(O,{justifyContent:"end",spacing:2,mb:6,children:[e(Dg,{}),e(Ic,{minimal:!0})]}),s(pe,{alignItems:"center",w:"full",spacing:4,children:[e(Pg,{src:eo,alt:c("appName")||"Rebecca",filter:h==="dark"?"brightness(0) invert(1)":"none"}),e(u,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(u,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(P,{w:"full",pt:"4",children:e("form",{onSubmit:v(b),children:s(pe,{spacing:4,children:[e(_,{children:e(Fr,{w:"full",placeholder:c("username"),...m("username"),error:c((S=g==null?void 0:g.username)==null?void 0:S.message)})}),s(_,{isInvalid:!!g.password,children:[s(Ar,{children:[e(Ce,{w:"full",type:a?"text":"password",placeholder:c("password"),...m("password")}),e(Vr,{children:e(qe,{"aria-label":a?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>i(!a),icon:a?e(Tg,{}):e(zg,{})})})]}),e(Ps,{children:(f=g.password)==null?void 0:f.message})]}),t&&s(Tr,{status:"error",rounded:"md",children:[e(Mr,{}),e($s,{children:t})]}),s(V,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(Eg,{marginRight:1}),c("login")]})]})})})]})})})},ms=({title:t,children:n,headerActions:r,...o})=>{const a=Fe("gray.200","whiteAlpha.300"),i=Fe("white","blackAlpha.400"),l=Fe("sm","none");return s(P,{borderWidth:"1px",borderColor:a,borderRadius:"lg",bg:i,boxShadow:l,overflow:"hidden",...o,children:[(t||r)&&s(P,{px:{base:3,md:4},py:3,borderBottomWidth:"1px",borderBottomColor:a,display:"flex",justifyContent:"space-between",alignItems:"center",children:[t&&e(u,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t}),r&&e(P,{children:r})]}),e(P,{p:{base:3,md:4},children:n})]})},yo=d.exports.forwardRef((t,n)=>e(Du,{...t,ref:n}));yo.displayName="DatePicker";const Mg=ue(ja,{baseStyle:{w:4,h:4}}),Ng=({border:t,...n})=>{const{getInputProps:r,getRadioProps:o}=mc(n),a=Br({base:"xs",md:"sm"});return s(P,{as:"label",children:[e("input",{...r()}),e(P,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:a,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},kn=({value:t,onChange:n,presets:r=[{key:"24h",label:"24H",amount:24,unit:"hour"},{key:"7d",label:"7D",amount:7,unit:"day"},{key:"30d",label:"30D",amount:30,unit:"day"},{key:"90d",label:"90D",amount:90,unit:"day"}],defaultPreset:o="30d",showPresets:a=!0})=>{const{t:i,i18n:l}=je();fs();const{isOpen:c,onOpen:h,onClose:p}=sr(),m=d.exports.useRef(null);hc({ref:m,handler:p}),Br({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]});const g={h:"hour",d:"day",w:"week",m:"month",y:"year"},v=Br({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),[b,S]=d.exports.useState(0),[f,w]=d.exports.useState(t.start),[W,z]=d.exports.useState(t.end),[le,R]=d.exports.useState(t.presetKey||t.key||o),K=Br({base:1,md:2}),y=Br({base:"xs",md:"sm"});d.exports.useEffect(()=>{w(t.start),z(t.end),R(t.presetKey||t.key||o)},[t,o]);const ae=U=>{const Z=r.find(Ie=>Ie.key===U);if(!Z)return;const se=Z.unit==="hour"?"hour":"day",M=Ue().utc().endOf(se).toDate(),be=Math.max(Z.amount-1,0),ee=Ue().utc().subtract(be,Z.unit).startOf(se).toDate();R(U),n({start:ee,end:M,presetKey:U,key:U,unit:Z.unit}),p()},Se=U=>{const Z=Number(U.substring(0,U.length-1)),se=g[U[U.length-1]],M=se==="hour"?"hour":"day",be=Ue().utc().endOf(M).toDate(),ee=Math.max(Z-1,0),Ie=Ue().utc().subtract(ee,se).startOf(M).toDate();n({start:Ie,end:be,presetKey:"custom",key:"custom",unit:se}),p()},ve=U=>{const[Z,se]=U;if(W&&!se)w(null),z(null);else if(w(Z),z(se),Z&&se){const M=Ue(Z),be=Ue(se),[ee,Ie]=M.isBefore(be)?[M,be]:[be,M],me=ee.startOf("day").toDate(),J=Ie.endOf("day").toDate(),N=ee.isSame(Ie,"day");n({start:me,end:J,presetKey:"custom",key:"custom",unit:N?"hour":"day"}),p()}},{getRootProps:T,getRadioProps:F}=pc({name:"relative-filter",defaultValue:"",onChange:Se}),q=Ue(t.start).format("YYYY-MM-DD"),$=Ue(t.end).format("YYYY-MM-DD"),Q=q===$?q:`${q} - ${$}`;return t.start,t.end,t.presetKey||t.key,t.key||t.presetKey,t.unit,s(O,{spacing:2,flexWrap:"wrap",children:[a&&r.map(U=>e(V,{size:"sm",onClick:()=>ae(U.key),colorScheme:"primary",variant:le===U.key?"solid":"outline",children:U.label},U.key)),s(ei,{isOpen:c,onClose:p,placement:"auto-end",closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(ti,{children:e(V,{size:"sm",variant:"outline",leftIcon:e(Mg,{}),onClick:h,minW:{base:"200px",md:"240px"},maxW:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:Q})}),s(ri,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(qi,{}),e(si,{px:0,py:0,ref:m,children:s(dn,{onChange:U=>S(U),index:b,children:[s(un,{px:3,pt:3,children:[e(hr,{fontSize:y,children:i("userDialog.relative","Relative")}),e(hr,{fontSize:y,children:i("userDialog.absolute","Absolute")})]}),s(hn,{children:[e(pr,{px:3,pb:3,children:e(pe,{spacing:3,align:"stretch",children:v.map(U=>s(pe,{alignItems:"start",spacing:2,children:[e(u,{fontSize:y,fontWeight:"medium",minW:"60px",children:i(`userDialog.${U.title}`,U.title)}),e(Ve,{...T(),columns:U.options.length,gap:2,w:"full",children:U.options.map(Z=>e(Ng,{border:!0,...F({value:Z}),children:Z},Z))})]},U.title))})}),e(pr,{px:3,pb:3,className:"datepicker-panel",children:e(pe,{children:e(yo,{locale:l.language.toLocaleLowerCase(),selected:f,onChange:ve,startDate:f,endDate:W,selectsRange:!0,maxDate:new Date,monthsShown:K,peekNextMonth:!1,inline:!0})})})]})]})})]})]})]})},Lg=async t=>Ee("/myaccount",{query:t}),Rg=async(t,n)=>Ee(`/admin/${encodeURIComponent(t)}/usage/nodes`,{query:n}),Ug=async t=>Ee("/myaccount/change_password",{method:"POST",body:JSON.stringify(t)}),Og=async()=>Ee("/myaccount/api-keys"),Wg=async t=>Ee("/myaccount/api-keys",{method:"POST",body:JSON.stringify({lifetime:t})}),Fg=async(t,n)=>Ee(`/myaccount/api-keys/${t}`,{method:"DELETE",body:JSON.stringify({current_password:n})});Ue.extend(zn);const Hg=ue(mo,{baseStyle:{w:4,h:4}}),Bg=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,o=Ue.utc(r);return o.isValid()?n?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},Vg=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Ke(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Ke(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Kg=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Ke(Number(r)||0,2)}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),On=({label:t,value:n})=>s(Xl,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"surface.light",_dark:{bg:"surface.dark"},children:[e(Ql,{children:t}),e(Zl,{fontSize:"lg",children:n})]}),$g=({isOpen:t,onClose:n,onSubmit:r})=>{const{t:o}=je(),a=cr(),[i,l]=d.exports.useState(!1),[c,h]=d.exports.useState(!1),[p,m]=d.exports.useState(""),[g,v]=d.exports.useState(""),[b,S]=d.exports.useState(!1),f=d.exports.useCallback(z=>{var K;const le="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",R=le.length;if(typeof window<"u"&&((K=window.crypto)==null?void 0:K.getRandomValues)){const y=new Uint32Array(z);return window.crypto.getRandomValues(y),Array.from(y,ae=>le[ae%R]).join("")}return Array.from({length:z},()=>{const y=Math.floor(Math.random()*R);return le[y]}).join("")},[]),w=()=>{const z=f(12);v(z)},W=async()=>{S(!0);try{await r(p,g),a({title:o("myaccount.passwordUpdated"),status:"success"}),m(""),v(""),n()}catch(z){a({title:(z==null?void 0:z.detail)||o("error"),status:"error"})}finally{S(!1)}};return s(Gt,{isOpen:t,onClose:n,isCentered:!0,children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:o("myaccount.changePassword")}),e(Qt,{}),e(It,{children:s(pe,{spacing:4,align:"stretch",children:[e(P,{maxW:"420px",children:s(Ar,{children:[e(Ce,{placeholder:o("myaccount.currentPassword"),type:i?"text":"password",value:p,onChange:z=>m(z.target.value)}),e(Vr,{children:e(qe,{"aria-label":o(i?"admins.hidePassword":"admins.showPassword"),size:"sm",variant:"ghost",icon:i?e(Jn,{width:16}):e(ln,{width:16}),onClick:()=>l(!i)})})]})}),e(P,{maxW:"420px",children:s(O,{spacing:2,children:[s(Ar,{children:[e(Ce,{placeholder:o("myaccount.newPassword"),type:c?"text":"password",value:g,onChange:z=>v(z.target.value)}),e(Vr,{children:e(qe,{"aria-label":o(c?"admins.hidePassword":"admins.showPassword"),size:"sm",variant:"ghost",icon:c?e(Jn,{width:16}):e(ln,{width:16}),onClick:()=>h(!c)})})]}),e(qe,{"aria-label":o("admins.generatePassword"),size:"md",variant:"outline",icon:e(Cn,{width:20}),onClick:w})]})})]})}),s(Bt,{children:[e(V,{mr:3,onClick:n,variant:"ghost",children:o("cancel")}),e(V,{colorScheme:"primary",onClick:W,isLoading:b,isDisabled:!g,children:o("save")})]})]})]})},qg=()=>{var ze,Ne,Je,H,ke,Me,Be,ot;const{t}=je(),n=cr(),r=sr(),o=sr(),a=za(),{colorMode:i}=fs(),{userData:l}=Dr(),{onCopy:c,setValue:h}=Pa(""),[p,m]=d.exports.useState(()=>{const X=Ue().utc().endOf("day");return{start:X.subtract(30,"day").startOf("day").toDate(),end:X.toDate(),presetKey:"1m",key:"1m"}}),{data:g,isLoading:v,isFetching:b,refetch:S}=yr(["myaccount",p.start,p.end],()=>Lg({start:`${Ue(p.start).utc().format("YYYY-MM-DDTHH:mm:ss")}Z`,end:`${Ue(p.end).utc().format("YYYY-MM-DDTHH:mm:ss")}Z`}),{keepPreviousData:!0}),f=l==null?void 0:l.username,w=(l==null?void 0:l.role)===Ye.FullAccess,W=((ze=l==null?void 0:l.permissions)==null?void 0:ze.self_permissions)||{self_myaccount:!0,self_change_password:!0,self_api_keys:!0},z=w?{self_myaccount:!0,self_change_password:!0,self_api_keys:!0}:W,{data:le,isFetching:R}=yr(["myaccount-nodes",f,p.start,p.end],()=>f?Rg(f,{start:`${Ue(p.start).utc().format("YYYY-MM-DDTHH:mm:ss")}Z`,end:`${Ue(p.end).utc().format("YYYY-MM-DDTHH:mm:ss")}Z`}):Promise.resolve({usages:[]}),{keepPreviousData:!0,enabled:Boolean(f)}),K=vr(Ug,{onSuccess:()=>{a.invalidateQueries("myaccount")}}),y=yr(["myaccount-api-keys"],Og),ae=vr(Wg,{onSuccess:X=>{var Ae;a.invalidateQueries("myaccount-api-keys"),X!=null&&X.api_key&&h(X.api_key),n({title:t("myaccount.apiKeyCreated"),status:"success"}),q((Ae=X==null?void 0:X.api_key)!=null?Ae:"")}}),Se=vr(({id:X,current_password:Ae})=>Fg(X,Ae),{onSuccess:()=>{a.invalidateQueries("myaccount-api-keys"),n({title:t("myaccount.apiKeyDeleted"),status:"success"}),Q.onClose(),M(null),Z(""),ee(!1)}}),[ve,T]=d.exports.useState("1m"),[F,q]=d.exports.useState(""),$=Boolean(F),Q=sr(),[U,Z]=d.exports.useState(""),[se,M]=d.exports.useState(null),[be,ee]=d.exports.useState(!1),Ie=async(X,Ae)=>{await K.mutateAsync({current_password:X,new_password:Ae})},me=d.exports.useMemo(()=>{var X;return(X=g==null?void 0:g.daily_usage)!=null?X:[]},[g==null?void 0:g.daily_usage]),J=d.exports.useMemo(()=>me.reduce((X,Ae)=>X+Number(Ae.used_traffic||0),0),[me]),N=d.exports.useMemo(()=>me.map(X=>Bg(X.date)),[me]),B=d.exports.useMemo(()=>[{name:t("myaccount.dailyUsage","Daily usage"),data:me.map(X=>X.used_traffic)}],[me,t]),A=d.exports.useMemo(()=>{var Ae,xe;return((xe=(Ae=le==null?void 0:le.usages)!=null?Ae:g==null?void 0:g.node_usages)!=null?xe:[]).map($e=>{var Ze,Vt,ge,Te;return{node_id:(Ze=$e.node_id)!=null?Ze:null,node_name:$e.node_name||"Unknown",used_traffic:Number((Te=$e.used_traffic)!=null?Te:((Vt=$e.uplink)!=null?Vt:0)+((ge=$e.downlink)!=null?ge:0))}})},[le==null?void 0:le.usages,g==null?void 0:g.node_usages]),k=A.map(X=>X.node_name||"Unknown"),L=A.map(X=>X.used_traffic||0),te=d.exports.useMemo(()=>A.reduce((X,Ae)=>X+Number(Ae.used_traffic||0),0),[A]);if(v||!g)return e(xt,{justify:"center",align:"center",py:10,children:e(zt,{})});if(!z.self_myaccount)return s(pe,{spacing:3,align:"start",children:[e(u,{fontSize:"lg",fontWeight:"semibold",children:t("myaccount.forbiddenTitle")}),e(u,{color:"gray.500",_dark:{color:"gray.400"},children:t("myaccount.forbiddenDescription")})]});const Oe=g.used_traffic||0,ne=(Ne=g.data_limit)!=null?Ne:0,I=(Je=g.remaining_data)!=null?Je:Math.max(ne-Oe,0),E=(H=g.users_limit)!=null?H:0,G=(ke=g.remaining_users)!=null?ke:0;return s(pe,{spacing:4,align:"stretch",children:[s(O,{justify:"space-between",align:"center",children:[s(P,{children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("myaccount.title")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("myaccount.subtitle")})]}),b&&s(O,{spacing:2,children:[e(zt,{size:"sm"}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})]}),s(An,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)"},gap:4,children:[s(Jr,{children:[e(u,{fontWeight:"semibold",mb:2,children:t("myaccount.dataUsage")}),s(Ve,{columns:{base:1,sm:3},spacing:3,children:[e(On,{label:t("myaccount.usedData"),value:Ke(Oe,2)}),e(On,{label:t("myaccount.remainingData"),value:g.data_limit===null?t("myaccount.unlimited"):Ke(I,2)}),e(On,{label:t("myaccount.totalData"),value:g.data_limit===null?t("myaccount.unlimited"):Ke(ne,2)})]})]}),s(Jr,{children:[e(u,{fontWeight:"semibold",mb:2,children:t("myaccount.userLimits")}),s(Ve,{columns:{base:1,sm:3},spacing:3,children:[e(On,{label:t("myaccount.createdUsers"),value:`${g.current_users_count}`}),e(On,{label:t("myaccount.remainingUsers"),value:g.users_limit===null?t("myaccount.unlimited"):`${Math.max(G,0)}`}),e(On,{label:t("myaccount.totalUsers"),value:g.users_limit===null?t("myaccount.unlimited"):`${E}`})]})]})]}),s(An,{templateColumns:{base:"1fr",lg:"2fr 1fr"},gap:4,children:[e(Jr,{children:s(ms,{title:t("myaccount.dailyUsage"),headerActions:e(kn,{value:p,onChange:X=>{m(X)}}),minH:"500px",children:[s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mb:3,children:[t("nodes.totalUsage","Total usage"),":"," ",e(ue.span,{fontWeight:"semibold",children:Ke(J,2)})]}),B[0].data.length?e(ps,{options:Vg(i,N),series:B,type:"area",height:340}):e(u,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]})}),e(Jr,{children:s(ms,{title:t("myaccount.perNodeUsage"),minH:"500px",children:[s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mb:3,children:[t("nodes.totalUsage","Total usage"),":"," ",e(ue.span,{fontWeight:"semibold",children:Ke(te,2)})]}),A.length>0&&L.some(X=>X>0)?e(ps,{type:"donut",height:360,options:Kg(i,k),series:L}):e(u,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]})})]}),e(ms,{title:t("myaccount.apiKeys"),headerActions:e(V,{size:"sm",colorScheme:"primary",onClick:o.onOpen,children:t("myaccount.createApiKey")}),children:z.self_api_keys?y.isLoading?s(O,{children:[e(zt,{size:"sm"}),e(u,{children:t("loading")})]}):((Be=(Me=y.data)==null?void 0:Me.length)!=null?Be:0)===0?e(u,{color:"gray.500",_dark:{color:"gray.400"},children:t("myaccount.noApiKeys")}):s(Ks,{size:"sm",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:t("myaccount.apiKeyMasked")}),e(Xe,{children:t("createdAt")}),e(Xe,{children:t("expiresAt")}),e(Xe,{children:t("myaccount.lastUsed")}),e(Xe,{})]})}),e(as,{children:(ot=y.data)==null?void 0:ot.map(X=>{var Ae;return s(Lt,{children:[e(Le,{children:(Ae=X.masked_key)!=null?Ae:"****"}),e(Le,{children:X.created_at?Ue(X.created_at).format("YYYY-MM-DD HH:mm"):"-"}),e(Le,{children:X.expires_at?Ue(X.expires_at).format("YYYY-MM-DD"):t("myaccount.never")}),e(Le,{children:X.last_used_at?Ue(X.last_used_at).format("YYYY-MM-DD HH:mm"):t("myaccount.neverUsed")}),e(Le,{textAlign:"right",children:e(V,{size:"xs",colorScheme:"red",variant:"ghost",isLoading:Se.isLoading,onClick:()=>{M(X.id),Z(""),ee(!1),Q.onOpen()},children:t("delete")})})]},X.id)})})]}):e(u,{color:"gray.500",_dark:{color:"gray.400"},children:t("myaccount.apiKeysForbidden")})}),z.self_change_password&&s(ms,{title:t("myaccount.changePasswordCard"),children:[e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mb:3,children:t("myaccount.changePasswordHint")}),e(P,{maxW:"400px",children:e(V,{colorScheme:"primary",onClick:r.onOpen,w:"auto",children:t("myaccount.changePassword")})})]}),s(Gt,{isOpen:o.isOpen,onClose:()=>{o.onClose(),q("")},isCentered:!0,children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:t("myaccount.createApiKey")}),e(Qt,{}),e(It,{children:s(pe,{spacing:4,align:"stretch",children:[!$&&s(P,{children:[e(u,{fontWeight:"medium",mb:2,children:t("myaccount.apiKeyLifetime")}),s(at,{value:ve,onChange:X=>T(X.target.value),children:[e("option",{value:"1m",children:t("myaccount.lifetime1m")}),e("option",{value:"3m",children:t("myaccount.lifetime3m")}),e("option",{value:"6m",children:t("myaccount.lifetime6m")}),e("option",{value:"12m",children:t("myaccount.lifetime12m")}),e("option",{value:"forever",children:t("myaccount.lifetimeForever")})]})]}),$&&s(P,{children:[e(u,{fontWeight:"medium",mb:1,children:t("myaccount.yourApiKey")}),s(O,{children:[e(Ce,{value:F,isReadOnly:!0}),e(qe,{"aria-label":t("copy"),icon:e(Hg,{}),onClick:()=>{h(F),c(),n({title:t("copied"),status:"success",duration:1200})}})]}),e(u,{fontSize:"xs",color:"orange.500",mt:2,children:t("myaccount.apiKeyWarning")})]})]})}),e(Bt,{children:$?e(V,{colorScheme:"primary",onClick:()=>{o.onClose(),q("")},children:t("close")}):s(Wt,{children:[e(V,{variant:"ghost",mr:3,onClick:()=>{o.onClose(),q("")},children:t("cancel")}),e(V,{colorScheme:"primary",isLoading:ae.isLoading,onClick:()=>ae.mutate(ve),isDisabled:$,children:t("create")})]})})]})]}),e($g,{isOpen:r.isOpen,onClose:r.onClose,onSubmit:Ie}),s(Gt,{isOpen:Q.isOpen,onClose:()=>{Q.onClose(),M(null),Z(""),ee(!1)},isCentered:!0,children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:t("myaccount.deleteApiKey")}),e(Qt,{}),e(It,{children:s(pe,{spacing:3,align:"stretch",children:[e(u,{color:"gray.600",_dark:{color:"gray.300"},children:t("myaccount.deleteApiKeyPrompt")}),s(Ar,{children:[e(Ce,{placeholder:t("myaccount.currentPassword"),type:be?"text":"password",value:U,onChange:X=>Z(X.target.value)}),e(Vr,{children:e(qe,{"aria-label":t(be?"admins.hidePassword":"admins.showPassword"),size:"sm",variant:"ghost",icon:be?e(Jn,{width:16}):e(ln,{width:16}),onClick:()=>ee(!be)})})]}),Se.isError&&e(u,{color:"red.500",fontSize:"sm",children:t("myaccount.incorrectPassword")})]})}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:()=>{Q.onClose(),M(null),Z(""),ee(!1)},children:t("cancel")}),e(V,{colorScheme:"red",isLoading:Se.isLoading,isDisabled:!U||se===null,onClick:()=>{se!==null&&Se.mutate({id:se,current_password:U})},children:t("delete")})]})]})]})]})},Jg=10,Yg=({isOpen:t,title:n,description:r,currentVersion:o,allowPersist:a=!1,isSubmitting:i,onSubmit:l,onClose:c})=>{const{t:h}=je(),[p,m]=d.exports.useState(""),[g,v]=d.exports.useState(!1),[b,S]=d.exports.useState(null),f=yr(["core-xray-releases"],()=>Ee("/core/xray/releases",{query:{limit:Jg}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(m(o||""),v(!1),S(null))},[t,o]);const w=d.exports.useMemo(()=>{var K,y;return(y=(K=f.data)==null?void 0:K.tags)!=null?y:[]},[f.data]),W=K=>{m(K.target.value)},z=K=>{m(K.target.value)},le=async()=>{if(!p){S(h("validation.required"));return}try{S(null),await l({version:p,persist:a?g:void 0})}catch(K){K instanceof Error?S(K.message):S(h("core.generalErrorMessage"))}},R=f.isLoading;return s(Gt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:n}),e(Qt,{}),e(It,{children:s(we,{spacing:4,children:[r&&e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),s(_,{children:[e(D,{children:h("nodes.coreVersionDialog.latestReleases")}),e(at,{placeholder:h(R?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&w.includes(p)?p:"",onChange:W,isDisabled:R||w.length===0,size:"sm",children:w.map(K=>e("option",{value:K,children:K},K))}),R&&s(we,{direction:"row",align:"center",spacing:2,mt:2,children:[e(zt,{size:"sm"}),e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:h("nodes.coreVersionDialog.fetchingFromGithub")})]}),f.isError&&e(u,{fontSize:"xs",color:"red.500",mt:1,children:h("nodes.coreVersionDialog.failedToLoadReleases")})]}),s(_,{isRequired:!0,children:[e(D,{children:h("nodes.coreVersionDialog.customVersionLabel")}),e(Ce,{value:p,placeholder:h("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:z,size:"sm"}),e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:h("nodes.coreVersionDialog.customVersionHelper")})]}),a&&e(Yr,{isChecked:g,onChange:K=>v(K.target.checked),children:h("nodes.coreVersionDialog.persistExecutable")}),b&&s(Tr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Mr,{}),e($s,{children:b})]})]})}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:c,children:h("cancel")}),e(V,{colorScheme:"primary",onClick:le,isLoading:i,children:h("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},Gg=({deleteCallback:t})=>{const{deleteNode:n,deletingNode:r,setDeletingNode:o}=Gi(),{t:a}=je(),i=cr(),l=za(),c=()=>{o(null)},{isLoading:h,mutate:p}=vr(n,{onSuccess:()=>{gr(a("deleteNode.deleteSuccess",{name:r==null?void 0:r.name}),i),o(null),l.invalidateQueries(Zr),t==null||t()},onError:m=>{ir(m,i)},onSettled:()=>{o(null)}});return s(Gt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(En,{color:"red",children:e(Xi,{})})}),e(Qt,{mt:3}),s(It,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:a("deleteNode.title")}),r&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ea,{components:{b:e("b",{})},children:a("deleteNode.prompt",{name:r.name})})})]}),s(Bt,{display:"flex",children:[e(V,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(V,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:h?e(zt,{size:"xs"}):void 0,children:a("delete")})]})]})]})},ml="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Xg=ue(ic,{baseStyle:{w:3.5,h:3.5}}),Qg=ue(en,{baseStyle:{w:3.5,h:3.5}}),Zg=ue(gs,{baseStyle:{w:4,h:4}}),ki=(t,n)=>({id:typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${t||"geo-file"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,name:t,url:n}),jg=({isOpen:t,title:n,isSubmitting:r,showMasterOptions:o=!1,defaultTemplateIndexUrl:a,onSubmit:i,onClose:l})=>{const{t:c}=je(),[h,p]=d.exports.useState("template"),[m,g]=d.exports.useState(ml),[v,b]=d.exports.useState(""),[S,f]=d.exports.useState([ki("geoip.dat",""),ki("geosite.dat","")]),[w,W]=d.exports.useState(!0),[z,le]=d.exports.useState(!1),[R,K]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),g(a||ml),b(""),f([ki("geoip.dat",""),ki("geosite.dat","")]),W(!0),le(!1),K(null))},[t,a]);const y=yr(["geo-templates",m],()=>Ee("/core/geo/templates",{query:m?{index_url:m}:void 0}),{enabled:t&&h==="template"&&Boolean(m),staleTime:10*60*1e3}),ae=d.exports.useMemo(()=>{var Q,U;return(U=(Q=y.data)==null?void 0:Q.templates)!=null?U:[]},[y.data]);d.exports.useEffect(()=>{ae.length>0&&b(Q=>Q||ae[0].name)},[ae]);const Se=Fe("gray.50","whiteAlpha.50"),ve=()=>{f(Q=>[...Q,ki("","")])},T=(Q,U,Z)=>{f(se=>se.map((M,be)=>be===Q?{...M,[U]:Z}:M))},F=Q=>{f(U=>U.filter((Z,se)=>se!==Q))},q=async()=>{const Q=h==="manual"?S.filter(Z=>Z.name.trim()&&Z.url.trim()):[];if(h==="template"){if(!m.trim()){K(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!v){K(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(Q.length===0){K(c("nodes.geoDialog.errors.missingFiles"));return}if(Q.find(se=>!se.name.trim()||!se.url.trim())){K(c("nodes.geoDialog.errors.invalidFile"));return}}K(null);const U=h==="manual"?Q:[];try{await i({mode:h,templateIndexUrl:m.trim(),templateName:v,files:U,persistEnv:w,applyToNodes:z})}catch(Z){const se=Z instanceof Error?Z.message:c("nodes.geoDialog.genericError");K(se)}},$=()=>s(we,{spacing:3,bg:Se,p:4,borderRadius:"md",children:[S.map((Q,U)=>s(P,{borderWidth:"1px",borderRadius:"md",p:3,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(_,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(Ce,{size:"sm",value:Q.name,placeholder:"geosite.dat",onChange:Z=>T(U,"name",Z.target.value)})]}),s(_,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(Ce,{size:"sm",value:Q.url,placeholder:"https://example.com/geosite.dat",onChange:Z=>T(U,"url",Z.target.value)})]})]}),e(O,{justify:"flex-end",mt:3,children:e(kt,{label:c("nodes.geoDialog.removeFile"),children:e(qe,{"aria-label":"remove file",icon:e(Xg,{}),variant:"ghost",size:"sm",onClick:()=>F(U),isDisabled:S.length<=1})})})]},Q.id)),e(V,{onClick:ve,leftIcon:e(Qg,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return s(Gt,{isOpen:t,onClose:l,size:"xl",isCentered:!0,children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:n}),e(Qt,{}),e(It,{children:s(we,{spacing:4,children:[s(_,{as:"fieldset",children:[e(D,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(Fi,{value:h,onChange:Q=>p(Q),children:s(O,{spacing:4,children:[e(is,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(is,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),h==="template"?s(we,{spacing:3,children:[s(_,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(Ce,{size:"sm",value:m,onChange:Q=>g(Q.target.value)})]}),s(_,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),s(O,{align:"center",spacing:2,children:[e(at,{size:"sm",flex:1,value:v,onChange:Q=>b(Q.target.value),isDisabled:y.isLoading||!ae.length,placeholder:y.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:ae.map(Q=>e("option",{value:Q.name,children:Q.name},Q.name))}),e(kt,{label:c("nodes.geoDialog.refreshTemplates"),children:e(qe,{"aria-label":"refresh templates",icon:e(Zg,{}),size:"sm",variant:"outline",onClick:()=>y.refetch(),isLoading:y.isFetching,isDisabled:!m.trim()})})]})]}),y.isError&&s(Tr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Mr,{}),e($s,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):$(),o&&s(we,{spacing:2,children:[e(Yr,{isChecked:w,onChange:Q=>W(Q.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Yr,{isChecked:z,onChange:Q=>le(Q.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),R&&s(Tr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Mr,{}),e($s,{children:R})]})]})}),s(Bt,{children:[e(V,{variant:"ghost",mr:3,onClick:l,children:c("cancel")}),e(V,{colorScheme:"primary",onClick:q,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})},e0=ue(ln,{baseStyle:{w:4,h:4}}),t0=ue(Jn,{baseStyle:{w:4,h:4}}),r0=ue(gc,{baseStyle:{w:4,h:4}}),s0=ue(ho,{baseStyle:{w:4,h:4}}),gl=1024*1024*1024,n0=51031,Sn=t=>{if(t&&typeof t=="object"&&"message"in t){const n=t.message;return typeof n=="string"?n:void 0}},fl=({isOpen:t,onClose:n,node:r,mutate:o,isLoading:a,isAddMode:i=!1})=>{var F,q,$,Q,U,Z,se,M,be,ee,Ie,me,J,N,B,A;const{t:l}=je(),c=cr(),[h,p]=d.exports.useState(!1),{fetchNodesUsage:m}=Gi(),[g,v]=d.exports.useState(null),{data:b}=yr({queryKey:"panel-settings",queryFn:Ma,staleTime:5*60*1e3}),S=(F=b==null?void 0:b.use_nobetci)!=null?F:!0,f=d.exports.useCallback(k=>{if(k==null)return null;const L=k/gl;return Number.isFinite(L)?Math.round(L*100)/100:null},[]),w=k=>k==null?null:Math.round(k*gl),W=i?{...ra(),add_as_new_host:!1}:{...ra(),...r,add_as_new_host:!1},z=Es({resolver:Da(Sm),defaultValues:{...W,data_limit:f((q=W.data_limit)!=null?q:null)}}),le=!i&&(r==null?void 0:r.node_certificate)||"",{onCopy:R,hasCopied:K}=Pa(le),y=z.watch("use_nobetci");d.exports.useEffect(()=>{if(!S||!y){z.getValues("nobetci_port")!==null&&z.setValue("nobetci_port",null);return}const k=z.getValues("nobetci_port");(k==null||k==="")&&z.setValue("nobetci_port",n0)},[y,z,S]),d.exports.useEffect(()=>{b&&!b.use_nobetci&&(z.getValues("use_nobetci")&&z.setValue("use_nobetci",!1),z.getValues("nobetci_port")!==null&&z.setValue("nobetci_port",null))},[b,z]),d.exports.useEffect(()=>{var k;if(t){const L=i?{...ra(),add_as_new_host:!1}:{...ra(),...r,add_as_new_host:!1};z.reset({...L,data_limit:f((k=L.data_limit)!=null?k:null)}),p(!i&&!!(r!=null&&r.node_certificate))}},[t,i,r,z,f]),d.exports.useEffect(()=>{!i&&r&&t?m({start:Ue().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(k=>{const L=k.usages[r.id];L&&v({uplink:L.uplink,downlink:L.downlink})}):v(null)},[r,i,t,m]);const ae=z.handleSubmit(k=>{var te;const L={...k,data_limit:w((te=k.data_limit)!=null?te:null)};o(L)}),Se=()=>{!le||(R(),c({title:l("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},ve=()=>{if(!le)return;const k=new Blob([le],{type:"text/plain"}),L=URL.createObjectURL(k),te=document.createElement("a");te.href=L,te.download="node_certificate.pem",te.click(),URL.revokeObjectURL(L)},T=()=>{p(!1),v(null),n()};return s(Gt,{isOpen:t,onClose:T,size:"lg",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",as:"form",onSubmit:ae,children:[e(Tt,{pt:6,children:e(u,{fontWeight:"semibold",fontSize:"lg",children:l(i?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(Qt,{mt:3}),e(It,{children:s(we,{spacing:6,children:[!i&&g&&s(we,{spacing:2,children:[e(u,{fontWeight:"medium",children:l("nodes.usage")}),s(O,{children:[s(pt,{colorScheme:"green",children:[l("nodes.uplink"),":"," ",wn.sizeFormat(g.uplink)]}),s(pt,{colorScheme:"blue",children:[l("nodes.downlink"),":"," ",wn.sizeFormat(g.downlink)]})]})]}),!i&&le&&s(we,{spacing:3,children:[s(O,{justify:"space-between",align:"center",children:[e(u,{fontWeight:"medium",children:l("nodes.certificate")}),s(O,{spacing:2,children:[e(V,{size:"xs",variant:"outline",leftIcon:e(r0,{}),onClick:Se,children:l(K?"copied":"copy")}),e(V,{size:"xs",variant:"outline",leftIcon:e(s0,{}),onClick:ve,children:l("nodes.download-certificate")}),e(kt,{placement:"top",label:l(h?"nodes.hide-certificate":"nodes.show-certificate"),children:e(qe,{"aria-label":l(h?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(k=>!k),size:"xs",variant:"ghost",children:h?e(t0,{}):e(e0,{})})})]})]}),e($n,{in:h,animateOpacity:!0,children:e(P,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:le})})]}),s(we,{spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(_,{children:e(Fr,{label:l("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...z.register("name"),error:Sn((Q=($=z.formState)==null?void 0:$.errors)==null?void 0:Q.name)})}),e(_,{children:e(Fr,{label:l("nodes.nodeAddress"),size:"sm",placeholder:"192.168.1.1 or 2001:db8::1",...z.register("address"),error:Sn((Z=(U=z.formState)==null?void 0:U.errors)==null?void 0:Z.address)})})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(_,{children:e(Fr,{label:l("nodes.nodePort"),size:"sm",placeholder:"62050",...z.register("port"),error:Sn((M=(se=z.formState)==null?void 0:se.errors)==null?void 0:M.port)})}),e(_,{children:e(Fr,{label:l("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...z.register("api_port"),error:Sn((ee=(be=z.formState)==null?void 0:be.errors)==null?void 0:ee.api_port)})})]}),e(_,{children:e(Fr,{label:l("nodes.usageCoefficient"),size:"sm",placeholder:"1",...z.register("usage_coefficient"),error:Sn((me=(Ie=z.formState)==null?void 0:Ie.errors)==null?void 0:me.usage_coefficient)})}),s(_,{children:[e(Fr,{label:l("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:l("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...z.register("data_limit",{setValueAs:k=>{if(k===""||k===null||k===void 0)return null;const L=Number(k);return Number.isFinite(L)?L:Number.NaN},validate:k=>k==null?!0:Number.isNaN(k)?l("nodes.dataLimitValidation","Data limit must be a valid number"):k>=0||l("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:Sn((N=(J=z.formState)==null?void 0:J.errors)==null?void 0:N.data_limit)}),e(u,{fontSize:"xs",color:"gray.500",mt:1,children:l("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),S&&s(Wt,{children:[s(_,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:l("nodes.useNobetci","Enable Nobetci integration")}),e(At,{control:z.control,name:"use_nobetci",render:({field:k})=>e(_t,{isChecked:Boolean(k.value),onChange:L=>k.onChange(L.target.checked)})})]}),e($n,{in:Boolean(y),animateOpacity:!0,children:s(_,{mt:y?2:0,children:[e(Fr,{label:l("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...z.register("nobetci_port",{setValueAs:k=>{if(k===""||k===null||k===void 0)return null;const L=Number(k);return Number.isFinite(L)?L:Number.NaN},validate:k=>y?k==null?l("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(k)?l("nodes.nobetciPortInvalid","Enter a valid port number"):k>=1&&k<=65535?!0:l("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:Sn((A=(B=z.formState)==null?void 0:B.errors)==null?void 0:A.nobetci_port)}),e(u,{fontSize:"xs",color:"gray.500",mt:1,children:l("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),i&&e(P,{children:e(Yr,{...z.register("add_as_new_host"),children:l("nodes.addHostForEveryInbound")})})]})}),s(Bt,{gap:3,children:[e(V,{variant:"outline",onClick:T,children:l("cancel")}),e(V,{type:"submit",colorScheme:"primary",isLoading:a,children:l(i?"nodes.addNode":"nodes.editNode")})]})]})]})},Qi={baseStyle:{strokeWidth:"2px",w:4,h:4}},bl=ue(Iu,Qi),yl=ue(Pu,Qi),xl=ue(Eu,Qi),Sl=ue(fc,Qi),i0=ue(fc,Qi),td=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],_n={active:{statusColor:"green",bandWidthColor:"primary",icon:bl},connected:{statusColor:"green",bandWidthColor:"primary",icon:bl},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:yl},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Sl},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:i0},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Sl},limited:{statusColor:"red",bandWidthColor:"red",icon:xl},error:{statusColor:"red",bandWidthColor:"red",icon:xl},deleted:{statusColor:"gray",bandWidthColor:"gray",icon:yl}},Na=t=>{const n={status:"",time:""};if(t){Ue(t*1e3).utc().isAfter(Ue().utc())?n.status="expires":n.status="expired";const r=[],o=Ue.duration(Ue(t*1e3).utc().diff(Ue()));o.years()!==0&&r.push(Math.abs(o.years())+" year"+(Math.abs(o.years())!==1?"s":"")),o.months()!==0&&r.push(Math.abs(o.months())+" month"+(Math.abs(o.months())!==1?"s":"")),o.days()!==0&&r.push(Math.abs(o.days())+" day"+(Math.abs(o.days())!==1?"s":"")),r.length===0&&(o.hours()!==0&&r.push(Math.abs(o.hours())+" hour"+(Math.abs(o.hours())!==1?"s":"")),o.minutes()!==0&&r.push(Math.abs(o.minutes())+" min"+(Math.abs(o.minutes())!==1?"s":""))),n.time=r.join(", ")}return n},vl=({expiryDate:t,status:n,compact:r=!1,showDetail:o=!0,extraText:a})=>{const{t:i}=je(),l=Na(t),c=_n[n].icon;return s(Wt,{children:[s(fr,{colorScheme:_n[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),o&&s(u,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[n&&i(`nodeModal.status.${n}`),a&&`: ${a}`]})]}),o&&t&&e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(l.status,{time:l.time})})]})},_i=t=>t?t.trim().replace(/^v+/i,"").split(/[-_]/)[0].trim():"";Ue.extend(zn);const a0=ue(en,{baseStyle:{w:4,h:4}}),o0=ue(Vs,{baseStyle:{w:4,h:4}}),l0=ue(cn,{baseStyle:{w:4,h:4}}),wl=ue(gs,{baseStyle:{w:4,h:4}}),c0=ue(Aa,{baseStyle:{w:4,h:4}}),d0=ue(gc,{baseStyle:{w:4,h:4}}),u0=ue(ho,{baseStyle:{w:4,h:4}}),rd=1024**3,h0=t=>{if(t==null)return"";const n=t/rd;return Number.isFinite(n)?(Math.round(n*100)/100).toString():""},kl=t=>{const n=t.trim();if(!n)return null;const r=Number(n);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*rd)},p0=()=>{var mt,it,Nt,Or,Ws,Ms,ai,oi,li,ci,di,ui,hi,pi,xo,So,vo;const{t}=je(),{userData:n,getUserIsSuccess:r}=Dr(),o=r&&Boolean((mt=n.permissions)==null?void 0:mt.sections.nodes),{onEditingNodes:a}=Ot(),i=Ot(re=>re.isEditingNodes),{data:l,isLoading:c,error:h,refetch:p,isFetching:m}=fo({enabled:o}),{addNode:g,updateNode:v,regenerateNodeCertificate:b,reconnectNode:S,restartNodeService:f,updateNodeService:w,resetNodeUsage:W,updateMasterNode:z,resetMasterUsage:le,setDeletingNode:R}=Gi(),K=za(),y=cr(),[ae,Se]=d.exports.useState(null),[ve,T]=d.exports.useState(!1),[F,q]=d.exports.useState(""),[$,Q]=d.exports.useState(null),[U,Z]=d.exports.useState(null),[se,M]=d.exports.useState(null),[be,ee]=d.exports.useState(null),[Ie,me]=d.exports.useState(!1),[J,N]=d.exports.useState(!1),[B,A]=d.exports.useState(!1),[k,L]=d.exports.useState(null),[te,Oe]=d.exports.useState({}),[ne,I]=d.exports.useState(null),[E,G]=d.exports.useState(null),[ze,Ne]=d.exports.useState(null),[Je,H]=d.exports.useState(null),[ke,Me]=d.exports.useState(null),[Be,ot]=d.exports.useState(null),X=(it=Be==null?void 0:Be.certificate)!=null?it:"",{onCopy:Ae,hasCopied:xe}=Pa(X),{isOpen:$e,onOpen:Ze,onClose:Vt}=sr(),ge=d.exports.useRef(null),[Te,Re]=d.exports.useState(""),[ut,lt]=d.exports.useState(!1),{isOpen:Mt,onOpen:er,onClose:ie}=sr(),st=d.exports.useRef(null),{data:Qe,isLoading:Pt,refetch:Rt,error:Ft}=yr(["core-stats"],()=>Ee("/core"),{refetchOnWindowFocus:!1,enabled:o}),{data:We,isLoading:ce,error:Pe,refetch:fe}=yr(["master-node-state"],()=>Ee("/node/master"),{refetchInterval:o&&i?3e3:void 0,refetchOnWindowFocus:!1,enabled:o}),dt=yr({queryKey:["node-latest-release"],queryFn:async()=>{const re=await window.fetch("https://api.github.com/repos/rebeccapanel/Rebecca-node/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!re.ok)throw new Error("Failed to load latest node release");return re.json()},refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:1,enabled:o});d.exports.useEffect(()=>{if(!o){a(!1);return}return a(!0),()=>{a(!1)}},[o,a]),d.exports.useEffect(()=>{var wt,ct;if(!We)return;if(ut){const Jt=kl(Te),nr=(wt=We.data_limit)!=null?wt:null;if(Jt!==nr)return}const re=h0((ct=We.data_limit)!=null?ct:null);Re(re),ut&&lt(!1)},[We,ut,Te]);const yt=d.exports.useMemo(()=>{var re,wt;return(wt=(re=l==null?void 0:l.find(ct=>ct.node_service_version))==null?void 0:re.node_service_version)!=null?wt:""},[l]),Kt=((Nt=dt.data)==null?void 0:Nt.tag_name)||((Or=dt.data)==null?void 0:Or.name)||"",$t=_i(Kt)&&_i(yt)&&_i(Kt)!==_i(yt),{isLoading:Ut,mutate:ft}=vr(g,{onSuccess:re=>{gr(t("nodes.addNodeSuccess"),y),K.invalidateQueries(Zr),p(),T(!1),re!=null&&re.node_certificate&&ot({certificate:re.node_certificate,name:re.name})},onError:re=>{ir(re,y)},onSettled:()=>{T(!1)}}),{isLoading:et,mutate:he}=vr(v,{onSuccess:()=>{gr(t("nodes.nodeUpdated"),y),K.invalidateQueries(Zr),p(),Se(null)},onError:re=>{ir(re,y)},onSettled:()=>{Se(null)}}),{mutate:De,isLoading:tt}=vr(b,{onMutate:re=>{var wt;Ne((wt=re.id)!=null?wt:null)},onSuccess:re=>{gr(t("nodes.regenerateCertSuccess","New certificate generated"),y),K.invalidateQueries(Zr),re!=null&&re.node_certificate&&ot({certificate:re.node_certificate,name:re.name}),Se(re)},onError:re=>{ir(re,y)},onSettled:()=>{Ne(null)}}),{isLoading:tr,mutate:xr}=vr(S,{onSuccess:()=>{K.invalidateQueries(Zr)}}),{mutate:es,isLoading:bs}=vr(v,{onSuccess:()=>{K.invalidateQueries(Zr)},onError:re=>{ir(re,y)},onSettled:(re,wt,ct)=>{(ct==null?void 0:ct.id)!=null&&Oe(Jt=>{const nr={...Jt};return delete nr[ct.id],nr}),L(null)}}),{isLoading:os,mutate:ys}=vr(W,{onSuccess:()=>{gr(t("nodes.resetUsageSuccess","Node usage reset"),y),K.invalidateQueries(Zr)},onError:re=>{ir(re,y)},onSettled:()=>{I(null),G(null),Vt()}}),{mutate:xs,isLoading:Ss}=vr(f,{onMutate:re=>{var wt;H((wt=re.id)!=null?wt:null)},onSuccess:()=>{gr(t("nodes.restartServiceTriggered","Node restart requested"),y),K.invalidateQueries(Zr)},onError:re=>{ir(re,y)},onSettled:()=>{H(null)}}),{mutate:vs,isLoading:ws}=vr(w,{onMutate:re=>{var wt;Me((wt=re.id)!=null?wt:null)},onSuccess:()=>{gr(t("nodes.updateServiceTriggered","Node update requested"),y),K.invalidateQueries(Zr)},onError:re=>{ir(re,y)},onSettled:()=>{Me(null)}}),{isLoading:Gr,mutate:ls}=vr(z,{onSuccess:()=>{gr(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),y),fe(),lt(!1)},onError:re=>{ir(re,y)}}),{isLoading:ar,mutate:j}=vr(le,{onSuccess:()=>{gr(t("nodes.resetMasterUsageSuccess","Master usage reset"),y),fe(),ie()},onError:re=>{ir(re,y)}}),He=d.exports.useMemo(()=>kl(Te),[Te]),ht=(Ws=We==null?void 0:We.data_limit)!=null?Ws:null,St=He===void 0,Ht=He!==void 0&&He!==ht,Sr=Pt||ce,Kr=d.exports.useMemo(()=>{if(Ft instanceof Error)return Ft.message;if(typeof Ft=="string")return Ft;if(Pe instanceof Error)return Pe.message;if(typeof Pe=="string")return Pe},[Ft,Pe]),ks=(Ms=We==null?void 0:We.total_usage)!=null?Ms:0,Lr=(ai=We==null?void 0:We.data_limit)!=null?ai:null,Rr=(oi=We==null?void 0:We.remaining_data)!=null?oi:null,dr=We!=null&&We.updated_at?Ue(We.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Ur=(li=We==null?void 0:We.status)!=null?li:"error",cs=Ke(ks,2),_s=Lr!==null&&Lr>0?Ke(Lr,2):t("nodes.unlimited","Unlimited"),$r=Rr!=null?Ke(Rr,2):null,ts=re=>{lt(!0),Re(re)},Cs=()=>{if(St||He===void 0){ir(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),y);return}ls({data_limit:He!=null?He:null})},zs=()=>{lt(!0),Re(""),ls({data_limit:null})},Ts=()=>{er()},rs=re=>{if(!(re!=null&&re.id))return;const wt=re.status!=="disabled",ct=wt?"disabled":"connecting",Jt=re.id;L(Jt),Oe(nr=>({...nr,[Jt]:!wt})),es({...re,status:ct})},As=re=>{!(re!=null&&re.id)||(G(re),Ze())},Ir=re=>{if(!(re!=null&&re.id))return;const wt=re.name||re.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:wt}))||xs(re)},_e=re=>{if(!(re!=null&&re.id))return;const wt=re.name||re.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:wt}))||vs(re)},Ds=()=>{!(E!=null&&E.id)||(I(E.id),ys(E))},vt=()=>{G(null),Vt()},or=()=>Q(null),Ct=()=>Z(null),mr=async({version:re,persist:wt})=>{var ct;if(!!$){if($.type==="master"){me(!0);try{await Ee("/core/xray/update",{method:"POST",body:{version:re,persist_env:Boolean(wt)}}),gr(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:re}),y),await Promise.all([Rt(),K.invalidateQueries(Zr)]),or()}catch(Jt){ir(Jt,y)}finally{me(!1)}return}if($.type==="bulk"){const Jt=(l!=null?l:[]).filter(nr=>nr.id!=null&&nr.status==="connected");if(Jt.length===0){y({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}N(!0);try{const nr=[];for(const yn of Jt)try{await Ee(`/node/${yn.id}/xray/update`,{method:"POST",body:{version:re}}),nr.push({status:"fulfilled",node:yn})}catch(La){nr.push({status:"rejected",node:yn}),ir(La,y)}const tn=nr.filter(yn=>yn.status==="fulfilled").length,fn=nr.length-tn,bn=nr.length;tn>0&&gr(t("nodes.coreVersionDialog.bulkSuccess",{success:tn,total:bn}),y),fn>0&&y({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:fn,total:bn}),status:"error",isClosable:!0,position:"top",duration:4e3}),K.invalidateQueries(Zr),or()}finally{N(!1)}return}if($.type==="node"){const Jt=$.node;if(!(Jt!=null&&Jt.id))return;M(Jt.id);try{await Ee(`/node/${Jt.id}/xray/update`,{method:"POST",body:{version:re}}),gr(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(ct=Jt.name)!=null?ct:t("nodes.unnamedNode","Unnamed node"),version:re}),y),K.invalidateQueries(Zr),or()}catch(nr){ir(nr,y)}finally{M(null)}}}},qt=async re=>{var ct;if(!U)return;const wt={mode:re.mode,template_index_url:re.templateIndexUrl,template_name:re.templateName,files:re.files,persist_env:re.persistEnv};if(U.type==="master"){A(!0);try{await Ee("/core/geo/update",{method:"POST",body:wt}),gr(t("nodes.geoDialog.masterUpdateSuccess"),y),Ct()}catch(Jt){ir(Jt,y)}finally{A(!1)}return}if(U.type==="node"){const Jt=U.node;if(!(Jt!=null&&Jt.id))return;ee(Jt.id);try{await Ee(`/node/${Jt.id}/geo/update`,{method:"POST",body:wt}),gr(t("nodes.geoDialog.nodeUpdateSuccess",{name:(ct=Jt.name)!=null?ct:t("nodes.unnamedNode","Unnamed node")}),y),K.invalidateQueries(Zr),Ct()}catch(nr){ir(nr,y)}finally{ee(null)}}},jt=d.exports.useMemo(()=>{if(!l)return[];const re=F.trim().toLowerCase();return re?l.filter(wt=>{var tn,fn,bn;const ct=((tn=wt.name)!=null?tn:"").toLowerCase(),Jt=((fn=wt.address)!=null?fn:"").toLowerCase(),nr=((bn=wt.xray_version)!=null?bn:"").toLowerCase();return ct.includes(re)||Jt.includes(re)||nr.includes(re)}):l},[l,F]),wr=d.exports.useMemo(()=>(l!=null?l:[]).some(re=>re.id!=null&&re.status==="connected"),[l]),ss=d.exports.useMemo(()=>{if(!!h){if(h instanceof Error)return h.message;if(typeof h=="string")return h;if(typeof h=="object"&&"message"in h){const re=h.message;if(typeof re=="string")return re}return t("errorOccurred")}},[h,t]),Os=Boolean(ss),qs=t("nodes.masterNode","Master"),Js=F.trim().toLowerCase(),pn=!Js||qs.toLowerCase().includes(Js)||((ci=Qe==null?void 0:Qe.version)!=null?ci:"").toLowerCase().includes(Js),mn=($==null?void 0:$.type)==="master"?Ie:($==null?void 0:$.type)==="node"?$.node.id!=null&&se===$.node.id:($==null?void 0:$.type)==="bulk"?J:!1,gn=(U==null?void 0:U.type)==="master"?B:(U==null?void 0:U.type)==="node"?U.node.id!=null&&be===U.node.id:!1,x=($==null?void 0:$.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):($==null?void 0:$.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):($==null?void 0:$.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(di=$.node.name)!=null?di:t("nodes.unnamedNode","Unnamed node")}):"",C=($==null?void 0:$.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):($==null?void 0:$.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):($==null?void 0:$.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(ui=$.node.name)!=null?ui:t("nodes.unnamedNode","Unnamed node")}):"",Y=($==null?void 0:$.type)==="master"?(hi=Qe==null?void 0:Qe.version)!=null?hi:"":($==null?void 0:$.type)==="node"&&(pi=$.node.xray_version)!=null?pi:"",Ge=(U==null?void 0:U.type)==="master"?t("nodes.geoDialog.masterTitle"):(U==null?void 0:U.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(xo=U.node.name)!=null?xo:t("nodes.unnamedNode","Unnamed node")}):"";return r?o?s(pe,{spacing:6,align:"stretch",children:[s(we,{spacing:1,children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")}),s(O,{spacing:2,flexWrap:"wrap",pt:1,children:[yt?e(pt,{size:"sm",colorScheme:"gray",children:t("nodes.nodeServiceVersionTag",{version:yt})}):e(pt,{size:"sm",colorScheme:"gray",children:t("nodes.nodeServiceVersionUnknown","Node version unknown")}),Kt?e(pt,{size:"sm",colorScheme:"blue",children:t("nodes.latestNodeVersionTag",{version:_i(Kt)})}):null,$t&&e(pt,{size:"sm",colorScheme:"green",children:t("nodes.nodeUpdateAvailable","Update available")})]})]}),Os&&s(Tr,{status:"error",borderRadius:"md",children:[e(Mr,{}),e($s,{children:ss})]}),s(we,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(u,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),s(we,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[s(O,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[s(Ar,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Ca,{pointerEvents:"none",children:e(c0,{color:"gray.400"})}),e(Ce,{value:F,onChange:re=>q(re.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(kt,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(qe,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(wl,{}),variant:"ghost",size:"sm",onClick:()=>p(),isLoading:m})})]}),s(we,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(V,{variant:"outline",size:"sm",onClick:()=>Q({type:"bulk"}),isDisabled:!wr,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(V,{leftIcon:e(a0,{}),colorScheme:"primary",size:"sm",onClick:()=>T(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),c?e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3},(re,wt)=>`nodes-skeleton-${wt}`).map(re=>e(P,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:s(pe,{spacing:3,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},re))}):s(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:[pn&&e(P,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:Sr?s(pe,{spacing:3,align:"center",justify:"center",children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Kr?s(pe,{spacing:3,align:"stretch",children:[e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Kr}),e(V,{size:"sm",variant:"outline",onClick:()=>{Rt(),fe()},children:t("refresh","Refresh")})]}):We?s(pe,{align:"stretch",spacing:4,children:[s(we,{spacing:2,children:[s(O,{spacing:3,align:"center",flexWrap:"wrap",children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:qs}),e(pt,{colorScheme:"purple",size:"sm",children:Qe!=null&&Qe.version?`Xray ${Qe.version}`:t("nodes.versionUnknown","Version unknown")})]}),s(O,{spacing:2,align:"center",children:[e(vl,{status:Ur,compact:!0}),We.limit_exceeded&&e(pt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Qe!=null&&Qe.started?t("nodes.masterStartedAt",{date:Ue(Qe.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),We.message&&s(Tr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(Mr,{}),e($s,{fontSize:"sm",children:We.message})]}),e(nn,{}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(u,{fontWeight:"medium",children:cs})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(u,{fontWeight:"medium",children:_s})]}),$r&&s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(u,{fontWeight:"medium",children:$r})]}),dr&&s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(u,{fontWeight:"medium",children:dr})]})]}),s(we,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[s(Ar,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(Ce,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:Te,onChange:re=>ts(re.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Vr,{pointerEvents:"none",children:e(u,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(V,{colorScheme:"primary",size:"sm",onClick:Cs,isDisabled:!Ht||St||Gr,isLoading:Gr,children:t("save","Save")}),e(V,{variant:"ghost",size:"sm",onClick:zs,isDisabled:Lr===null||Gr,isLoading:Gr&&Lr===null,children:t("nodes.clearDataLimit","Clear limit")})]}),St&&e(u,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),s(we,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",children:[e(V,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>Q({type:"master"}),isLoading:Ie,flex:{base:"1",sm:"0 1 auto"},minW:{base:"full",sm:"auto"},whiteSpace:"normal",wordBreak:"break-word",children:t("nodes.coreVersionDialog.updateMasterButton")}),e(V,{size:"sm",variant:"outline",onClick:()=>Z({type:"master"}),isLoading:B,flex:{base:"1",sm:"0 1 auto"},minW:{base:"full",sm:"auto"},whiteSpace:"normal",wordBreak:"break-word",children:t("nodes.geoDialog.updateMasterButton")}),e(V,{size:"sm",variant:"outline",colorScheme:"red",onClick:Ts,isLoading:ar,flex:{base:"1",sm:"0 1 auto"},minW:{base:"full",sm:"auto"},whiteSpace:"normal",wordBreak:"break-word",children:t("nodes.resetUsage","Reset usage")})]})]}):s(pe,{spacing:3,align:"stretch",children:[e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(V,{size:"sm",variant:"outline",onClick:()=>{Rt(),fe()},children:t("refresh","Refresh")})]})},"master-node"),jt.length>0?jt.map(re=>{var ko,_o,Co,Ao;const wt=re.status||"error",ct=re==null?void 0:re.id,Jt=wt!=="disabled"&&wt!=="limited",nr=ct!=null?te[ct]:void 0,tn=nr!=null?nr:Jt,fn=ct!=null&&k===ct&&bs,bn=ct!=null&&se===ct,yn=ct!=null&&be===ct,La=Ss&&ct!=null&&Je===ct,nd=ws&&ct!=null&&ke===ct,wo=e(vl,{status:wt,compact:!0}),id=wt==="error"&&re.message?e(kt,{label:re.message,hasArrow:!0,placement:"top",openDelay:300,children:e(P,{as:"span",children:wo})}):wo;return e(P,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:s(pe,{align:"stretch",spacing:4,children:[s(we,{spacing:2,children:[s(O,{spacing:3,align:"center",flexWrap:"wrap",children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:re.name||t("nodes.unnamedNode","Unnamed node")}),e(_t,{size:"sm",colorScheme:"primary",isChecked:tn,onChange:()=>rs(re),isDisabled:fn,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),re.status==="error"&&e(V,{size:"sm",variant:"outline",leftIcon:e(wl,{}),onClick:()=>xr(re),isLoading:tr,children:t("nodes.reconnect")})]}),s(O,{spacing:2,flexWrap:"wrap",children:[id,s(O,{spacing:1,align:"center",children:[e(pt,{colorScheme:"blue",size:"sm",children:re.xray_version?`Xray ${re.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(pt,{colorScheme:"green",size:"sm",children:re.node_service_version?t("nodes.nodeServiceVersionTag",{version:re.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(V,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>ct&&Q({type:"node",node:re}),isLoading:bn,isDisabled:!ct,children:t("nodes.updateCoreAction")})]}),e(V,{size:"xs",variant:"ghost",onClick:()=>ct&&Z({type:"node",node:re}),isLoading:yn,isDisabled:!ct,children:t("nodes.updateGeoAction","Update geo")}),e(V,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>Ir(re),isLoading:La,isDisabled:!ct,children:t("nodes.restartServiceAction","Restart node service")}),e(V,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>_e(re),isLoading:nd,isDisabled:!ct,children:t("nodes.updateServiceAction","Update node service")}),e(V,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>As(re),isLoading:os&&ct!=null&&ne===ct,isDisabled:!ct,children:t("nodes.resetUsage","Reset usage")})]}),wt==="limited"&&e(u,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")}),re.uses_default_certificate&&s(Tr,{status:"warning",borderRadius:"md",alignItems:"flex-start",gap:3,textAlign:"start",children:[e(Mr,{mt:.5}),s(P,{children:[e(u,{fontWeight:"semibold",fontSize:"sm",lineHeight:"short",children:t("nodes.legacyCertCardTitle","Legacy shared certificate in use")}),e(u,{fontSize:"xs",lineHeight:"short",children:t("nodes.legacyCertCardDesc","Generate a private certificate for this node and reinstall it on the node host.")}),e(V,{size:"xs",mt:2,colorScheme:"primary",onClick:()=>ct&&De(re),isLoading:tt&&ct!=null&&ze===ct,isDisabled:!ct,alignSelf:"flex-start",children:t("nodes.generatePrivateCert","Generate private certificate")})]})]})]}),e(nn,{}),s(Ve,{columns:{base:1,sm:2},spacingY:2,children:[s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(u,{fontWeight:"medium",children:re.address})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(u,{fontWeight:"medium",children:re.port})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(u,{fontWeight:"medium",children:re.api_port})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(u,{fontWeight:"medium",children:re.usage_coefficient})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(u,{fontWeight:"medium",children:Ke(((ko=re.uplink)!=null?ko:0)+((_o=re.downlink)!=null?_o:0),2)})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(u,{fontWeight:"medium",children:re.data_limit!=null&&re.data_limit>0?Ke(re.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(nn,{}),s(O,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[s(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(Co=re.id)!=null?Co:"-"]}),s(nc,{size:"sm",variant:"ghost",children:[e(qe,{"aria-label":t("edit"),icon:e(l0,{}),onClick:()=>Se(re)}),e(qe,{"aria-label":t("delete"),icon:e(o0,{}),colorScheme:"red",onClick:()=>R(re)})]})]})]})},(Ao=re.id)!=null?Ao:re.name)}):e(P,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Yg,{isOpen:Boolean($),onClose:or,onSubmit:mr,currentVersion:Y,title:x,description:C,allowPersist:($==null?void 0:$.type)==="master",isSubmitting:mn}),e(jg,{isOpen:Boolean(U),onClose:Ct,onSubmit:qt,title:Ge,showMasterOptions:(U==null?void 0:U.type)==="master",isSubmitting:gn}),e(Yn,{isOpen:$e,leastDestructiveRef:ge,onClose:vt,children:e(Dt,{children:s(Gn,{children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(It,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(vo=(So=E==null?void 0:E.name)!=null?So:E==null?void 0:E.address)!=null?vo:t("nodes.thisNode","this node")})}),s(Bt,{children:[e(V,{ref:ge,onClick:vt,children:t("cancel","Cancel")}),e(V,{colorScheme:"red",onClick:Ds,ml:3,isLoading:os,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Yn,{isOpen:Mt,leastDestructiveRef:st,onClose:ie,children:e(Dt,{children:s(Gn,{children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(It,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:qs})}),s(Bt,{children:[e(V,{ref:st,onClick:ie,children:t("cancel","Cancel")}),e(V,{colorScheme:"red",onClick:()=>j(),ml:3,isLoading:ar,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(fl,{isOpen:ve,onClose:()=>T(!1),mutate:ft,isLoading:Ut,isAddMode:!0}),e(fl,{isOpen:!!ae,onClose:()=>Se(null),node:ae||void 0,mutate:he,isLoading:et}),Be&&s(Gt,{isOpen:!0,onClose:()=>ot(null),size:"md",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:t("nodes.newNodePublicKeyTitle")}),e(Qt,{}),e(It,{children:s(pe,{align:"stretch",spacing:4,children:[e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.newNodePublicKeyDesc")}),s(P,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[s(O,{justify:"space-between",align:"center",px:4,py:3,bg:"gray.50",_dark:{bg:"gray.800"},children:[s(pe,{align:"flex-start",spacing:0,children:[e(u,{fontWeight:"semibold",children:t("nodes.certificateLabel")}),Be.name&&e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:Be.name})]}),s(O,{spacing:2,children:[e(V,{size:"sm",variant:"outline",leftIcon:e(d0,{}),onClick:()=>{!X||(Ae(),y({title:t("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},isDisabled:!X,children:t(xe?"copied":"copy")}),e(V,{size:"sm",variant:"outline",leftIcon:e(u0,{}),onClick:()=>{if(!X)return;const re=new Blob([X],{type:"text/plain"}),wt=URL.createObjectURL(re),ct=document.createElement("a");ct.href=wt,ct.download="node_certificate.pem",ct.click(),URL.revokeObjectURL(wt)},isDisabled:!X,children:t("nodes.download-node-certificate")})]})]}),e(P,{px:4,py:3,bg:"white",_dark:{bg:"gray.900"},fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",wordBreak:"break-word",maxH:"280px",overflow:"auto",children:X})]})]})}),e(Bt,{children:e(V,{onClick:()=>ot(null),colorScheme:"primary",children:t("close","Close")})})]})]}),e(Gg,{deleteCallback:()=>K.invalidateQueries(Zr)})]}):s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("nodes.title","Nodes")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.noPermission","You do not have permission to manage nodes.")})]}):e(pe,{spacing:4,align:"center",py:10,children:e(zt,{size:"lg"})})},la="__no_service__",m0=({isOpen:t,onClose:n,onSubmit:r,isSaving:o,allHosts:a,allAdmins:i,initialService:l})=>{var be,ee,Ie,me,J;const{t:c}=je(),[h,p]=d.exports.useState((be=l==null?void 0:l.name)!=null?be:""),[m,g]=d.exports.useState((ee=l==null?void 0:l.description)!=null?ee:""),[v,b]=d.exports.useState((Ie=l==null?void 0:l.flow)!=null?Ie:""),[S,f]=d.exports.useState((me=l==null?void 0:l.admin_ids)!=null?me:[]),[w,W]=d.exports.useState((J=l==null?void 0:l.hosts.map(N=>N.id))!=null?J:[]),[z,le]=d.exports.useState(""),[R,K]=d.exports.useState(""),[y,ae]=d.exports.useState(null),Se=cr();d.exports.useEffect(()=>{var N,B,A,k,L;t&&(p((N=l==null?void 0:l.name)!=null?N:""),g((B=l==null?void 0:l.description)!=null?B:""),b((A=l==null?void 0:l.flow)!=null?A:""),f((k=l==null?void 0:l.admin_ids)!=null?k:[]),W((L=l==null?void 0:l.hosts.map(te=>te.id))!=null?L:[]),le(""),K(""))},[t,l]);const ve=d.exports.useMemo(()=>new Map(a.map(N=>[N.id,N])),[a]),T=d.exports.useMemo(()=>a.filter(N=>!w.includes(N.id)&&!N.isDisabled),[a,w]),F=d.exports.useMemo(()=>{const N=R.trim().toLowerCase();return N?T.filter(B=>{const A=B.label.toLowerCase(),k=B.inboundTag.toLowerCase(),L=B.protocol.toLowerCase();return A.includes(N)||k.includes(N)||L.includes(N)}):T},[T,R]),q=d.exports.useMemo(()=>{const N=z.trim().toLowerCase();return N?i.filter(B=>B.username.toLowerCase().includes(N)):i},[z,i]),$=d.exports.useMemo(()=>new Set(S),[S]),Q=()=>{const N=S.length===i.length&&i.length>0;f(N?[]:i.map(B=>B.id))},U=N=>{f(B=>B.includes(N)?B.filter(A=>A!==N):[...B,N])},Z=N=>{W(B=>B.includes(N)?B.filter(A=>A!==N):[...B,N])},se=(N,B)=>{W(A=>{const k=A.indexOf(N);if(k===-1)return A;const L=B==="up"?k-1:k+1;if(L<0||L>=A.length)return A;const te=[...A];return[te[k],te[L]]=[te[L],te[k]],te})},M=async()=>{if(!h.trim()){Se({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!w.length){Se({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const N=w.map((B,A)=>({host_id:B,sort:A}));await r({name:h.trim(),description:(m==null?void 0:m.trim())||null,flow:v!=null&&v.trim()?v.trim():null,admin_ids:S,hosts:N},l==null?void 0:l.id)};return s(Gt,{isOpen:t,onClose:n,size:"5xl",children:[e(Dt,{}),s(Xt,{children:[e(Tt,{children:l?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Qt,{}),e(It,{children:s(we,{spacing:6,children:[s(O,{spacing:4,children:[e(Fr,{label:c("services.fields.name","Name"),value:h,onChange:N=>p(N.target.value),maxLength:128,isRequired:!0}),e(Fr,{label:c("services.fields.description","Description"),value:m!=null?m:"",onChange:N=>g(N.target.value),maxLength:256})]}),s(_,{maxW:{base:"100%",md:"320px"},children:[e(D,{children:c("services.fields.flow","Flow")}),e(at,{value:v,onChange:N=>b(N.target.value),placeholder:c("services.flow.placeholder","No flow"),children:e("option",{value:"xtls-rprx-vision",children:"xtls-rprx-vision"})}),e(br,{children:c("services.flow.helper","Applies to supported protocols (e.g. VLESS/Trojan)")})]}),s(P,{children:[e(u,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),s(we,{spacing:3,children:[e(Yr,{isChecked:S.length===i.length&&i.length>0,onChange:Q,isDisabled:i.length===0,children:c("services.selectAllAdmins","Select all admins")}),e(Fr,{value:z,onChange:N=>le(N.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(pe,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:i.length===0?e(u,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):q.length===0?e(u,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):q.map(N=>{const B=$.has(N.id);return e(P,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:B?"primary.400":"gray.200",bg:B?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:B?"primary.300":"gray.600",bg:B?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>U(N.id),onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),U(N.id))},role:"button",tabIndex:0,children:s(xt,{align:"center",justify:"space-between",children:[e(u,{fontWeight:"medium",children:N.username}),B&&e(fr,{colorScheme:"primary",children:c("services.selected","Selected")})]})},N.id)})})]}),e(u,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),s(An,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(Jr,{children:s(jr,{variant:"outline",h:"full",children:[e(Vn,{children:e(u,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(Zs,{children:s(we,{spacing:3,children:[e(Fr,{value:R,onChange:N=>K(N.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(pe,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:T.length===0?e(u,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):F.length===0?e(u,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):F.map(N=>s(P,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:y===N.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>ae(N.id),onMouseLeave:()=>ae(null),onClick:()=>Z(N.id),children:[e(u,{fontWeight:"medium",children:N.label}),s(u,{fontSize:"sm",color:"gray.500",children:[N.protocol.toUpperCase()," -"," ",N.inboundTag]})]},N.id))})]})})]})}),e(Jr,{children:s(jr,{variant:"outline",h:"full",children:[e(Vn,{children:e(u,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(Zs,{children:s(pe,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[w.length===0&&e(u,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),w.map((N,B)=>{const A=ve.get(N);return A?e(zu.div,{layout:!0,children:s(xt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[s(P,{children:[s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"medium",children:A.label}),A.isDisabled&&e(fr,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),s(u,{fontSize:"sm",color:"gray.500",children:[A.protocol.toUpperCase()," -"," ",A.inboundTag]})]}),s(O,{spacing:1,children:[e(kt,{label:c("services.moveUp","Move up"),children:e(qe,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(ac,{width:16}),onClick:()=>se(N,"up"),isDisabled:B===0})}),e(kt,{label:c("services.moveDown","Move down"),children:e(qe,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(oc,{width:16}),onClick:()=>se(N,"down"),isDisabled:B===w.length-1})}),e(kt,{label:c("services.removeHost","Remove host"),children:e(qe,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(Vs,{width:16}),onClick:()=>Z(N)})})]})]})},N):null})]})})]})})]})]})}),e(Bt,{children:s(O,{justify:"flex-end",w:"full",children:[e(V,{onClick:n,children:c("cancel")}),e(V,{colorScheme:"primary",onClick:M,isLoading:o,children:c(l?"saveChanges":"create")})]})})]})]})},g0=()=>{var ze,Ne,Je;const{t,i18n:n}=je();n.language;const r=cr(),{userData:o,getUserIsSuccess:a}=Dr(),i=a&&Boolean((ze=o.permissions)==null?void 0:ze.sections.services),l=on(),c=Us(),h=qc(),{inbounds:p,refetchUsers:m}=Ot(),g=sr(),[v,b]=d.exports.useState(null);d.exports.useEffect(()=>{!a||!i||(l.fetchServices(),c.fetchAdmins({limit:500,offset:0}),Bi(),h.fetchHosts())},[a,i,c.fetchAdmins,h.fetchHosts,l.fetchServices]);const S=d.exports.useMemo(()=>c.admins.slice().sort((H,ke)=>H.username.localeCompare(ke.username)).map(H=>({id:H.id,username:H.username})),[c.admins]),f=d.exports.useMemo(()=>{var ke,Me;const H=[];for(const[Be,ot]of Object.entries(h.hosts)){const X=(ke=Array.from(p.values()).flat().find(xe=>xe.tag===Be))!=null?ke:null,Ae=(Me=X==null?void 0:X.protocol)!=null?Me:"unknown";ot.forEach(xe=>{xe.id!=null&&H.push({id:xe.id,label:xe.remark,inboundTag:Be,protocol:Ae,isDisabled:Boolean(xe.is_disabled)})})}return H},[h.hosts,p]),w=()=>{b(null),g.onOpen()},W=async H=>{try{const ke=await l.fetchServiceDetail(H);b(ke),g.onOpen()}catch{r({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},z=async(H,ke)=>{var Me,Be;try{ke?(await l.updateService(ke,H),r({status:"success",title:t("services.updated","Service updated")})):(await l.createService(H),r({status:"success",title:t("services.created","Service created")})),m(!0),g.onClose()}catch(ot){r({status:"error",title:(Be=(Me=ot==null?void 0:ot.data)==null?void 0:Me.detail)!=null?Be:t("services.saveFailed","Failed to save service")})}},le=async H=>{var ke,Me;try{const Be=await l.fetchServiceDetail(H);be(Be),te()}catch(Be){r({status:"error",title:(Me=(ke=Be==null?void 0:Be.data)==null?void 0:ke.detail)!=null?Me:t("services.deleteFailed","Unable to delete service")})}},R=async H=>{var ke,Me;try{await l.resetServiceUsage(H),r({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(Be){r({status:"error",title:(Me=(ke=Be==null?void 0:Be.data)==null?void 0:ke.detail)!=null?Me:t("services.resetFailed","Failed to reset usage")})}},[K,y]=d.exports.useState(null),[ae,Se]=d.exports.useState(!1),{isOpen:ve,onOpen:T,onClose:F}=sr(),q=d.exports.useRef(null),$=H=>{y(H),T()},Q=async()=>{if(K!=null){Se(!0);try{await R(K)}finally{Se(!1),F()}}},U=K!=null?(Ne=l.services.find(H=>H.id===K))==null?void 0:Ne.name:void 0,Z=()=>{be(null),Oe()},se=async()=>{var ke,Me;if(!M)return;const H={mode:M.user_count?ee:"delete_users",unlink_admins:me,target_service_id:null};H.mode==="transfer_users"&&(H.target_service_id=N!=null?N:null),k(!0);try{await l.deleteService(M.id,H),r({status:"success",title:t("services.deleted","Service removed")}),m(!0),Z()}catch(Be){r({status:"error",title:(Me=(ke=Be==null?void 0:Be.data)==null?void 0:ke.detail)!=null?Me:t("services.deleteFailed","Unable to delete service")})}finally{k(!1)}},[M,be]=d.exports.useState(null),[ee,Ie]=d.exports.useState("transfer_users"),[me,J]=d.exports.useState(!1),[N,B]=d.exports.useState(null),[A,k]=d.exports.useState(!1),{isOpen:L,onOpen:te,onClose:Oe}=sr(),ne=d.exports.useMemo(()=>M?l.services.filter(H=>H.id!==M.id):l.services,[M,l.services]);d.exports.useEffect(()=>{if(M){const H=M.user_count>0;Ie(H?"transfer_users":"delete_users"),J(M.admin_ids.length>0),B(null)}},[M]),d.exports.useEffect(()=>{ee==="delete_users"&&B(null)},[ee]);const I=H=>e(yc,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:ke})=>s(Wt,{children:[s(xc,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[s(P,{flex:"1",textAlign:"left",children:[e(u,{fontWeight:"semibold",children:H.name}),H.description&&e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:ke?3:1,mt:1,children:H.description})]}),s(pe,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[s(O,{spacing:1,children:[s(u,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),s(u,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:[H.host_count,!H.has_hosts&&e(fr,{colorScheme:"red",ml:2,children:"Broken"})]})]}),s(O,{spacing:1,children:[s(u,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(u,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:H.user_count})]})]}),e(Tu,{})]}),e(Sc,{pt:0,pb:4,children:s(we,{spacing:4,children:[s(Ve,{columns:2,spacing:3,children:[s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(u,{fontWeight:"semibold",children:Ke(H.used_traffic)})]}),s(P,{children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(u,{fontWeight:"semibold",children:Ke(H.lifetime_used_traffic)})]})]}),s(we,{spacing:2,children:[e(u,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),s(O,{spacing:2,flexWrap:"wrap",children:[e(kt,{label:t("services.view","View"),children:e(qe,{"aria-label":"View",icon:e(ln,{width:18}),size:"sm",variant:"outline",onClick:Me=>{Me.stopPropagation(),l.fetchServiceDetail(H.id)}})}),e(kt,{label:t("services.edit","Edit"),children:e(qe,{"aria-label":"Edit",icon:e(Za,{width:18}),size:"sm",variant:"outline",onClick:Me=>{Me.stopPropagation(),W(H.id)},isDisabled:!i})}),e(kt,{label:t("services.resetUsage","Reset usage"),children:e(qe,{"aria-label":"Reset usage",icon:e(gs,{width:18}),size:"sm",variant:"outline",onClick:Me=>{Me.stopPropagation(),$(H.id)},isDisabled:!i})}),e(kt,{label:t("services.delete","Delete"),children:e(qe,{"aria-label":"Delete",icon:e(Vs,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:Me=>{Me.stopPropagation(),le(H.id)},isDisabled:!i})})]})]})]})})]})},`service-accordion-${H.id}`),E=(H,ke)=>s(Lt,{className:ke===l.services.length-1?"last-row":void 0,children:[e(Le,{children:s(pe,{align:"start",spacing:0,children:[e(u,{fontWeight:"semibold",children:H.name}),H.description&&e(u,{fontSize:"sm",color:"gray.500",children:H.description})]})}),s(Le,{children:[H.host_count,!H.has_hosts&&e(fr,{colorScheme:"red",ml:2,children:"Broken"})]}),e(Le,{children:H.user_count}),e(Le,{children:Ke(H.used_traffic)}),e(Le,{children:Ke(H.lifetime_used_traffic)}),e(Le,{children:s(O,{spacing:2,children:[e(kt,{label:t("services.view","View"),children:e(qe,{"aria-label":"View",icon:e(ln,{width:18}),size:"sm",variant:"ghost",onClick:()=>l.fetchServiceDetail(H.id)})}),i&&s(Wt,{children:[e(kt,{label:t("services.edit","Edit"),children:e(qe,{"aria-label":"Edit",icon:e(Za,{width:18}),size:"sm",variant:"ghost",onClick:()=>W(H.id)})}),e(kt,{label:t("services.resetUsage","Reset usage"),children:e(qe,{"aria-label":"Reset usage",icon:e(gs,{width:18}),size:"sm",variant:"ghost",onClick:()=>$(H.id)})}),e(kt,{label:t("services.delete","Delete"),children:e(qe,{"aria-label":"Delete",icon:e(Vs,{width:18}),size:"sm",variant:"ghost",onClick:()=>le(H.id)})})]})]})})]},H.id),G=l.serviceDetail;return a?i?s(pe,{spacing:4,align:"stretch",children:[s(xt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[s(P,{children:[e(u,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(u,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),i&&e(V,{leftIcon:e(en,{width:18}),colorScheme:"primary",onClick:w,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(jr,{variant:"outline",children:e(Zs,{children:l.isLoading?e(xt,{justify:"center",py:10,children:e(zt,{})}):s(Wt,{children:[e(bc,{allowToggle:!0,display:{base:"block",md:"none"},children:l.services.map(I)}),e(P,{display:{base:"none",md:"block"},overflowX:"auto",children:s(Ks,{variant:"simple",children:[e(hs,{children:s(Lt,{children:[e(Xe,{children:t("services.columns.name","Name")}),e(Xe,{children:t("services.columns.hosts","Hosts")}),e(Xe,{children:t("services.columns.users","Users")}),e(Xe,{children:t("services.columns.usage","Usage")}),e(Xe,{children:t("services.columns.lifetime","Lifetime")}),e(Xe,{children:t("services.columns.actions","Actions")})]})}),e(as,{children:l.services.map((H,ke)=>E(H,ke))})]})})]})})}),G&&s(jr,{variant:"outline",children:[e(Vn,{children:s(xt,{justify:"space-between",align:"center",children:[s(P,{children:[e(u,{fontWeight:"semibold",children:G.name}),G.description&&e(u,{fontSize:"sm",color:"gray.500",children:G.description}),G.flow&&s(u,{fontSize:"sm",color:"gray.500",children:[t("services.currentFlow","Flow"),": ",G.flow]})]}),e(fr,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:G.user_count})})]})}),e(Zs,{children:s(Ve,{columns:{base:1,md:2},spacing:6,children:[s(P,{children:[e(u,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(we,{spacing:2,children:G.admins.length===0?e(u,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):G.admins.map(H=>s(xt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(u,{fontWeight:"medium",children:H.username}),s(u,{fontSize:"sm",color:"gray.500",children:[Ke(H.used_traffic)," /"," ",Ke(H.lifetime_used_traffic)]})]},H.id))})]}),s(P,{children:[e(u,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(we,{spacing:2,children:G.hosts.map(H=>s(xt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[s(P,{children:[e(u,{fontWeight:"medium",children:H.remark}),s(u,{fontSize:"sm",color:"gray.500",children:[H.inbound_protocol.toUpperCase()," -"," ",H.inbound_tag]})]}),s(fr,{colorScheme:"gray",children:["#",H.sort+1]})]},H.id))})]})]})})]}),e(Yn,{isOpen:ve,leastDestructiveRef:q,onClose:F,isCentered:!0,motionPreset:"slideInBottom",children:e(Dt,{children:s(Gn,{mx:{base:4,sm:0},children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(It,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:U!=null?U:t("services.thisService","this service")})}),s(Bt,{children:[e(V,{ref:q,onClick:F,children:t("cancel","Cancel")}),e(V,{colorScheme:"primary",ml:3,onClick:Q,isLoading:ae,children:t("services.resetUsage","Reset usage")})]})]})})}),s(Gt,{isOpen:L,onClose:Z,size:"lg",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(Xt,{children:[s(Tt,{children:[t("services.deleteDialogTitle","Delete Service"),M?` \u2013 ${M.name}`:""]}),e(Qt,{}),e(It,{children:M?s(pe,{align:"stretch",spacing:4,children:[e(u,{children:t("services.deleteDialogDescription",{name:M.name})}),M.admin_ids.length>0?e(Yr,{isChecked:me,onChange:H=>J(H.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(u,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),M.user_count>0?s(pe,{align:"stretch",spacing:3,children:[e(u,{fontWeight:"semibold",children:t("services.userDeletePrompt",{count:M.user_count})}),e(Fi,{value:ee,onChange:H=>Ie(H),children:s(we,{align:"flex-start",spacing:2,children:[e(is,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(is,{value:"transfer_users",children:t("services.transferUsersOption","Keep linked users (move them to No service or another service)")})]})}),ee==="transfer_users"&&s(_,{children:[e(D,{children:t("services.selectTargetService","Target service")}),s(at,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:N===null?la:(Je=N==null?void 0:N.toString())!=null?Je:la,onChange:H=>{const ke=H.target.value;if(!ke||ke===la){B(null);return}B(Number(ke))},children:[e("option",{value:la,children:t("services.noServiceTargetOption","Move users to No service (default)")}),ne.map(H=>e("option",{value:H.id,children:H.name},H.id))]}),e(br,{children:t("services.transferUsersHint","Users will be unassigned from this service by default. Select another service if you want to move them elsewhere.")})]})]}):s(Tr,{status:"info",borderRadius:"md",children:[e(Mr,{}),e($s,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(u,{children:t("services.loading","Loading...")})}),s(Bt,{gap:3,children:[e(V,{variant:"ghost",onClick:Z,children:t("cancel","Cancel")}),e(V,{colorScheme:"red",onClick:se,isLoading:A,isDisabled:!M,children:t("services.delete","Delete")})]})]})]}),e(m0,{isOpen:g.isOpen,onClose:g.onClose,onSubmit:z,isSaving:l.isSaving,allHosts:f,allAdmins:S,initialService:v!=null?v:void 0})]}):s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(u,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(xt,{justify:"center",align:"center",h:"full",py:10,children:e(zt,{})})};Ue.extend(zn);const _l=ue(Ji,{baseStyle:{w:4,h:4}}),f0=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,o=Ue.utc(r);return o.isValid()?n?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},Cl=t=>`${Ue(t).utc().format("YYYY-MM-DDTHH:mm:ss")}Z`,Al=t=>`${Ue(t).utc().format("YYYY-MM-DDTHH:mm:ss")}Z`,ca=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Ue.utc(r).valueOf()},b0=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Ke(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Ke(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},y0=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Ke(Number(r)||0,2),title:{formatter:(r,o)=>{var a,i,l,c;return(c=(l=(i=(a=o==null?void 0:o.w)==null?void 0:a.globals)==null?void 0:i.labels)==null?void 0:l[o.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),x0=()=>{var se;const{t}=je(),{colorMode:n}=fs(),{admins:r}=Us(),[o,a]=d.exports.useState([]),[i,l]=d.exports.useState([]),[c,h]=d.exports.useState(null),[p,m]=d.exports.useState([]),[g,v]=d.exports.useState(!1),b=d.exports.useMemo(()=>[{key:"7h",label:"7h",amount:7,unit:"hour"},{key:"1d",label:"1d",amount:1,unit:"day"},{key:"3d",label:"3d",amount:3,unit:"day"},{key:"1w",label:"1w",amount:7,unit:"day"},{key:"1m",label:"1m",amount:30,unit:"day"},{key:"3m",label:"3m",amount:90,unit:"day"}],[]),[S,f]=d.exports.useState(()=>{const M=Ue().utc().endOf("day");return{start:M.subtract(30,"day").startOf("day").toDate(),end:M.toDate(),presetKey:"1m",key:"1m"}}),[w,W]=d.exports.useState(null),[z,le]=d.exports.useState([]),[R,K]=d.exports.useState(!1);d.exports.useMemo(()=>{var M;return(M=i.find(be=>be.id===c))!=null?M:null},[i,c]);const y=d.exports.useMemo(()=>{if(!c)return o;const M=new Set(p.map(ee=>ee.username).filter(ee=>Boolean(ee))),be=o.filter(ee=>M.has(ee.username));return be.length?be:o},[o,c,p]),ae=d.exports.useMemo(()=>p.reduce((M,be)=>M+(be.used_traffic||0),0),[p]),Se=d.exports.useMemo(()=>p.map(M=>M.used_traffic||0),[p]),ve=d.exports.useMemo(()=>p.map(M=>M.username||t("services.unassignedAdmin","Unassigned")),[p,t]),T=d.exports.useMemo(()=>y0(n,ve),[n,ve]);d.exports.useEffect(()=>{let M=!1;return(async()=>{var ee;try{const Ie=await Ee("/v2/services",{query:{limit:500}});if(M||!Ie)return;const me=(ee=Ie.services)!=null?ee:[];l(me),h(J=>J!==null?J:me.length?me[0].id:null)}catch{M||l([])}})(),()=>{M=!0}},[]),d.exports.useEffect(()=>{if(!c){m([]);return}let M=!1;return v(!0),Ee(`/v2/services/${c}/usage/admins`,{query:{start:Cl(S.start),end:Al(S.end)}}).then(be=>{var ee;M||!be||m((ee=be.admins)!=null?ee:[])}).catch(()=>{M||m([])}).finally(()=>{M||v(!1)}),()=>{M=!0}},[c,S.start,S.end]),d.exports.useEffect(()=>{let M=!1;return(async()=>{try{const ee=await Ee("/admins");if(M)return;Array.isArray(ee)?a(ee):a(ee.admins||[])}catch(ee){console.error("Failed to load all admins:",ee),a(r||[])}})(),()=>{M=!0}},[r]),d.exports.useEffect(()=>{if(!w)return;let M=!1;K(!0);const be=Ue(S.start).isSame(S.end,"day"),ee={start:Cl(S.start),end:Al(S.end)};be&&(ee.granularity="hour");const Ie=be?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:w,endpoint:Ie,query:ee}),Ee(`/admin/${encodeURIComponent(w)}/usage/${Ie}`,{query:ee}).then(me=>{if(M)return;const J=Array.isArray(me==null?void 0:me.usages)?me.usages:[];console.debug("AdminsUsage: response usages",{length:J.length,endpoint:Ie});let N;if(be){const B=new Map;J.forEach(k=>{var Oe,ne;const L=typeof(k==null?void 0:k.date)=="string"?k.date:"";if(!L)return;const te=(Oe=B.get(L))!=null?Oe:0;B.set(L,te+Number((ne=k==null?void 0:k.used_traffic)!=null?ne:0))});const A=Array.from(B.entries());A.sort((k,L)=>{const[te]=k,[Oe]=L;return ca(te)-ca(Oe)}),N=A.map(([k,L])=>({date:k,used_traffic:L}))}else{const B=J.map(A=>{var k,L;return{date:(k=A==null?void 0:A.date)!=null?k:"",used_traffic:Number((L=A==null?void 0:A.used_traffic)!=null?L:0)}});B.sort((A,k)=>ca(A.date)-ca(k.date)),N=B}le(N)}).catch(me=>{M||(console.error("Error fetching admin usage:",me),le([]))}).finally(()=>{M||K(!1)}),()=>{M=!0}},[w,S]),d.exports.useEffect(()=>{if(!y||y.length===0)return;y.some(be=>be.username===w)||W(y[0].username)},[y,w]);const F=d.exports.useMemo(()=>z.map(M=>f0(M.date)),[z]),q=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:z.map(M=>M.used_traffic)}],[z,t]),$=d.exports.useMemo(()=>({options:b0(n,F),series:q}),[n,F,q]),Q=d.exports.useMemo(()=>z.reduce((M,be)=>M+Number(be.used_traffic||0),0),[z]),U=d.exports.useMemo(()=>b.map(M=>({key:M.key,label:M.label,amount:M.amount,unit:M.unit==="hour"?"hour":"day"})),[b.map]),Z=M=>{f(M)};return s(pe,{spacing:4,align:"stretch",children:[s(ms,{title:t("admins.serviceUsageTitle","Service usage distribution"),headerActions:s(we,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(at,{value:c!=null?c:"",onChange:M=>{const be=Number(M.target.value);h(Number.isNaN(be)?null:be)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!i.length,children:i.map(M=>e("option",{value:M.id,children:M.name},M.id))}),s(O,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(_l,{}),s(u,{children:[t("services.totalUsage","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(ae,2)})]})]})]}),children:[e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mb:4,children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")}),s(we,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(P,{flex:"1",children:g?s(pe,{spacing:3,py:8,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):p.length&&ae>0?e(ps,{type:"donut",height:320,options:T,series:Se}):e(u,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(pe,{flex:"1",align:"stretch",spacing:2,children:p.length?p.map(M=>{var me;const be=M.username||t("services.unassignedAdmin","Unassigned"),ee=Boolean(M.username),Ie=w===M.username&&ee;return e(V,{size:"sm",variant:Ie?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{ee&&M.username&&W(M.username)},isDisabled:!ee,children:s(O,{justify:"space-between",w:"full",children:[e(u,{children:be}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Ke(M.used_traffic||0,2)})]})},`${(me=M.admin_id)!=null?me:"na"}-${be}`)}):e(u,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),s(ms,{title:s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(kt,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(_l,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),headerActions:s(we,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(kn,{value:S,onChange:Z,presets:U,defaultPreset:"1m"}),e(at,{value:w!=null?w:"",onChange:M=>W(M.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!y.length,children:y.map(M=>e("option",{value:M.username,children:M.username},M.username))})]}),children:[e(pe,{align:"start",spacing:1,mb:4,children:s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(ue.span,{fontWeight:"medium",children:w!=null?w:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(Q||0,2)})]})}),R?s(pe,{spacing:3,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(se=$.series)!=null&&se.length?e(ps,{options:$.options,series:$.series,type:"area",height:360}):e(u,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]})]})};Ue.extend(zn);const Mi=t=>{const n=t.unit==="hour"?"hour":"day",r=Ue().utc().endOf(n),o=Math.max(t.amount-1,0),a=r.subtract(o,t.unit).startOf(n);return{key:t.key,start:a.toDate(),end:r.toDate(),unit:t.unit}},sd=(t,n)=>{const r=Ue(t),o=Ue(n),[a,i]=r.isBefore(o)?[r,o]:[o,r],l=a.startOf("day"),c=i.endOf("day"),h=l.isSame(c,"day");return{key:"custom",start:l.toDate(),end:c.toDate(),unit:h?"hour":"day"}};function S0(t){const n=360/t,r=90,o=47,a=[];for(let i=0;i<t;i++){const l=i*n%360+140,c=v0(l,r,o);a.push(c)}return a}function v0(t,n,r){t/=360,n/=100,r/=100;let o=0,a=0,i=0;if(n===0)o=a=i=r;else{const c=(m,g,v)=>(v<0&&(v+=1),v>1&&(v-=1),v<.16666666666666666?m+(g-m)*6*v:v<.5?g:v<.6666666666666666?m+(g-m)*(.6666666666666666-v)*6:m),h=r<.5?r*(1+n):r+n-r*n,p=2*r-h;o=Math.round(c(p,h,t+1/3)*255),a=Math.round(c(p,h,t)*255),i=Math.round(c(p,h,t-1/3)*255)}const l=c=>{const h=c.toString(16);return h.length===1?`0${h}`:h};return`#${l(o)}${l(a)}${l(i)}`}const Dl=({border:t,...n})=>{const{getInputProps:r,getRadioProps:o}=mc(n),a=Br({base:"xs",md:"sm"});return s(P,{as:"label",children:[e("input",{...r()}),e(P,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:a,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},w0=({onChange:t,defaultValue:n,...r})=>{const{t:o,i18n:a}=je();fs();const i=Br({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),l={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=Br({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:h,getRadioProps:p,setValue:m}=pc({name:"filter",defaultValue:n,onChange:q=>{if(q==="custom")return;b(),i.indexOf(q)>=0?(w(o("userDialog.custom")),z(!1)):(w(`${o("userDialog.custom")} (${q})`),z(!0));const $=Number(q.substring(0,q.length-1)),Q=l[q[q.length-1]];t(q,{start:Ue().utc().subtract($,Q).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:v,onClose:b}=sr(),S=d.exports.useRef(null);hc({ref:S,handler:b});const[f,w]=d.exports.useState(o("userDialog.custom")),[W,z]=d.exports.useState(!1),[le,R]=d.exports.useState(0),K=Br({base:1,md:2}),y=Br({base:"xs",md:"sm"}),[ae,Se]=d.exports.useState(null),[ve,T]=d.exports.useState(null),F=q=>{const[$,Q]=q;ve&&!Q?(Se(null),T(null)):(Se($),T(Q),$&&Q&&(b(),t("custom",{start:Ue($).format("YYYY-MM-DDT00:00:00"),end:Ue(Q).format("YYYY-MM-DDT23:59:59")})))};return s(pe,{...r,children:[le===0&&s(Ve,{...h(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(q=>e(Dl,{...p({value:q}),children:q},q)),e(P,{onClick:()=>{Se(null),T(null),v()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:y,px:3,py:1,bg:W?"primary.500":"unset",color:W?"white":"unset",borderColor:W?"primary.500":"unset",children:s(O,{children:[e(u,{children:f}),e(lr,{as:ja,boxSize:"18px"})]})})]}),le===1&&s(O,{onClick:v,cursor:"pointer",fontSize:y,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(u,{w:"full",color:ae?"unset":"gray.500",children:ae?Ue(ae).format("YYYY-MM-DD (00:00)"):o("userDialog.startDate")}),e(lr,{as:go,boxSize:"18px"}),e(u,{w:"full",color:ve?"unset":"gray.500",children:ve?Ue(ve).format("YYYY-MM-DD (23:59)"):o("userDialog.endDate")}),e(lr,{as:ja,boxSize:"18px"})]}),e(pe,{ref:S,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:s(dn,{onChange:q=>R(q),children:[s(un,{children:[e(hr,{fontSize:y,children:o("userDialog.relative")}),e(hr,{fontSize:y,children:o("userDialog.absolute")})]}),s(hn,{children:[e(pr,{children:c.map(q=>e(pe,{alignItems:"start",pl:2,pr:2,children:s(O,{justifyItems:"flex-start",mb:4,children:[e(u,{fontSize:y,minW:"60px",children:o(`userDialog.${q.title}`)}),q.options.map($=>e(Dl,{border:!0,...p({value:$}),children:$},`${$}.custom`))]})},q.title))}),e(pr,{className:"datepicker-panel",children:e(pe,{children:e(yo,{locale:a.language.toLocaleLowerCase(),selected:ae,onChange:F,startDate:ae,endDate:ve,selectsRange:!0,maxDate:new Date,monthsShown:K,peekNextMonth:!1,inline:!0})})})]})]})})]})};function ka(t,n,r=[],o=[]){const a=Ke(r.reduce((i,l)=>i+l,0));return{series:r,options:{labels:o,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${n}${a}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:l,w:c})=>Ke(c.config.series[l],1)},tooltip:{custom:({series:i,seriesIndex:l,dataPointIndex:c,w:h})=>{const p=Ke(i[l],1),m=Math.max(i.reduce((v,b)=>v+b,0),1),g=`${Math.round(i[l]/m*1e3)/10}%`;return`
            <div style="
                    background-color: ${h.globals.colors[l]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${h.config.labels[l]}: <b>${g}, ${p}</b>
            </div>
          `}},colors:S0(r.length)}}}Ue.extend(zn);const da=ue(Ji,{baseStyle:{w:4,h:4}}),k0={key:"30d",label:"30d",amount:30,unit:"day"},Il=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,o=Ue.utc(r);return o.isValid()?n?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},Ci=t=>Ue(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Ai=t=>Ue(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Pl=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Ke(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Ke(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},ua=t=>({start:t.start,end:t.end,presetKey:t.key,key:t.key,unit:t.unit}),ha=t=>{if(t.presetKey&&t.presetKey!=="custom")return sd(t.start,t.end);const n=t.unit==="hour"?"hour":"day";return{key:"custom",start:t.start,end:t.end,unit:n}},_0=()=>{var Mt,er,ie,st,Qe,Pt,Rt,Ft,We;const{t}=je(),n=cr(),{colorMode:r}=fs(),{data:o}=fo(),{fetchNodesUsage:a}=Gi(),{userData:i}=Dr(),l=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(er=(Mt=l.find(ce=>ce.key==="30d"))!=null?Mt:l[0])!=null?er:k0,[h,p]=d.exports.useState(()=>Mi(c)),[m,g]=d.exports.useState([]),[v,b]=d.exports.useState(!1),[S,f]=d.exports.useState(()=>Mi(c)),[w,W]=d.exports.useState(null),[z,le]=d.exports.useState(!1),[R,K]=d.exports.useState([]),[y,ae]=d.exports.useState(null),[Se,ve]=d.exports.useState(()=>Mi(c)),[T,F]=d.exports.useState(()=>Mi(c)),[q,$]=d.exports.useState([]),[Q,U]=d.exports.useState(null),[Z,se]=d.exports.useState(null),[M,be]=d.exports.useState([]),[ee,Ie]=d.exports.useState([]),[me,J]=d.exports.useState(!1),[N,B]=d.exports.useState(null),[A,k]=d.exports.useState(!1),[L,te]=d.exports.useState([]),[Oe,ne]=d.exports.useState(null),I=d.exports.useCallback(ce=>ce?(Array.isArray(ce)?ce:Object.values(ce)).map(fe=>{var dt,yt,Kt,$t;return{nodeId:Number((dt=fe==null?void 0:fe.node_id)!=null?dt:0),nodeName:(yt=fe==null?void 0:fe.node_name)!=null?yt:t("nodes.unknownNode","Unknown"),total:Number((Kt=fe==null?void 0:fe.uplink)!=null?Kt:0)+Number(($t=fe==null?void 0:fe.downlink)!=null?$t:0)}}):[],[t]),E=d.exports.useCallback(ce=>{const Pe=ha(ce);p(Pe)},[]),G=d.exports.useCallback(ce=>{const Pe=ha(ce);f(Pe)},[]),ze=d.exports.useCallback(ce=>{const Pe=ha(ce);F(Pe)},[]),Ne=d.exports.useCallback(ce=>{const Pe=ha(ce);ve(Pe)},[]),Je=d.exports.useMemo(()=>m.reduce((ce,Pe)=>ce+Pe.total,0),[m]),H=d.exports.useMemo(()=>{const ce=m.map(fe=>fe.total),Pe=m.map(fe=>fe.nodeName);return ka(r,`${t("userDialog.total")} ${Ke(Je||0,2)}`,ce,Pe)},[r,m,t,Je]),ke=d.exports.useMemo(()=>R.map(ce=>Il(ce.date)),[R]),Me=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:R.map(ce=>ce.used_traffic)}],[R,t]),Be=d.exports.useMemo(()=>R.reduce((ce,Pe)=>ce+Pe.used_traffic,0),[R]),ot=d.exports.useMemo(()=>({options:Pl(r,ke),series:Me}),[r,ke,Me]),X=d.exports.useMemo(()=>ee.reduce((ce,Pe)=>ce+Pe.total,0),[ee]),Ae=d.exports.useMemo(()=>{const ce=ee.map(fe=>fe.total),Pe=ee.map(fe=>fe.nodeName);return ka(r,`${t("userDialog.total")} ${Ke(X||0,2)}`,ce,Pe)},[ee,r,t,X]),xe=d.exports.useMemo(()=>L.map(ce=>Il(ce.date)),[L]),$e=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:L.map(ce=>ce.used_traffic)}],[L,t]),Ze=d.exports.useMemo(()=>L.reduce((ce,Pe)=>ce+Pe.used_traffic,0),[L]),Vt=d.exports.useMemo(()=>({options:Pl(r,xe),series:$e}),[r,xe,$e]),ge=d.exports.useMemo(()=>{const ce=[],Pe=new Set;return m.forEach(fe=>{fe.nodeId>0&&!Pe.has(fe.nodeId)&&(Pe.add(fe.nodeId),ce.push({value:fe.nodeId,label:fe.nodeName}))}),Array.isArray(o)&&o.forEach(fe=>{(fe==null?void 0:fe.id)&&!Pe.has(fe.id)&&(Pe.add(fe.id),ce.push({value:fe.id,label:fe.name}))}),ce.sort((fe,dt)=>fe.label.localeCompare(dt.label))},[m,o]),Te=d.exports.useMemo(()=>{const ce=[],Pe=new Set;return M.forEach(fe=>{Pe.has(fe.nodeId)||(Pe.add(fe.nodeId),ce.push({value:fe.nodeId,label:fe.nodeName}))}),Pe.has(0)||ce.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(o)&&o.forEach(fe=>{(fe==null?void 0:fe.id)&&!Pe.has(fe.id)&&(Pe.add(fe.id),ce.push({value:fe.id,label:fe.name}))}),ce.sort((fe,dt)=>fe.label.localeCompare(dt.label))},[M,o,t]),Re=d.exports.useMemo(()=>q.map(ce=>({value:ce,label:ce})),[q]),ut=d.exports.useMemo(()=>{const ce=new Map;return Array.isArray(o)&&o.forEach(Pe=>{(Pe==null?void 0:Pe.id)!=null&&ce.set(Pe.id,Pe.name)}),ce},[o]);d.exports.useEffect(()=>{let ce=!1;return b(!0),a({start:Ci(h.start),end:Ai(h.end)}).then(Pe=>{if(ce)return;const fe=I(Pe==null?void 0:Pe.usages);g(fe)}).catch(Pe=>{ce||(console.error("Error fetching usage data:",Pe),g([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ce||b(!1)}),()=>{ce=!0}},[a,h,I,n,t]),d.exports.useEffect(()=>{var Pe,fe;const ce=Boolean((fe=(Pe=i.permissions)==null?void 0:Pe.admin_management)==null?void 0:fe[Nr.View])||i.role===Ye.FullAccess;!(i!=null&&i.username)||(U(dt=>dt!=null?dt:i.username),se(dt=>dt!=null?dt:i.username),ce||$([i.username]))},[i]),d.exports.useEffect(()=>{var fe,dt;const ce=Boolean((dt=(fe=i==null?void 0:i.permissions)==null?void 0:fe.admin_management)==null?void 0:dt[Nr.View])||(i==null?void 0:i.role)===Ye.FullAccess;if(!(i!=null&&i.username)||!ce)return;let Pe=!1;return Ee("/admins").then(yt=>{if(Pe)return;const $t=(Array.isArray(yt)?yt:Array.isArray(yt==null?void 0:yt.admins)?yt.admins:[]).map(ft=>ft==null?void 0:ft.username).filter(ft=>typeof ft=="string"),Ut=Array.from(new Set($t)).sort((ft,et)=>ft.localeCompare(et));if(!Ut.length&&(i==null?void 0:i.username)){$([i.username]);return}$(Ut),U(ft=>{var et,he;return ft&&Ut.includes(ft)?ft:(he=(et=Ut[0])!=null?et:ft)!=null?he:null}),se(ft=>{var et,he;return ft&&Ut.includes(ft)?ft:(he=(et=Ut[0])!=null?et:ft)!=null?he:null})}).catch(yt=>{console.error("Error fetching admins:",yt)}),()=>{Pe=!0}},[(ie=i==null?void 0:i.permissions)==null?void 0:ie.admin_management,i==null?void 0:i.role,i==null?void 0:i.username]),d.exports.useEffect(()=>{var Pe,fe;if(w!==null)return;const ce=(Pe=m.filter(dt=>dt.nodeId>0).sort((dt,yt)=>yt.total-dt.total)[0])==null?void 0:Pe.nodeId;if(ce&&ce>0){W(ce);return}if(Array.isArray(o)&&o.length){const dt=(fe=o[0])==null?void 0:fe.id;dt&&W(dt)}},[w,m,o]),d.exports.useEffect(()=>{B(null)},[]),d.exports.useEffect(()=>{if(!Q){be([]),B(null);return}let ce=!1;const Pe={start:Ci(T.start),end:Ai(T.end)};return Ee(`/admin/${encodeURIComponent(Q)}/usage/nodes`,{query:Pe}).then(fe=>{if(ce)return;const dt=I(fe==null?void 0:fe.usages);be(dt),B(yt=>{var $t,Ut,ft;if(yt!==null)return yt;const Kt=($t=dt.filter(et=>et.nodeId!==0).sort((et,he)=>he.total-et.total)[0])==null?void 0:$t.nodeId;return typeof Kt=="number"?Kt:(ft=(Ut=dt[0])==null?void 0:Ut.nodeId)!=null?ft:0})}).catch(fe=>{ce||(console.error("Error fetching daily admin nodes:",fe),be([]),B(null),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{ce=!0}},[Q,T,I,n,t]),d.exports.useEffect(()=>{if(!Z){Ie([]),J(!1);return}let ce=!1;return J(!0),Ee(`/admin/${encodeURIComponent(Z)}/usage/nodes`,{query:{start:Ci(Se.start),end:Ai(Se.end)}}).then(Pe=>{if(ce)return;const fe=I(Pe==null?void 0:Pe.usages);Ie(fe)}).catch(Pe=>{ce||(console.error("Error fetching admin totals nodes:",Pe),Ie([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ce||J(!1)}),()=>{ce=!0}},[Z,Se,I,n,t]),d.exports.useEffect(()=>{if(w===null){K([]),ae(null);return}let ce=!1;le(!0);const Pe={start:Ci(S.start),end:Ai(S.end)};return S.unit==="hour"&&(Pe.granularity="hour"),Ee(`/node/${w}/usage/daily`,{query:Pe}).then(fe=>{var $t,Ut,ft;if(ce)return;const yt=(Array.isArray(fe==null?void 0:fe.usages)?fe.usages:[]).map(et=>{var he,De;return{date:(he=et==null?void 0:et.date)!=null?he:"",used_traffic:Number((De=et==null?void 0:et.used_traffic)!=null?De:0)}});K(yt);const Kt=(Ut=($t=fe==null?void 0:fe.node_name)!=null?$t:ut.get(w))!=null?Ut:t("nodes.unknownNode","Unknown");ae({nodeName:Kt,nodeId:(ft=fe==null?void 0:fe.node_id)!=null?ft:w})}).catch(fe=>{ce||(console.error("Error fetching node daily usage:",fe),K([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ce||le(!1)}),()=>{ce=!0}},[w,S,ut,n,t]),d.exports.useEffect(()=>{if(!Q){te([]),ne(null);return}if(N===null){te([]),ne(null);return}let ce=!1;k(!0);const Pe={start:Ci(T.start),end:Ai(T.end)};return N!=null&&(Pe.node_id=N),T.unit==="hour"&&(Pe.granularity="hour"),Ee(`/admin/${encodeURIComponent(Q)}/usage/chart`,{query:Pe}).then(fe=>{var Kt,$t,Ut,ft;if(ce)return;const yt=(Array.isArray(fe==null?void 0:fe.usages)?fe.usages:[]).map(et=>{var he,De;return{date:(he=et==null?void 0:et.date)!=null?he:"",used_traffic:Number((De=et==null?void 0:et.used_traffic)!=null?De:0)}});te(yt),ne({nodeName:(Ut=($t=fe==null?void 0:fe.node_name)!=null?$t:(Kt=Te.find(et=>et.value===N))==null?void 0:Kt.label)!=null?Ut:null,nodeId:(ft=fe==null?void 0:fe.node_id)!=null?ft:N})}).catch(fe=>{ce||(console.error("Error fetching admin usage chart:",fe),te([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ce||k(!1)}),()=>{ce=!0}},[Q,N,T,Te,t,n]);const lt=d.exports.useMemo(()=>l.map(ce=>({key:ce.key,label:ce.label,amount:ce.amount,unit:ce.unit==="hour"?"hour":(ce.unit==="day","day")})),[l]);return s(pe,{spacing:6,align:"stretch",children:[s(ms,{title:e(kt,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(da,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),headerActions:e(kn,{value:ua(h),onChange:E,presets:lt,defaultPreset:"30d"}),children:[e(pe,{align:"start",spacing:1,mb:4,children:s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(Je||0,2)})]})}),v?s(pe,{spacing:3,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):H.series.length?e(ps,{options:H.options,series:H.series,type:"donut",height:360}):e(u,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]}),s(ms,{title:e(kt,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(da,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),headerActions:s(we,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(at,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:w!=null?w:"",onChange:ce=>{const Pe=ce.target.value;if(!Pe){W(null);return}const fe=Number(Pe);W(Number.isFinite(fe)&&fe>0?fe:null)},placeholder:t("nodes.selectNode","Select node"),children:ge.map(ce=>e("option",{value:ce.value,children:ce.label},ce.value))}),e(kn,{value:ua(S),onChange:G,presets:lt,defaultPreset:"30d"})]}),children:[e(pe,{align:"start",spacing:1,mb:4,children:s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),":"," ",e(ue.span,{fontWeight:"medium",children:(st=y==null?void 0:y.nodeName)!=null?st:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(Be||0,2)})]})}),z?s(pe,{spacing:3,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(Pt=(Qe=Me[0])==null?void 0:Qe.data)!=null&&Pt.length?e(ps,{options:ot.options,series:ot.series,type:"area",height:360}):e(u,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]}),s(ms,{title:e(kt,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(da,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),headerActions:s(we,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(at,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:Q!=null?Q:"",onChange:ce=>U(ce.target.value||null),isDisabled:Re.length===0,children:Re.map(ce=>e("option",{value:ce.value,children:ce.label},ce.value))}),e(at,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:N!=null?N:"",onChange:ce=>{const Pe=ce.target.value;if(Pe===""){B(null);return}const fe=Number(Pe);B(Number.isNaN(fe)?null:fe)},placeholder:t("nodes.selectNode","Select node"),children:Te.map(ce=>e("option",{value:ce.value,children:ce.label},ce.value))}),e(kn,{value:ua(T),onChange:ze,presets:lt,defaultPreset:"30d"})]}),children:[e(pe,{align:"start",spacing:1,mb:4,children:s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),":"," ",e(ue.span,{fontWeight:"medium",children:Q!=null?Q:"-"})," ",t("nodes.selectedNode","Node"),":"," ",e(ue.span,{fontWeight:"medium",children:(Rt=Oe==null?void 0:Oe.nodeName)!=null?Rt:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(Ze||0,2)})]})}),A?s(pe,{spacing:3,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(We=(Ft=$e[0])==null?void 0:Ft.data)!=null&&We.length?e(ps,{options:Vt.options,series:Vt.series,type:"area",height:360}):e(u,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]}),s(ms,{title:e(kt,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(da,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),headerActions:s(we,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(at,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:Z!=null?Z:"",onChange:ce=>se(ce.target.value||null),isDisabled:Re.length===0,children:Re.map(ce=>e("option",{value:ce.value,children:ce.label},ce.value))}),e(kn,{value:ua(Se),onChange:Ne,presets:lt,defaultPreset:"30d"})]}),children:[e(pe,{align:"start",spacing:1,mb:4,children:s(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),":"," ",e(ue.span,{fontWeight:"medium",children:Z!=null?Z:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(X||0,2)})]})}),me?s(pe,{spacing:3,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Ae.series.length?e(ps,{options:Ae.options,series:Ae.series,type:"donut",height:360}):e(u,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})]})]})};Ue.extend(zn);const Ya=ue(Ji,{baseStyle:{w:4,h:4}}),Ga=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],El=t=>Ue(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),zl=t=>Ue(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Tl=(t,n)=>{if(!t)return t;const r=Ue.utc(t);return r.isValid()?n==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},Ml=(t,n,r)=>{const o=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>o)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:a=>Ke(Number(a)||0,1),style:{colors:[o]}},title:{text:r,style:{color:o}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:a=>Ke(Number(a)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},C0=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Ke(Number(r)||0,2),title:{formatter:(r,o)=>{var a,i,l,c;return(c=(l=(i=(a=o==null?void 0:o.w)==null?void 0:a.globals)==null?void 0:i.labels)==null?void 0:l[o.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),A0=t=>({start:t.start,end:t.end,presetKey:t.key,key:t.key,unit:t.unit}),D0=t=>{if(t.presetKey&&t.presetKey!=="custom")return sd(t.start,t.end);const n=t.unit==="hour"?"hour":"day";return{key:"custom",start:t.start,end:t.end,unit:n}},I0=({services:t,selectedServiceId:n})=>{var Oe,ne,I;const{t:r}=je(),{colorMode:o}=fs(),a=d.exports.useMemo(()=>t.map(E=>({id:E.id,name:E.name})),[t]),i=d.exports.useMemo(()=>n||(a.length?a[0].id:null),[n,a]),l=(Oe=Ga.find(E=>E.key==="30d"))!=null?Oe:Ga[0],[c,h]=d.exports.useState(i),[p,m]=d.exports.useState(()=>Mi(l)),[g,v]=d.exports.useState([]),[b,S]=d.exports.useState("day"),[f,w]=d.exports.useState([]),[W,z]=d.exports.useState(!1),[le,R]=d.exports.useState(!1),[K,y]=d.exports.useState(null),[ae,Se]=d.exports.useState([]),[ve,T]=d.exports.useState("day"),[F,q]=d.exports.useState(""),[$,Q]=d.exports.useState(!1);d.exports.useEffect(()=>{h(i)},[i]),d.exports.useEffect(()=>{if(!c){v([]),w([]),Se([]),y(null),q("");return}const E={start:El(p.start),end:zl(p.end)},G=p.unit==="hour"?"hour":"day";let ze=!1;return z(!0),Ee(`/v2/services/${c}/usage/timeseries`,{query:{...E,granularity:G}}).then(Ne=>{var Je,H;ze||!Ne||(v((Je=Ne.points)!=null?Je:[]),S((H=Ne.granularity)!=null?H:G))}).catch(()=>{ze||(v([]),S(G))}).finally(()=>{ze||z(!1)}),R(!0),Ee(`/v2/services/${c}/usage/admins`,{query:E}).then(Ne=>{var Je;ze||!Ne||w((Je=Ne.admins)!=null?Je:[])}).catch(()=>{ze||w([])}).finally(()=>{ze||R(!1)}),()=>{ze=!0}},[c,p.start,p.end,p.unit]),d.exports.useEffect(()=>{if(!c){y(null),Se([]),q("");return}if(!f.length){y(null);return}y(E=>{var Je,H;const G=f.map(ke=>ke.admin_id);if(E===null){if(G.includes(null))return E}else if(G.includes(E))return E;const ze=f.find(ke=>(ke.used_traffic||0)>0);if(ze)return(Je=ze.admin_id)!=null?Je:null;const Ne=f[0];return(H=Ne==null?void 0:Ne.admin_id)!=null?H:null})},[f,c]),d.exports.useEffect(()=>{if(!c){Se([]),q(""),T("day");return}if(K===void 0)return;if(!f.length&&K===null){Se([]),q("");return}const E=p.unit==="hour"?"hour":"day",G=K===null?"null":Number.isFinite(K)?String(K):"null";let ze=!1;return Q(!0),Ee(`/v2/services/${c}/usage/admin-timeseries`,{query:{start:El(p.start),end:zl(p.end),granularity:E,admin_id:G}}).then(Ne=>{var Je,H,ke;ze||!Ne||(Se((Je=Ne.points)!=null?Je:[]),T((H=Ne.granularity)!=null?H:E),q((ke=Ne.username)!=null?ke:""))}).catch(()=>{ze||(Se([]),q(""),T(E))}).finally(()=>{ze||Q(!1)}),()=>{ze=!0}},[f,p.end,p.start,p.unit,K,c]);const U=d.exports.useMemo(()=>Ga.map(E=>({key:E.key,label:E.label,amount:E.amount,unit:E.unit==="hour"?"hour":"day"})),[]),Z=E=>{const G=D0(E);m(G)},se=d.exports.useMemo(()=>g.map(E=>Tl(E.timestamp,b)),[g,b]),M=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:g.map(E=>E.used_traffic)}],[g,r]),be=d.exports.useMemo(()=>Ml(o,se,r("services.usageYAxis","Usage")),[se,o,r]),ee=d.exports.useMemo(()=>f.map(E=>({value:E.admin_id===null?"null":String(E.admin_id),label:E.username||r("services.unassignedAdmin","Unassigned")})),[f,r]),Ie=d.exports.useMemo(()=>{var G,ze;const E=K===null?"null":String(K);return(ze=(G=ee.find(Ne=>Ne.value===E))==null?void 0:G.label)!=null?ze:K===null?r("services.unassignedAdmin","Unassigned"):""},[ee,K,r]),me=d.exports.useMemo(()=>ae.map(E=>Tl(E.timestamp,ve)),[ae,ve]),J=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ae.map(E=>E.used_traffic)}],[ae,r]),N=d.exports.useMemo(()=>Ml(o,me,r("services.usageYAxis","Usage")),[me,o,r]),B=d.exports.useMemo(()=>ae.reduce((E,G)=>E+(G.used_traffic||0),0),[ae]),A=d.exports.useMemo(()=>f.map(E=>E.used_traffic),[f]),k=d.exports.useMemo(()=>f.map(E=>E.username||r("services.unassignedAdmin","Unassigned")),[f,r]),L=d.exports.useMemo(()=>C0(o,k),[o,k]),te=d.exports.useMemo(()=>f.reduce((E,G)=>E+(G.used_traffic||0),0),[f]);return a.length===0?s(pe,{spacing:2,align:"stretch",mt:4,children:[e(u,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(P,{borderWidth:"1px",borderRadius:"md",p:6,children:e(u,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):s(pe,{spacing:4,align:"stretch",children:[s(O,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),s(we,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(at,{value:c!=null?c:"",onChange:E=>h(Number(E.target.value)||null),minW:{md:"220px"},children:a.map(E=>e("option",{value:E.id,children:E.name},E.id))}),e(kn,{value:A0(p),onChange:Z,presets:U,defaultPreset:"30d"})]})]}),e(ms,{title:r("services.usageOverTime","Usage over time"),headerActions:s(O,{fontSize:"sm",color:"gray.500",children:[e(Ya,{}),s(u,{children:[r("services.totalUsage","Total")," ",e(ue.span,{fontWeight:"medium",children:Ke(g.reduce((E,G)=>E+(G.used_traffic||0),0),2)})]})]}),children:W?s(pe,{spacing:3,py:10,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):g.length?e(ps,{type:"area",height:360,options:be,series:M}):e(u,{textAlign:"center",color:"gray.500",children:r("noData")})}),s(ms,{title:e(kt,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(u,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Ya,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),headerActions:e(at,{size:"sm",minW:{md:"200px"},value:K===null?"null":String(K),onChange:E=>{const G=E.target.value;if(G==="null"){y(null);return}const ze=Number(G);y(Number.isNaN(ze)?null:ze)},isDisabled:ee.length===0,children:ee.map(E=>e("option",{value:E.value,children:E.label},E.value))}),children:[e(pe,{align:"start",spacing:1,mb:4,children:s(u,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(ue.span,{fontWeight:"medium",children:Ie||F||"-"})," ",r("services.totalUsage","Total"),":"," ",e(ue.span,{fontWeight:"medium",children:Ke(B||0,2)})]})}),$?s(pe,{spacing:3,py:10,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(I=(ne=J[0])==null?void 0:ne.data)!=null&&I.length?e(ps,{type:"area",height:360,options:N,series:J}):e(u,{textAlign:"center",color:"gray.500",children:r("noData")})]}),e(ms,{title:r("services.adminUsageDistribution","Admin usage distribution"),headerActions:s(O,{fontSize:"sm",color:"gray.500",children:[e(Ya,{}),s(u,{children:[r("services.totalUsage","Total")," ",e(ue.span,{fontWeight:"medium",children:Ke(te,2)})]})]}),children:s(we,{direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(P,{flex:"1",children:le?s(pe,{spacing:3,py:8,children:[e(zt,{}),e(u,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):f.length&&te>0?e(ps,{type:"donut",height:320,options:L,series:A}):e(u,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(pe,{flex:"1",align:"stretch",spacing:2,children:f.length?f.map(E=>{var G;return s(O,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(u,{fontWeight:"medium",children:E.username||r("services.unassignedAdmin","Unassigned")}),e(u,{fontSize:"sm",color:"gray.500",children:Ke(E.used_traffic||0,2)})]},`${(G=E.admin_id)!=null?G:"na"}-${E.username}`)}):e(u,{color:"gray.500",children:r("noData")})})]})})]})},P0=()=>{var l;const{t}=je(),{userData:n,getUserIsSuccess:r}=Dr(),o=Boolean(r&&((l=n.permissions)==null?void 0:l.sections.usage)),a=on(c=>c.services),i=on(c=>c.fetchServices);return d.exports.useEffect(()=>{o&&i({limit:500})},[i,o]),r?o?s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),s(dn,{variant:"enclosed",colorScheme:"primary",children:[s(un,{children:[e(hr,{children:t("usage.tabs.services","Services")}),e(hr,{children:t("usage.tabs.admins","Admins")}),e(hr,{children:t("usage.tabs.nodes","Nodes")})]}),s(hn,{children:[e(pr,{px:0,children:e(I0,{services:a})}),e(pr,{px:0,children:e(x0,{})}),e(pr,{px:0,children:e(_0,{})})]})]})]}):s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(xt,{justify:"center",align:"center",py:10,children:e(zt,{})})},E0=Mu;const Nl=ue(Nu),z0=ue(go,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),T0=ue(vc,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),M0=ue(wc,{baseStyle:{w:5,h:5}}),N0=()=>{const{QRcodeLinks:t,setQRCode:n,setSubLink:r,subscribeUrl:o}=Ot(),a=t!==null,[i,l]=d.exports.useState(0),{t:c}=je(),h=()=>{n(null),r(null)},p=String(o).startsWith("/")?window.location.origin+o:String(o);return s(Gt,{isOpen:a,onClose:h,children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Tt,{pt:6,children:e(En,{color:"primary",children:e(M0,{color:"white"})})}),e(Qt,{mt:3}),t&&s(It,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[o&&s(pe,{children:[e(Nl,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(u,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),s(P,{w:"300px",children:[e(E0,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:l,onInit:()=>l(0),nextArrow:e(qe,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(z0,{})}),prevArrow:e(qe,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(T0,{})}),children:t.map(m=>e(O,{children:e(Nl,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"})},m))}),s(u,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},L0=ue(gs,{baseStyle:{w:5,h:5}}),R0=()=>{const[t,n]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:o}=Ot(),{t:a}=je(),i=cr(),l=()=>{Ot.setState({resetUsageUser:null})},c=()=>{r&&(n(!0),o(r).then(()=>{i({title:a("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:a("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(Gt,{isCentered:!0,isOpen:!!r,onClose:l,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(En,{color:"blue",children:e(L0,{})})}),e(Qt,{mt:3}),s(It,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:a("resetUserUsage.title")}),r&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ea,{components:{b:e("b",{})},children:a("resetUserUsage.prompt",{username:r.username})})})]}),s(Bt,{display:"flex",children:[e(V,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(V,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(zt,{size:"xs"}):void 0,children:a("reset")})]})]})]})},U0=ue(gs,{baseStyle:{w:5,h:5}}),O0=()=>{const[t,n]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:o}=Ot(),{t:a}=je(),i=cr(),l=()=>{Ot.setState({revokeSubscriptionUser:null})},c=()=>{r&&(n(!0),o(r).then(()=>{i({title:a("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:a("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(Gt,{isCentered:!0,isOpen:!!r,onClose:l,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Xt,{mx:"3",children:[e(Tt,{pt:6,children:e(En,{color:"blue",children:e(U0,{})})}),e(Qt,{mt:3}),s(It,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:a("revokeUserSub.title")}),r&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ea,{components:{b:e("b",{})},children:a("revokeUserSub.prompt",{username:r.username})})})]}),s(Bt,{display:"flex",children:[e(V,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(V,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(zt,{size:"xs"}):void 0,children:a("revoke")})]})]})]})},W0=({value:t,onChange:n,placeholder:r="Select date",disabled:o=!1,minDate:a,quickSelects:i=[]})=>{const{isOpen:l,onOpen:c,onClose:h}=sr(),[p,m]=d.exports.useState(()=>t?Ue(t):Ue()),[g,v]=d.exports.useState({hour:t?Ue(t).hour():12,minute:t?Ue(t).minute():0}),b=Fe("white","gray.900"),S=Fe("gray.900","white"),f=Fe("gray.200","gray.700"),w=Fe("gray.50","gray.800"),W=Fe("gray.100","gray.700"),z=Fe("gray.100","gray.700"),le=Fe("gray.500","gray.400"),R=Fe("gray.400","gray.500"),K=Fe("gray.100","gray.700"),y=Fe("gray.200","gray.700"),ae=Fe("gray.600","gray.400"),Se=Fe("primary.500","primary.400");d.exports.useEffect(()=>{t&&(m(Ue(t)),v({hour:Ue(t).hour(),minute:Ue(t).minute()}))},[t]);const ve=()=>{t||(m(Ue()),v({hour:12,minute:0})),h()},T=p.daysInMonth(),F=p.startOf("month").day(),q=Ue(),$=t?Ue(t):null,Q=me=>{const J=p.date(me).hour(g.hour).minute(g.minute).second(0).millisecond(0);a&&J.isBefore(Ue(a),"day")||n(J.toDate())},U=(me,J)=>{if(v({hour:me,minute:J}),t){const N=Ue(t).hour(me).minute(J);n(N.toDate())}},Z=()=>{n(null),m(Ue()),v({hour:12,minute:0}),h()},se=()=>m(p.subtract(1,"month")),M=()=>m(p.add(1,"month")),be=me=>{const N=(t?Ue(t):Ue()).add(me,"day");n(N.toDate())},ee=()=>{const me=[],J=a?Ue(a):null;for(let N=0;N<F;N++)me.push(e(Jr,{},`empty-${N}`));for(let N=1;N<=T;N++){const B=p.date(N),A=B.isSame(q,"day"),k=$==null?void 0:$.isSame(B,"day"),L=J&&B.isBefore(J,"day");me.push(e(Jr,{children:e(V,{size:"xs",variant:"ghost",w:"full",h:"28px",minW:"28px",fontSize:"xs",fontWeight:A?"bold":"normal",bg:k?"primary.500":"transparent",color:k?"white":L?R:"inherit",border:A?"1px solid":"none",borderColor:Se,_hover:{bg:L?"transparent":k?"primary.600":K},onClick:()=>!L&&Q(N),isDisabled:!!L,cursor:L?"not-allowed":"pointer",children:N})},N))}return me},Ie=t?Ue(t).format("YYYY/MM/DD HH:mm"):"";return s(ei,{isOpen:l,onOpen:c,onClose:ve,placement:"bottom-start",isLazy:!0,children:[e(ti,{children:e(Ce,{value:Ie,placeholder:r,size:"sm",isReadOnly:!0,cursor:"pointer",isDisabled:o,onClick:c,bg:"transparent",_dark:{bg:"transparent"}})}),e(Wi,{children:e(ri,{w:"auto",maxW:"min(90vw, 420px)",bg:b,borderColor:f,color:S,_focus:{boxShadow:"none"},children:e(si,{p:0,children:s(xt,{children:[s(pe,{spacing:1,align:"stretch",px:2,py:2,bg:w,minW:"100px",maxW:"110px",borderRight:"1px solid",borderColor:W,flexShrink:0,children:[e(V,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>be(1),_hover:{bg:z},children:"+1 Day"}),e(V,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>be(30),_hover:{bg:z},children:"+1 Month"}),e(V,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>be(90),_hover:{bg:z},children:"+3 Months"}),e(V,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>be(180),_hover:{bg:z},children:"+6 Months"}),e(V,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>be(365),_hover:{bg:z},children:"+1 Year"}),e(V,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>be(1095),_hover:{bg:z},children:"+3 Years"})]}),s(P,{flex:"1",p:2,children:[s(xt,{justify:"space-between",align:"center",mb:2,children:[s(O,{spacing:1,children:[e(qe,{"aria-label":"Previous month",size:"xs",variant:"ghost",icon:e(vc,{width:14,height:14}),onClick:se,_hover:{bg:z}}),e(qe,{"aria-label":"Next month",size:"xs",variant:"ghost",icon:e(go,{width:14,height:14}),onClick:M,_hover:{bg:z}})]}),e(u,{fontSize:"xs",fontWeight:"semibold",children:p.format("MMMM YYYY")})]}),e(An,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:1,children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(me=>e(Jr,{children:e(u,{fontSize:"2xs",textAlign:"center",color:le,fontWeight:"semibold",children:me})},me))}),e(An,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:2,children:ee()}),s(O,{spacing:2,justify:"center",pt:2,borderTop:"1px solid",borderColor:y,children:[e(u,{fontSize:"2xs",color:ae,children:"Time:"}),e(Ce,{type:"number",size:"xs",w:"45px",min:0,max:23,value:g.hour,onChange:me=>{const J=Math.max(0,Math.min(23,parseInt(me.target.value,10)||0));U(J,g.minute)},textAlign:"center",fontSize:"xs"}),e(u,{fontSize:"xs",children:":"}),e(Ce,{type:"number",size:"xs",w:"45px",min:0,max:59,value:g.minute,onChange:me=>{const J=Math.max(0,Math.min(59,parseInt(me.target.value,10)||0));U(g.hour,J)},textAlign:"center",fontSize:"xs"})]}),s(O,{spacing:2,justify:"flex-end",mt:2,children:[e(V,{size:"xs",variant:"ghost",onClick:Z,children:"Clear"}),e(V,{size:"xs",colorScheme:"primary",onClick:ve,children:"Done"})]})]})]})})})})]})},F0=ue(Lu,{baseStyle:{w:5,h:5}}),H0=ue(cn,{baseStyle:{w:5,h:5}}),B0=ue(Kl,{baseStyle:{w:5,h:5}}),V0=ue(Ru,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});ue($i,{baseStyle:{w:4,h:4}});const K0=t=>{var r,o,a,i,l,c,h;const n=(r=t.next_plan)!=null?r:null;return{...t,flow:(o=t.flow)!=null?o:"",data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(a=t.service_id)!=null?a:null,credential_key:(i=t.credential_key)!=null?i:null,manual_key_entry:!1,next_plan_enabled:Boolean(n),next_plan_data_limit:n!=null&&n.data_limit?Number((n.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(l=n==null?void 0:n.expire)!=null?l:null,next_plan_add_remaining_traffic:(c=n==null?void 0:n.add_remaining_traffic)!=null?c:!1,next_plan_fire_on_either:(h=n==null?void 0:n.fire_on_either)!=null?h:!0}},Xa=()=>{const{inbounds:t}=Ot.getState(),n={},r={vless:{id:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}};for(const[o,a]of t.entries())a&&a.length>0&&(n[o]=r[o]||{});return{data_limit:null,ip_limit:null,expire:null,credential_key:null,manual_key_entry:!1,flow:"",username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:n,service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}},$0=/^[0-9a-fA-F]{32}$/,q0=["","xtls-rprx-vision","xtls-rprx-vision-udp443"],Di={username:ye.string().min(1,{message:"Required"}),note:ye.string().nullable(),flow:ye.string().optional().transform(t=>t===""||typeof t>"u"?null:t).refine(t=>t===null||q0.includes(t),"Unsupported flow"),service_id:ye.union([ye.string(),ye.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),proxies:ye.record(ye.string(),ye.record(ye.string(),ye.any())).transform(t=>{const n=(r,o)=>{r&&r[o]===""&&delete r[o]};return n(t.vmess,"id"),n(t.vless,"id"),n(t.trojan,"password"),n(t.shadowsocks,"password"),n(t.shadowsocks,"method"),t}),data_limit:ye.string().min(0).or(ye.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:ye.number().nullable(),data_limit_reset_strategy:ye.string(),inbounds:ye.record(ye.string(),ye.array(ye.string())).transform(t=>(Object.keys(t).forEach(n=>{var r;Array.isArray(t[n])&&!((r=t[n])!=null&&r.length)&&delete t[n]}),t)),next_plan_enabled:ye.boolean().default(!1),next_plan_data_limit:ye.union([ye.string(),ye.number(),ye.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:Math.max(0,n)}),next_plan_expire:ye.union([ye.number(),ye.string(),ye.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),next_plan_add_remaining_traffic:ye.boolean().default(!1),next_plan_fire_on_either:ye.boolean().default(!0),ip_limit:ye.union([ye.number().min(0),ye.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null),manual_key_entry:ye.boolean().default(!1),credential_key:ye.union([ye.string(),ye.null(),ye.undefined()]).transform(t=>{if(!t||typeof t!="string")return null;const n=t.trim();return n===""?null:n}).nullable()},J0=ye.discriminatedUnion("status",[ye.object({status:ye.literal("active"),...Di}),ye.object({status:ye.literal("disabled"),...Di}),ye.object({status:ye.literal("limited"),...Di}),ye.object({status:ye.literal("expired"),...Di}),ye.object({status:ye.literal("on_hold"),on_hold_expire_duration:ye.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...Di})]).superRefine((t,n)=>{if(!t.manual_key_entry)return;const r=t.credential_key;if(!r){n.addIssue({code:ye.ZodIssueCode.custom,path:["credential_key"],message:"Credential key is required when manual entry is enabled."});return}$0.test(r)||n.addIssue({code:ye.ZodIssueCode.custom,path:["credential_key"],message:"Credential key must be a 32-character hexadecimal string."})}),Y0=()=>{var yt,Kt,$t,Ut,ft,et,he,De,tt,tr,xr,es,bs,os,ys,xs,Ss,vs,ws,Gr,ls,ar;const{editingUser:t,isCreatingNewUser:n,onCreateUser:r,editUser:o,fetchUserUsage:a,onEditingUser:i,createUserWithService:l,onDeletingUser:c,users:h,isUserLimitReached:p}=Ot(),m=!!t,g=n||m,v=(yt=h.users_limit)!=null?yt:null,b=(Kt=h.active_total)!=null?Kt:null,S=p&&!m,[f,w]=d.exports.useState(!1),[W,z]=d.exports.useState(""),le=cr(),{t:R}=je(),{colorMode:K}=fs(),y=Es({defaultValues:Xa(),resolver:Da(J0)}),ae=ur({control:y.control,name:"manual_key_entry"}),Se=Boolean(t==null?void 0:t.credential_key),ve=y.getValues("expire"),T=y.getValues("next_plan_expire"),F=d.exports.useCallback(j=>{if(typeof j!="number"||j<=0)return null;const He=Ue.unix(j).utc().local(),ht=Ue(),St=He.diff(ht,"day",!0);return Number.isFinite(St)?Math.max(0,Math.round(St)):null},[]);function q(j){return Ue().add(j,"day").endOf("day").utc().unix()}const[$,Q]=d.exports.useState(()=>F(ve)),[U,Z]=d.exports.useState(()=>F(T)),se=[{label:R("userDialog.quickSelectOneMonth","+1 month"),amount:1,unit:"month"},{label:R("userDialog.quickSelectThreeMonths","+3 months"),amount:3,unit:"month"},{label:R("userDialog.quickSelectOneYear","+1 year"),amount:1,unit:"year"}],M=on(j=>j.services),be=on(j=>j.isLoading),{userData:ee,getUserIsSuccess:Ie}=Dr(),me=Boolean(Ie&&(ee.role===Ye.Sudo||ee.role===Ye.FullAccess)),J=me||Boolean((Ut=($t=ee.permissions)==null?void 0:$t.users)==null?void 0:Ut[nt.SetFlow]),N=me||Boolean((et=(ft=ee.permissions)==null?void 0:ft.users)==null?void 0:et[nt.AllowCustomKey]);me||Boolean((De=(he=ee.permissions)==null?void 0:he.users)==null?void 0:De[nt.Create]);const B=me||Boolean((tr=(tt=ee.permissions)==null?void 0:tt.users)==null?void 0:tr[nt.Delete]),A=me||Boolean((es=(xr=ee.permissions)==null?void 0:xr.users)==null?void 0:es[nt.ResetUsage]),k=me||Boolean((os=(bs=ee.permissions)==null?void 0:bs.users)==null?void 0:os[nt.Revoke]),[L,te]=d.exports.useState(null),Oe=M.length>0,ne=L&&(ys=M.find(j=>j.id===L))!=null?ys:null,I=Boolean(t==null?void 0:t.service_id),E=!me&&M.length===1,G=me||M.length!==1,ze=G&&M.length>0,Ne=!ze,Je=!me&&M.length===0,{data:H}=yr("panel-settings",Ma,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),ke=Boolean(H==null?void 0:H.use_nobetci),[Me,Be]=d.exports.useState(!1),ot=()=>{Be(j=>!j)};d.exports.useEffect(()=>{g&&on.getState().fetchServices()},[g]),d.exports.useEffect(()=>{var j,He;m?t!=null&&t.service_id?te(t.service_id):me?te(null):M.length?te((He=(j=M[0])==null?void 0:j.id)!=null?He:null):te(null):g||te(null)},[m,t,g,me,M]),d.exports.useEffect(()=>{!m&&g&&Oe&&!me&&te(j=>{var He,ht;return(ht=j!=null?j:(He=M[0])==null?void 0:He.id)!=null?ht:null})},[M,m,g,Oe,me]),d.exports.useEffect(()=>{!m&&g&&!Oe&&te(null)},[Oe,m,g]),d.exports.useEffect(()=>{E&&M[0]&&te(j=>j!=null?j:M[0].id)},[E,M]);const[X,Ae]=ur({control:y.control,name:["data_limit","status"]}),xe=ur({control:y.control,name:"next_plan_enabled"}),$e=ur({control:y.control,name:"expire"}),Ze=ur({control:y.control,name:"next_plan_data_limit"}),Vt=ur({control:y.control,name:"next_plan_expire"}),ge=ur({control:y.control,name:"next_plan_add_remaining_traffic"}),Te=ur({control:y.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const j=F($e);Q(He=>He===j?He:j)},[$e,F]),d.exports.useEffect(()=>{const j=F(Vt);Z(He=>He===j?He:j)},[Vt,F]);const Re=j=>{y.setValue("next_plan_enabled",j,{shouldDirty:!0}),j?(y.getValues("next_plan_data_limit")===null&&y.setValue("next_plan_data_limit",0,{shouldDirty:!1}),y.getValues("next_plan_add_remaining_traffic")===void 0&&y.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),y.getValues("next_plan_fire_on_either")===void 0&&y.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(y.setValue("next_plan_data_limit",null,{shouldDirty:!0}),y.setValue("next_plan_expire",null,{shouldDirty:!0}),Z(null))},ut=R("userDialog.total"),[lt,Mt]=d.exports.useState(ka(K,ut)),[er,ie]=d.exports.useState("1m"),st=d.exports.useCallback(j=>{!t||a(t,j).then(He=>{const ht=[],St=[];for(const Ht in He.usages)St.push(He.usages[Ht].used_traffic),ht.push(He.usages[Ht].node_name);Mt(ka(K,ut,St,ht))})},[t,K,ut,a]);d.exports.useEffect(()=>{if(t){const j=K0(t);y.reset(j),Q(F(j.expire)),Z(F(j.next_plan_expire)),st({start:Ue().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const j=Xa();y.reset(j),Q(F(j.expire)),Z(F(j.next_plan_expire))}},[t,F,st,y.reset]),d.exports.useEffect(()=>{N||(y.setValue("manual_key_entry",!1,{shouldDirty:!0}),y.setValue("credential_key",null,{shouldDirty:!0})),J||y.setValue("flow","",{shouldDirty:!1})},[N,J,y]);const Qe=j=>{var _e,Ds;if(S)return;w(!0),z(null);const{service_id:He,next_plan_enabled:ht,next_plan_data_limit:St,next_plan_expire:Ht,next_plan_add_remaining_traffic:Sr,next_plan_fire_on_either:Kr,flow:ks,proxies:Lr,inbounds:Rr,status:dr,data_limit:Ur,data_limit_reset_strategy:cs,on_hold_expire_duration:_s,ip_limit:$r,credential_key:ts,manual_key_entry:Cs,...zs}=j,Ts=ht&&St&&St>0?Number((Number(St)*1073741824).toFixed(5)):0,rs=ht?{data_limit:Ts,expire:Ht!=null?Ht:0,add_remaining_traffic:Sr,fire_on_either:Kr}:null,As=typeof $r=="number"&&Number.isFinite($r)&&$r>0?Math.floor($r):0;if(!m){const vt=me||L!=null?L:E&&(Ds=(_e=M[0])==null?void 0:_e.id)!=null?Ds:null;if(!me&&!vt){z(R("userDialog.selectService","Please choose a service")),w(!1);return}const or={username:j.username,service_id:vt!=null?vt:0,note:j.note,status:j.status==="active"||j.status==="disabled"||j.status==="on_hold"?j.status:"active",expire:j.expire,data_limit:j.data_limit,ip_limit:As,data_limit_reset_strategy:Ur&&Ur>0?cs:"no_reset",on_hold_expire_duration:dr==="on_hold"?_s:null,flow:J&&ks||null};if(N&&Cs&&ts&&(or.credential_key=ts),rs&&(or.next_plan=rs),vt===null||vt===0){const{inbounds:Ct}=Ot.getState(),mr=new Set(Ct.keys()),qt={};if(Lr)for(const[wr,ss]of Object.entries(Lr))mr.has(wr)&&(qt[wr]=ss);const jt={};if(Rr)for(const[wr,ss]of Object.entries(Rr))mr.has(wr)&&(jt[wr]=ss);Object.keys(qt).length>0&&(or.proxies=qt),Object.keys(jt).length>0&&(or.inbounds=jt)}l(or).then(()=>{le({title:R("userDialog.userCreated",{username:j.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Pt()}).catch(Ct=>{var mr,qt,jt,wr,ss;(((mr=Ct==null?void 0:Ct.response)==null?void 0:mr.status)===409||((qt=Ct==null?void 0:Ct.response)==null?void 0:qt.status)===400)&&z((wr=(jt=Ct==null?void 0:Ct.response)==null?void 0:jt._data)==null?void 0:wr.detail),((ss=Ct==null?void 0:Ct.response)==null?void 0:ss.status)===422&&Object.keys(Ct.response._data.detail).forEach(Os=>{z(Ct==null?void 0:Ct.response._data.detail[Os]),y.setError(Os,{type:"custom",message:Ct.response._data.detail[Os]})})}).finally(()=>{w(!1)});return}const Ir={...zs,data_limit:Ur,ip_limit:As,data_limit_reset_strategy:Ur&&Ur>0?cs:"no_reset",status:dr==="active"||dr==="disabled"||dr==="on_hold"?dr:"active",on_hold_expire_duration:dr==="on_hold"?_s:null,flow:J&&ks||null};if(N&&Cs&&ts&&(Ir.credential_key=ts),rs?Ir.next_plan=rs:!ht&&(t==null?void 0:t.next_plan)&&(Ir.next_plan=null),!(t!=null&&t.service_id)){const{inbounds:vt}=Ot.getState(),or=new Set(vt.keys()),Ct={};if(Lr)for(const[qt,jt]of Object.entries(Lr))or.has(qt)&&(Ct[qt]=jt);const mr={};if(Rr)for(const[qt,jt]of Object.entries(Rr))or.has(qt)&&(mr[qt]=jt);Object.keys(Ct).length>0&&(Ir.proxies=Ct),Object.keys(mr).length>0&&(Ir.inbounds=mr)}typeof L<"u"&&(L===null?me&&(Ir.service_id=null):L!==(t==null?void 0:t.service_id)&&(Ir.service_id=L)),o(t==null?void 0:t.username,Ir).then(()=>{le({title:R("userDialog.userEdited",{username:j.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Pt()}).catch(vt=>{var or,Ct,mr,qt,jt;(((or=vt==null?void 0:vt.response)==null?void 0:or.status)===409||((Ct=vt==null?void 0:vt.response)==null?void 0:Ct.status)===400)&&z((qt=(mr=vt==null?void 0:vt.response)==null?void 0:mr._data)==null?void 0:qt.detail),((jt=vt==null?void 0:vt.response)==null?void 0:jt.status)===422&&Object.keys(vt.response._data.detail).forEach(wr=>{z(vt==null?void 0:vt.response._data.detail[wr]),y.setError(wr,{type:"custom",message:vt.response._data.detail[wr]})})}).finally(()=>{w(!1)})},Pt=()=>{y.reset(Xa()),Q(null),Z(null),r(!1),i(null),z(null),Be(!1),ie("1m"),te(null)},Rt=()=>{!A||Ot.setState({resetUsageUser:t!=null?t:null})},Ft=()=>{!k||Ot.setState({revokeSubscriptionUser:t!=null?t:null})},We=f||S,ce=Ae==="on_hold",[Pe,fe]=d.exports.useState(!1),dt=()=>{fe(!0);let j="";const He="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ht=He.length;let St=0;for(;St<6;)j+=He.charAt(Math.floor(Math.random()*ht)),St+=1;return j};return s(Gt,{isOpen:g,onClose:Pt,size:Je?"lg":"2xl",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Uu,{...y,children:s(Xt,{mx:"3",position:"relative",overflow:"hidden",children:[e(Qt,{mt:3,disabled:f}),e(P,{pointerEvents:S?"none":"auto",filter:S?"blur(6px)":"none",transition:"filter 0.2s ease",children:s("form",{onSubmit:y.handleSubmit(Qe),children:[e(Tt,{pt:6,children:s(O,{gap:2,children:[e(En,{color:"primary",children:m?e(H0,{color:"white"}):e(F0,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:R(m?"userDialog.editUserTitle":"createNewUser")})]})}),s(It,{children:[m&&I&&s(Tr,{status:"info",mb:4,borderRadius:"md",children:[e(Mr,{}),R("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(xs=t==null?void 0:t.service_name)!=null?xs:""})]}),s(An,{templateColumns:{base:"repeat(1, 1fr)",md:ze?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...Ne?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(Jr,{children:s(pe,{justifyContent:"space-between",children:[s(xt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(xt,{flexDirection:"row",w:"full",gap:2,children:s(_,{mb:"10px",isInvalid:!!((Ss=y.formState.errors.username)!=null&&Ss.message),children:[e(D,{children:R("username")}),s(O,{align:"flex-end",children:[e(P,{flex:"1",minW:"0",children:s(Ar,{size:"sm",children:[e(Ce,{type:"text",borderRadius:"6px",placeholder:R("username"),isDisabled:We||m,...y.register("username")}),!m&&e(Vr,{width:"auto",pr:1,children:e(qe,{"aria-label":R("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(Cn,{width:18}),onClick:()=>{const j=dt();y.setValue("username",j,{shouldDirty:!0}),setTimeout(()=>{fe(!1)},350)},isLoading:Pe,isDisabled:We})})]})}),m&&e(O,{px:1,children:e(At,{name:"status",control:y.control,render:({field:j})=>e(kt,{placement:"top",label:"status: "+R(`status.${j.value}`),textTransform:"capitalize",children:e(P,{children:e(_t,{colorScheme:"primary",isChecked:j.value==="active",onChange:He=>{He.target.checked?j.onChange("active"):j.onChange("disabled")}})})})})})]}),e(Ps,{children:(vs=y.formState.errors.username)==null?void 0:vs.message})]})}),s(we,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[s(_,{flex:"1",children:[e(D,{children:R("userDialog.dataLimit")}),e(At,{control:y.control,name:"data_limit",render:({field:j})=>{var He;return e(Fr,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",onChange:j.onChange,disabled:We,error:(He=y.formState.errors.data_limit)==null?void 0:He.message,value:j.value?String(j.value):""})}})]}),ke&&s(_,{flex:"1",children:[s(D,{display:"flex",alignItems:"center",gap:2,children:[R("userDialog.ipLimitLabel","IP limit"),e(kt,{hasArrow:!0,placement:"top",label:R("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(ue.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(dc,{width:16,height:16})})})]}),e(At,{control:y.control,name:"ip_limit",rules:{validate:j=>j==null?!0:typeof j!="number"||Number.isNaN(j)?R("userDialog.ipLimitValidation","Enter a valid non-negative number"):j>=0?!0:R("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:j})=>{var He;return e(Fr,{size:"sm",borderRadius:"6px",placeholder:R("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof j.value=="number"&&j.value>0?String(j.value):"",onChange:ht=>{const St=ht.target.value;if(!St.trim()||St.trim()==="-"){j.onChange(null);return}const Ht=Number(St);Number.isNaN(Ht)||j.onChange(Ht<0?0:Math.floor(Ht))},disabled:We,error:(He=y.formState.errors.ip_limit)==null?void 0:He.message})}})]})]}),e($n,{in:!!(X&&X>0),animateOpacity:!0,style:{width:"100%"},children:s(_,{height:"66px",children:[e(D,{children:R("userDialog.periodicUsageReset")}),e(At,{control:y.control,name:"data_limit_reset_strategy",render:({field:j})=>e(at,{size:"sm",...j,disabled:We,bg:We?"gray.100":"transparent",_dark:{bg:We?"gray.600":"transparent"},sx:{option:{backgroundColor:K==="dark"?"#222C3B":"white"}},children:td.map(He=>e("option",{value:He.value,children:R("userDialog.resetStrategy"+He.title)},He.value))})})]})}),s(_,{mb:"10px",isInvalid:!ce&&Boolean(y.formState.errors.expire),children:[s(xt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(D,{mb:0,children:ce?R("userDialog.onHoldExpireDuration"):R("userDialog.expiryDaysLabel","Expires in (days)")}),!m&&e(At,{name:"status",control:y.control,render:({field:j})=>{const He=j.value==="on_hold";return s(O,{spacing:2,align:"center",children:[e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:R("userDialog.onHold")}),e(_t,{colorScheme:"primary",isChecked:He,onChange:ht=>{ht.target.checked?j.onChange("on_hold"):(j.onChange("active"),y.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:We})]})}})]}),ce?e(At,{control:y.control,name:"on_hold_expire_duration",render:({field:j})=>{var He;return e(Fr,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:ht=>{y.setValue("expire",null);const St=ht.target.value;if(!St){j.onChange(null);return}const Ht=Number(St);Number.isNaN(Ht)||Ht<0||j.onChange(Math.round(Ht))},disabled:We,error:(He=y.formState.errors.on_hold_expire_duration)==null?void 0:He.message,value:j.value?String(j.value):""})}}):s(Wt,{children:[e(At,{name:"expire",control:y.control,render:({field:j})=>{const{status:He,time:ht}=Na(j.value),St=j.value?Ue.unix(j.value).toDate():null,Ht=Sr=>{if(!Sr){j.onChange(null),y.setValue("on_hold_expire_duration",null,{shouldDirty:!1});return}const Kr=Ue(Sr).utc().unix();y.setValue("on_hold_expire_duration",null,{shouldDirty:!1}),j.onChange(Kr)};return s(P,{mt:"3px",children:[e(W0,{value:St,onChange:Ht,placeholder:R("userDialog.selectExpiryDate","Select expiration date"),disabled:We,minDate:new Date,quickSelects:se.map(Sr=>({label:Sr.label,onClick:()=>{const Kr=Ue().add(Sr.amount,Sr.unit).endOf("day");Ht(Kr.toDate())}}))}),j.value?e(br,{children:R(He,{time:ht})}):null]})}}),e(Ps,{children:(ws=y.formState.errors.expire)==null?void 0:ws.message})]})]}),s(P,{mb:"10px",children:[s(O,{justify:"space-between",align:"center",children:[e(D,{mb:0,children:R("userDialog.nextPlanTitle","Next plan")}),e(_t,{colorScheme:"primary",isChecked:xe,onChange:j=>Re(j.target.checked),isDisabled:We})]}),e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:R("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e($n,{in:xe,animateOpacity:!0,style:{width:"100%"},children:s(pe,{align:"stretch",spacing:3,mt:3,children:[s(_,{children:[e(D,{fontSize:"sm",children:R("userDialog.nextPlanDataLimit","Next plan data limit")}),e(Fr,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",disabled:We,value:Ze!==null&&typeof Ze<"u"?String(Ze):"",onChange:j=>{const He=j.target.value;if(!He){y.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}!/^[0-9]*\\.?[0-9]*$/.test(He)||y.setValue("next_plan_data_limit",He,{shouldDirty:!0})}})]}),s(_,{children:[e(D,{fontSize:"sm",children:R("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(At,{control:y.control,name:"next_plan_expire",render:({field:j})=>{const He=ht=>{if(!ht){Z(null),j.onChange(null);return}const St=Number(ht);if(Number.isNaN(St)||St<0)return;const Ht=Math.min(Math.round(St),3650);Z(Ht);const Sr=q(Ht);j.onChange(Sr)};return e(Fr,{endAdornment:R("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof U=="number"?String(U):"",onChange:ht=>He(ht.target.value),disabled:We})}})]}),s(O,{justify:"space-between",children:[e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:R("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(_t,{size:"sm",colorScheme:"primary",isChecked:Boolean(ge),onChange:j=>y.setValue("next_plan_add_remaining_traffic",j.target.checked,{shouldDirty:!0}),isDisabled:We})]}),s(O,{justify:"space-between",children:[e(u,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:R("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(_t,{size:"sm",colorScheme:"primary",isChecked:Boolean(Te),onChange:j=>y.setValue("next_plan_fire_on_either",j.target.checked,{shouldDirty:!0}),isDisabled:We})]})]})})]}),s(_,{mb:"10px",isInvalid:!!y.formState.errors.note,children:[e(D,{children:R("userDialog.note")}),e(ns,{...y.register("note")}),e(Ps,{children:(ls=(Gr=y.formState.errors)==null?void 0:Gr.note)==null?void 0:ls.message})]})]}),W&&s(Tr,{status:"error",display:{base:"none",md:"flex"},children:[e(Mr,{}),W]})]})}),G&&e(Jr,{mt:ze?0:4,children:s(_,{isRequired:!me,children:[e(D,{children:R("userDialog.selectServiceLabel","Service")}),!be&&!Oe&&e(P,{w:"full",display:"block",mt:2,mb:4,children:s(Tr,{status:"warning",variant:"subtle",w:"full",px:4,py:3,borderRadius:"md",alignItems:"flex-start",children:[e(Mr,{}),e($s,{children:`${R("userDialog.noServicesAvailable","No services are available yet.")} ${R("userDialog.createServiceToManage","Create a service to manage users.")}`})]})}),be?s(O,{spacing:2,py:4,children:[e(zt,{size:"sm"}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:R("loading")})]}):Oe?s(pe,{align:"stretch",spacing:3,children:[me&&s(P,{role:"button",tabIndex:We?-1:0,"aria-pressed":L===null,onKeyDown:j=>{We||(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),te(null))},onClick:()=>{We||te(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:L===null?"primary.500":"gray.200",bg:L===null?"primary.50":"transparent",cursor:We?"not-allowed":"pointer",pointerEvents:We?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:We?{}:{borderColor:L===null?"primary.500":"gray.300"},_dark:{borderColor:L===null?"primary.400":"gray.700",bg:L===null?"primary.900":"transparent"},children:[e(u,{fontWeight:"semibold",children:R("userDialog.noServiceOption","No service")}),e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:R("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),M.map(j=>{const He=L===j.id,ht=j.broken===!0||j.has_hosts===!1;return e(P,{role:"button",tabIndex:We||ht?-1:0,"aria-pressed":He,onKeyDown:St=>{We||ht||(St.key==="Enter"||St.key===" ")&&(St.preventDefault(),te(j.id))},onClick:()=>{We||ht||te(j.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:He?"primary.500":"gray.200",bg:He?"primary.50":"transparent",cursor:We||ht?"not-allowed":"pointer",pointerEvents:We||ht?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:We?{}:{borderColor:He?"primary.500":"gray.300"},_dark:{borderColor:He?"primary.400":"gray.700",bg:He?"primary.900":"transparent"},children:s(O,{justify:"space-between",align:"flex-start",children:[s(pe,{align:"flex-start",spacing:0,children:[e(u,{fontWeight:"semibold",children:j.name}),j.description&&e(u,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:j.description})]}),e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:R("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:j.host_count,users:j.user_count})}),ht&&e(fr,{colorScheme:"red",mt:1,children:R("userDialog.brokenService","No hosts")})]})},j.id)})]}):null,ne&&s(br,{mt:2,children:[R("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:ne.host_count,users:ne.user_count}),ne&&(ne.broken||ne.has_hosts===!1)&&e(u,{color:"red.500",fontSize:"sm",mt:1,children:R("userDialog.brokenServiceWarning","Selected service has no hosts. Please pick another service.")})]})]})}),J&&e(Jr,{colSpan:{base:1,md:G?2:1},children:s(_,{children:[e(D,{children:R("userDialog.flow.label","Flow")}),e(At,{name:"flow",control:y.control,render:({field:j})=>{var He;return s(at,{size:"sm",value:(He=j.value)!=null?He:"",onChange:ht=>j.onChange(ht.target.value),isDisabled:We,children:[e("option",{value:"",children:R("userDialog.flow.none","None")}),e("option",{value:"xtls-rprx-vision",children:R("userDialog.flow.xtls_rprx_vision","xtls-rprx-vision")}),e("option",{value:"xtls-rprx-vision-udp443",children:R("userDialog.flow.xtls_rprx_vision_udp443","xtls-rprx-vision-udp443")})]})}})]})}),e(Jr,{colSpan:{base:1,md:G?2:1},children:Se&&N&&s(Wt,{children:[s(_,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e(D,{mb:0,children:R("userDialog.allowManualKeyEntry","Custom key")}),e(At,{name:"manual_key_entry",control:y.control,render:({field:j})=>e(_t,{size:"sm",colorScheme:"primary",isChecked:j.value,onChange:He=>j.onChange(He.target.checked),isDisabled:We})})]}),ae&&s(_,{mt:4,isInvalid:Boolean(y.formState.errors.credential_key),children:[e(D,{children:R("userDialog.credentialKeyLabel","Credential key")}),e(At,{name:"credential_key",control:y.control,render:({field:j})=>{var He;return e(Ce,{placeholder:"35e4e39c7d5c4f4b8b71558e4f37ff53",maxLength:32,value:(He=j.value)!=null?He:"",onChange:ht=>j.onChange(ht.target.value),isDisabled:We})}}),e(br,{children:R("userDialog.manualKeyHelper","Enter a 32-character hexadecimal credential key.")}),e(Ps,{children:(ar=y.formState.errors.credential_key)==null?void 0:ar.message})]})]})}),m&&Me&&e(Jr,{pt:6,colSpan:{base:1,md:G?2:1},children:s(pe,{gap:4,children:[e(w0,{defaultValue:er,onChange:(j,He)=>{ie(j),st(He)}}),e(P,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(ps,{options:lt.options,series:lt.series,type:"donut"})})]})})]}),W&&s(Tr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(Mr,{}),W]})]}),e(Bt,{mt:"3",children:s(O,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(O,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:m&&s(Wt,{children:[B&&e(kt,{label:R("delete"),placement:"top",children:e(qe,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),Pt()},children:e(Xi,{})})}),e(kt,{label:R("userDialog.usage"),placement:"top",children:e(qe,{"aria-label":"usage",size:"sm",onClick:ot,children:e(B0,{})})}),A&&e(V,{onClick:Rt,size:"sm",children:R("userDialog.resetUsage")}),k&&e(V,{onClick:Ft,size:"sm",children:R("userDialog.revokeSubscription")})]})}),e(O,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(V,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:f?e(zt,{size:"xs"}):void 0,disabled:We,children:R(m?"userDialog.editUser":"createUser")})})]})})]})}),S&&s(xt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(En,{color:"primary",children:e(V0,{})}),e(u,{fontSize:"xl",fontWeight:"semibold",children:R("userDialog.limitReachedTitle")}),e(u,{fontSize:"md",maxW:"sm",children:v&&v>0?R("userDialog.limitReachedBody",{limit:v,active:b!=null?b:v}):R("userDialog.limitReachedContent")})]})]})})]})},G0=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),X0=t=>{if(!t)return null;const n=new Date(`${t}Z`);return Math.floor(n.getTime()/1e3)},Ll=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=X0(t);return!t||r===null?e(P,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):n-r<=60?e(P,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(P,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Q0=t=>{if(!t)return null;const n=new Date(`${t}Z`);return Math.floor(n.getTime()/1e3)},Rl=({lastOnline:t})=>{const{t:n}=je(),r=Math.floor(Date.now()/1e3),o=Q0(t),a=o?r-o:null,i=o?Na(o):{status:"",time:n("onlineStatus.notConnectedYet","Not Connected Yet")};return e(u,{display:"inline-flex",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},as:"span",gap:1,alignItems:"center",children:a&&a<=60?n("onlineStatus.online","Online"):a&&i.time?s(Wt,{children:[e(P,{as:"span",dir:"ltr",display:"inline-block",style:{unicodeBidi:"embed"},children:i.time}),e(u,{as:"span",children:n("onlineStatus.ago","ago")})]}):i.time})},Qa=({expiryDate:t,status:n,compact:r=!1,showDetail:o=!0,extraText:a})=>{const{t:i}=je(),l=Na(t),c=_n[n].icon;return s(Wt,{children:[s(fr,{colorScheme:_n[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),o&&s(u,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n&&i(`status.${n}`),a&&`: ${a}`]})]}),o&&t&&l.time&&e(u,{display:"inline-flex",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},as:"span",gap:1,alignItems:"center",children:l.status==="expires"?s(Wt,{children:[e(u,{as:"span",children:i("expires").replace("{{time}}","").trim()}),e(P,{as:"span",dir:"ltr",display:"inline",style:{unicodeBidi:"embed"},children:l.time})]}):s(Wt,{children:[e(P,{as:"span",dir:"ltr",display:"inline",style:{unicodeBidi:"embed"},children:l.time}),e(u,{as:"span",children:" "+(i("expired").includes("{{time}}")?i("expired").split("{{time}}")[1]:" \u067E\u06CC\u0634 \u0628\u0647 \u067E\u0627\u06CC\u0627\u0646 \u0631\u0633\u06CC\u062F\u0647")})]})})]})},Z0=ue(G0),ii={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},j0=ue(mo,ii),ef=ue(_a,ii),Ul=ue($i,ii),tf=ue(uc,ii),rf=ue(wc,ii),sf=ue(cn,ii),nf=ue(_a,{baseStyle:{width:"15px",height:"15px"}}),af=ue(Ou,{baseStyle:{width:{base:16,md:20},height:{base:16,md:20}}}),of=t=>{var r;const n=td.find(o=>o.value===t);return(r=n==null?void 0:n.title)!=null?r:"No"},lf=t=>{const{used:n,total:r,dataLimitResetStrategy:o,totalUsedTraffic:a}=t,i=r===0||r===null;return e(O,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:s(u,{children:[Ke(n)," /"," ",i?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ke(r)]})})},Ol=t=>{const{used:n,total:r,dataLimitResetStrategy:o,totalUsedTraffic:a,...i}=t,l=r===0||r===null,c=!l&&n/r*100>=100;return s(Wt,{children:[e(ec,{orientation:"horizontal",value:l?100:Math.min(n/r*100,100),colorScheme:c?"red":"primary",...i,children:e(tc,{h:"6px",borderRadius:"full",children:e(rc,{borderRadius:"full"})})}),s(O,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[s(u,{children:[Xs("usersTable.total"),": ",Ke(a)]}),s(u,{children:[Ke(n)," /"," ",l?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ke(r)+(o&&o!=="no_reset"?" "+Xs("userDialog.resetStrategy"+of(o)):"")]})]})]})},Wn=({sort:t,column:n})=>t.includes(n)?e(nf,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,cf=t=>{var Z,se,M,be,ee,Ie,me,J,N;const{filters:n,users:{users:r,total:o},onEditingUser:a,onFilterChange:i,loading:l}=Ot(),{t:c,i18n:h}=je(),p=h.language==="fa",[m,g]=d.exports.useState(void 0),{className:v,sx:b,...S}=t,f=p?{"& th":{textAlign:"right"},"& td":{textAlign:"right"}}:void 0,w=Array.isArray(b)?Object.assign({},...b):b,W=f?{...f,...w||{}}:w,z=p?Sa(v,"rb-rtl-table"):v,R={...S,className:z,dir:p?"ltr":void 0,sx:W},K=Br({base:!1,md:!0}),{userData:y}=Dr(),ae=y.role===Ye.Sudo||y.role===Ye.FullAccess,Se=Boolean(!ae&&y.status===Ls.Disabled),ve=ae||Boolean((se=(Z=y.permissions)==null?void 0:Z.users)==null?void 0:se[nt.Create]);ae||Boolean((be=(M=y.permissions)==null?void 0:M.users)==null?void 0:be[nt.Delete]),ae||Boolean((Ie=(ee=y.permissions)==null?void 0:ee.users)==null?void 0:Ie[nt.ResetUsage]),ae||Boolean((J=(me=y.permissions)==null?void 0:me.users)==null?void 0:J[nt.Revoke]);const T=y.disabled_reason,F=r.length!==o,q=n.limit||10,$=B=>{let A=n.sort;A.includes(B)?A.startsWith("-")?A="-created_at":A=`-${B}`:A=B,i({sort:A})},Q=B=>{i({status:B.target.value.length>0?B.target.value:void 0})},U=B=>{g(B===m?void 0:B)};return s(P,{position:"relative",w:"full",children:[s(P,{id:"users-table",overflowX:{base:"auto",md:"auto"},w:"full",filter:Se?"blur(4px)":void 0,pointerEvents:Se?"none":void 0,"aria-hidden":Se?!0:void 0,children:[e(bc,{allowMultiple:!0,display:{base:"block",md:"none"},index:m,children:s(Ks,{orientation:"vertical",zIndex:"docked",...R,children:[e(hs,{zIndex:"docked",position:"relative",children:s(Lt,{children:[e(Xe,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:$.bind(null,"username"),children:s(O,{children:[e("span",{children:c("users")}),e(Wn,{sort:n.sort,column:"username"})]})}),e(Xe,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:s(O,{spacing:0,position:"relative",children:[s(u,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),n.status?`: ${n.status}`:""]}),s(at,{value:(N=n.status)!=null?N:"",fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Wt,{}),_focusVisible:{border:"0 !important"},onChange:Q,children:[e("option",{value:""}),e("option",{value:"active",children:"active"}),e("option",{value:"on_hold",children:"on_hold"}),e("option",{value:"disabled",children:"disabled"}),e("option",{value:"limited",children:"limited"}),e("option",{value:"expired",children:"expired"})]})]})}),e(Xe,{minW:"100px",cursor:"pointer",pr:0,onClick:$.bind(null,"used_traffic"),children:s(O,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Wn,{sort:n.sort,column:"used_traffic"})]})}),e(Xe,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),s(as,{children:[!K&&(l?Array.from({length:q},(B,A)=>`skeleton-${A}`).map(B=>s(d.exports.Fragment,{children:[s(Lt,{children:[e(Le,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(Zi,{noOfLines:1,width:"40%"})}),e(Le,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Tn,{height:"16px",width:"64px"})}),e(Le,{borderBottom:0,minW:"100px",pr:0,children:e(Tn,{height:"16px",width:"120px"})}),e(Le,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Tn,{height:"16px",width:"16px"})})]}),e(Lt,{className:"collapsible",children:e(Le,{p:0,colSpan:4,children:e(P,{px:6,py:3,children:e(Zi,{noOfLines:3})})})})]},B)):r==null?void 0:r.map((B,A)=>{var k,L,te;return s(d.exports.Fragment,{children:[s(Lt,{onClick:U.bind(null,A),cursor:"pointer",children:[e(Le,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:s("div",{className:"flex-status",children:[e(Ll,{lastOnline:(k=B.online_at)!=null?k:null}),e(u,{isTruncated:!0,children:B.username})]})}),e(Le,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Qa,{compact:!0,showDetail:!1,expiryDate:B.expire,status:B.status})}),e(Le,{borderBottom:0,minW:"100px",pr:0,children:e(lf,{totalUsedTraffic:B.lifetime_used_traffic,dataLimitResetStrategy:B.data_limit_reset_strategy,used:B.used_traffic,total:B.data_limit,colorScheme:_n[B.status].bandWidthColor})}),e(Le,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(ef,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:m===A?"rotate(180deg)":"0deg"})})]}),e(Lt,{className:"collapsible",onClick:U.bind(null,A),children:e(Le,{p:0,colSpan:4,children:s(yc,{border:0,children:[e(xc,{display:"none"}),e(Sc,{border:0,cursor:"pointer",px:6,py:3,children:s(pe,{justifyContent:"space-between",spacing:"4",children:[s(pe,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(u,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(P,{width:"full",minW:"230px",children:e(Ol,{totalUsedTraffic:B.lifetime_used_traffic,dataLimitResetStrategy:B.data_limit_reset_strategy,used:B.used_traffic,total:B.data_limit,colorScheme:_n[B.status].bandWidthColor})})]}),s(pe,{alignItems:"flex-start",w:"full",spacing:1,children:[e(u,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.service","Service")}),e(u,{fontSize:"sm",color:B.service_name?"gray.700":"gray.500",_dark:{color:B.service_name?"gray.200":"gray.500"},children:(L=B.service_name)!=null?L:c("usersTable.defaultService","Default")})]}),s(O,{w:"full",justifyContent:"space-between",children:[s(P,{width:"full",children:[e(Qa,{compact:!0,expiryDate:B.expire,status:B.status}),e(Rl,{lastOnline:(te=B.online_at)!=null?te:null})]}),s(O,{children:[e(Fl,{user:B}),ve&&e(kt,{label:c("userDialog.editUser"),placement:"top",children:e(qe,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:Oe=>{Oe.stopPropagation(),a(B)},children:e(sf,{})})})]})]})]})})]})})})]},B.username)})),!l&&!K&&r.length===0&&e(Lt,{children:e(Le,{colSpan:4,border:0,children:e(Hl,{isFiltered:F,isCreateDisabled:Se})})})]})]})}),e(P,{overflowX:"auto",w:"full",display:{base:"none",md:"block"},children:s(Ks,{orientation:"vertical",display:{base:"none",md:"table"},minW:{base:"100%",md:"800px"},...R,children:[e(hs,{position:"relative",zIndex:"docked",children:s(Lt,{children:[e(Xe,{minW:"140px",cursor:"pointer",onClick:$.bind(null,"username"),textAlign:p?"right":"left",children:s(O,{direction:p?"row-reverse":"row",justify:p?"flex-end":"flex-start",children:[e("span",{children:c("username")}),e(Wn,{sort:n.sort,column:"username"})]})}),e(Xe,{width:"400px",minW:"150px",cursor:"pointer",textAlign:p?"right":"left",children:s(O,{position:"relative",gap:"5px",direction:p?"row-reverse":"row",children:[p?s(Wt,{children:[s(u,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),n.status?`: ${n.status}`:""]}),e(u,{children:"/"}),e(O,{onClick:$.bind(null,"expire"),children:e(u,{children:c("usersTable.sortByExpire","Sort by expire")})}),e(Wn,{sort:n.sort,column:"expire"})]}):s(Wt,{children:[s(u,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),n.status?`: ${n.status}`:""]}),e(u,{children:"/"}),e(Wn,{sort:n.sort,column:"expire"}),e(O,{onClick:$.bind(null,"expire"),children:e(u,{children:c("usersTable.sortByExpire","Sort by expire")})})]}),s(at,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:p?void 0:"-40px",right:p?"-40px":void 0,border:0,h:"auto",w:"auto",icon:e(Wt,{}),_focusVisible:{border:"0 !important"},value:n.sort,onChange:Q,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Xe,{minW:"150px",textAlign:p?"right":"left",children:e("span",{children:c("usersTable.service","Service")})}),e(Xe,{width:"350px",minW:"230px",cursor:"pointer",onClick:$.bind(null,"used_traffic"),textAlign:p?"right":"left",children:s(O,{direction:p?"row-reverse":"row",justify:p?"flex-end":"flex-start",children:[e("span",{children:c("usersTable.dataUsage")}),e(Wn,{sort:n.sort,column:"used_traffic"})]})}),e(Xe,{width:"200px",minW:"180px","data-actions":"true",textAlign:p?"left":"right"})]})}),s(as,{children:[K&&(l?Array.from({length:q},(B,A)=>`skeleton-desktop-${A}`).map(B=>s(Lt,{children:[e(Le,{minW:"140px",children:e(Zi,{noOfLines:1,width:"40%"})}),e(Le,{width:"400px",minW:"150px",children:e(Tn,{height:"16px",width:"120px"})}),e(Le,{minW:"150px",children:e(Zi,{noOfLines:1,width:"60%"})}),e(Le,{width:"350px",minW:"230px",children:e(Tn,{height:"16px",width:"200px"})}),e(Le,{width:"200px",minW:"180px",children:e(Tn,{height:"16px",width:"64px"})})]},B)):r==null?void 0:r.map((B,A)=>{var k,L,te;return s(Lt,{className:Sa("interactive",{"last-row":A===r.length-1}),onClick:()=>{ve&&a(B)},cursor:ve?"pointer":"default",children:[e(Le,{minW:"140px",textAlign:p?"right":"left",children:s("div",{className:"flex-status",children:[e(Ll,{lastOnline:(k=B.online_at)!=null?k:null}),B.username,e(Rl,{lastOnline:(L=B.online_at)!=null?L:null})]})}),e(Le,{width:"400px",minW:"150px",textAlign:p?"right":"left",children:e(Qa,{expiryDate:B.expire,status:B.status})}),e(Le,{minW:"150px",textAlign:p?"right":"left",children:e(u,{fontSize:"sm",color:B.service_name?"gray.700":"gray.500",_dark:{color:B.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(te=B.service_name)!=null?te:c("usersTable.defaultService","Default")})}),e(Le,{width:"350px",minW:"230px",textAlign:p?"right":"left",children:e(Ol,{totalUsedTraffic:B.lifetime_used_traffic,dataLimitResetStrategy:B.data_limit_reset_strategy,used:B.used_traffic,total:B.data_limit,colorScheme:_n[B.status].bandWidthColor})}),e(Le,{width:"200px",minW:"180px","data-actions":"true",textAlign:p?"left":"right",children:e(Fl,{user:B})})]},B.username)})),!l&&r.length===0&&e(Lt,{children:e(Le,{colSpan:5,children:e(Hl,{isFiltered:F,isCreateDisabled:Se||!ve})})})]})]})})]}),Se&&s(xt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",textAlign:"center",px:6,py:8,bg:"rgba(255, 255, 255, 0.85)",_dark:{bg:"rgba(15, 23, 42, 0.9)"},zIndex:"overlay",children:[e(af,{color:"red.400",mb:6}),e(u,{fontSize:"xl",fontWeight:"bold",mb:3,children:c("usersTable.adminDisabledTitle","Your account is disabled")}),e(u,{maxW:"480px",color:"gray.600",_dark:{color:"gray.200"},children:T||c("usersTable.adminDisabledDescription","Please contact the sudo admin to regain access.")})]})]})},Wl=(t,n)=>{if(t.link_data&&n&&t.status==="active"){const o=[];let a=0;for(const[i,l]of Object.entries(n))for(const c of l){const h=t.link_data;if(h&&a<h.length){const p=h[a];if(p.protocol===i){let m=c;p.uuid?m=m.replace(/{UUID}/g,p.uuid):p.password?m=m.replace(/{PASSWORD}/g,encodeURIComponent(p.password)):p.password_b64&&(m=m.replace(/{PASSWORD_B64}/g,p.password_b64)),o.push(m),a++}}}if(o.length>0)return o}return t.links||[]},Fl=({user:t})=>{const{setQRCode:n,setSubLink:r,linkTemplates:o}=Ot(),i=Wl(t,o).join(`\r
`),c=(m=>m?m.startsWith("/")?window.location.origin+m:m:"")(t.subscription_url),[h,p]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{h[1]&&setTimeout(()=>{p([-1,!1])},1e3)},[h]),s(O,{justifyContent:"flex-end",onClick:m=>{m.preventDefault(),m.stopPropagation()},children:[e(Po,{text:c,onCopy:()=>{p([0,!0])},children:e("div",{children:e(kt,{label:h[0]===0&&h[1]?Xs("usersTable.copied"):Xs("usersTable.copyLink"),placement:"top",children:e(qe,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:h[0]===0&&h[1]?e(Ul,{}):e(tf,{})})})})}),e(Po,{text:i,onCopy:()=>{p([1,!0])},children:e("div",{children:e(kt,{label:h[0]===1&&h[1]?Xs("usersTable.copied"):Xs("usersTable.copyConfigs"),placement:"top",children:e(qe,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:h[0]===1&&h[1]?e(Ul,{}):e(j0,{})})})})}),e(kt,{label:"QR Code",placement:"top",children:e(qe,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{const m=Wl(t,o);n(m),r(c)},children:e(rf,{})})})]})},Hl=({isFiltered:t,isCreateDisabled:n})=>{const{onCreateUser:r}=Ot(),o=()=>{n||r(!0)};return s(P,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Z0,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(u,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Xs("usersTable.noUserMatched"):Xs("usersTable.noUser")}),!t&&!n&&e(V,{size:"sm",colorScheme:"primary",onClick:o,children:Xs("createUser")})]})},df=()=>{const{t}=je();return d.exports.useEffect(()=>{Ot.getState().refetchUsers(),Bi()},[]),s(pe,{spacing:4,align:"stretch",children:[e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Lc,{}),e(cf,{}),e(Rc,{}),e(Y0,{}),e(Wm,{}),e(N0,{}),e(R0,{}),e(O0,{})]})},uf=async()=>{try{const t=wa();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const n=await Ee("/admin",{headers:{Authorization:`Bearer ${t}`}});if(n&&typeof n=="object"&&"error"in n)throw new Error(`API error: ${n.error||"Unknown error"}`);return n}catch(t){throw console.error("Loader error:",t),t}},hf=Wu([{path:"/",element:e(Wh,{}),errorElement:e(pl,{}),loader:uf,children:[{index:!0,element:e(Lm,{})},{path:"users",element:e(df,{})},{path:"admins",element:e($p,{})},{path:"myaccount",element:e(qg,{})},{path:"usage",element:e(P0,{})},{path:"services",element:e(g0,{})},{path:"hosts",element:e(xg,{})},{path:"node-settings",element:e(p0,{})},{path:"integrations",element:e(kg,{})},{path:"xray-settings",element:e(Nm,{})},{path:"xray-logs",element:e(Kc,{})},{path:"access-insights",element:e(Xh,{})}]},{path:"/login/",element:e(pl,{})}]);function pf(){return e(Fu,{router:hf})}Ue.extend(Hu);Ue.extend(Bu);Ue.extend(zn);Ue.extend(Vu);Ue.extend(Ku);Pi($u.get()||"light");qu.createRoot(document.getElementById("root")).render(e(va.StrictMode,{children:e(Ju,{theme:Gu,children:e(Yu,{client:Ii,children:e(pf,{})})})}));
